"use strict";var rb=Object.create;var mf=Object.defineProperty;var ib=Object.getOwnPropertyDescriptor;var ob=Object.getOwnPropertyNames;var sb=Object.getPrototypeOf,ab=Object.prototype.hasOwnProperty;var Qe=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var cb=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ob(t))!ab.call(e,r)&&r!==n&&mf(e,r,{get:()=>t[r],enumerable:!(i=ib(t,r))||i.enumerable});return e};var Bn=(e,t,n)=>(n=e!=null?rb(sb(e)):{},cb(t||!e||!e.__esModule?mf(n,"default",{value:e,enumerable:!0}):n,e));var Ss=Qe(wn=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.thenable=wn.typedArray=wn.stringArray=wn.array=wn.func=wn.error=wn.number=wn.string=wn.boolean=void 0;function ub(e){return e===!0||e===!1}wn.boolean=ub;function kf(e){return typeof e=="string"||e instanceof String}wn.string=kf;function fb(e){return typeof e=="number"||e instanceof Number}wn.number=fb;function db(e){return e instanceof Error}wn.error=db;function vf(e){return typeof e=="function"}wn.func=vf;function Tf(e){return Array.isArray(e)}wn.array=Tf;function pb(e){return Tf(e)&&e.every(t=>kf(t))}wn.stringArray=pb;function hb(e,t){return Array.isArray(e)&&e.every(t)}wn.typedArray=hb;function gb(e){return e&&vf(e.then)}wn.thenable=gb});var ro=Qe(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.stringArray=jn.array=jn.func=jn.error=jn.number=jn.string=jn.boolean=void 0;function mb(e){return e===!0||e===!1}jn.boolean=mb;function wf(e){return typeof e=="string"||e instanceof String}jn.string=wf;function _b(e){return typeof e=="number"||e instanceof Number}jn.number=_b;function bb(e){return e instanceof Error}jn.error=bb;function yb(e){return typeof e=="function"}jn.func=yb;function Rf(e){return Array.isArray(e)}jn.array=Rf;function kb(e){return Rf(e)&&e.every(t=>wf(t))}jn.stringArray=kb});var Zc=Qe(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.Message=st.NotificationType9=st.NotificationType8=st.NotificationType7=st.NotificationType6=st.NotificationType5=st.NotificationType4=st.NotificationType3=st.NotificationType2=st.NotificationType1=st.NotificationType0=st.NotificationType=st.RequestType9=st.RequestType8=st.RequestType7=st.RequestType6=st.RequestType5=st.RequestType4=st.RequestType3=st.RequestType2=st.RequestType1=st.RequestType=st.RequestType0=st.AbstractMessageSignature=st.ParameterStructures=st.ResponseError=st.ErrorCodes=void 0;var Mi=ro(),Dc;(function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.jsonrpcReservedErrorRangeStart=-32099,e.serverErrorStart=-32099,e.MessageWriteError=-32099,e.MessageReadError=-32098,e.PendingResponseRejected=-32097,e.ConnectionInactive=-32096,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.jsonrpcReservedErrorRangeEnd=-32e3,e.serverErrorEnd=-32e3})(Dc||(st.ErrorCodes=Dc={}));var Ac=class e extends Error{constructor(t,n,i){super(n),this.code=Mi.number(t)?t:Dc.UnknownErrorCode,this.data=i,Object.setPrototypeOf(this,e.prototype)}toJson(){let t={code:this.code,message:this.message};return this.data!==void 0&&(t.data=this.data),t}};st.ResponseError=Ac;var zn=class e{constructor(t){this.kind=t}static is(t){return t===e.auto||t===e.byName||t===e.byPosition}toString(){return this.kind}};st.ParameterStructures=zn;zn.auto=new zn("auto");zn.byPosition=new zn("byPosition");zn.byName=new zn("byName");var un=class{constructor(t,n){this.method=t,this.numberOfParams=n}get parameterStructures(){return zn.auto}};st.AbstractMessageSignature=un;var Pc=class extends un{constructor(t){super(t,0)}};st.RequestType0=Pc;var Ec=class extends un{constructor(t,n=zn.auto){super(t,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}};st.RequestType=Ec;var Oc=class extends un{constructor(t,n=zn.auto){super(t,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}};st.RequestType1=Oc;var Nc=class extends un{constructor(t){super(t,2)}};st.RequestType2=Nc;var Lc=class extends un{constructor(t){super(t,3)}};st.RequestType3=Lc;var Mc=class extends un{constructor(t){super(t,4)}};st.RequestType4=Mc;var Ic=class extends un{constructor(t){super(t,5)}};st.RequestType5=Ic;var Fc=class extends un{constructor(t){super(t,6)}};st.RequestType6=Fc;var qc=class extends un{constructor(t){super(t,7)}};st.RequestType7=qc;var jc=class extends un{constructor(t){super(t,8)}};st.RequestType8=jc;var Kc=class extends un{constructor(t){super(t,9)}};st.RequestType9=Kc;var $c=class extends un{constructor(t,n=zn.auto){super(t,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}};st.NotificationType=$c;var Wc=class extends un{constructor(t){super(t,0)}};st.NotificationType0=Wc;var Vc=class extends un{constructor(t,n=zn.auto){super(t,1),this._parameterStructures=n}get parameterStructures(){return this._parameterStructures}};st.NotificationType1=Vc;var Uc=class extends un{constructor(t){super(t,2)}};st.NotificationType2=Uc;var Bc=class extends un{constructor(t){super(t,3)}};st.NotificationType3=Bc;var Hc=class extends un{constructor(t){super(t,4)}};st.NotificationType4=Hc;var zc=class extends un{constructor(t){super(t,5)}};st.NotificationType5=zc;var Gc=class extends un{constructor(t){super(t,6)}};st.NotificationType6=Gc;var Xc=class extends un{constructor(t){super(t,7)}};st.NotificationType7=Xc;var Qc=class extends un{constructor(t){super(t,8)}};st.NotificationType8=Qc;var Jc=class extends un{constructor(t){super(t,9)}};st.NotificationType9=Jc;var xf;(function(e){function t(r){let s=r;return s&&Mi.string(s.method)&&(Mi.string(s.id)||Mi.number(s.id))}e.isRequest=t;function n(r){let s=r;return s&&Mi.string(s.method)&&r.id===void 0}e.isNotification=n;function i(r){let s=r;return s&&(s.result!==void 0||!!s.error)&&(Mi.string(s.id)||Mi.number(s.id)||s.id===null)}e.isResponse=i})(xf||(st.Message=xf={}))});var el=Qe(fi=>{"use strict";var Cf;Object.defineProperty(fi,"__esModule",{value:!0});fi.LRUCache=fi.LinkedMap=fi.Touch=void 0;var Kn;(function(e){e.None=0,e.First=1,e.AsOld=e.First,e.Last=2,e.AsNew=e.Last})(Kn||(fi.Touch=Kn={}));var Ds=class{constructor(){this[Cf]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(t){return this._map.has(t)}get(t,n=Kn.None){let i=this._map.get(t);if(i)return n!==Kn.None&&this.touch(i,n),i.value}set(t,n,i=Kn.None){let r=this._map.get(t);if(r)r.value=n,i!==Kn.None&&this.touch(r,i);else{switch(r={key:t,value:n,next:void 0,previous:void 0},i){case Kn.None:this.addItemLast(r);break;case Kn.First:this.addItemFirst(r);break;case Kn.Last:this.addItemLast(r);break;default:this.addItemLast(r);break}this._map.set(t,r),this._size++}return this}delete(t){return!!this.remove(t)}remove(t){let n=this._map.get(t);if(n)return this._map.delete(t),this.removeItem(n),this._size--,n.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let t=this._head;return this._map.delete(t.key),this.removeItem(t),this._size--,t.value}forEach(t,n){let i=this._state,r=this._head;for(;r;){if(n?t.bind(n)(r.value,r.key,this):t(r.value,r.key,this),this._state!==i)throw new Error("LinkedMap got modified during iteration.");r=r.next}}keys(){let t=this._state,n=this._head,i={[Symbol.iterator]:()=>i,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let r={value:n.key,done:!1};return n=n.next,r}else return{value:void 0,done:!0}}};return i}values(){let t=this._state,n=this._head,i={[Symbol.iterator]:()=>i,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let r={value:n.value,done:!1};return n=n.next,r}else return{value:void 0,done:!0}}};return i}entries(){let t=this._state,n=this._head,i={[Symbol.iterator]:()=>i,next:()=>{if(this._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let r={value:[n.key,n.value],done:!1};return n=n.next,r}else return{value:void 0,done:!0}}};return i}[(Cf=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(t){if(t>=this.size)return;if(t===0){this.clear();return}let n=this._head,i=this.size;for(;n&&i>t;)this._map.delete(n.key),n=n.next,i--;this._head=n,this._size=i,n&&(n.previous=void 0),this._state++}addItemFirst(t){if(!this._head&&!this._tail)this._tail=t;else if(this._head)t.next=this._head,this._head.previous=t;else throw new Error("Invalid list");this._head=t,this._state++}addItemLast(t){if(!this._head&&!this._tail)this._head=t;else if(this._tail)t.previous=this._tail,this._tail.next=t;else throw new Error("Invalid list");this._tail=t,this._state++}removeItem(t){if(t===this._head&&t===this._tail)this._head=void 0,this._tail=void 0;else if(t===this._head){if(!t.next)throw new Error("Invalid list");t.next.previous=void 0,this._head=t.next}else if(t===this._tail){if(!t.previous)throw new Error("Invalid list");t.previous.next=void 0,this._tail=t.previous}else{let n=t.next,i=t.previous;if(!n||!i)throw new Error("Invalid list");n.previous=i,i.next=n}t.next=void 0,t.previous=void 0,this._state++}touch(t,n){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(n!==Kn.First&&n!==Kn.Last)){if(n===Kn.First){if(t===this._head)return;let i=t.next,r=t.previous;t===this._tail?(r.next=void 0,this._tail=r):(i.previous=r,r.next=i),t.previous=void 0,t.next=this._head,this._head.previous=t,this._head=t,this._state++}else if(n===Kn.Last){if(t===this._tail)return;let i=t.next,r=t.previous;t===this._head?(i.previous=void 0,this._head=i):(i.previous=r,r.next=i),t.next=void 0,t.previous=this._tail,this._tail.next=t,this._tail=t,this._state++}}}toJSON(){let t=[];return this.forEach((n,i)=>{t.push([i,n])}),t}fromJSON(t){this.clear();for(let[n,i]of t)this.set(n,i)}};fi.LinkedMap=Ds;var Yc=class extends Ds{constructor(t,n=1){super(),this._limit=t,this._ratio=Math.min(Math.max(0,n),1)}get limit(){return this._limit}set limit(t){this._limit=t,this.checkTrim()}get ratio(){return this._ratio}set ratio(t){this._ratio=Math.min(Math.max(0,t),1),this.checkTrim()}get(t,n=Kn.AsNew){return super.get(t,n)}peek(t){return super.get(t,Kn.None)}set(t,n){return super.set(t,n,Kn.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};fi.LRUCache=Yc});var Df=Qe(As=>{"use strict";Object.defineProperty(As,"__esModule",{value:!0});As.Disposable=void 0;var Sf;(function(e){function t(n){return{dispose:n}}e.create=t})(Sf||(As.Disposable=Sf={}))});var di=Qe(rl=>{"use strict";Object.defineProperty(rl,"__esModule",{value:!0});var tl;function nl(){if(tl===void 0)throw new Error("No runtime abstraction layer installed");return tl}(function(e){function t(n){if(n===void 0)throw new Error("No runtime abstraction layer provided");tl=n}e.install=t})(nl||(nl={}));rl.default=nl});var oo=Qe(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.Emitter=io.Event=void 0;var vb=di(),Af;(function(e){let t={dispose(){}};e.None=function(){return t}})(Af||(io.Event=Af={}));var il=class{add(t,n=null,i){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(t),this._contexts.push(n),Array.isArray(i)&&i.push({dispose:()=>this.remove(t,n)})}remove(t,n=null){if(!this._callbacks)return;let i=!1;for(let r=0,s=this._callbacks.length;r<s;r++)if(this._callbacks[r]===t)if(this._contexts[r]===n){this._callbacks.splice(r,1),this._contexts.splice(r,1);return}else i=!0;if(i)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...t){if(!this._callbacks)return[];let n=[],i=this._callbacks.slice(0),r=this._contexts.slice(0);for(let s=0,a=i.length;s<a;s++)try{n.push(i[s].apply(r[s],t))}catch(c){(0,vb.default)().console.error(c)}return n}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},Ps=class e{constructor(t){this._options=t}get event(){return this._event||(this._event=(t,n,i)=>{this._callbacks||(this._callbacks=new il),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(t,n);let r={dispose:()=>{this._callbacks&&(this._callbacks.remove(t,n),r.dispose=e._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(i)&&i.push(r),r}),this._event}fire(t){this._callbacks&&this._callbacks.invoke.call(this._callbacks,t)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};io.Emitter=Ps;Ps._noop=function(){}});var Ns=Qe(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.CancellationTokenSource=so.CancellationToken=void 0;var Tb=di(),wb=ro(),ol=oo(),Es;(function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:ol.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:ol.Event.None});function t(n){let i=n;return i&&(i===e.None||i===e.Cancelled||wb.boolean(i.isCancellationRequested)&&!!i.onCancellationRequested)}e.is=t})(Es||(so.CancellationToken=Es={}));var Rb=Object.freeze(function(e,t){let n=(0,Tb.default)().timer.setTimeout(e.bind(t),0);return{dispose(){n.dispose()}}}),Os=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Rb:(this._emitter||(this._emitter=new ol.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},sl=class{get token(){return this._token||(this._token=new Os),this._token}cancel(){this._token?this._token.cancel():this._token=Es.Cancelled}dispose(){this._token?this._token instanceof Os&&this._token.dispose():this._token=Es.None}};so.CancellationTokenSource=sl});var Pf=Qe(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.SharedArrayReceiverStrategy=ao.SharedArraySenderStrategy=void 0;var xb=Ns(),Uo;(function(e){e.Continue=0,e.Cancelled=1})(Uo||(Uo={}));var al=class{constructor(){this.buffers=new Map}enableCancellation(t){if(t.id===null)return;let n=new SharedArrayBuffer(4),i=new Int32Array(n,0,1);i[0]=Uo.Continue,this.buffers.set(t.id,n),t.$cancellationData=n}async sendCancellation(t,n){let i=this.buffers.get(n);if(i===void 0)return;let r=new Int32Array(i,0,1);Atomics.store(r,0,Uo.Cancelled)}cleanup(t){this.buffers.delete(t)}dispose(){this.buffers.clear()}};ao.SharedArraySenderStrategy=al;var cl=class{constructor(t){this.data=new Int32Array(t,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===Uo.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},ll=class{constructor(t){this.token=new cl(t)}cancel(){}dispose(){}},ul=class{constructor(){this.kind="request"}createCancellationTokenSource(t){let n=t.$cancellationData;return n===void 0?new xb.CancellationTokenSource:new ll(n)}};ao.SharedArrayReceiverStrategy=ul});var dl=Qe(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0});Ls.Semaphore=void 0;var Cb=di(),fl=class{constructor(t=1){if(t<=0)throw new Error("Capacity must be greater than 0");this._capacity=t,this._active=0,this._waiting=[]}lock(t){return new Promise((n,i)=>{this._waiting.push({thunk:t,resolve:n,reject:i}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Cb.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let t=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let n=t.thunk();n instanceof Promise?n.then(i=>{this._active--,t.resolve(i),this.runNext()},i=>{this._active--,t.reject(i),this.runNext()}):(this._active--,t.resolve(n),this.runNext())}catch(n){this._active--,t.reject(n),this.runNext()}}};Ls.Semaphore=fl});var Of=Qe(pi=>{"use strict";Object.defineProperty(pi,"__esModule",{value:!0});pi.ReadableStreamMessageReader=pi.AbstractMessageReader=pi.MessageReader=void 0;var hl=di(),co=ro(),pl=oo(),Sb=dl(),Ef;(function(e){function t(n){let i=n;return i&&co.func(i.listen)&&co.func(i.dispose)&&co.func(i.onError)&&co.func(i.onClose)&&co.func(i.onPartialMessage)}e.is=t})(Ef||(pi.MessageReader=Ef={}));var Ms=class{constructor(){this.errorEmitter=new pl.Emitter,this.closeEmitter=new pl.Emitter,this.partialMessageEmitter=new pl.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(t){this.errorEmitter.fire(this.asError(t))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(t){this.partialMessageEmitter.fire(t)}asError(t){return t instanceof Error?t:new Error(`Reader received error. Reason: ${co.string(t.message)?t.message:"unknown"}`)}};pi.AbstractMessageReader=Ms;var gl;(function(e){function t(n){let i,r,s,a=new Map,c,p=new Map;if(n===void 0||typeof n=="string")i=n??"utf-8";else{if(i=n.charset??"utf-8",n.contentDecoder!==void 0&&(s=n.contentDecoder,a.set(s.name,s)),n.contentDecoders!==void 0)for(let f of n.contentDecoders)a.set(f.name,f);if(n.contentTypeDecoder!==void 0&&(c=n.contentTypeDecoder,p.set(c.name,c)),n.contentTypeDecoders!==void 0)for(let f of n.contentTypeDecoders)p.set(f.name,f)}return c===void 0&&(c=(0,hl.default)().applicationJson.decoder,p.set(c.name,c)),{charset:i,contentDecoder:s,contentDecoders:a,contentTypeDecoder:c,contentTypeDecoders:p}}e.fromOptions=t})(gl||(gl={}));var ml=class extends Ms{constructor(t,n){super(),this.readable=t,this.options=gl.fromOptions(n),this.buffer=(0,hl.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new Sb.Semaphore(1)}set partialMessageTimeout(t){this._partialMessageTimeout=t}get partialMessageTimeout(){return this._partialMessageTimeout}listen(t){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=t;let n=this.readable.onData(i=>{this.onData(i)});return this.readable.onError(i=>this.fireError(i)),this.readable.onClose(()=>this.fireClose()),n}onData(t){try{for(this.buffer.append(t);;){if(this.nextMessageLength===-1){let i=this.buffer.tryReadHeaders(!0);if(!i)return;let r=i.get("content-length");if(!r){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(i))}`));return}let s=parseInt(r);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${r}`));return}this.nextMessageLength=s}let n=this.buffer.tryReadBody(this.nextMessageLength);if(n===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let i=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(n):n,r=await this.options.contentTypeDecoder.decode(i,this.options);this.callback(r)}).catch(i=>{this.fireError(i)})}}catch(n){this.fireError(n)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,hl.default)().timer.setTimeout((t,n)=>{this.partialMessageTimer=void 0,t===this.messageToken&&(this.firePartialMessage({messageToken:t,waitingTime:n}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};pi.ReadableStreamMessageReader=ml});var Ff=Qe(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.WriteableStreamMessageWriter=hi.AbstractMessageWriter=hi.MessageWriter=void 0;var Nf=di(),Bo=ro(),Db=dl(),Lf=oo(),Ab="Content-Length: ",Mf=`\r
`,If;(function(e){function t(n){let i=n;return i&&Bo.func(i.dispose)&&Bo.func(i.onClose)&&Bo.func(i.onError)&&Bo.func(i.write)}e.is=t})(If||(hi.MessageWriter=If={}));var Is=class{constructor(){this.errorEmitter=new Lf.Emitter,this.closeEmitter=new Lf.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(t,n,i){this.errorEmitter.fire([this.asError(t),n,i])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(t){return t instanceof Error?t:new Error(`Writer received error. Reason: ${Bo.string(t.message)?t.message:"unknown"}`)}};hi.AbstractMessageWriter=Is;var _l;(function(e){function t(n){return n===void 0||typeof n=="string"?{charset:n??"utf-8",contentTypeEncoder:(0,Nf.default)().applicationJson.encoder}:{charset:n.charset??"utf-8",contentEncoder:n.contentEncoder,contentTypeEncoder:n.contentTypeEncoder??(0,Nf.default)().applicationJson.encoder}}e.fromOptions=t})(_l||(_l={}));var bl=class extends Is{constructor(t,n){super(),this.writable=t,this.options=_l.fromOptions(n),this.errorCount=0,this.writeSemaphore=new Db.Semaphore(1),this.writable.onError(i=>this.fireError(i)),this.writable.onClose(()=>this.fireClose())}async write(t){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(t,this.options).then(i=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(i):i).then(i=>{let r=[];return r.push(Ab,i.byteLength.toString(),Mf),r.push(Mf),this.doWrite(t,r,i)},i=>{throw this.fireError(i),i}))}async doWrite(t,n,i){try{return await this.writable.write(n.join(""),"ascii"),this.writable.write(i)}catch(r){return this.handleError(r,t),Promise.reject(r)}}handleError(t,n){this.errorCount++,this.fireError(t,n,this.errorCount)}end(){this.writable.end()}};hi.WriteableStreamMessageWriter=bl});var qf=Qe(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.AbstractMessageBuffer=void 0;var Pb=13,Eb=10,Ob=`\r
`,yl=class{constructor(t="utf-8"){this._encoding=t,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(t){let n=typeof t=="string"?this.fromString(t,this._encoding):t;this._chunks.push(n),this._totalLength+=n.byteLength}tryReadHeaders(t=!1){if(this._chunks.length===0)return;let n=0,i=0,r=0,s=0;e:for(;i<this._chunks.length;){let f=this._chunks[i];for(r=0;r<f.length;){switch(f[r]){case Pb:switch(n){case 0:n=1;break;case 2:n=3;break;default:n=0}break;case Eb:switch(n){case 1:n=2;break;case 3:n=4,r++;break e;default:n=0}break;default:n=0}r++}s+=f.byteLength,i++}if(n!==4)return;let a=this._read(s+r),c=new Map,p=this.toString(a,"ascii").split(Ob);if(p.length<2)return c;for(let f=0;f<p.length-2;f++){let l=p[f],b=l.indexOf(":");if(b===-1)throw new Error(`Message header must separate key and value using ':'
${l}`);let v=l.substr(0,b),d=l.substr(b+1).trim();c.set(t?v.toLowerCase():v,d)}return c}tryReadBody(t){if(!(this._totalLength<t))return this._read(t)}get numberOfBytes(){return this._totalLength}_read(t){if(t===0)return this.emptyBuffer();if(t>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===t){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=t,this.asNative(s)}if(this._chunks[0].byteLength>t){let s=this._chunks[0],a=this.asNative(s,t);return this._chunks[0]=s.slice(t),this._totalLength-=t,a}let n=this.allocNative(t),i=0,r=0;for(;t>0;){let s=this._chunks[r];if(s.byteLength>t){let a=s.slice(0,t);n.set(a,i),i+=t,this._chunks[r]=s.slice(t),this._totalLength-=t,t-=t}else n.set(s,i),i+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,t-=s.byteLength}return n}};Fs.AbstractMessageBuffer=yl});var Vf=Qe(At=>{"use strict";Object.defineProperty(At,"__esModule",{value:!0});At.createMessageConnection=At.ConnectionOptions=At.MessageStrategy=At.CancellationStrategy=At.CancellationSenderStrategy=At.CancellationReceiverStrategy=At.RequestCancellationReceiverStrategy=At.IdCancellationReceiverStrategy=At.ConnectionStrategy=At.ConnectionError=At.ConnectionErrors=At.LogTraceNotification=At.SetTraceNotification=At.TraceFormat=At.TraceValues=At.Trace=At.NullLogger=At.ProgressType=At.ProgressToken=void 0;var jf=di(),mn=ro(),mt=Zc(),Kf=el(),Ho=oo(),kl=Ns(),Xo;(function(e){e.type=new mt.NotificationType("$/cancelRequest")})(Xo||(Xo={}));var vl;(function(e){function t(n){return typeof n=="string"||typeof n=="number"}e.is=t})(vl||(At.ProgressToken=vl={}));var zo;(function(e){e.type=new mt.NotificationType("$/progress")})(zo||(zo={}));var Tl=class{constructor(){}};At.ProgressType=Tl;var wl;(function(e){function t(n){return mn.func(n)}e.is=t})(wl||(wl={}));At.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var Gt;(function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Compact=2]="Compact",e[e.Verbose=3]="Verbose"})(Gt||(At.Trace=Gt={}));var $f;(function(e){e.Off="off",e.Messages="messages",e.Compact="compact",e.Verbose="verbose"})($f||(At.TraceValues=$f={}));(function(e){function t(i){if(!mn.string(i))return e.Off;switch(i=i.toLowerCase(),i){case"off":return e.Off;case"messages":return e.Messages;case"compact":return e.Compact;case"verbose":return e.Verbose;default:return e.Off}}e.fromString=t;function n(i){switch(i){case e.Off:return"off";case e.Messages:return"messages";case e.Compact:return"compact";case e.Verbose:return"verbose";default:return"off"}}e.toString=n})(Gt||(At.Trace=Gt={}));var nr;(function(e){e.Text="text",e.JSON="json"})(nr||(At.TraceFormat=nr={}));(function(e){function t(n){return mn.string(n)?(n=n.toLowerCase(),n==="json"?e.JSON:e.Text):e.Text}e.fromString=t})(nr||(At.TraceFormat=nr={}));var Rl;(function(e){e.type=new mt.NotificationType("$/setTrace")})(Rl||(At.SetTraceNotification=Rl={}));var qs;(function(e){e.type=new mt.NotificationType("$/logTrace")})(qs||(At.LogTraceNotification=qs={}));var Go;(function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"})(Go||(At.ConnectionErrors=Go={}));var lo=class e extends Error{constructor(t,n){super(n),this.code=t,Object.setPrototypeOf(this,e.prototype)}};At.ConnectionError=lo;var xl;(function(e){function t(n){let i=n;return i&&mn.func(i.cancelUndispatched)}e.is=t})(xl||(At.ConnectionStrategy=xl={}));var js;(function(e){function t(n){let i=n;return i&&(i.kind===void 0||i.kind==="id")&&mn.func(i.createCancellationTokenSource)&&(i.dispose===void 0||mn.func(i.dispose))}e.is=t})(js||(At.IdCancellationReceiverStrategy=js={}));var Cl;(function(e){function t(n){let i=n;return i&&i.kind==="request"&&mn.func(i.createCancellationTokenSource)&&(i.dispose===void 0||mn.func(i.dispose))}e.is=t})(Cl||(At.RequestCancellationReceiverStrategy=Cl={}));var Ks;(function(e){e.Message=Object.freeze({createCancellationTokenSource(n){return new kl.CancellationTokenSource}});function t(n){return js.is(n)||Cl.is(n)}e.is=t})(Ks||(At.CancellationReceiverStrategy=Ks={}));var $s;(function(e){e.Message=Object.freeze({sendCancellation(n,i){return n.sendNotification(Xo.type,{id:i})},cleanup(n){}});function t(n){let i=n;return i&&mn.func(i.sendCancellation)&&mn.func(i.cleanup)}e.is=t})($s||(At.CancellationSenderStrategy=$s={}));var Ws;(function(e){e.Message=Object.freeze({receiver:Ks.Message,sender:$s.Message});function t(n){let i=n;return i&&Ks.is(i.receiver)&&$s.is(i.sender)}e.is=t})(Ws||(At.CancellationStrategy=Ws={}));var Vs;(function(e){function t(n){let i=n;return i&&mn.func(i.handleMessage)}e.is=t})(Vs||(At.MessageStrategy=Vs={}));var Wf;(function(e){function t(n){let i=n;return i&&(Ws.is(i.cancellationStrategy)||xl.is(i.connectionStrategy)||Vs.is(i.messageStrategy))}e.is=t})(Wf||(At.ConnectionOptions=Wf={}));var Pr;(function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"})(Pr||(Pr={}));function Nb(e,t,n,i){let r=n!==void 0?n:At.NullLogger,s=0,a=0,c=0,p="2.0",f,l=new Map,b,v=new Map,d=new Map,w,D=new Kf.LinkedMap,$=new Map,C=new Set,g=new Map,y=Gt.Off,u=nr.Text,B,h=Pr.New,le=new Ho.Emitter,ge=new Ho.Emitter,Ne=new Ho.Emitter,Re=new Ho.Emitter,W=new Ho.Emitter,U=i&&i.cancellationStrategy?i.cancellationStrategy:Ws.Message;function Ke(O){if(O===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+O.toString()}function ye(O){return O===null?"res-unknown-"+(++c).toString():"res-"+O.toString()}function ct(){return"not-"+(++a).toString()}function De(O,re){mt.Message.isRequest(re)?O.set(Ke(re.id),re):mt.Message.isResponse(re)?O.set(ye(re.id),re):O.set(ct(),re)}function S(O){}function Et(){return h===Pr.Listening}function Lt(){return h===Pr.Closed}function Pe(){return h===Pr.Disposed}function rn(){(h===Pr.New||h===Pr.Listening)&&(h=Pr.Closed,ge.fire(void 0))}function yn(O){le.fire([O,void 0,void 0])}function en(O){le.fire(O)}e.onClose(rn),e.onError(yn),t.onClose(rn),t.onError(en);function Fe(){w||D.size===0||(w=(0,jf.default)().timer.setImmediate(()=>{w=void 0,Rt()}))}function ut(O){mt.Message.isRequest(O)?rt(O):mt.Message.isNotification(O)?Je(O):mt.Message.isResponse(O)?on(O):Sn(O)}function Rt(){if(D.size===0)return;let O=D.shift();try{let re=i?.messageStrategy;Vs.is(re)?re.handleMessage(O,ut):ut(O)}finally{Fe()}}let Bt=O=>{try{if(mt.Message.isNotification(O)&&O.method===Xo.type.method){let re=O.params.id,ae=Ke(re),xe=D.get(ae);if(mt.Message.isRequest(xe)){let Pt=i?.connectionStrategy,_t=Pt&&Pt.cancelUndispatched?Pt.cancelUndispatched(xe,S):void 0;if(_t&&(_t.error!==void 0||_t.result!==void 0)){D.delete(ae),g.delete(re),_t.id=xe.id,Ae(_t,O.method,Date.now()),t.write(_t).catch(()=>r.error("Sending response for canceled message failed."));return}}let yt=g.get(re);if(yt!==void 0){yt.cancel(),ht(O);return}else C.add(re)}De(D,O)}finally{Fe()}};function rt(O){if(Pe())return;function re(lt,qt,It){let tn={jsonrpc:p,id:O.id};lt instanceof mt.ResponseError?tn.error=lt.toJson():tn.result=lt===void 0?null:lt,Ae(tn,qt,It),t.write(tn).catch(()=>r.error("Sending response failed."))}function ae(lt,qt,It){let tn={jsonrpc:p,id:O.id,error:lt.toJson()};Ae(tn,qt,It),t.write(tn).catch(()=>r.error("Sending response failed."))}function xe(lt,qt,It){lt===void 0&&(lt=null);let tn={jsonrpc:p,id:O.id,result:lt};Ae(tn,qt,It),t.write(tn).catch(()=>r.error("Sending response failed."))}bt(O);let yt=l.get(O.method),Pt,_t;yt&&(Pt=yt.type,_t=yt.handler);let Ze=Date.now();if(_t||f){let lt=O.id??String(Date.now()),qt=js.is(U.receiver)?U.receiver.createCancellationTokenSource(lt):U.receiver.createCancellationTokenSource(O);O.id!==null&&C.has(O.id)&&qt.cancel(),O.id!==null&&g.set(lt,qt);try{let It;if(_t)if(O.params===void 0){if(Pt!==void 0&&Pt.numberOfParams!==0){ae(new mt.ResponseError(mt.ErrorCodes.InvalidParams,`Request ${O.method} defines ${Pt.numberOfParams} params but received none.`),O.method,Ze);return}It=_t(qt.token)}else if(Array.isArray(O.params)){if(Pt!==void 0&&Pt.parameterStructures===mt.ParameterStructures.byName){ae(new mt.ResponseError(mt.ErrorCodes.InvalidParams,`Request ${O.method} defines parameters by name but received parameters by position`),O.method,Ze);return}It=_t(...O.params,qt.token)}else{if(Pt!==void 0&&Pt.parameterStructures===mt.ParameterStructures.byPosition){ae(new mt.ResponseError(mt.ErrorCodes.InvalidParams,`Request ${O.method} defines parameters by position but received parameters by name`),O.method,Ze);return}It=_t(O.params,qt.token)}else f&&(It=f(O.method,O.params,qt.token));let tn=It;It?tn.then?tn.then(Ot=>{g.delete(lt),re(Ot,O.method,Ze)},Ot=>{g.delete(lt),Ot instanceof mt.ResponseError?ae(Ot,O.method,Ze):Ot&&mn.string(Ot.message)?ae(new mt.ResponseError(mt.ErrorCodes.InternalError,`Request ${O.method} failed with message: ${Ot.message}`),O.method,Ze):ae(new mt.ResponseError(mt.ErrorCodes.InternalError,`Request ${O.method} failed unexpectedly without providing any details.`),O.method,Ze)}):(g.delete(lt),re(It,O.method,Ze)):(g.delete(lt),xe(It,O.method,Ze))}catch(It){g.delete(lt),It instanceof mt.ResponseError?re(It,O.method,Ze):It&&mn.string(It.message)?ae(new mt.ResponseError(mt.ErrorCodes.InternalError,`Request ${O.method} failed with message: ${It.message}`),O.method,Ze):ae(new mt.ResponseError(mt.ErrorCodes.InternalError,`Request ${O.method} failed unexpectedly without providing any details.`),O.method,Ze)}}else ae(new mt.ResponseError(mt.ErrorCodes.MethodNotFound,`Unhandled method ${O.method}`),O.method,Ze)}function on(O){if(!Pe())if(O.id===null)O.error?r.error(`Received response message without id: Error is: 
${JSON.stringify(O.error,void 0,4)}`):r.error("Received response message without id. No further error information provided.");else{let re=O.id,ae=$.get(re);if(Vt(O,ae),ae!==void 0){$.delete(re);try{if(O.error){let xe=O.error;ae.reject(new mt.ResponseError(xe.code,xe.message,xe.data))}else if(O.result!==void 0)ae.resolve(O.result);else throw new Error("Should never happen.")}catch(xe){xe.message?r.error(`Response handler '${ae.method}' failed with message: ${xe.message}`):r.error(`Response handler '${ae.method}' failed unexpectedly.`)}}}}function Je(O){if(Pe())return;let re,ae;if(O.method===Xo.type.method){let xe=O.params.id;C.delete(xe),ht(O);return}else{let xe=v.get(O.method);xe&&(ae=xe.handler,re=xe.type)}if(ae||b)try{if(ht(O),ae)if(O.params===void 0)re!==void 0&&re.numberOfParams!==0&&re.parameterStructures!==mt.ParameterStructures.byName&&r.error(`Notification ${O.method} defines ${re.numberOfParams} params but received none.`),ae();else if(Array.isArray(O.params)){let xe=O.params;O.method===zo.type.method&&xe.length===2&&vl.is(xe[0])?ae({token:xe[0],value:xe[1]}):(re!==void 0&&(re.parameterStructures===mt.ParameterStructures.byName&&r.error(`Notification ${O.method} defines parameters by name but received parameters by position`),re.numberOfParams!==O.params.length&&r.error(`Notification ${O.method} defines ${re.numberOfParams} params but received ${xe.length} arguments`)),ae(...xe))}else re!==void 0&&re.parameterStructures===mt.ParameterStructures.byPosition&&r.error(`Notification ${O.method} defines parameters by position but received parameters by name`),ae(O.params);else b&&b(O.method,O.params)}catch(xe){xe.message?r.error(`Notification handler '${O.method}' failed with message: ${xe.message}`):r.error(`Notification handler '${O.method}' failed unexpectedly.`)}else Ne.fire(O)}function Sn(O){if(!O){r.error("Received empty message.");return}r.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(O,null,4)}`);let re=O;if(mn.string(re.id)||mn.number(re.id)){let ae=re.id,xe=$.get(ae);xe&&xe.reject(new Error("The received response has neither a result nor an error property."))}}function Q(O){if(O!=null)switch(y){case Gt.Verbose:return JSON.stringify(O,null,4);case Gt.Compact:return JSON.stringify(O);default:return}}function ve(O){if(!(y===Gt.Off||!B))if(u===nr.Text){let re;(y===Gt.Verbose||y===Gt.Compact)&&O.params&&(re=`Params: ${Q(O.params)}

`),B.log(`Sending request '${O.method} - (${O.id})'.`,re)}else it("send-request",O)}function ze(O){if(!(y===Gt.Off||!B))if(u===nr.Text){let re;(y===Gt.Verbose||y===Gt.Compact)&&(O.params?re=`Params: ${Q(O.params)}

`:re=`No parameters provided.

`),B.log(`Sending notification '${O.method}'.`,re)}else it("send-notification",O)}function Ae(O,re,ae){if(!(y===Gt.Off||!B))if(u===nr.Text){let xe;(y===Gt.Verbose||y===Gt.Compact)&&(O.error&&O.error.data?xe=`Error data: ${Q(O.error.data)}

`:O.result?xe=`Result: ${Q(O.result)}

`:O.error===void 0&&(xe=`No result returned.

`)),B.log(`Sending response '${re} - (${O.id})'. Processing request took ${Date.now()-ae}ms`,xe)}else it("send-response",O)}function bt(O){if(!(y===Gt.Off||!B))if(u===nr.Text){let re;(y===Gt.Verbose||y===Gt.Compact)&&O.params&&(re=`Params: ${Q(O.params)}

`),B.log(`Received request '${O.method} - (${O.id})'.`,re)}else it("receive-request",O)}function ht(O){if(!(y===Gt.Off||!B||O.method===qs.type.method))if(u===nr.Text){let re;(y===Gt.Verbose||y===Gt.Compact)&&(O.params?re=`Params: ${Q(O.params)}

`:re=`No parameters provided.

`),B.log(`Received notification '${O.method}'.`,re)}else it("receive-notification",O)}function Vt(O,re){if(!(y===Gt.Off||!B))if(u===nr.Text){let ae;if((y===Gt.Verbose||y===Gt.Compact)&&(O.error&&O.error.data?ae=`Error data: ${Q(O.error.data)}

`:O.result?ae=`Result: ${Q(O.result)}

`:O.error===void 0&&(ae=`No result returned.

`)),re){let xe=O.error?` Request failed: ${O.error.message} (${O.error.code}).`:"";B.log(`Received response '${re.method} - (${O.id})' in ${Date.now()-re.timerStart}ms.${xe}`,ae)}else B.log(`Received response ${O.id} without active response promise.`,ae)}else it("receive-response",O)}function it(O,re){if(!B||y===Gt.Off)return;let ae={isLSPMessage:!0,type:O,message:re,timestamp:Date.now()};B.log(ae)}function ot(){if(Lt())throw new lo(Go.Closed,"Connection is closed.");if(Pe())throw new lo(Go.Disposed,"Connection is disposed.")}function Le(){if(Et())throw new lo(Go.AlreadyListening,"Connection is already listening")}function je(){if(!Et())throw new Error("Call listen() first.")}function xt(O){return O===void 0?null:O}function be(O){if(O!==null)return O}function tt(O){return O!=null&&!Array.isArray(O)&&typeof O=="object"}function Mt(O,re){switch(O){case mt.ParameterStructures.auto:return tt(re)?be(re):[xt(re)];case mt.ParameterStructures.byName:if(!tt(re))throw new Error("Received parameters by name but param is not an object literal.");return be(re);case mt.ParameterStructures.byPosition:return[xt(re)];default:throw new Error(`Unknown parameter structure ${O.toString()}`)}}function Ye(O,re){let ae,xe=O.numberOfParams;switch(xe){case 0:ae=void 0;break;case 1:ae=Mt(O.parameterStructures,re[0]);break;default:ae=[];for(let yt=0;yt<re.length&&yt<xe;yt++)ae.push(xt(re[yt]));if(re.length<xe)for(let yt=re.length;yt<xe;yt++)ae.push(null);break}return ae}let qe={sendNotification:(O,...re)=>{ot();let ae,xe;if(mn.string(O)){ae=O;let Pt=re[0],_t=0,Ze=mt.ParameterStructures.auto;mt.ParameterStructures.is(Pt)&&(_t=1,Ze=Pt);let lt=re.length,qt=lt-_t;switch(qt){case 0:xe=void 0;break;case 1:xe=Mt(Ze,re[_t]);break;default:if(Ze===mt.ParameterStructures.byName)throw new Error(`Received ${qt} parameters for 'by Name' notification parameter structure.`);xe=re.slice(_t,lt).map(It=>xt(It));break}}else{let Pt=re;ae=O.method,xe=Ye(O,Pt)}let yt={jsonrpc:p,method:ae,params:xe};return ze(yt),t.write(yt).catch(Pt=>{throw r.error("Sending notification failed."),Pt})},onNotification:(O,re)=>{ot();let ae;return mn.func(O)?b=O:re&&(mn.string(O)?(ae=O,v.set(O,{type:void 0,handler:re})):(ae=O.method,v.set(O.method,{type:O,handler:re}))),{dispose:()=>{ae!==void 0?v.delete(ae):b=void 0}}},onProgress:(O,re,ae)=>{if(d.has(re))throw new Error(`Progress handler for token ${re} already registered`);return d.set(re,ae),{dispose:()=>{d.delete(re)}}},sendProgress:(O,re,ae)=>qe.sendNotification(zo.type,{token:re,value:ae}),onUnhandledProgress:Re.event,sendRequest:(O,...re)=>{ot(),je();let ae,xe,yt;if(mn.string(O)){ae=O;let lt=re[0],qt=re[re.length-1],It=0,tn=mt.ParameterStructures.auto;mt.ParameterStructures.is(lt)&&(It=1,tn=lt);let Ot=re.length;kl.CancellationToken.is(qt)&&(Ot=Ot-1,yt=qt);let jt=Ot-It;switch(jt){case 0:xe=void 0;break;case 1:xe=Mt(tn,re[It]);break;default:if(tn===mt.ParameterStructures.byName)throw new Error(`Received ${jt} parameters for 'by Name' request parameter structure.`);xe=re.slice(It,Ot).map(jr=>xt(jr));break}}else{let lt=re;ae=O.method,xe=Ye(O,lt);let qt=O.numberOfParams;yt=kl.CancellationToken.is(lt[qt])?lt[qt]:void 0}let Pt=s++,_t;yt&&(_t=yt.onCancellationRequested(()=>{let lt=U.sender.sendCancellation(qe,Pt);return lt===void 0?(r.log(`Received no promise from cancellation strategy when cancelling id ${Pt}`),Promise.resolve()):lt.catch(()=>{r.log(`Sending cancellation messages for id ${Pt} failed`)})}));let Ze={jsonrpc:p,id:Pt,method:ae,params:xe};return ve(Ze),typeof U.sender.enableCancellation=="function"&&U.sender.enableCancellation(Ze),new Promise(async(lt,qt)=>{let It=jt=>{lt(jt),U.sender.cleanup(Pt),_t?.dispose()},tn=jt=>{qt(jt),U.sender.cleanup(Pt),_t?.dispose()},Ot={method:ae,timerStart:Date.now(),resolve:It,reject:tn};try{await t.write(Ze),$.set(Pt,Ot)}catch(jt){throw r.error("Sending request failed."),Ot.reject(new mt.ResponseError(mt.ErrorCodes.MessageWriteError,jt.message?jt.message:"Unknown reason")),jt}})},onRequest:(O,re)=>{ot();let ae=null;return wl.is(O)?(ae=void 0,f=O):mn.string(O)?(ae=null,re!==void 0&&(ae=O,l.set(O,{handler:re,type:void 0}))):re!==void 0&&(ae=O.method,l.set(O.method,{type:O,handler:re})),{dispose:()=>{ae!==null&&(ae!==void 0?l.delete(ae):f=void 0)}}},hasPendingResponse:()=>$.size>0,trace:async(O,re,ae)=>{let xe=!1,yt=nr.Text;ae!==void 0&&(mn.boolean(ae)?xe=ae:(xe=ae.sendNotification||!1,yt=ae.traceFormat||nr.Text)),y=O,u=yt,y===Gt.Off?B=void 0:B=re,xe&&!Lt()&&!Pe()&&await qe.sendNotification(Rl.type,{value:Gt.toString(O)})},onError:le.event,onClose:ge.event,onUnhandledNotification:Ne.event,onDispose:W.event,end:()=>{t.end()},dispose:()=>{if(Pe())return;h=Pr.Disposed,W.fire(void 0);let O=new mt.ResponseError(mt.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let re of $.values())re.reject(O);$=new Map,g=new Map,C=new Set,D=new Kf.LinkedMap,mn.func(t.dispose)&&t.dispose(),mn.func(e.dispose)&&e.dispose()},listen:()=>{ot(),Le(),h=Pr.Listening,e.listen(Bt)},inspect:()=>{(0,jf.default)().console.log("inspect")}};return qe.onNotification(qs.type,O=>{if(y===Gt.Off||!B)return;let re=y===Gt.Verbose||y===Gt.Compact;B.log(O.message,re?O.verbose:void 0)}),qe.onNotification(zo.type,O=>{let re=d.get(O.token);re?re(O.value):Re.fire(O)}),qe}At.createMessageConnection=Nb});var Us=Qe(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.ProgressType=pe.ProgressToken=pe.createMessageConnection=pe.NullLogger=pe.ConnectionOptions=pe.ConnectionStrategy=pe.AbstractMessageBuffer=pe.WriteableStreamMessageWriter=pe.AbstractMessageWriter=pe.MessageWriter=pe.ReadableStreamMessageReader=pe.AbstractMessageReader=pe.MessageReader=pe.SharedArrayReceiverStrategy=pe.SharedArraySenderStrategy=pe.CancellationToken=pe.CancellationTokenSource=pe.Emitter=pe.Event=pe.Disposable=pe.LRUCache=pe.Touch=pe.LinkedMap=pe.ParameterStructures=pe.NotificationType9=pe.NotificationType8=pe.NotificationType7=pe.NotificationType6=pe.NotificationType5=pe.NotificationType4=pe.NotificationType3=pe.NotificationType2=pe.NotificationType1=pe.NotificationType0=pe.NotificationType=pe.ErrorCodes=pe.ResponseError=pe.RequestType9=pe.RequestType8=pe.RequestType7=pe.RequestType6=pe.RequestType5=pe.RequestType4=pe.RequestType3=pe.RequestType2=pe.RequestType1=pe.RequestType0=pe.RequestType=pe.Message=pe.RAL=void 0;pe.MessageStrategy=pe.CancellationStrategy=pe.CancellationSenderStrategy=pe.CancellationReceiverStrategy=pe.ConnectionError=pe.ConnectionErrors=pe.LogTraceNotification=pe.SetTraceNotification=pe.TraceFormat=pe.TraceValues=pe.Trace=void 0;var an=Zc();Object.defineProperty(pe,"Message",{enumerable:!0,get:function(){return an.Message}});Object.defineProperty(pe,"RequestType",{enumerable:!0,get:function(){return an.RequestType}});Object.defineProperty(pe,"RequestType0",{enumerable:!0,get:function(){return an.RequestType0}});Object.defineProperty(pe,"RequestType1",{enumerable:!0,get:function(){return an.RequestType1}});Object.defineProperty(pe,"RequestType2",{enumerable:!0,get:function(){return an.RequestType2}});Object.defineProperty(pe,"RequestType3",{enumerable:!0,get:function(){return an.RequestType3}});Object.defineProperty(pe,"RequestType4",{enumerable:!0,get:function(){return an.RequestType4}});Object.defineProperty(pe,"RequestType5",{enumerable:!0,get:function(){return an.RequestType5}});Object.defineProperty(pe,"RequestType6",{enumerable:!0,get:function(){return an.RequestType6}});Object.defineProperty(pe,"RequestType7",{enumerable:!0,get:function(){return an.RequestType7}});Object.defineProperty(pe,"RequestType8",{enumerable:!0,get:function(){return an.RequestType8}});Object.defineProperty(pe,"RequestType9",{enumerable:!0,get:function(){return an.RequestType9}});Object.defineProperty(pe,"ResponseError",{enumerable:!0,get:function(){return an.ResponseError}});Object.defineProperty(pe,"ErrorCodes",{enumerable:!0,get:function(){return an.ErrorCodes}});Object.defineProperty(pe,"NotificationType",{enumerable:!0,get:function(){return an.NotificationType}});Object.defineProperty(pe,"NotificationType0",{enumerable:!0,get:function(){return an.NotificationType0}});Object.defineProperty(pe,"NotificationType1",{enumerable:!0,get:function(){return an.NotificationType1}});Object.defineProperty(pe,"NotificationType2",{enumerable:!0,get:function(){return an.NotificationType2}});Object.defineProperty(pe,"NotificationType3",{enumerable:!0,get:function(){return an.NotificationType3}});Object.defineProperty(pe,"NotificationType4",{enumerable:!0,get:function(){return an.NotificationType4}});Object.defineProperty(pe,"NotificationType5",{enumerable:!0,get:function(){return an.NotificationType5}});Object.defineProperty(pe,"NotificationType6",{enumerable:!0,get:function(){return an.NotificationType6}});Object.defineProperty(pe,"NotificationType7",{enumerable:!0,get:function(){return an.NotificationType7}});Object.defineProperty(pe,"NotificationType8",{enumerable:!0,get:function(){return an.NotificationType8}});Object.defineProperty(pe,"NotificationType9",{enumerable:!0,get:function(){return an.NotificationType9}});Object.defineProperty(pe,"ParameterStructures",{enumerable:!0,get:function(){return an.ParameterStructures}});var Sl=el();Object.defineProperty(pe,"LinkedMap",{enumerable:!0,get:function(){return Sl.LinkedMap}});Object.defineProperty(pe,"LRUCache",{enumerable:!0,get:function(){return Sl.LRUCache}});Object.defineProperty(pe,"Touch",{enumerable:!0,get:function(){return Sl.Touch}});var Lb=Df();Object.defineProperty(pe,"Disposable",{enumerable:!0,get:function(){return Lb.Disposable}});var Uf=oo();Object.defineProperty(pe,"Event",{enumerable:!0,get:function(){return Uf.Event}});Object.defineProperty(pe,"Emitter",{enumerable:!0,get:function(){return Uf.Emitter}});var Bf=Ns();Object.defineProperty(pe,"CancellationTokenSource",{enumerable:!0,get:function(){return Bf.CancellationTokenSource}});Object.defineProperty(pe,"CancellationToken",{enumerable:!0,get:function(){return Bf.CancellationToken}});var Hf=Pf();Object.defineProperty(pe,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return Hf.SharedArraySenderStrategy}});Object.defineProperty(pe,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return Hf.SharedArrayReceiverStrategy}});var Dl=Of();Object.defineProperty(pe,"MessageReader",{enumerable:!0,get:function(){return Dl.MessageReader}});Object.defineProperty(pe,"AbstractMessageReader",{enumerable:!0,get:function(){return Dl.AbstractMessageReader}});Object.defineProperty(pe,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Dl.ReadableStreamMessageReader}});var Al=Ff();Object.defineProperty(pe,"MessageWriter",{enumerable:!0,get:function(){return Al.MessageWriter}});Object.defineProperty(pe,"AbstractMessageWriter",{enumerable:!0,get:function(){return Al.AbstractMessageWriter}});Object.defineProperty(pe,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Al.WriteableStreamMessageWriter}});var Mb=qf();Object.defineProperty(pe,"AbstractMessageBuffer",{enumerable:!0,get:function(){return Mb.AbstractMessageBuffer}});var En=Vf();Object.defineProperty(pe,"ConnectionStrategy",{enumerable:!0,get:function(){return En.ConnectionStrategy}});Object.defineProperty(pe,"ConnectionOptions",{enumerable:!0,get:function(){return En.ConnectionOptions}});Object.defineProperty(pe,"NullLogger",{enumerable:!0,get:function(){return En.NullLogger}});Object.defineProperty(pe,"createMessageConnection",{enumerable:!0,get:function(){return En.createMessageConnection}});Object.defineProperty(pe,"ProgressToken",{enumerable:!0,get:function(){return En.ProgressToken}});Object.defineProperty(pe,"ProgressType",{enumerable:!0,get:function(){return En.ProgressType}});Object.defineProperty(pe,"Trace",{enumerable:!0,get:function(){return En.Trace}});Object.defineProperty(pe,"TraceValues",{enumerable:!0,get:function(){return En.TraceValues}});Object.defineProperty(pe,"TraceFormat",{enumerable:!0,get:function(){return En.TraceFormat}});Object.defineProperty(pe,"SetTraceNotification",{enumerable:!0,get:function(){return En.SetTraceNotification}});Object.defineProperty(pe,"LogTraceNotification",{enumerable:!0,get:function(){return En.LogTraceNotification}});Object.defineProperty(pe,"ConnectionErrors",{enumerable:!0,get:function(){return En.ConnectionErrors}});Object.defineProperty(pe,"ConnectionError",{enumerable:!0,get:function(){return En.ConnectionError}});Object.defineProperty(pe,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return En.CancellationReceiverStrategy}});Object.defineProperty(pe,"CancellationSenderStrategy",{enumerable:!0,get:function(){return En.CancellationSenderStrategy}});Object.defineProperty(pe,"CancellationStrategy",{enumerable:!0,get:function(){return En.CancellationStrategy}});Object.defineProperty(pe,"MessageStrategy",{enumerable:!0,get:function(){return En.MessageStrategy}});var Ib=di();pe.RAL=Ib.default});var Xf=Qe(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});var zf=require("util"),Zr=Us(),Bs=class e extends Zr.AbstractMessageBuffer{constructor(t="utf-8"){super(t)}emptyBuffer(){return e.emptyBuffer}fromString(t,n){return Buffer.from(t,n)}toString(t,n){return t instanceof Buffer?t.toString(n):new zf.TextDecoder(n).decode(t)}asNative(t,n){return n===void 0?t instanceof Buffer?t:Buffer.from(t):t instanceof Buffer?t.slice(0,n):Buffer.from(t,0,n)}allocNative(t){return Buffer.allocUnsafe(t)}};Bs.emptyBuffer=Buffer.allocUnsafe(0);var Pl=class{constructor(t){this.stream=t}onClose(t){return this.stream.on("close",t),Zr.Disposable.create(()=>this.stream.off("close",t))}onError(t){return this.stream.on("error",t),Zr.Disposable.create(()=>this.stream.off("error",t))}onEnd(t){return this.stream.on("end",t),Zr.Disposable.create(()=>this.stream.off("end",t))}onData(t){return this.stream.on("data",t),Zr.Disposable.create(()=>this.stream.off("data",t))}},El=class{constructor(t){this.stream=t}onClose(t){return this.stream.on("close",t),Zr.Disposable.create(()=>this.stream.off("close",t))}onError(t){return this.stream.on("error",t),Zr.Disposable.create(()=>this.stream.off("error",t))}onEnd(t){return this.stream.on("end",t),Zr.Disposable.create(()=>this.stream.off("end",t))}write(t,n){return new Promise((i,r)=>{let s=a=>{a==null?i():r(a)};typeof t=="string"?this.stream.write(t,n,s):this.stream.write(t,s)})}end(){this.stream.end()}},Gf=Object.freeze({messageBuffer:Object.freeze({create:e=>new Bs(e)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(e,t)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(e,void 0,0),t.charset))}catch(n){return Promise.reject(n)}}}),decoder:Object.freeze({name:"application/json",decode:(e,t)=>{try{return e instanceof Buffer?Promise.resolve(JSON.parse(e.toString(t.charset))):Promise.resolve(JSON.parse(new zf.TextDecoder(t.charset).decode(e)))}catch(n){return Promise.reject(n)}}})}),stream:Object.freeze({asReadableStream:e=>new Pl(e),asWritableStream:e=>new El(e)}),console,timer:Object.freeze({setTimeout(e,t,...n){let i=setTimeout(e,t,...n);return{dispose:()=>clearTimeout(i)}},setImmediate(e,...t){let n=setImmediate(e,...t);return{dispose:()=>clearImmediate(n)}},setInterval(e,t,...n){let i=setInterval(e,t,...n);return{dispose:()=>clearInterval(i)}}})});function Ol(){return Gf}(function(e){function t(){Zr.RAL.install(Gf)}e.install=t})(Ol||(Ol={}));Nl.default=Ol});var gi=Qe(Wt=>{"use strict";var Fb=Wt&&Wt.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),qb=Wt&&Wt.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&Fb(t,e,n)};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.createMessageConnection=Wt.createServerSocketTransport=Wt.createClientSocketTransport=Wt.createServerPipeTransport=Wt.createClientPipeTransport=Wt.generateRandomPipeName=Wt.StreamMessageWriter=Wt.StreamMessageReader=Wt.SocketMessageWriter=Wt.SocketMessageReader=Wt.PortMessageWriter=Wt.PortMessageReader=Wt.IPCMessageWriter=Wt.IPCMessageReader=void 0;var uo=Xf();uo.default.install();var Qf=require("path"),jb=require("os"),Kb=require("crypto"),Gs=require("net"),rr=Us();qb(Us(),Wt);var Ll=class extends rr.AbstractMessageReader{constructor(t){super(),this.process=t;let n=this.process;n.on("error",i=>this.fireError(i)),n.on("close",()=>this.fireClose())}listen(t){return this.process.on("message",t),rr.Disposable.create(()=>this.process.off("message",t))}};Wt.IPCMessageReader=Ll;var Ml=class extends rr.AbstractMessageWriter{constructor(t){super(),this.process=t,this.errorCount=0;let n=this.process;n.on("error",i=>this.fireError(i)),n.on("close",()=>this.fireClose)}write(t){try{return typeof this.process.send=="function"&&this.process.send(t,void 0,void 0,n=>{n?(this.errorCount++,this.handleError(n,t)):this.errorCount=0}),Promise.resolve()}catch(n){return this.handleError(n,t),Promise.reject(n)}}handleError(t,n){this.errorCount++,this.fireError(t,n,this.errorCount)}end(){}};Wt.IPCMessageWriter=Ml;var Il=class extends rr.AbstractMessageReader{constructor(t){super(),this.onData=new rr.Emitter,t.on("close",()=>this.fireClose),t.on("error",n=>this.fireError(n)),t.on("message",n=>{this.onData.fire(n)})}listen(t){return this.onData.event(t)}};Wt.PortMessageReader=Il;var Fl=class extends rr.AbstractMessageWriter{constructor(t){super(),this.port=t,this.errorCount=0,t.on("close",()=>this.fireClose()),t.on("error",n=>this.fireError(n))}write(t){try{return this.port.postMessage(t),Promise.resolve()}catch(n){return this.handleError(n,t),Promise.reject(n)}}handleError(t,n){this.errorCount++,this.fireError(t,n,this.errorCount)}end(){}};Wt.PortMessageWriter=Fl;var Ii=class extends rr.ReadableStreamMessageReader{constructor(t,n="utf-8"){super((0,uo.default)().stream.asReadableStream(t),n)}};Wt.SocketMessageReader=Ii;var Fi=class extends rr.WriteableStreamMessageWriter{constructor(t,n){super((0,uo.default)().stream.asWritableStream(t),n),this.socket=t}dispose(){super.dispose(),this.socket.destroy()}};Wt.SocketMessageWriter=Fi;var Hs=class extends rr.ReadableStreamMessageReader{constructor(t,n){super((0,uo.default)().stream.asReadableStream(t),n)}};Wt.StreamMessageReader=Hs;var zs=class extends rr.WriteableStreamMessageWriter{constructor(t,n){super((0,uo.default)().stream.asWritableStream(t),n)}};Wt.StreamMessageWriter=zs;var Jf=process.env.XDG_RUNTIME_DIR,$b=new Map([["linux",107],["darwin",103]]);function Wb(){let e=(0,Kb.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${e}-sock`;let t;Jf?t=Qf.join(Jf,`vscode-ipc-${e}.sock`):t=Qf.join(jb.tmpdir(),`vscode-${e}.sock`);let n=$b.get(process.platform);return n!==void 0&&t.length>n&&(0,uo.default)().console.warn(`WARNING: IPC handle "${t}" is longer than ${n} characters.`),t}Wt.generateRandomPipeName=Wb;function Vb(e,t="utf-8"){let n,i=new Promise((r,s)=>{n=r});return new Promise((r,s)=>{let a=(0,Gs.createServer)(c=>{a.close(),n([new Ii(c,t),new Fi(c,t)])});a.on("error",s),a.listen(e,()=>{a.removeListener("error",s),r({onConnected:()=>i})})})}Wt.createClientPipeTransport=Vb;function Ub(e,t="utf-8"){let n=(0,Gs.createConnection)(e);return[new Ii(n,t),new Fi(n,t)]}Wt.createServerPipeTransport=Ub;function Bb(e,t="utf-8"){let n,i=new Promise((r,s)=>{n=r});return new Promise((r,s)=>{let a=(0,Gs.createServer)(c=>{a.close(),n([new Ii(c,t),new Fi(c,t)])});a.on("error",s),a.listen(e,"127.0.0.1",()=>{a.removeListener("error",s),r({onConnected:()=>i})})})}Wt.createClientSocketTransport=Bb;function Hb(e,t="utf-8"){let n=(0,Gs.createConnection)(e,"127.0.0.1");return[new Ii(n,t),new Fi(n,t)]}Wt.createServerSocketTransport=Hb;function zb(e){let t=e;return t.read!==void 0&&t.addListener!==void 0}function Gb(e){let t=e;return t.write!==void 0&&t.addListener!==void 0}function Xb(e,t,n,i){n||(n=rr.NullLogger);let r=zb(e)?new Hs(e):e,s=Gb(t)?new zs(t):t;return rr.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),(0,rr.createMessageConnection)(r,s,n,i)}Wt.createMessageConnection=Xb});var ql=Qe((pv,Zf)=>{"use strict";Zf.exports=gi()});var Qs=Qe((Yf,Xs)=>{(function(e){if(typeof Xs=="object"&&typeof Xs.exports=="object"){var t=e(require,Yf);t!==void 0&&(Xs.exports=t)}else typeof define=="function"&&define.amd&&define(["require","exports"],e)})(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextDocument=t.EOL=t.WorkspaceFolder=t.InlineCompletionContext=t.SelectedCompletionInfo=t.InlineCompletionTriggerKind=t.InlineCompletionList=t.InlineCompletionItem=t.StringValue=t.InlayHint=t.InlayHintLabelPart=t.InlayHintKind=t.InlineValueContext=t.InlineValueEvaluatableExpression=t.InlineValueVariableLookup=t.InlineValueText=t.SemanticTokens=t.SemanticTokenModifiers=t.SemanticTokenTypes=t.SelectionRange=t.DocumentLink=t.FormattingOptions=t.CodeLens=t.CodeAction=t.CodeActionContext=t.CodeActionTriggerKind=t.CodeActionKind=t.DocumentSymbol=t.WorkspaceSymbol=t.SymbolInformation=t.SymbolTag=t.SymbolKind=t.DocumentHighlight=t.DocumentHighlightKind=t.SignatureInformation=t.ParameterInformation=t.Hover=t.MarkedString=t.CompletionList=t.CompletionItem=t.CompletionItemLabelDetails=t.InsertTextMode=t.InsertReplaceEdit=t.CompletionItemTag=t.InsertTextFormat=t.CompletionItemKind=t.MarkupContent=t.MarkupKind=t.TextDocumentItem=t.OptionalVersionedTextDocumentIdentifier=t.VersionedTextDocumentIdentifier=t.TextDocumentIdentifier=t.WorkspaceChange=t.WorkspaceEdit=t.DeleteFile=t.RenameFile=t.CreateFile=t.TextDocumentEdit=t.AnnotatedTextEdit=t.ChangeAnnotationIdentifier=t.ChangeAnnotation=t.TextEdit=t.Command=t.Diagnostic=t.CodeDescription=t.DiagnosticTag=t.DiagnosticSeverity=t.DiagnosticRelatedInformation=t.FoldingRange=t.FoldingRangeKind=t.ColorPresentation=t.ColorInformation=t.Color=t.LocationLink=t.Location=t.Range=t.Position=t.uinteger=t.integer=t.URI=t.DocumentUri=void 0;var n;(function(k){function M(I){return typeof I=="string"}k.is=M})(n||(t.DocumentUri=n={}));var i;(function(k){function M(I){return typeof I=="string"}k.is=M})(i||(t.URI=i={}));var r;(function(k){k.MIN_VALUE=-2147483648,k.MAX_VALUE=2147483647;function M(I){return typeof I=="number"&&k.MIN_VALUE<=I&&I<=k.MAX_VALUE}k.is=M})(r||(t.integer=r={}));var s;(function(k){k.MIN_VALUE=0,k.MAX_VALUE=2147483647;function M(I){return typeof I=="number"&&k.MIN_VALUE<=I&&I<=k.MAX_VALUE}k.is=M})(s||(t.uinteger=s={}));var a;(function(k){function M(x,_){return x===Number.MAX_VALUE&&(x=s.MAX_VALUE),_===Number.MAX_VALUE&&(_=s.MAX_VALUE),{line:x,character:_}}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&G.uinteger(_.line)&&G.uinteger(_.character)}k.is=I})(a||(t.Position=a={}));var c;(function(k){function M(x,_,X,_e){if(G.uinteger(x)&&G.uinteger(_)&&G.uinteger(X)&&G.uinteger(_e))return{start:a.create(x,_),end:a.create(X,_e)};if(a.is(x)&&a.is(_))return{start:x,end:_};throw new Error("Range#create called with invalid arguments[".concat(x,", ").concat(_,", ").concat(X,", ").concat(_e,"]"))}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&a.is(_.start)&&a.is(_.end)}k.is=I})(c||(t.Range=c={}));var p;(function(k){function M(x,_){return{uri:x,range:_}}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&c.is(_.range)&&(G.string(_.uri)||G.undefined(_.uri))}k.is=I})(p||(t.Location=p={}));var f;(function(k){function M(x,_,X,_e){return{targetUri:x,targetRange:_,targetSelectionRange:X,originSelectionRange:_e}}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&c.is(_.targetRange)&&G.string(_.targetUri)&&c.is(_.targetSelectionRange)&&(c.is(_.originSelectionRange)||G.undefined(_.originSelectionRange))}k.is=I})(f||(t.LocationLink=f={}));var l;(function(k){function M(x,_,X,_e){return{red:x,green:_,blue:X,alpha:_e}}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&G.numberRange(_.red,0,1)&&G.numberRange(_.green,0,1)&&G.numberRange(_.blue,0,1)&&G.numberRange(_.alpha,0,1)}k.is=I})(l||(t.Color=l={}));var b;(function(k){function M(x,_){return{range:x,color:_}}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&c.is(_.range)&&l.is(_.color)}k.is=I})(b||(t.ColorInformation=b={}));var v;(function(k){function M(x,_,X){return{label:x,textEdit:_,additionalTextEdits:X}}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&G.string(_.label)&&(G.undefined(_.textEdit)||B.is(_))&&(G.undefined(_.additionalTextEdits)||G.typedArray(_.additionalTextEdits,B.is))}k.is=I})(v||(t.ColorPresentation=v={}));var d;(function(k){k.Comment="comment",k.Imports="imports",k.Region="region"})(d||(t.FoldingRangeKind=d={}));var w;(function(k){function M(x,_,X,_e,kt,fn){var Qt={startLine:x,endLine:_};return G.defined(X)&&(Qt.startCharacter=X),G.defined(_e)&&(Qt.endCharacter=_e),G.defined(kt)&&(Qt.kind=kt),G.defined(fn)&&(Qt.collapsedText=fn),Qt}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&G.uinteger(_.startLine)&&G.uinteger(_.startLine)&&(G.undefined(_.startCharacter)||G.uinteger(_.startCharacter))&&(G.undefined(_.endCharacter)||G.uinteger(_.endCharacter))&&(G.undefined(_.kind)||G.string(_.kind))}k.is=I})(w||(t.FoldingRange=w={}));var D;(function(k){function M(x,_){return{location:x,message:_}}k.create=M;function I(x){var _=x;return G.defined(_)&&p.is(_.location)&&G.string(_.message)}k.is=I})(D||(t.DiagnosticRelatedInformation=D={}));var $;(function(k){k.Error=1,k.Warning=2,k.Information=3,k.Hint=4})($||(t.DiagnosticSeverity=$={}));var C;(function(k){k.Unnecessary=1,k.Deprecated=2})(C||(t.DiagnosticTag=C={}));var g;(function(k){function M(I){var x=I;return G.objectLiteral(x)&&G.string(x.href)}k.is=M})(g||(t.CodeDescription=g={}));var y;(function(k){function M(x,_,X,_e,kt,fn){var Qt={range:x,message:_};return G.defined(X)&&(Qt.severity=X),G.defined(_e)&&(Qt.code=_e),G.defined(kt)&&(Qt.source=kt),G.defined(fn)&&(Qt.relatedInformation=fn),Qt}k.create=M;function I(x){var _,X=x;return G.defined(X)&&c.is(X.range)&&G.string(X.message)&&(G.number(X.severity)||G.undefined(X.severity))&&(G.integer(X.code)||G.string(X.code)||G.undefined(X.code))&&(G.undefined(X.codeDescription)||G.string((_=X.codeDescription)===null||_===void 0?void 0:_.href))&&(G.string(X.source)||G.undefined(X.source))&&(G.undefined(X.relatedInformation)||G.typedArray(X.relatedInformation,D.is))}k.is=I})(y||(t.Diagnostic=y={}));var u;(function(k){function M(x,_){for(var X=[],_e=2;_e<arguments.length;_e++)X[_e-2]=arguments[_e];var kt={title:x,command:_};return G.defined(X)&&X.length>0&&(kt.arguments=X),kt}k.create=M;function I(x){var _=x;return G.defined(_)&&G.string(_.title)&&G.string(_.command)}k.is=I})(u||(t.Command=u={}));var B;(function(k){function M(X,_e){return{range:X,newText:_e}}k.replace=M;function I(X,_e){return{range:{start:X,end:X},newText:_e}}k.insert=I;function x(X){return{range:X,newText:""}}k.del=x;function _(X){var _e=X;return G.objectLiteral(_e)&&G.string(_e.newText)&&c.is(_e.range)}k.is=_})(B||(t.TextEdit=B={}));var h;(function(k){function M(x,_,X){var _e={label:x};return _!==void 0&&(_e.needsConfirmation=_),X!==void 0&&(_e.description=X),_e}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&G.string(_.label)&&(G.boolean(_.needsConfirmation)||_.needsConfirmation===void 0)&&(G.string(_.description)||_.description===void 0)}k.is=I})(h||(t.ChangeAnnotation=h={}));var le;(function(k){function M(I){var x=I;return G.string(x)}k.is=M})(le||(t.ChangeAnnotationIdentifier=le={}));var ge;(function(k){function M(X,_e,kt){return{range:X,newText:_e,annotationId:kt}}k.replace=M;function I(X,_e,kt){return{range:{start:X,end:X},newText:_e,annotationId:kt}}k.insert=I;function x(X,_e){return{range:X,newText:"",annotationId:_e}}k.del=x;function _(X){var _e=X;return B.is(_e)&&(h.is(_e.annotationId)||le.is(_e.annotationId))}k.is=_})(ge||(t.AnnotatedTextEdit=ge={}));var Ne;(function(k){function M(x,_){return{textDocument:x,edits:_}}k.create=M;function I(x){var _=x;return G.defined(_)&&Lt.is(_.textDocument)&&Array.isArray(_.edits)}k.is=I})(Ne||(t.TextDocumentEdit=Ne={}));var Re;(function(k){function M(x,_,X){var _e={kind:"create",uri:x};return _!==void 0&&(_.overwrite!==void 0||_.ignoreIfExists!==void 0)&&(_e.options=_),X!==void 0&&(_e.annotationId=X),_e}k.create=M;function I(x){var _=x;return _&&_.kind==="create"&&G.string(_.uri)&&(_.options===void 0||(_.options.overwrite===void 0||G.boolean(_.options.overwrite))&&(_.options.ignoreIfExists===void 0||G.boolean(_.options.ignoreIfExists)))&&(_.annotationId===void 0||le.is(_.annotationId))}k.is=I})(Re||(t.CreateFile=Re={}));var W;(function(k){function M(x,_,X,_e){var kt={kind:"rename",oldUri:x,newUri:_};return X!==void 0&&(X.overwrite!==void 0||X.ignoreIfExists!==void 0)&&(kt.options=X),_e!==void 0&&(kt.annotationId=_e),kt}k.create=M;function I(x){var _=x;return _&&_.kind==="rename"&&G.string(_.oldUri)&&G.string(_.newUri)&&(_.options===void 0||(_.options.overwrite===void 0||G.boolean(_.options.overwrite))&&(_.options.ignoreIfExists===void 0||G.boolean(_.options.ignoreIfExists)))&&(_.annotationId===void 0||le.is(_.annotationId))}k.is=I})(W||(t.RenameFile=W={}));var U;(function(k){function M(x,_,X){var _e={kind:"delete",uri:x};return _!==void 0&&(_.recursive!==void 0||_.ignoreIfNotExists!==void 0)&&(_e.options=_),X!==void 0&&(_e.annotationId=X),_e}k.create=M;function I(x){var _=x;return _&&_.kind==="delete"&&G.string(_.uri)&&(_.options===void 0||(_.options.recursive===void 0||G.boolean(_.options.recursive))&&(_.options.ignoreIfNotExists===void 0||G.boolean(_.options.ignoreIfNotExists)))&&(_.annotationId===void 0||le.is(_.annotationId))}k.is=I})(U||(t.DeleteFile=U={}));var Ke;(function(k){function M(I){var x=I;return x&&(x.changes!==void 0||x.documentChanges!==void 0)&&(x.documentChanges===void 0||x.documentChanges.every(function(_){return G.string(_.kind)?Re.is(_)||W.is(_)||U.is(_):Ne.is(_)}))}k.is=M})(Ke||(t.WorkspaceEdit=Ke={}));var ye=function(){function k(M,I){this.edits=M,this.changeAnnotations=I}return k.prototype.insert=function(M,I,x){var _,X;if(x===void 0?_=B.insert(M,I):le.is(x)?(X=x,_=ge.insert(M,I,x)):(this.assertChangeAnnotations(this.changeAnnotations),X=this.changeAnnotations.manage(x),_=ge.insert(M,I,X)),this.edits.push(_),X!==void 0)return X},k.prototype.replace=function(M,I,x){var _,X;if(x===void 0?_=B.replace(M,I):le.is(x)?(X=x,_=ge.replace(M,I,x)):(this.assertChangeAnnotations(this.changeAnnotations),X=this.changeAnnotations.manage(x),_=ge.replace(M,I,X)),this.edits.push(_),X!==void 0)return X},k.prototype.delete=function(M,I){var x,_;if(I===void 0?x=B.del(M):le.is(I)?(_=I,x=ge.del(M,I)):(this.assertChangeAnnotations(this.changeAnnotations),_=this.changeAnnotations.manage(I),x=ge.del(M,_)),this.edits.push(x),_!==void 0)return _},k.prototype.add=function(M){this.edits.push(M)},k.prototype.all=function(){return this.edits},k.prototype.clear=function(){this.edits.splice(0,this.edits.length)},k.prototype.assertChangeAnnotations=function(M){if(M===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},k}(),ct=function(){function k(M){this._annotations=M===void 0?Object.create(null):M,this._counter=0,this._size=0}return k.prototype.all=function(){return this._annotations},Object.defineProperty(k.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),k.prototype.manage=function(M,I){var x;if(le.is(M)?x=M:(x=this.nextId(),I=M),this._annotations[x]!==void 0)throw new Error("Id ".concat(x," is already in use."));if(I===void 0)throw new Error("No annotation provided for id ".concat(x));return this._annotations[x]=I,this._size++,x},k.prototype.nextId=function(){return this._counter++,this._counter.toString()},k}(),De=function(){function k(M){var I=this;this._textEditChanges=Object.create(null),M!==void 0?(this._workspaceEdit=M,M.documentChanges?(this._changeAnnotations=new ct(M.changeAnnotations),M.changeAnnotations=this._changeAnnotations.all(),M.documentChanges.forEach(function(x){if(Ne.is(x)){var _=new ye(x.edits,I._changeAnnotations);I._textEditChanges[x.textDocument.uri]=_}})):M.changes&&Object.keys(M.changes).forEach(function(x){var _=new ye(M.changes[x]);I._textEditChanges[x]=_})):this._workspaceEdit={}}return Object.defineProperty(k.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),k.prototype.getTextEditChange=function(M){if(Lt.is(M)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var I={uri:M.uri,version:M.version},x=this._textEditChanges[I.uri];if(!x){var _=[],X={textDocument:I,edits:_};this._workspaceEdit.documentChanges.push(X),x=new ye(_,this._changeAnnotations),this._textEditChanges[I.uri]=x}return x}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var x=this._textEditChanges[M];if(!x){var _=[];this._workspaceEdit.changes[M]=_,x=new ye(_),this._textEditChanges[M]=x}return x}},k.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new ct,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},k.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},k.prototype.createFile=function(M,I,x){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var _;h.is(I)||le.is(I)?_=I:x=I;var X,_e;if(_===void 0?X=Re.create(M,x):(_e=le.is(_)?_:this._changeAnnotations.manage(_),X=Re.create(M,x,_e)),this._workspaceEdit.documentChanges.push(X),_e!==void 0)return _e},k.prototype.renameFile=function(M,I,x,_){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var X;h.is(x)||le.is(x)?X=x:_=x;var _e,kt;if(X===void 0?_e=W.create(M,I,_):(kt=le.is(X)?X:this._changeAnnotations.manage(X),_e=W.create(M,I,_,kt)),this._workspaceEdit.documentChanges.push(_e),kt!==void 0)return kt},k.prototype.deleteFile=function(M,I,x){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var _;h.is(I)||le.is(I)?_=I:x=I;var X,_e;if(_===void 0?X=U.create(M,x):(_e=le.is(_)?_:this._changeAnnotations.manage(_),X=U.create(M,x,_e)),this._workspaceEdit.documentChanges.push(X),_e!==void 0)return _e},k}();t.WorkspaceChange=De;var S;(function(k){function M(x){return{uri:x}}k.create=M;function I(x){var _=x;return G.defined(_)&&G.string(_.uri)}k.is=I})(S||(t.TextDocumentIdentifier=S={}));var Et;(function(k){function M(x,_){return{uri:x,version:_}}k.create=M;function I(x){var _=x;return G.defined(_)&&G.string(_.uri)&&G.integer(_.version)}k.is=I})(Et||(t.VersionedTextDocumentIdentifier=Et={}));var Lt;(function(k){function M(x,_){return{uri:x,version:_}}k.create=M;function I(x){var _=x;return G.defined(_)&&G.string(_.uri)&&(_.version===null||G.integer(_.version))}k.is=I})(Lt||(t.OptionalVersionedTextDocumentIdentifier=Lt={}));var Pe;(function(k){function M(x,_,X,_e){return{uri:x,languageId:_,version:X,text:_e}}k.create=M;function I(x){var _=x;return G.defined(_)&&G.string(_.uri)&&G.string(_.languageId)&&G.integer(_.version)&&G.string(_.text)}k.is=I})(Pe||(t.TextDocumentItem=Pe={}));var rn;(function(k){k.PlainText="plaintext",k.Markdown="markdown";function M(I){var x=I;return x===k.PlainText||x===k.Markdown}k.is=M})(rn||(t.MarkupKind=rn={}));var yn;(function(k){function M(I){var x=I;return G.objectLiteral(I)&&rn.is(x.kind)&&G.string(x.value)}k.is=M})(yn||(t.MarkupContent=yn={}));var en;(function(k){k.Text=1,k.Method=2,k.Function=3,k.Constructor=4,k.Field=5,k.Variable=6,k.Class=7,k.Interface=8,k.Module=9,k.Property=10,k.Unit=11,k.Value=12,k.Enum=13,k.Keyword=14,k.Snippet=15,k.Color=16,k.File=17,k.Reference=18,k.Folder=19,k.EnumMember=20,k.Constant=21,k.Struct=22,k.Event=23,k.Operator=24,k.TypeParameter=25})(en||(t.CompletionItemKind=en={}));var Fe;(function(k){k.PlainText=1,k.Snippet=2})(Fe||(t.InsertTextFormat=Fe={}));var ut;(function(k){k.Deprecated=1})(ut||(t.CompletionItemTag=ut={}));var Rt;(function(k){function M(x,_,X){return{newText:x,insert:_,replace:X}}k.create=M;function I(x){var _=x;return _&&G.string(_.newText)&&c.is(_.insert)&&c.is(_.replace)}k.is=I})(Rt||(t.InsertReplaceEdit=Rt={}));var Bt;(function(k){k.asIs=1,k.adjustIndentation=2})(Bt||(t.InsertTextMode=Bt={}));var rt;(function(k){function M(I){var x=I;return x&&(G.string(x.detail)||x.detail===void 0)&&(G.string(x.description)||x.description===void 0)}k.is=M})(rt||(t.CompletionItemLabelDetails=rt={}));var on;(function(k){function M(I){return{label:I}}k.create=M})(on||(t.CompletionItem=on={}));var Je;(function(k){function M(I,x){return{items:I||[],isIncomplete:!!x}}k.create=M})(Je||(t.CompletionList=Je={}));var Sn;(function(k){function M(x){return x.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}k.fromPlainText=M;function I(x){var _=x;return G.string(_)||G.objectLiteral(_)&&G.string(_.language)&&G.string(_.value)}k.is=I})(Sn||(t.MarkedString=Sn={}));var Q;(function(k){function M(I){var x=I;return!!x&&G.objectLiteral(x)&&(yn.is(x.contents)||Sn.is(x.contents)||G.typedArray(x.contents,Sn.is))&&(I.range===void 0||c.is(I.range))}k.is=M})(Q||(t.Hover=Q={}));var ve;(function(k){function M(I,x){return x?{label:I,documentation:x}:{label:I}}k.create=M})(ve||(t.ParameterInformation=ve={}));var ze;(function(k){function M(I,x){for(var _=[],X=2;X<arguments.length;X++)_[X-2]=arguments[X];var _e={label:I};return G.defined(x)&&(_e.documentation=x),G.defined(_)?_e.parameters=_:_e.parameters=[],_e}k.create=M})(ze||(t.SignatureInformation=ze={}));var Ae;(function(k){k.Text=1,k.Read=2,k.Write=3})(Ae||(t.DocumentHighlightKind=Ae={}));var bt;(function(k){function M(I,x){var _={range:I};return G.number(x)&&(_.kind=x),_}k.create=M})(bt||(t.DocumentHighlight=bt={}));var ht;(function(k){k.File=1,k.Module=2,k.Namespace=3,k.Package=4,k.Class=5,k.Method=6,k.Property=7,k.Field=8,k.Constructor=9,k.Enum=10,k.Interface=11,k.Function=12,k.Variable=13,k.Constant=14,k.String=15,k.Number=16,k.Boolean=17,k.Array=18,k.Object=19,k.Key=20,k.Null=21,k.EnumMember=22,k.Struct=23,k.Event=24,k.Operator=25,k.TypeParameter=26})(ht||(t.SymbolKind=ht={}));var Vt;(function(k){k.Deprecated=1})(Vt||(t.SymbolTag=Vt={}));var it;(function(k){function M(I,x,_,X,_e){var kt={name:I,kind:x,location:{uri:X,range:_}};return _e&&(kt.containerName=_e),kt}k.create=M})(it||(t.SymbolInformation=it={}));var ot;(function(k){function M(I,x,_,X){return X!==void 0?{name:I,kind:x,location:{uri:_,range:X}}:{name:I,kind:x,location:{uri:_}}}k.create=M})(ot||(t.WorkspaceSymbol=ot={}));var Le;(function(k){function M(x,_,X,_e,kt,fn){var Qt={name:x,detail:_,kind:X,range:_e,selectionRange:kt};return fn!==void 0&&(Qt.children=fn),Qt}k.create=M;function I(x){var _=x;return _&&G.string(_.name)&&G.number(_.kind)&&c.is(_.range)&&c.is(_.selectionRange)&&(_.detail===void 0||G.string(_.detail))&&(_.deprecated===void 0||G.boolean(_.deprecated))&&(_.children===void 0||Array.isArray(_.children))&&(_.tags===void 0||Array.isArray(_.tags))}k.is=I})(Le||(t.DocumentSymbol=Le={}));var je;(function(k){k.Empty="",k.QuickFix="quickfix",k.Refactor="refactor",k.RefactorExtract="refactor.extract",k.RefactorInline="refactor.inline",k.RefactorRewrite="refactor.rewrite",k.Source="source",k.SourceOrganizeImports="source.organizeImports",k.SourceFixAll="source.fixAll"})(je||(t.CodeActionKind=je={}));var xt;(function(k){k.Invoked=1,k.Automatic=2})(xt||(t.CodeActionTriggerKind=xt={}));var be;(function(k){function M(x,_,X){var _e={diagnostics:x};return _!=null&&(_e.only=_),X!=null&&(_e.triggerKind=X),_e}k.create=M;function I(x){var _=x;return G.defined(_)&&G.typedArray(_.diagnostics,y.is)&&(_.only===void 0||G.typedArray(_.only,G.string))&&(_.triggerKind===void 0||_.triggerKind===xt.Invoked||_.triggerKind===xt.Automatic)}k.is=I})(be||(t.CodeActionContext=be={}));var tt;(function(k){function M(x,_,X){var _e={title:x},kt=!0;return typeof _=="string"?(kt=!1,_e.kind=_):u.is(_)?_e.command=_:_e.edit=_,kt&&X!==void 0&&(_e.kind=X),_e}k.create=M;function I(x){var _=x;return _&&G.string(_.title)&&(_.diagnostics===void 0||G.typedArray(_.diagnostics,y.is))&&(_.kind===void 0||G.string(_.kind))&&(_.edit!==void 0||_.command!==void 0)&&(_.command===void 0||u.is(_.command))&&(_.isPreferred===void 0||G.boolean(_.isPreferred))&&(_.edit===void 0||Ke.is(_.edit))}k.is=I})(tt||(t.CodeAction=tt={}));var Mt;(function(k){function M(x,_){var X={range:x};return G.defined(_)&&(X.data=_),X}k.create=M;function I(x){var _=x;return G.defined(_)&&c.is(_.range)&&(G.undefined(_.command)||u.is(_.command))}k.is=I})(Mt||(t.CodeLens=Mt={}));var Ye;(function(k){function M(x,_){return{tabSize:x,insertSpaces:_}}k.create=M;function I(x){var _=x;return G.defined(_)&&G.uinteger(_.tabSize)&&G.boolean(_.insertSpaces)}k.is=I})(Ye||(t.FormattingOptions=Ye={}));var qe;(function(k){function M(x,_,X){return{range:x,target:_,data:X}}k.create=M;function I(x){var _=x;return G.defined(_)&&c.is(_.range)&&(G.undefined(_.target)||G.string(_.target))}k.is=I})(qe||(t.DocumentLink=qe={}));var O;(function(k){function M(x,_){return{range:x,parent:_}}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&c.is(_.range)&&(_.parent===void 0||k.is(_.parent))}k.is=I})(O||(t.SelectionRange=O={}));var re;(function(k){k.namespace="namespace",k.type="type",k.class="class",k.enum="enum",k.interface="interface",k.struct="struct",k.typeParameter="typeParameter",k.parameter="parameter",k.variable="variable",k.property="property",k.enumMember="enumMember",k.event="event",k.function="function",k.method="method",k.macro="macro",k.keyword="keyword",k.modifier="modifier",k.comment="comment",k.string="string",k.number="number",k.regexp="regexp",k.operator="operator",k.decorator="decorator"})(re||(t.SemanticTokenTypes=re={}));var ae;(function(k){k.declaration="declaration",k.definition="definition",k.readonly="readonly",k.static="static",k.deprecated="deprecated",k.abstract="abstract",k.async="async",k.modification="modification",k.documentation="documentation",k.defaultLibrary="defaultLibrary"})(ae||(t.SemanticTokenModifiers=ae={}));var xe;(function(k){function M(I){var x=I;return G.objectLiteral(x)&&(x.resultId===void 0||typeof x.resultId=="string")&&Array.isArray(x.data)&&(x.data.length===0||typeof x.data[0]=="number")}k.is=M})(xe||(t.SemanticTokens=xe={}));var yt;(function(k){function M(x,_){return{range:x,text:_}}k.create=M;function I(x){var _=x;return _!=null&&c.is(_.range)&&G.string(_.text)}k.is=I})(yt||(t.InlineValueText=yt={}));var Pt;(function(k){function M(x,_,X){return{range:x,variableName:_,caseSensitiveLookup:X}}k.create=M;function I(x){var _=x;return _!=null&&c.is(_.range)&&G.boolean(_.caseSensitiveLookup)&&(G.string(_.variableName)||_.variableName===void 0)}k.is=I})(Pt||(t.InlineValueVariableLookup=Pt={}));var _t;(function(k){function M(x,_){return{range:x,expression:_}}k.create=M;function I(x){var _=x;return _!=null&&c.is(_.range)&&(G.string(_.expression)||_.expression===void 0)}k.is=I})(_t||(t.InlineValueEvaluatableExpression=_t={}));var Ze;(function(k){function M(x,_){return{frameId:x,stoppedLocation:_}}k.create=M;function I(x){var _=x;return G.defined(_)&&c.is(x.stoppedLocation)}k.is=I})(Ze||(t.InlineValueContext=Ze={}));var lt;(function(k){k.Type=1,k.Parameter=2;function M(I){return I===1||I===2}k.is=M})(lt||(t.InlayHintKind=lt={}));var qt;(function(k){function M(x){return{value:x}}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&(_.tooltip===void 0||G.string(_.tooltip)||yn.is(_.tooltip))&&(_.location===void 0||p.is(_.location))&&(_.command===void 0||u.is(_.command))}k.is=I})(qt||(t.InlayHintLabelPart=qt={}));var It;(function(k){function M(x,_,X){var _e={position:x,label:_};return X!==void 0&&(_e.kind=X),_e}k.create=M;function I(x){var _=x;return G.objectLiteral(_)&&a.is(_.position)&&(G.string(_.label)||G.typedArray(_.label,qt.is))&&(_.kind===void 0||lt.is(_.kind))&&_.textEdits===void 0||G.typedArray(_.textEdits,B.is)&&(_.tooltip===void 0||G.string(_.tooltip)||yn.is(_.tooltip))&&(_.paddingLeft===void 0||G.boolean(_.paddingLeft))&&(_.paddingRight===void 0||G.boolean(_.paddingRight))}k.is=I})(It||(t.InlayHint=It={}));var tn;(function(k){function M(I){return{kind:"snippet",value:I}}k.createSnippet=M})(tn||(t.StringValue=tn={}));var Ot;(function(k){function M(I,x,_,X){return{insertText:I,filterText:x,range:_,command:X}}k.create=M})(Ot||(t.InlineCompletionItem=Ot={}));var jt;(function(k){function M(I){return{items:I}}k.create=M})(jt||(t.InlineCompletionList=jt={}));var jr;(function(k){k.Invoked=0,k.Automatic=1})(jr||(t.InlineCompletionTriggerKind=jr={}));var no;(function(k){function M(I,x){return{range:I,text:x}}k.create=M})(no||(t.SelectedCompletionInfo=no={}));var Ts;(function(k){function M(I,x){return{triggerKind:I,selectedCompletionInfo:x}}k.create=M})(Ts||(t.InlineCompletionContext=Ts={}));var ws;(function(k){function M(I){var x=I;return G.objectLiteral(x)&&i.is(x.uri)&&G.string(x.name)}k.is=M})(ws||(t.WorkspaceFolder=ws={})),t.EOL=[`
`,`\r
`,"\r"];var Rs;(function(k){function M(X,_e,kt,fn){return new Rc(X,_e,kt,fn)}k.create=M;function I(X){var _e=X;return!!(G.defined(_e)&&G.string(_e.uri)&&(G.undefined(_e.languageId)||G.string(_e.languageId))&&G.uinteger(_e.lineCount)&&G.func(_e.getText)&&G.func(_e.positionAt)&&G.func(_e.offsetAt))}k.is=I;function x(X,_e){for(var kt=X.getText(),fn=_(_e,function(A,N){var L=A.range.start.line-N.range.start.line;return L===0?A.range.start.character-N.range.start.character:L}),Qt=kt.length,er=fn.length-1;er>=0;er--){var tr=fn[er],dr=X.offsetAt(tr.range.start),T=X.offsetAt(tr.range.end);if(T<=Qt)kt=kt.substring(0,dr)+tr.newText+kt.substring(T,kt.length);else throw new Error("Overlapping edit");Qt=dr}return kt}k.applyEdits=x;function _(X,_e){if(X.length<=1)return X;var kt=X.length/2|0,fn=X.slice(0,kt),Qt=X.slice(kt);_(fn,_e),_(Qt,_e);for(var er=0,tr=0,dr=0;er<fn.length&&tr<Qt.length;){var T=_e(fn[er],Qt[tr]);T<=0?X[dr++]=fn[er++]:X[dr++]=Qt[tr++]}for(;er<fn.length;)X[dr++]=fn[er++];for(;tr<Qt.length;)X[dr++]=Qt[tr++];return X}})(Rs||(t.TextDocument=Rs={}));var Rc=function(){function k(M,I,x,_){this._uri=M,this._languageId=I,this._version=x,this._content=_,this._lineOffsets=void 0}return Object.defineProperty(k.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),k.prototype.getText=function(M){if(M){var I=this.offsetAt(M.start),x=this.offsetAt(M.end);return this._content.substring(I,x)}return this._content},k.prototype.update=function(M,I){this._content=M.text,this._version=I,this._lineOffsets=void 0},k.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var M=[],I=this._content,x=!0,_=0;_<I.length;_++){x&&(M.push(_),x=!1);var X=I.charAt(_);x=X==="\r"||X===`
`,X==="\r"&&_+1<I.length&&I.charAt(_+1)===`
`&&_++}x&&I.length>0&&M.push(I.length),this._lineOffsets=M}return this._lineOffsets},k.prototype.positionAt=function(M){M=Math.max(Math.min(M,this._content.length),0);var I=this.getLineOffsets(),x=0,_=I.length;if(_===0)return a.create(0,M);for(;x<_;){var X=Math.floor((x+_)/2);I[X]>M?_=X:x=X+1}var _e=x-1;return a.create(_e,M-I[_e])},k.prototype.offsetAt=function(M){var I=this.getLineOffsets();if(M.line>=I.length)return this._content.length;if(M.line<0)return 0;var x=I[M.line],_=M.line+1<I.length?I[M.line+1]:this._content.length;return Math.max(Math.min(x+M.character,_),x)},Object.defineProperty(k.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),k}(),G;(function(k){var M=Object.prototype.toString;function I(T){return typeof T<"u"}k.defined=I;function x(T){return typeof T>"u"}k.undefined=x;function _(T){return T===!0||T===!1}k.boolean=_;function X(T){return M.call(T)==="[object String]"}k.string=X;function _e(T){return M.call(T)==="[object Number]"}k.number=_e;function kt(T,A,N){return M.call(T)==="[object Number]"&&A<=T&&T<=N}k.numberRange=kt;function fn(T){return M.call(T)==="[object Number]"&&-2147483648<=T&&T<=2147483647}k.integer=fn;function Qt(T){return M.call(T)==="[object Number]"&&0<=T&&T<=2147483647}k.uinteger=Qt;function er(T){return M.call(T)==="[object Function]"}k.func=er;function tr(T){return T!==null&&typeof T=="object"}k.objectLiteral=tr;function dr(T,A){return Array.isArray(T)&&T.every(A)}k.typedArray=dr})(G||(G={}))})});var dn=Qe(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.ProtocolNotificationType=Gn.ProtocolNotificationType0=Gn.ProtocolRequestType=Gn.ProtocolRequestType0=Gn.RegistrationType=Gn.MessageDirection=void 0;var fo=gi(),ed;(function(e){e.clientToServer="clientToServer",e.serverToClient="serverToClient",e.both="both"})(ed||(Gn.MessageDirection=ed={}));var jl=class{constructor(t){this.method=t}};Gn.RegistrationType=jl;var Kl=class extends fo.RequestType0{constructor(t){super(t)}};Gn.ProtocolRequestType0=Kl;var $l=class extends fo.RequestType{constructor(t){super(t,fo.ParameterStructures.byName)}};Gn.ProtocolRequestType=$l;var Wl=class extends fo.NotificationType0{constructor(t){super(t)}};Gn.ProtocolNotificationType0=Wl;var Vl=class extends fo.NotificationType{constructor(t){super(t,fo.ParameterStructures.byName)}};Gn.ProtocolNotificationType=Vl});var Js=Qe(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.objectLiteral=Rn.typedArray=Rn.stringArray=Rn.array=Rn.func=Rn.error=Rn.number=Rn.string=Rn.boolean=void 0;function Qb(e){return e===!0||e===!1}Rn.boolean=Qb;function td(e){return typeof e=="string"||e instanceof String}Rn.string=td;function Jb(e){return typeof e=="number"||e instanceof Number}Rn.number=Jb;function Zb(e){return e instanceof Error}Rn.error=Zb;function Yb(e){return typeof e=="function"}Rn.func=Yb;function nd(e){return Array.isArray(e)}Rn.array=nd;function ey(e){return nd(e)&&e.every(t=>td(t))}Rn.stringArray=ey;function ty(e,t){return Array.isArray(e)&&e.every(t)}Rn.typedArray=ty;function ny(e){return e!==null&&typeof e=="object"}Rn.objectLiteral=ny});var od=Qe(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.ImplementationRequest=void 0;var rd=dn(),id;(function(e){e.method="textDocument/implementation",e.messageDirection=rd.MessageDirection.clientToServer,e.type=new rd.ProtocolRequestType(e.method)})(id||(Zs.ImplementationRequest=id={}))});var cd=Qe(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.TypeDefinitionRequest=void 0;var sd=dn(),ad;(function(e){e.method="textDocument/typeDefinition",e.messageDirection=sd.MessageDirection.clientToServer,e.type=new sd.ProtocolRequestType(e.method)})(ad||(Ys.TypeDefinitionRequest=ad={}))});var fd=Qe(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.DidChangeWorkspaceFoldersNotification=po.WorkspaceFoldersRequest=void 0;var ea=dn(),ld;(function(e){e.method="workspace/workspaceFolders",e.messageDirection=ea.MessageDirection.serverToClient,e.type=new ea.ProtocolRequestType0(e.method)})(ld||(po.WorkspaceFoldersRequest=ld={}));var ud;(function(e){e.method="workspace/didChangeWorkspaceFolders",e.messageDirection=ea.MessageDirection.clientToServer,e.type=new ea.ProtocolNotificationType(e.method)})(ud||(po.DidChangeWorkspaceFoldersNotification=ud={}))});var hd=Qe(ta=>{"use strict";Object.defineProperty(ta,"__esModule",{value:!0});ta.ConfigurationRequest=void 0;var dd=dn(),pd;(function(e){e.method="workspace/configuration",e.messageDirection=dd.MessageDirection.serverToClient,e.type=new dd.ProtocolRequestType(e.method)})(pd||(ta.ConfigurationRequest=pd={}))});var _d=Qe(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.ColorPresentationRequest=ho.DocumentColorRequest=void 0;var na=dn(),gd;(function(e){e.method="textDocument/documentColor",e.messageDirection=na.MessageDirection.clientToServer,e.type=new na.ProtocolRequestType(e.method)})(gd||(ho.DocumentColorRequest=gd={}));var md;(function(e){e.method="textDocument/colorPresentation",e.messageDirection=na.MessageDirection.clientToServer,e.type=new na.ProtocolRequestType(e.method)})(md||(ho.ColorPresentationRequest=md={}))});var kd=Qe(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});go.FoldingRangeRefreshRequest=go.FoldingRangeRequest=void 0;var ra=dn(),bd;(function(e){e.method="textDocument/foldingRange",e.messageDirection=ra.MessageDirection.clientToServer,e.type=new ra.ProtocolRequestType(e.method)})(bd||(go.FoldingRangeRequest=bd={}));var yd;(function(e){e.method="workspace/foldingRange/refresh",e.messageDirection=ra.MessageDirection.serverToClient,e.type=new ra.ProtocolRequestType0(e.method)})(yd||(go.FoldingRangeRefreshRequest=yd={}))});var wd=Qe(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.DeclarationRequest=void 0;var vd=dn(),Td;(function(e){e.method="textDocument/declaration",e.messageDirection=vd.MessageDirection.clientToServer,e.type=new vd.ProtocolRequestType(e.method)})(Td||(ia.DeclarationRequest=Td={}))});var Cd=Qe(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.SelectionRangeRequest=void 0;var Rd=dn(),xd;(function(e){e.method="textDocument/selectionRange",e.messageDirection=Rd.MessageDirection.clientToServer,e.type=new Rd.ProtocolRequestType(e.method)})(xd||(oa.SelectionRangeRequest=xd={}))});var Pd=Qe(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.WorkDoneProgressCancelNotification=mi.WorkDoneProgressCreateRequest=mi.WorkDoneProgress=void 0;var ry=gi(),sa=dn(),Sd;(function(e){e.type=new ry.ProgressType;function t(n){return n===e.type}e.is=t})(Sd||(mi.WorkDoneProgress=Sd={}));var Dd;(function(e){e.method="window/workDoneProgress/create",e.messageDirection=sa.MessageDirection.serverToClient,e.type=new sa.ProtocolRequestType(e.method)})(Dd||(mi.WorkDoneProgressCreateRequest=Dd={}));var Ad;(function(e){e.method="window/workDoneProgress/cancel",e.messageDirection=sa.MessageDirection.clientToServer,e.type=new sa.ProtocolNotificationType(e.method)})(Ad||(mi.WorkDoneProgressCancelNotification=Ad={}))});var Ld=Qe(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.CallHierarchyOutgoingCallsRequest=_i.CallHierarchyIncomingCallsRequest=_i.CallHierarchyPrepareRequest=void 0;var mo=dn(),Ed;(function(e){e.method="textDocument/prepareCallHierarchy",e.messageDirection=mo.MessageDirection.clientToServer,e.type=new mo.ProtocolRequestType(e.method)})(Ed||(_i.CallHierarchyPrepareRequest=Ed={}));var Od;(function(e){e.method="callHierarchy/incomingCalls",e.messageDirection=mo.MessageDirection.clientToServer,e.type=new mo.ProtocolRequestType(e.method)})(Od||(_i.CallHierarchyIncomingCallsRequest=Od={}));var Nd;(function(e){e.method="callHierarchy/outgoingCalls",e.messageDirection=mo.MessageDirection.clientToServer,e.type=new mo.ProtocolRequestType(e.method)})(Nd||(_i.CallHierarchyOutgoingCallsRequest=Nd={}))});var Kd=Qe(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn.SemanticTokensRefreshRequest=Xn.SemanticTokensRangeRequest=Xn.SemanticTokensDeltaRequest=Xn.SemanticTokensRequest=Xn.SemanticTokensRegistrationType=Xn.TokenFormat=void 0;var Yr=dn(),Md;(function(e){e.Relative="relative"})(Md||(Xn.TokenFormat=Md={}));var Qo;(function(e){e.method="textDocument/semanticTokens",e.type=new Yr.RegistrationType(e.method)})(Qo||(Xn.SemanticTokensRegistrationType=Qo={}));var Id;(function(e){e.method="textDocument/semanticTokens/full",e.messageDirection=Yr.MessageDirection.clientToServer,e.type=new Yr.ProtocolRequestType(e.method),e.registrationMethod=Qo.method})(Id||(Xn.SemanticTokensRequest=Id={}));var Fd;(function(e){e.method="textDocument/semanticTokens/full/delta",e.messageDirection=Yr.MessageDirection.clientToServer,e.type=new Yr.ProtocolRequestType(e.method),e.registrationMethod=Qo.method})(Fd||(Xn.SemanticTokensDeltaRequest=Fd={}));var qd;(function(e){e.method="textDocument/semanticTokens/range",e.messageDirection=Yr.MessageDirection.clientToServer,e.type=new Yr.ProtocolRequestType(e.method),e.registrationMethod=Qo.method})(qd||(Xn.SemanticTokensRangeRequest=qd={}));var jd;(function(e){e.method="workspace/semanticTokens/refresh",e.messageDirection=Yr.MessageDirection.serverToClient,e.type=new Yr.ProtocolRequestType0(e.method)})(jd||(Xn.SemanticTokensRefreshRequest=jd={}))});var Vd=Qe(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.ShowDocumentRequest=void 0;var $d=dn(),Wd;(function(e){e.method="window/showDocument",e.messageDirection=$d.MessageDirection.serverToClient,e.type=new $d.ProtocolRequestType(e.method)})(Wd||(aa.ShowDocumentRequest=Wd={}))});var Hd=Qe(ca=>{"use strict";Object.defineProperty(ca,"__esModule",{value:!0});ca.LinkedEditingRangeRequest=void 0;var Ud=dn(),Bd;(function(e){e.method="textDocument/linkedEditingRange",e.messageDirection=Ud.MessageDirection.clientToServer,e.type=new Ud.ProtocolRequestType(e.method)})(Bd||(ca.LinkedEditingRangeRequest=Bd={}))});var ep=Qe($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.WillDeleteFilesRequest=$n.DidDeleteFilesNotification=$n.DidRenameFilesNotification=$n.WillRenameFilesRequest=$n.DidCreateFilesNotification=$n.WillCreateFilesRequest=$n.FileOperationPatternKind=void 0;var br=dn(),zd;(function(e){e.file="file",e.folder="folder"})(zd||($n.FileOperationPatternKind=zd={}));var Gd;(function(e){e.method="workspace/willCreateFiles",e.messageDirection=br.MessageDirection.clientToServer,e.type=new br.ProtocolRequestType(e.method)})(Gd||($n.WillCreateFilesRequest=Gd={}));var Xd;(function(e){e.method="workspace/didCreateFiles",e.messageDirection=br.MessageDirection.clientToServer,e.type=new br.ProtocolNotificationType(e.method)})(Xd||($n.DidCreateFilesNotification=Xd={}));var Qd;(function(e){e.method="workspace/willRenameFiles",e.messageDirection=br.MessageDirection.clientToServer,e.type=new br.ProtocolRequestType(e.method)})(Qd||($n.WillRenameFilesRequest=Qd={}));var Jd;(function(e){e.method="workspace/didRenameFiles",e.messageDirection=br.MessageDirection.clientToServer,e.type=new br.ProtocolNotificationType(e.method)})(Jd||($n.DidRenameFilesNotification=Jd={}));var Zd;(function(e){e.method="workspace/didDeleteFiles",e.messageDirection=br.MessageDirection.clientToServer,e.type=new br.ProtocolNotificationType(e.method)})(Zd||($n.DidDeleteFilesNotification=Zd={}));var Yd;(function(e){e.method="workspace/willDeleteFiles",e.messageDirection=br.MessageDirection.clientToServer,e.type=new br.ProtocolRequestType(e.method)})(Yd||($n.WillDeleteFilesRequest=Yd={}))});var op=Qe(bi=>{"use strict";Object.defineProperty(bi,"__esModule",{value:!0});bi.MonikerRequest=bi.MonikerKind=bi.UniquenessLevel=void 0;var tp=dn(),np;(function(e){e.document="document",e.project="project",e.group="group",e.scheme="scheme",e.global="global"})(np||(bi.UniquenessLevel=np={}));var rp;(function(e){e.$import="import",e.$export="export",e.local="local"})(rp||(bi.MonikerKind=rp={}));var ip;(function(e){e.method="textDocument/moniker",e.messageDirection=tp.MessageDirection.clientToServer,e.type=new tp.ProtocolRequestType(e.method)})(ip||(bi.MonikerRequest=ip={}))});var lp=Qe(yi=>{"use strict";Object.defineProperty(yi,"__esModule",{value:!0});yi.TypeHierarchySubtypesRequest=yi.TypeHierarchySupertypesRequest=yi.TypeHierarchyPrepareRequest=void 0;var _o=dn(),sp;(function(e){e.method="textDocument/prepareTypeHierarchy",e.messageDirection=_o.MessageDirection.clientToServer,e.type=new _o.ProtocolRequestType(e.method)})(sp||(yi.TypeHierarchyPrepareRequest=sp={}));var ap;(function(e){e.method="typeHierarchy/supertypes",e.messageDirection=_o.MessageDirection.clientToServer,e.type=new _o.ProtocolRequestType(e.method)})(ap||(yi.TypeHierarchySupertypesRequest=ap={}));var cp;(function(e){e.method="typeHierarchy/subtypes",e.messageDirection=_o.MessageDirection.clientToServer,e.type=new _o.ProtocolRequestType(e.method)})(cp||(yi.TypeHierarchySubtypesRequest=cp={}))});var dp=Qe(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.InlineValueRefreshRequest=bo.InlineValueRequest=void 0;var la=dn(),up;(function(e){e.method="textDocument/inlineValue",e.messageDirection=la.MessageDirection.clientToServer,e.type=new la.ProtocolRequestType(e.method)})(up||(bo.InlineValueRequest=up={}));var fp;(function(e){e.method="workspace/inlineValue/refresh",e.messageDirection=la.MessageDirection.serverToClient,e.type=new la.ProtocolRequestType0(e.method)})(fp||(bo.InlineValueRefreshRequest=fp={}))});var mp=Qe(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.InlayHintRefreshRequest=ki.InlayHintResolveRequest=ki.InlayHintRequest=void 0;var yo=dn(),pp;(function(e){e.method="textDocument/inlayHint",e.messageDirection=yo.MessageDirection.clientToServer,e.type=new yo.ProtocolRequestType(e.method)})(pp||(ki.InlayHintRequest=pp={}));var hp;(function(e){e.method="inlayHint/resolve",e.messageDirection=yo.MessageDirection.clientToServer,e.type=new yo.ProtocolRequestType(e.method)})(hp||(ki.InlayHintResolveRequest=hp={}));var gp;(function(e){e.method="workspace/inlayHint/refresh",e.messageDirection=yo.MessageDirection.serverToClient,e.type=new yo.ProtocolRequestType0(e.method)})(gp||(ki.InlayHintRefreshRequest=gp={}))});var wp=Qe(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.DiagnosticRefreshRequest=yr.WorkspaceDiagnosticRequest=yr.DocumentDiagnosticRequest=yr.DocumentDiagnosticReportKind=yr.DiagnosticServerCancellationData=void 0;var Tp=gi(),iy=Js(),ko=dn(),_p;(function(e){function t(n){let i=n;return i&&iy.boolean(i.retriggerRequest)}e.is=t})(_p||(yr.DiagnosticServerCancellationData=_p={}));var bp;(function(e){e.Full="full",e.Unchanged="unchanged"})(bp||(yr.DocumentDiagnosticReportKind=bp={}));var yp;(function(e){e.method="textDocument/diagnostic",e.messageDirection=ko.MessageDirection.clientToServer,e.type=new ko.ProtocolRequestType(e.method),e.partialResult=new Tp.ProgressType})(yp||(yr.DocumentDiagnosticRequest=yp={}));var kp;(function(e){e.method="workspace/diagnostic",e.messageDirection=ko.MessageDirection.clientToServer,e.type=new ko.ProtocolRequestType(e.method),e.partialResult=new Tp.ProgressType})(kp||(yr.WorkspaceDiagnosticRequest=kp={}));var vp;(function(e){e.method="workspace/diagnostic/refresh",e.messageDirection=ko.MessageDirection.serverToClient,e.type=new ko.ProtocolRequestType0(e.method)})(vp||(yr.DiagnosticRefreshRequest=vp={}))});var Pp=Qe(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.DidCloseNotebookDocumentNotification=kn.DidSaveNotebookDocumentNotification=kn.DidChangeNotebookDocumentNotification=kn.NotebookCellArrayChange=kn.DidOpenNotebookDocumentNotification=kn.NotebookDocumentSyncRegistrationType=kn.NotebookDocument=kn.NotebookCell=kn.ExecutionSummary=kn.NotebookCellKind=void 0;var Jo=Qs(),Er=Js(),Vr=dn(),Ul;(function(e){e.Markup=1,e.Code=2;function t(n){return n===1||n===2}e.is=t})(Ul||(kn.NotebookCellKind=Ul={}));var Bl;(function(e){function t(r,s){let a={executionOrder:r};return(s===!0||s===!1)&&(a.success=s),a}e.create=t;function n(r){let s=r;return Er.objectLiteral(s)&&Jo.uinteger.is(s.executionOrder)&&(s.success===void 0||Er.boolean(s.success))}e.is=n;function i(r,s){return r===s?!0:r==null||s===null||s===void 0?!1:r.executionOrder===s.executionOrder&&r.success===s.success}e.equals=i})(Bl||(kn.ExecutionSummary=Bl={}));var ua;(function(e){function t(s,a){return{kind:s,document:a}}e.create=t;function n(s){let a=s;return Er.objectLiteral(a)&&Ul.is(a.kind)&&Jo.DocumentUri.is(a.document)&&(a.metadata===void 0||Er.objectLiteral(a.metadata))}e.is=n;function i(s,a){let c=new Set;return s.document!==a.document&&c.add("document"),s.kind!==a.kind&&c.add("kind"),s.executionSummary!==a.executionSummary&&c.add("executionSummary"),(s.metadata!==void 0||a.metadata!==void 0)&&!r(s.metadata,a.metadata)&&c.add("metadata"),(s.executionSummary!==void 0||a.executionSummary!==void 0)&&!Bl.equals(s.executionSummary,a.executionSummary)&&c.add("executionSummary"),c}e.diff=i;function r(s,a){if(s===a)return!0;if(s==null||a===null||a===void 0||typeof s!=typeof a||typeof s!="object")return!1;let c=Array.isArray(s),p=Array.isArray(a);if(c!==p)return!1;if(c&&p){if(s.length!==a.length)return!1;for(let f=0;f<s.length;f++)if(!r(s[f],a[f]))return!1}if(Er.objectLiteral(s)&&Er.objectLiteral(a)){let f=Object.keys(s),l=Object.keys(a);if(f.length!==l.length||(f.sort(),l.sort(),!r(f,l)))return!1;for(let b=0;b<f.length;b++){let v=f[b];if(!r(s[v],a[v]))return!1}}return!0}})(ua||(kn.NotebookCell=ua={}));var Rp;(function(e){function t(i,r,s,a){return{uri:i,notebookType:r,version:s,cells:a}}e.create=t;function n(i){let r=i;return Er.objectLiteral(r)&&Er.string(r.uri)&&Jo.integer.is(r.version)&&Er.typedArray(r.cells,ua.is)}e.is=n})(Rp||(kn.NotebookDocument=Rp={}));var vo;(function(e){e.method="notebookDocument/sync",e.messageDirection=Vr.MessageDirection.clientToServer,e.type=new Vr.RegistrationType(e.method)})(vo||(kn.NotebookDocumentSyncRegistrationType=vo={}));var xp;(function(e){e.method="notebookDocument/didOpen",e.messageDirection=Vr.MessageDirection.clientToServer,e.type=new Vr.ProtocolNotificationType(e.method),e.registrationMethod=vo.method})(xp||(kn.DidOpenNotebookDocumentNotification=xp={}));var Cp;(function(e){function t(i){let r=i;return Er.objectLiteral(r)&&Jo.uinteger.is(r.start)&&Jo.uinteger.is(r.deleteCount)&&(r.cells===void 0||Er.typedArray(r.cells,ua.is))}e.is=t;function n(i,r,s){let a={start:i,deleteCount:r};return s!==void 0&&(a.cells=s),a}e.create=n})(Cp||(kn.NotebookCellArrayChange=Cp={}));var Sp;(function(e){e.method="notebookDocument/didChange",e.messageDirection=Vr.MessageDirection.clientToServer,e.type=new Vr.ProtocolNotificationType(e.method),e.registrationMethod=vo.method})(Sp||(kn.DidChangeNotebookDocumentNotification=Sp={}));var Dp;(function(e){e.method="notebookDocument/didSave",e.messageDirection=Vr.MessageDirection.clientToServer,e.type=new Vr.ProtocolNotificationType(e.method),e.registrationMethod=vo.method})(Dp||(kn.DidSaveNotebookDocumentNotification=Dp={}));var Ap;(function(e){e.method="notebookDocument/didClose",e.messageDirection=Vr.MessageDirection.clientToServer,e.type=new Vr.ProtocolNotificationType(e.method),e.registrationMethod=vo.method})(Ap||(kn.DidCloseNotebookDocumentNotification=Ap={}))});var Np=Qe(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});fa.InlineCompletionRequest=void 0;var Ep=dn(),Op;(function(e){e.method="textDocument/inlineCompletion",e.messageDirection=Ep.MessageDirection.clientToServer,e.type=new Ep.ProtocolRequestType(e.method)})(Op||(fa.InlineCompletionRequest=Op={}))});var Hh=Qe(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.WorkspaceSymbolRequest=P.CodeActionResolveRequest=P.CodeActionRequest=P.DocumentSymbolRequest=P.DocumentHighlightRequest=P.ReferencesRequest=P.DefinitionRequest=P.SignatureHelpRequest=P.SignatureHelpTriggerKind=P.HoverRequest=P.CompletionResolveRequest=P.CompletionRequest=P.CompletionTriggerKind=P.PublishDiagnosticsNotification=P.WatchKind=P.RelativePattern=P.FileChangeType=P.DidChangeWatchedFilesNotification=P.WillSaveTextDocumentWaitUntilRequest=P.WillSaveTextDocumentNotification=P.TextDocumentSaveReason=P.DidSaveTextDocumentNotification=P.DidCloseTextDocumentNotification=P.DidChangeTextDocumentNotification=P.TextDocumentContentChangeEvent=P.DidOpenTextDocumentNotification=P.TextDocumentSyncKind=P.TelemetryEventNotification=P.LogMessageNotification=P.ShowMessageRequest=P.ShowMessageNotification=P.MessageType=P.DidChangeConfigurationNotification=P.ExitNotification=P.ShutdownRequest=P.InitializedNotification=P.InitializeErrorCodes=P.InitializeRequest=P.WorkDoneProgressOptions=P.TextDocumentRegistrationOptions=P.StaticRegistrationOptions=P.PositionEncodingKind=P.FailureHandlingKind=P.ResourceOperationKind=P.UnregistrationRequest=P.RegistrationRequest=P.DocumentSelector=P.NotebookCellTextDocumentFilter=P.NotebookDocumentFilter=P.TextDocumentFilter=void 0;P.MonikerRequest=P.MonikerKind=P.UniquenessLevel=P.WillDeleteFilesRequest=P.DidDeleteFilesNotification=P.WillRenameFilesRequest=P.DidRenameFilesNotification=P.WillCreateFilesRequest=P.DidCreateFilesNotification=P.FileOperationPatternKind=P.LinkedEditingRangeRequest=P.ShowDocumentRequest=P.SemanticTokensRegistrationType=P.SemanticTokensRefreshRequest=P.SemanticTokensRangeRequest=P.SemanticTokensDeltaRequest=P.SemanticTokensRequest=P.TokenFormat=P.CallHierarchyPrepareRequest=P.CallHierarchyOutgoingCallsRequest=P.CallHierarchyIncomingCallsRequest=P.WorkDoneProgressCancelNotification=P.WorkDoneProgressCreateRequest=P.WorkDoneProgress=P.SelectionRangeRequest=P.DeclarationRequest=P.FoldingRangeRefreshRequest=P.FoldingRangeRequest=P.ColorPresentationRequest=P.DocumentColorRequest=P.ConfigurationRequest=P.DidChangeWorkspaceFoldersNotification=P.WorkspaceFoldersRequest=P.TypeDefinitionRequest=P.ImplementationRequest=P.ApplyWorkspaceEditRequest=P.ExecuteCommandRequest=P.PrepareRenameRequest=P.RenameRequest=P.PrepareSupportDefaultBehavior=P.DocumentOnTypeFormattingRequest=P.DocumentRangesFormattingRequest=P.DocumentRangeFormattingRequest=P.DocumentFormattingRequest=P.DocumentLinkResolveRequest=P.DocumentLinkRequest=P.CodeLensRefreshRequest=P.CodeLensResolveRequest=P.CodeLensRequest=P.WorkspaceSymbolResolveRequest=void 0;P.InlineCompletionRequest=P.DidCloseNotebookDocumentNotification=P.DidSaveNotebookDocumentNotification=P.DidChangeNotebookDocumentNotification=P.NotebookCellArrayChange=P.DidOpenNotebookDocumentNotification=P.NotebookDocumentSyncRegistrationType=P.NotebookDocument=P.NotebookCell=P.ExecutionSummary=P.NotebookCellKind=P.DiagnosticRefreshRequest=P.WorkspaceDiagnosticRequest=P.DocumentDiagnosticRequest=P.DocumentDiagnosticReportKind=P.DiagnosticServerCancellationData=P.InlayHintRefreshRequest=P.InlayHintResolveRequest=P.InlayHintRequest=P.InlineValueRefreshRequest=P.InlineValueRequest=P.TypeHierarchySupertypesRequest=P.TypeHierarchySubtypesRequest=P.TypeHierarchyPrepareRequest=void 0;var Ie=dn(),Lp=Qs(),An=Js(),oy=od();Object.defineProperty(P,"ImplementationRequest",{enumerable:!0,get:function(){return oy.ImplementationRequest}});var sy=cd();Object.defineProperty(P,"TypeDefinitionRequest",{enumerable:!0,get:function(){return sy.TypeDefinitionRequest}});var Wh=fd();Object.defineProperty(P,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return Wh.WorkspaceFoldersRequest}});Object.defineProperty(P,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return Wh.DidChangeWorkspaceFoldersNotification}});var ay=hd();Object.defineProperty(P,"ConfigurationRequest",{enumerable:!0,get:function(){return ay.ConfigurationRequest}});var Vh=_d();Object.defineProperty(P,"DocumentColorRequest",{enumerable:!0,get:function(){return Vh.DocumentColorRequest}});Object.defineProperty(P,"ColorPresentationRequest",{enumerable:!0,get:function(){return Vh.ColorPresentationRequest}});var Uh=kd();Object.defineProperty(P,"FoldingRangeRequest",{enumerable:!0,get:function(){return Uh.FoldingRangeRequest}});Object.defineProperty(P,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return Uh.FoldingRangeRefreshRequest}});var cy=wd();Object.defineProperty(P,"DeclarationRequest",{enumerable:!0,get:function(){return cy.DeclarationRequest}});var ly=Cd();Object.defineProperty(P,"SelectionRangeRequest",{enumerable:!0,get:function(){return ly.SelectionRangeRequest}});var Ql=Pd();Object.defineProperty(P,"WorkDoneProgress",{enumerable:!0,get:function(){return Ql.WorkDoneProgress}});Object.defineProperty(P,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return Ql.WorkDoneProgressCreateRequest}});Object.defineProperty(P,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return Ql.WorkDoneProgressCancelNotification}});var Jl=Ld();Object.defineProperty(P,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return Jl.CallHierarchyIncomingCallsRequest}});Object.defineProperty(P,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return Jl.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(P,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return Jl.CallHierarchyPrepareRequest}});var To=Kd();Object.defineProperty(P,"TokenFormat",{enumerable:!0,get:function(){return To.TokenFormat}});Object.defineProperty(P,"SemanticTokensRequest",{enumerable:!0,get:function(){return To.SemanticTokensRequest}});Object.defineProperty(P,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return To.SemanticTokensDeltaRequest}});Object.defineProperty(P,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return To.SemanticTokensRangeRequest}});Object.defineProperty(P,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return To.SemanticTokensRefreshRequest}});Object.defineProperty(P,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return To.SemanticTokensRegistrationType}});var uy=Vd();Object.defineProperty(P,"ShowDocumentRequest",{enumerable:!0,get:function(){return uy.ShowDocumentRequest}});var fy=Hd();Object.defineProperty(P,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return fy.LinkedEditingRangeRequest}});var qi=ep();Object.defineProperty(P,"FileOperationPatternKind",{enumerable:!0,get:function(){return qi.FileOperationPatternKind}});Object.defineProperty(P,"DidCreateFilesNotification",{enumerable:!0,get:function(){return qi.DidCreateFilesNotification}});Object.defineProperty(P,"WillCreateFilesRequest",{enumerable:!0,get:function(){return qi.WillCreateFilesRequest}});Object.defineProperty(P,"DidRenameFilesNotification",{enumerable:!0,get:function(){return qi.DidRenameFilesNotification}});Object.defineProperty(P,"WillRenameFilesRequest",{enumerable:!0,get:function(){return qi.WillRenameFilesRequest}});Object.defineProperty(P,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return qi.DidDeleteFilesNotification}});Object.defineProperty(P,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return qi.WillDeleteFilesRequest}});var Zl=op();Object.defineProperty(P,"UniquenessLevel",{enumerable:!0,get:function(){return Zl.UniquenessLevel}});Object.defineProperty(P,"MonikerKind",{enumerable:!0,get:function(){return Zl.MonikerKind}});Object.defineProperty(P,"MonikerRequest",{enumerable:!0,get:function(){return Zl.MonikerRequest}});var Yl=lp();Object.defineProperty(P,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return Yl.TypeHierarchyPrepareRequest}});Object.defineProperty(P,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return Yl.TypeHierarchySubtypesRequest}});Object.defineProperty(P,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return Yl.TypeHierarchySupertypesRequest}});var Bh=dp();Object.defineProperty(P,"InlineValueRequest",{enumerable:!0,get:function(){return Bh.InlineValueRequest}});Object.defineProperty(P,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return Bh.InlineValueRefreshRequest}});var eu=mp();Object.defineProperty(P,"InlayHintRequest",{enumerable:!0,get:function(){return eu.InlayHintRequest}});Object.defineProperty(P,"InlayHintResolveRequest",{enumerable:!0,get:function(){return eu.InlayHintResolveRequest}});Object.defineProperty(P,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return eu.InlayHintRefreshRequest}});var Zo=wp();Object.defineProperty(P,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return Zo.DiagnosticServerCancellationData}});Object.defineProperty(P,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return Zo.DocumentDiagnosticReportKind}});Object.defineProperty(P,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return Zo.DocumentDiagnosticRequest}});Object.defineProperty(P,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return Zo.WorkspaceDiagnosticRequest}});Object.defineProperty(P,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return Zo.DiagnosticRefreshRequest}});var Ur=Pp();Object.defineProperty(P,"NotebookCellKind",{enumerable:!0,get:function(){return Ur.NotebookCellKind}});Object.defineProperty(P,"ExecutionSummary",{enumerable:!0,get:function(){return Ur.ExecutionSummary}});Object.defineProperty(P,"NotebookCell",{enumerable:!0,get:function(){return Ur.NotebookCell}});Object.defineProperty(P,"NotebookDocument",{enumerable:!0,get:function(){return Ur.NotebookDocument}});Object.defineProperty(P,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return Ur.NotebookDocumentSyncRegistrationType}});Object.defineProperty(P,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return Ur.DidOpenNotebookDocumentNotification}});Object.defineProperty(P,"NotebookCellArrayChange",{enumerable:!0,get:function(){return Ur.NotebookCellArrayChange}});Object.defineProperty(P,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return Ur.DidChangeNotebookDocumentNotification}});Object.defineProperty(P,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return Ur.DidSaveNotebookDocumentNotification}});Object.defineProperty(P,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return Ur.DidCloseNotebookDocumentNotification}});var dy=Np();Object.defineProperty(P,"InlineCompletionRequest",{enumerable:!0,get:function(){return dy.InlineCompletionRequest}});var Hl;(function(e){function t(n){let i=n;return An.string(i)||An.string(i.language)||An.string(i.scheme)||An.string(i.pattern)}e.is=t})(Hl||(P.TextDocumentFilter=Hl={}));var zl;(function(e){function t(n){let i=n;return An.objectLiteral(i)&&(An.string(i.notebookType)||An.string(i.scheme)||An.string(i.pattern))}e.is=t})(zl||(P.NotebookDocumentFilter=zl={}));var Gl;(function(e){function t(n){let i=n;return An.objectLiteral(i)&&(An.string(i.notebook)||zl.is(i.notebook))&&(i.language===void 0||An.string(i.language))}e.is=t})(Gl||(P.NotebookCellTextDocumentFilter=Gl={}));var Xl;(function(e){function t(n){if(!Array.isArray(n))return!1;for(let i of n)if(!An.string(i)&&!Hl.is(i)&&!Gl.is(i))return!1;return!0}e.is=t})(Xl||(P.DocumentSelector=Xl={}));var Mp;(function(e){e.method="client/registerCapability",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolRequestType(e.method)})(Mp||(P.RegistrationRequest=Mp={}));var Ip;(function(e){e.method="client/unregisterCapability",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolRequestType(e.method)})(Ip||(P.UnregistrationRequest=Ip={}));var Fp;(function(e){e.Create="create",e.Rename="rename",e.Delete="delete"})(Fp||(P.ResourceOperationKind=Fp={}));var qp;(function(e){e.Abort="abort",e.Transactional="transactional",e.TextOnlyTransactional="textOnlyTransactional",e.Undo="undo"})(qp||(P.FailureHandlingKind=qp={}));var jp;(function(e){e.UTF8="utf-8",e.UTF16="utf-16",e.UTF32="utf-32"})(jp||(P.PositionEncodingKind=jp={}));var Kp;(function(e){function t(n){let i=n;return i&&An.string(i.id)&&i.id.length>0}e.hasId=t})(Kp||(P.StaticRegistrationOptions=Kp={}));var $p;(function(e){function t(n){let i=n;return i&&(i.documentSelector===null||Xl.is(i.documentSelector))}e.is=t})($p||(P.TextDocumentRegistrationOptions=$p={}));var Wp;(function(e){function t(i){let r=i;return An.objectLiteral(r)&&(r.workDoneProgress===void 0||An.boolean(r.workDoneProgress))}e.is=t;function n(i){let r=i;return r&&An.boolean(r.workDoneProgress)}e.hasWorkDoneProgress=n})(Wp||(P.WorkDoneProgressOptions=Wp={}));var Vp;(function(e){e.method="initialize",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Vp||(P.InitializeRequest=Vp={}));var Up;(function(e){e.unknownProtocolVersion=1})(Up||(P.InitializeErrorCodes=Up={}));var Bp;(function(e){e.method="initialized",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType(e.method)})(Bp||(P.InitializedNotification=Bp={}));var Hp;(function(e){e.method="shutdown",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType0(e.method)})(Hp||(P.ShutdownRequest=Hp={}));var zp;(function(e){e.method="exit",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType0(e.method)})(zp||(P.ExitNotification=zp={}));var Gp;(function(e){e.method="workspace/didChangeConfiguration",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType(e.method)})(Gp||(P.DidChangeConfigurationNotification=Gp={}));var Xp;(function(e){e.Error=1,e.Warning=2,e.Info=3,e.Log=4,e.Debug=5})(Xp||(P.MessageType=Xp={}));var Qp;(function(e){e.method="window/showMessage",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolNotificationType(e.method)})(Qp||(P.ShowMessageNotification=Qp={}));var Jp;(function(e){e.method="window/showMessageRequest",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolRequestType(e.method)})(Jp||(P.ShowMessageRequest=Jp={}));var Zp;(function(e){e.method="window/logMessage",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolNotificationType(e.method)})(Zp||(P.LogMessageNotification=Zp={}));var Yp;(function(e){e.method="telemetry/event",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolNotificationType(e.method)})(Yp||(P.TelemetryEventNotification=Yp={}));var eh;(function(e){e.None=0,e.Full=1,e.Incremental=2})(eh||(P.TextDocumentSyncKind=eh={}));var th;(function(e){e.method="textDocument/didOpen",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType(e.method)})(th||(P.DidOpenTextDocumentNotification=th={}));var nh;(function(e){function t(i){let r=i;return r!=null&&typeof r.text=="string"&&r.range!==void 0&&(r.rangeLength===void 0||typeof r.rangeLength=="number")}e.isIncremental=t;function n(i){let r=i;return r!=null&&typeof r.text=="string"&&r.range===void 0&&r.rangeLength===void 0}e.isFull=n})(nh||(P.TextDocumentContentChangeEvent=nh={}));var rh;(function(e){e.method="textDocument/didChange",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType(e.method)})(rh||(P.DidChangeTextDocumentNotification=rh={}));var ih;(function(e){e.method="textDocument/didClose",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType(e.method)})(ih||(P.DidCloseTextDocumentNotification=ih={}));var oh;(function(e){e.method="textDocument/didSave",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType(e.method)})(oh||(P.DidSaveTextDocumentNotification=oh={}));var sh;(function(e){e.Manual=1,e.AfterDelay=2,e.FocusOut=3})(sh||(P.TextDocumentSaveReason=sh={}));var ah;(function(e){e.method="textDocument/willSave",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType(e.method)})(ah||(P.WillSaveTextDocumentNotification=ah={}));var ch;(function(e){e.method="textDocument/willSaveWaitUntil",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(ch||(P.WillSaveTextDocumentWaitUntilRequest=ch={}));var lh;(function(e){e.method="workspace/didChangeWatchedFiles",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolNotificationType(e.method)})(lh||(P.DidChangeWatchedFilesNotification=lh={}));var uh;(function(e){e.Created=1,e.Changed=2,e.Deleted=3})(uh||(P.FileChangeType=uh={}));var fh;(function(e){function t(n){let i=n;return An.objectLiteral(i)&&(Lp.URI.is(i.baseUri)||Lp.WorkspaceFolder.is(i.baseUri))&&An.string(i.pattern)}e.is=t})(fh||(P.RelativePattern=fh={}));var dh;(function(e){e.Create=1,e.Change=2,e.Delete=4})(dh||(P.WatchKind=dh={}));var ph;(function(e){e.method="textDocument/publishDiagnostics",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolNotificationType(e.method)})(ph||(P.PublishDiagnosticsNotification=ph={}));var hh;(function(e){e.Invoked=1,e.TriggerCharacter=2,e.TriggerForIncompleteCompletions=3})(hh||(P.CompletionTriggerKind=hh={}));var gh;(function(e){e.method="textDocument/completion",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(gh||(P.CompletionRequest=gh={}));var mh;(function(e){e.method="completionItem/resolve",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(mh||(P.CompletionResolveRequest=mh={}));var _h;(function(e){e.method="textDocument/hover",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(_h||(P.HoverRequest=_h={}));var bh;(function(e){e.Invoked=1,e.TriggerCharacter=2,e.ContentChange=3})(bh||(P.SignatureHelpTriggerKind=bh={}));var yh;(function(e){e.method="textDocument/signatureHelp",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(yh||(P.SignatureHelpRequest=yh={}));var kh;(function(e){e.method="textDocument/definition",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(kh||(P.DefinitionRequest=kh={}));var vh;(function(e){e.method="textDocument/references",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(vh||(P.ReferencesRequest=vh={}));var Th;(function(e){e.method="textDocument/documentHighlight",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Th||(P.DocumentHighlightRequest=Th={}));var wh;(function(e){e.method="textDocument/documentSymbol",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(wh||(P.DocumentSymbolRequest=wh={}));var Rh;(function(e){e.method="textDocument/codeAction",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Rh||(P.CodeActionRequest=Rh={}));var xh;(function(e){e.method="codeAction/resolve",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(xh||(P.CodeActionResolveRequest=xh={}));var Ch;(function(e){e.method="workspace/symbol",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Ch||(P.WorkspaceSymbolRequest=Ch={}));var Sh;(function(e){e.method="workspaceSymbol/resolve",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Sh||(P.WorkspaceSymbolResolveRequest=Sh={}));var Dh;(function(e){e.method="textDocument/codeLens",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Dh||(P.CodeLensRequest=Dh={}));var Ah;(function(e){e.method="codeLens/resolve",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Ah||(P.CodeLensResolveRequest=Ah={}));var Ph;(function(e){e.method="workspace/codeLens/refresh",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolRequestType0(e.method)})(Ph||(P.CodeLensRefreshRequest=Ph={}));var Eh;(function(e){e.method="textDocument/documentLink",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Eh||(P.DocumentLinkRequest=Eh={}));var Oh;(function(e){e.method="documentLink/resolve",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Oh||(P.DocumentLinkResolveRequest=Oh={}));var Nh;(function(e){e.method="textDocument/formatting",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Nh||(P.DocumentFormattingRequest=Nh={}));var Lh;(function(e){e.method="textDocument/rangeFormatting",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Lh||(P.DocumentRangeFormattingRequest=Lh={}));var Mh;(function(e){e.method="textDocument/rangesFormatting",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Mh||(P.DocumentRangesFormattingRequest=Mh={}));var Ih;(function(e){e.method="textDocument/onTypeFormatting",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Ih||(P.DocumentOnTypeFormattingRequest=Ih={}));var Fh;(function(e){e.Identifier=1})(Fh||(P.PrepareSupportDefaultBehavior=Fh={}));var qh;(function(e){e.method="textDocument/rename",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(qh||(P.RenameRequest=qh={}));var jh;(function(e){e.method="textDocument/prepareRename",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(jh||(P.PrepareRenameRequest=jh={}));var Kh;(function(e){e.method="workspace/executeCommand",e.messageDirection=Ie.MessageDirection.clientToServer,e.type=new Ie.ProtocolRequestType(e.method)})(Kh||(P.ExecuteCommandRequest=Kh={}));var $h;(function(e){e.method="workspace/applyEdit",e.messageDirection=Ie.MessageDirection.serverToClient,e.type=new Ie.ProtocolRequestType("workspace/applyEdit")})($h||(P.ApplyWorkspaceEditRequest=$h={}))});var Gh=Qe(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});da.createProtocolConnection=void 0;var zh=gi();function py(e,t,n,i){return zh.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),(0,zh.createMessageConnection)(e,t,n,i)}da.createProtocolConnection=py});var Qh=Qe(Qn=>{"use strict";var hy=Qn&&Qn.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),pa=Qn&&Qn.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&hy(t,e,n)};Object.defineProperty(Qn,"__esModule",{value:!0});Qn.LSPErrorCodes=Qn.createProtocolConnection=void 0;pa(gi(),Qn);pa(Qs(),Qn);pa(dn(),Qn);pa(Hh(),Qn);var gy=Gh();Object.defineProperty(Qn,"createProtocolConnection",{enumerable:!0,get:function(){return gy.createProtocolConnection}});var Xh;(function(e){e.lspReservedErrorRangeStart=-32899,e.RequestFailed=-32803,e.ServerCancelled=-32802,e.ContentModified=-32801,e.RequestCancelled=-32800,e.lspReservedErrorRangeEnd=-32800})(Xh||(Qn.LSPErrorCodes=Xh={}))});var vn=Qe(Br=>{"use strict";var my=Br&&Br.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),Jh=Br&&Br.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&my(t,e,n)};Object.defineProperty(Br,"__esModule",{value:!0});Br.createProtocolConnection=void 0;var _y=ql();Jh(ql(),Br);Jh(Qh(),Br);function by(e,t,n,i){return(0,_y.createMessageConnection)(e,t,n,i)}Br.createProtocolConnection=by});var tu=Qe(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.generateUuid=kr.parse=kr.isUUID=kr.v4=kr.empty=void 0;var Yo=class{constructor(t){this._value=t}asHex(){return this._value}equals(t){return this.asHex()===t.asHex()}},es=class e extends Yo{static _oneOf(t){return t[Math.floor(t.length*Math.random())]}static _randomHex(){return e._oneOf(e._chars)}constructor(){super([e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),"-",e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),"-","4",e._randomHex(),e._randomHex(),e._randomHex(),"-",e._oneOf(e._timeHighBits),e._randomHex(),e._randomHex(),e._randomHex(),"-",e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex(),e._randomHex()].join(""))}};es._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];es._timeHighBits=["8","9","a","b"];kr.empty=new Yo("00000000-0000-0000-0000-000000000000");function Zh(){return new es}kr.v4=Zh;var yy=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Yh(e){return yy.test(e)}kr.isUUID=Yh;function ky(e){if(!Yh(e))throw new Error("invalid uuid");return new Yo(e)}kr.parse=ky;function vy(){return Zh().asHex()}kr.generateUuid=vy});var eg=Qe(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});Ti.attachPartialResult=Ti.ProgressFeature=Ti.attachWorkDone=void 0;var vi=vn(),Ty=tu(),ji=class e{constructor(t,n){this._connection=t,this._token=n,e.Instances.set(this._token,this)}begin(t,n,i,r){let s={kind:"begin",title:t,percentage:n,message:i,cancellable:r};this._connection.sendProgress(vi.WorkDoneProgress.type,this._token,s)}report(t,n){let i={kind:"report"};typeof t=="number"?(i.percentage=t,n!==void 0&&(i.message=n)):i.message=t,this._connection.sendProgress(vi.WorkDoneProgress.type,this._token,i)}done(){e.Instances.delete(this._token),this._connection.sendProgress(vi.WorkDoneProgress.type,this._token,{kind:"end"})}};ji.Instances=new Map;var ha=class extends ji{constructor(t,n){super(t,n),this._source=new vi.CancellationTokenSource}get token(){return this._source.token}done(){this._source.dispose(),super.done()}cancel(){this._source.cancel()}},ts=class{constructor(){}begin(){}report(){}done(){}},ga=class extends ts{constructor(){super(),this._source=new vi.CancellationTokenSource}get token(){return this._source.token}done(){this._source.dispose()}cancel(){this._source.cancel()}};function wy(e,t){if(t===void 0||t.workDoneToken===void 0)return new ts;let n=t.workDoneToken;return delete t.workDoneToken,new ji(e,n)}Ti.attachWorkDone=wy;var Ry=e=>class extends e{constructor(){super(),this._progressSupported=!1}initialize(t){super.initialize(t),t?.window?.workDoneProgress===!0&&(this._progressSupported=!0,this.connection.onNotification(vi.WorkDoneProgressCancelNotification.type,n=>{let i=ji.Instances.get(n.token);(i instanceof ha||i instanceof ga)&&i.cancel()}))}attachWorkDoneProgress(t){return t===void 0?new ts:new ji(this.connection,t)}createWorkDoneProgress(){if(this._progressSupported){let t=(0,Ty.generateUuid)();return this.connection.sendRequest(vi.WorkDoneProgressCreateRequest.type,{token:t}).then(()=>new ha(this.connection,t))}else return Promise.resolve(new ga)}};Ti.ProgressFeature=Ry;var nu;(function(e){e.type=new vi.ProgressType})(nu||(nu={}));var ru=class{constructor(t,n){this._connection=t,this._token=n}report(t){this._connection.sendProgress(nu.type,this._token,t)}};function xy(e,t){if(t===void 0||t.partialResultToken===void 0)return;let n=t.partialResultToken;return delete t.partialResultToken,new ru(e,n)}Ti.attachPartialResult=xy});var tg=Qe(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0});ma.ConfigurationFeature=void 0;var Cy=vn(),Sy=Ss(),Dy=e=>class extends e{getConfiguration(t){return t?Sy.string(t)?this._getConfiguration({section:t}):this._getConfiguration(t):this._getConfiguration({})}_getConfiguration(t){let n={items:Array.isArray(t)?t:[t]};return this.connection.sendRequest(Cy.ConfigurationRequest.type,n).then(i=>Array.isArray(i)?Array.isArray(t)?i:i[0]:Array.isArray(t)?[]:null)}};ma.ConfigurationFeature=Dy});var ng=Qe(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});ba.WorkspaceFoldersFeature=void 0;var _a=vn(),Ay=e=>class extends e{constructor(){super(),this._notificationIsAutoRegistered=!1}initialize(t){super.initialize(t);let n=t.workspace;n&&n.workspaceFolders&&(this._onDidChangeWorkspaceFolders=new _a.Emitter,this.connection.onNotification(_a.DidChangeWorkspaceFoldersNotification.type,i=>{this._onDidChangeWorkspaceFolders.fire(i.event)}))}fillServerCapabilities(t){super.fillServerCapabilities(t);let n=t.workspace?.workspaceFolders?.changeNotifications;this._notificationIsAutoRegistered=n===!0||typeof n=="string"}getWorkspaceFolders(){return this.connection.sendRequest(_a.WorkspaceFoldersRequest.type)}get onDidChangeWorkspaceFolders(){if(!this._onDidChangeWorkspaceFolders)throw new Error("Client doesn't support sending workspace folder change events.");return!this._notificationIsAutoRegistered&&!this._unregistration&&(this._unregistration=this.connection.client.register(_a.DidChangeWorkspaceFoldersNotification.type)),this._onDidChangeWorkspaceFolders.event}};ba.WorkspaceFoldersFeature=Ay});var rg=Qe(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.CallHierarchyFeature=void 0;var iu=vn(),Py=e=>class extends e{get callHierarchy(){return{onPrepare:t=>this.connection.onRequest(iu.CallHierarchyPrepareRequest.type,(n,i)=>t(n,i,this.attachWorkDoneProgress(n),void 0)),onIncomingCalls:t=>{let n=iu.CallHierarchyIncomingCallsRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))},onOutgoingCalls:t=>{let n=iu.CallHierarchyOutgoingCallsRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))}}}};ya.CallHierarchyFeature=Py});var su=Qe(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.SemanticTokensBuilder=wi.SemanticTokensDiff=wi.SemanticTokensFeature=void 0;var ka=vn(),Ey=e=>class extends e{get semanticTokens(){return{refresh:()=>this.connection.sendRequest(ka.SemanticTokensRefreshRequest.type),on:t=>{let n=ka.SemanticTokensRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))},onDelta:t=>{let n=ka.SemanticTokensDeltaRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))},onRange:t=>{let n=ka.SemanticTokensRangeRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))}}}};wi.SemanticTokensFeature=Ey;var va=class{constructor(t,n){this.originalSequence=t,this.modifiedSequence=n}computeDiff(){let t=this.originalSequence.length,n=this.modifiedSequence.length,i=0;for(;i<n&&i<t&&this.originalSequence[i]===this.modifiedSequence[i];)i++;if(i<n&&i<t){let r=t-1,s=n-1;for(;r>=i&&s>=i&&this.originalSequence[r]===this.modifiedSequence[s];)r--,s--;(r<i||s<i)&&(r++,s++);let a=r-i+1,c=this.modifiedSequence.slice(i,s+1);return c.length===1&&c[0]===this.originalSequence[r]?[{start:i,deleteCount:a-1}]:[{start:i,deleteCount:a,data:c}]}else return i<n?[{start:i,deleteCount:0,data:this.modifiedSequence.slice(i)}]:i<t?[{start:i,deleteCount:t-i}]:[]}};wi.SemanticTokensDiff=va;var ou=class{constructor(){this._prevData=void 0,this.initialize()}initialize(){this._id=Date.now(),this._prevLine=0,this._prevChar=0,this._data=[],this._dataLen=0}push(t,n,i,r,s){let a=t,c=n;this._dataLen>0&&(a-=this._prevLine,a===0&&(c-=this._prevChar)),this._data[this._dataLen++]=a,this._data[this._dataLen++]=c,this._data[this._dataLen++]=i,this._data[this._dataLen++]=r,this._data[this._dataLen++]=s,this._prevLine=t,this._prevChar=n}get id(){return this._id.toString()}previousResult(t){this.id===t&&(this._prevData=this._data),this.initialize()}build(){return this._prevData=void 0,{resultId:this.id,data:this._data}}canBuildEdits(){return this._prevData!==void 0}buildEdits(){return this._prevData!==void 0?{resultId:this.id,edits:new va(this._prevData,this._data).computeDiff()}:this.build()}};wi.SemanticTokensBuilder=ou});var ig=Qe(Ta=>{"use strict";Object.defineProperty(Ta,"__esModule",{value:!0});Ta.ShowDocumentFeature=void 0;var Oy=vn(),Ny=e=>class extends e{showDocument(t){return this.connection.sendRequest(Oy.ShowDocumentRequest.type,t)}};Ta.ShowDocumentFeature=Ny});var og=Qe(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.FileOperationsFeature=void 0;var wo=vn(),Ly=e=>class extends e{onDidCreateFiles(t){return this.connection.onNotification(wo.DidCreateFilesNotification.type,n=>{t(n)})}onDidRenameFiles(t){return this.connection.onNotification(wo.DidRenameFilesNotification.type,n=>{t(n)})}onDidDeleteFiles(t){return this.connection.onNotification(wo.DidDeleteFilesNotification.type,n=>{t(n)})}onWillCreateFiles(t){return this.connection.onRequest(wo.WillCreateFilesRequest.type,(n,i)=>t(n,i))}onWillRenameFiles(t){return this.connection.onRequest(wo.WillRenameFilesRequest.type,(n,i)=>t(n,i))}onWillDeleteFiles(t){return this.connection.onRequest(wo.WillDeleteFilesRequest.type,(n,i)=>t(n,i))}};wa.FileOperationsFeature=Ly});var sg=Qe(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});Ra.LinkedEditingRangeFeature=void 0;var My=vn(),Iy=e=>class extends e{onLinkedEditingRange(t){return this.connection.onRequest(My.LinkedEditingRangeRequest.type,(n,i)=>t(n,i,this.attachWorkDoneProgress(n),void 0))}};Ra.LinkedEditingRangeFeature=Iy});var ag=Qe(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.TypeHierarchyFeature=void 0;var au=vn(),Fy=e=>class extends e{get typeHierarchy(){return{onPrepare:t=>this.connection.onRequest(au.TypeHierarchyPrepareRequest.type,(n,i)=>t(n,i,this.attachWorkDoneProgress(n),void 0)),onSupertypes:t=>{let n=au.TypeHierarchySupertypesRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))},onSubtypes:t=>{let n=au.TypeHierarchySubtypesRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))}}}};xa.TypeHierarchyFeature=Fy});var lg=Qe(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.InlineValueFeature=void 0;var cg=vn(),qy=e=>class extends e{get inlineValue(){return{refresh:()=>this.connection.sendRequest(cg.InlineValueRefreshRequest.type),on:t=>this.connection.onRequest(cg.InlineValueRequest.type,(n,i)=>t(n,i,this.attachWorkDoneProgress(n)))}}};Ca.InlineValueFeature=qy});var fg=Qe(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});Sa.FoldingRangeFeature=void 0;var ug=vn(),jy=e=>class extends e{get foldingRange(){return{refresh:()=>this.connection.sendRequest(ug.FoldingRangeRefreshRequest.type),on:t=>{let n=ug.FoldingRangeRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))}}}};Sa.FoldingRangeFeature=jy});var dg=Qe(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.InlayHintFeature=void 0;var cu=vn(),Ky=e=>class extends e{get inlayHint(){return{refresh:()=>this.connection.sendRequest(cu.InlayHintRefreshRequest.type),on:t=>this.connection.onRequest(cu.InlayHintRequest.type,(n,i)=>t(n,i,this.attachWorkDoneProgress(n))),resolve:t=>this.connection.onRequest(cu.InlayHintResolveRequest.type,(n,i)=>t(n,i))}}};Da.InlayHintFeature=Ky});var pg=Qe(Aa=>{"use strict";Object.defineProperty(Aa,"__esModule",{value:!0});Aa.DiagnosticFeature=void 0;var ns=vn(),$y=e=>class extends e{get diagnostics(){return{refresh:()=>this.connection.sendRequest(ns.DiagnosticRefreshRequest.type),on:t=>this.connection.onRequest(ns.DocumentDiagnosticRequest.type,(n,i)=>t(n,i,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(ns.DocumentDiagnosticRequest.partialResult,n))),onWorkspace:t=>this.connection.onRequest(ns.WorkspaceDiagnosticRequest.type,(n,i)=>t(n,i,this.attachWorkDoneProgress(n),this.attachPartialResultProgress(ns.WorkspaceDiagnosticRequest.partialResult,n)))}}};Aa.DiagnosticFeature=$y});var uu=Qe(Pa=>{"use strict";Object.defineProperty(Pa,"__esModule",{value:!0});Pa.TextDocuments=void 0;var Ki=vn(),lu=class{constructor(t){this._configuration=t,this._syncedDocuments=new Map,this._onDidChangeContent=new Ki.Emitter,this._onDidOpen=new Ki.Emitter,this._onDidClose=new Ki.Emitter,this._onDidSave=new Ki.Emitter,this._onWillSave=new Ki.Emitter}get onDidOpen(){return this._onDidOpen.event}get onDidChangeContent(){return this._onDidChangeContent.event}get onWillSave(){return this._onWillSave.event}onWillSaveWaitUntil(t){this._willSaveWaitUntil=t}get onDidSave(){return this._onDidSave.event}get onDidClose(){return this._onDidClose.event}get(t){return this._syncedDocuments.get(t)}all(){return Array.from(this._syncedDocuments.values())}keys(){return Array.from(this._syncedDocuments.keys())}listen(t){t.__textDocumentSync=Ki.TextDocumentSyncKind.Incremental;let n=[];return n.push(t.onDidOpenTextDocument(i=>{let r=i.textDocument,s=this._configuration.create(r.uri,r.languageId,r.version,r.text);this._syncedDocuments.set(r.uri,s);let a=Object.freeze({document:s});this._onDidOpen.fire(a),this._onDidChangeContent.fire(a)})),n.push(t.onDidChangeTextDocument(i=>{let r=i.textDocument,s=i.contentChanges;if(s.length===0)return;let{version:a}=r;if(a==null)throw new Error(`Received document change event for ${r.uri} without valid version identifier`);let c=this._syncedDocuments.get(r.uri);c!==void 0&&(c=this._configuration.update(c,s,a),this._syncedDocuments.set(r.uri,c),this._onDidChangeContent.fire(Object.freeze({document:c})))})),n.push(t.onDidCloseTextDocument(i=>{let r=this._syncedDocuments.get(i.textDocument.uri);r!==void 0&&(this._syncedDocuments.delete(i.textDocument.uri),this._onDidClose.fire(Object.freeze({document:r})))})),n.push(t.onWillSaveTextDocument(i=>{let r=this._syncedDocuments.get(i.textDocument.uri);r!==void 0&&this._onWillSave.fire(Object.freeze({document:r,reason:i.reason}))})),n.push(t.onWillSaveTextDocumentWaitUntil((i,r)=>{let s=this._syncedDocuments.get(i.textDocument.uri);return s!==void 0&&this._willSaveWaitUntil?this._willSaveWaitUntil(Object.freeze({document:s,reason:i.reason}),r):[]})),n.push(t.onDidSaveTextDocument(i=>{let r=this._syncedDocuments.get(i.textDocument.uri);r!==void 0&&this._onDidSave.fire(Object.freeze({document:r}))})),Ki.Disposable.create(()=>{n.forEach(i=>i.dispose())})}};Pa.TextDocuments=lu});var du=Qe(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.NotebookDocuments=Ro.NotebookSyncFeature=void 0;var vr=vn(),hg=uu(),Wy=e=>class extends e{get synchronization(){return{onDidOpenNotebookDocument:t=>this.connection.onNotification(vr.DidOpenNotebookDocumentNotification.type,n=>{t(n)}),onDidChangeNotebookDocument:t=>this.connection.onNotification(vr.DidChangeNotebookDocumentNotification.type,n=>{t(n)}),onDidSaveNotebookDocument:t=>this.connection.onNotification(vr.DidSaveNotebookDocumentNotification.type,n=>{t(n)}),onDidCloseNotebookDocument:t=>this.connection.onNotification(vr.DidCloseNotebookDocumentNotification.type,n=>{t(n)})}}};Ro.NotebookSyncFeature=Wy;var Ea=class e{onDidOpenTextDocument(t){return this.openHandler=t,vr.Disposable.create(()=>{this.openHandler=void 0})}openTextDocument(t){this.openHandler&&this.openHandler(t)}onDidChangeTextDocument(t){return this.changeHandler=t,vr.Disposable.create(()=>{this.changeHandler=t})}changeTextDocument(t){this.changeHandler&&this.changeHandler(t)}onDidCloseTextDocument(t){return this.closeHandler=t,vr.Disposable.create(()=>{this.closeHandler=void 0})}closeTextDocument(t){this.closeHandler&&this.closeHandler(t)}onWillSaveTextDocument(){return e.NULL_DISPOSE}onWillSaveTextDocumentWaitUntil(){return e.NULL_DISPOSE}onDidSaveTextDocument(){return e.NULL_DISPOSE}};Ea.NULL_DISPOSE=Object.freeze({dispose:()=>{}});var fu=class{constructor(t){t instanceof hg.TextDocuments?this._cellTextDocuments=t:this._cellTextDocuments=new hg.TextDocuments(t),this.notebookDocuments=new Map,this.notebookCellMap=new Map,this._onDidOpen=new vr.Emitter,this._onDidChange=new vr.Emitter,this._onDidSave=new vr.Emitter,this._onDidClose=new vr.Emitter}get cellTextDocuments(){return this._cellTextDocuments}getCellTextDocument(t){return this._cellTextDocuments.get(t.document)}getNotebookDocument(t){return this.notebookDocuments.get(t)}getNotebookCell(t){let n=this.notebookCellMap.get(t);return n&&n[0]}findNotebookDocumentForCell(t){let n=typeof t=="string"?t:t.document,i=this.notebookCellMap.get(n);return i&&i[1]}get onDidOpen(){return this._onDidOpen.event}get onDidSave(){return this._onDidSave.event}get onDidChange(){return this._onDidChange.event}get onDidClose(){return this._onDidClose.event}listen(t){let n=new Ea,i=[];return i.push(this.cellTextDocuments.listen(n)),i.push(t.notebooks.synchronization.onDidOpenNotebookDocument(r=>{this.notebookDocuments.set(r.notebookDocument.uri,r.notebookDocument);for(let s of r.cellTextDocuments)n.openTextDocument({textDocument:s});this.updateCellMap(r.notebookDocument),this._onDidOpen.fire(r.notebookDocument)})),i.push(t.notebooks.synchronization.onDidChangeNotebookDocument(r=>{let s=this.notebookDocuments.get(r.notebookDocument.uri);if(s===void 0)return;s.version=r.notebookDocument.version;let a=s.metadata,c=!1,p=r.change;p.metadata!==void 0&&(c=!0,s.metadata=p.metadata);let f=[],l=[],b=[],v=[];if(p.cells!==void 0){let C=p.cells;if(C.structure!==void 0){let g=C.structure.array;if(s.cells.splice(g.start,g.deleteCount,...g.cells!==void 0?g.cells:[]),C.structure.didOpen!==void 0)for(let y of C.structure.didOpen)n.openTextDocument({textDocument:y}),f.push(y.uri);if(C.structure.didClose)for(let y of C.structure.didClose)n.closeTextDocument({textDocument:y}),l.push(y.uri)}if(C.data!==void 0){let g=new Map(C.data.map(y=>[y.document,y]));for(let y=0;y<=s.cells.length;y++){let u=g.get(s.cells[y].document);if(u!==void 0){let B=s.cells.splice(y,1,u);if(b.push({old:B[0],new:u}),g.delete(u.document),g.size===0)break}}}if(C.textContent!==void 0)for(let g of C.textContent)n.changeTextDocument({textDocument:g.document,contentChanges:g.changes}),v.push(g.document.uri)}this.updateCellMap(s);let d={notebookDocument:s};c&&(d.metadata={old:a,new:s.metadata});let w=[];for(let C of f)w.push(this.getNotebookCell(C));let D=[];for(let C of l)D.push(this.getNotebookCell(C));let $=[];for(let C of v)$.push(this.getNotebookCell(C));(w.length>0||D.length>0||b.length>0||$.length>0)&&(d.cells={added:w,removed:D,changed:{data:b,textContent:$}}),(d.metadata!==void 0||d.cells!==void 0)&&this._onDidChange.fire(d)})),i.push(t.notebooks.synchronization.onDidSaveNotebookDocument(r=>{let s=this.notebookDocuments.get(r.notebookDocument.uri);s!==void 0&&this._onDidSave.fire(s)})),i.push(t.notebooks.synchronization.onDidCloseNotebookDocument(r=>{let s=this.notebookDocuments.get(r.notebookDocument.uri);if(s!==void 0){this._onDidClose.fire(s);for(let a of r.cellTextDocuments)n.closeTextDocument({textDocument:a});this.notebookDocuments.delete(r.notebookDocument.uri);for(let a of s.cells)this.notebookCellMap.delete(a.document)}})),vr.Disposable.create(()=>{i.forEach(r=>r.dispose())})}updateCellMap(t){for(let n of t.cells)this.notebookCellMap.set(n.document,[n,t])}};Ro.NotebookDocuments=fu});var gg=Qe(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.MonikerFeature=void 0;var Vy=vn(),Uy=e=>class extends e{get moniker(){return{on:t=>{let n=Vy.MonikerRequest.type;return this.connection.onRequest(n,(i,r)=>t(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(n,i)))}}}};Oa.MonikerFeature=Uy});var bu=Qe(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.createConnection=Ht.combineFeatures=Ht.combineNotebooksFeatures=Ht.combineLanguagesFeatures=Ht.combineWorkspaceFeatures=Ht.combineWindowFeatures=Ht.combineClientFeatures=Ht.combineTracerFeatures=Ht.combineTelemetryFeatures=Ht.combineConsoleFeatures=Ht._NotebooksImpl=Ht._LanguagesImpl=Ht.BulkUnregistration=Ht.BulkRegistration=Ht.ErrorMessageTracker=void 0;var Be=vn(),Tr=Ss(),hu=tu(),Dt=eg(),By=tg(),Hy=ng(),zy=rg(),Gy=su(),Xy=ig(),Qy=og(),Jy=sg(),Zy=ag(),Yy=lg(),ek=fg(),tk=dg(),nk=pg(),rk=du(),ik=gg();function pu(e){if(e!==null)return e}var gu=class{constructor(){this._messages=Object.create(null)}add(t){let n=this._messages[t];n||(n=0),n++,this._messages[t]=n}sendErrors(t){Object.keys(this._messages).forEach(n=>{t.window.showErrorMessage(n)})}};Ht.ErrorMessageTracker=gu;var Na=class{constructor(){}rawAttach(t){this._rawConnection=t}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}fillServerCapabilities(t){}initialize(t){}error(t){this.send(Be.MessageType.Error,t)}warn(t){this.send(Be.MessageType.Warning,t)}info(t){this.send(Be.MessageType.Info,t)}log(t){this.send(Be.MessageType.Log,t)}debug(t){this.send(Be.MessageType.Debug,t)}send(t,n){this._rawConnection&&this._rawConnection.sendNotification(Be.LogMessageNotification.type,{type:t,message:n}).catch(()=>{(0,Be.RAL)().console.error("Sending log message failed")})}},mu=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}showErrorMessage(t,...n){let i={type:Be.MessageType.Error,message:t,actions:n};return this.connection.sendRequest(Be.ShowMessageRequest.type,i).then(pu)}showWarningMessage(t,...n){let i={type:Be.MessageType.Warning,message:t,actions:n};return this.connection.sendRequest(Be.ShowMessageRequest.type,i).then(pu)}showInformationMessage(t,...n){let i={type:Be.MessageType.Info,message:t,actions:n};return this.connection.sendRequest(Be.ShowMessageRequest.type,i).then(pu)}},mg=(0,Xy.ShowDocumentFeature)((0,Dt.ProgressFeature)(mu)),_g;(function(e){function t(){return new La}e.create=t})(_g||(Ht.BulkRegistration=_g={}));var La=class{constructor(){this._registrations=[],this._registered=new Set}add(t,n){let i=Tr.string(t)?t:t.method;if(this._registered.has(i))throw new Error(`${i} is already added to this registration`);let r=hu.generateUuid();this._registrations.push({id:r,method:i,registerOptions:n||{}}),this._registered.add(i)}asRegistrationParams(){return{registrations:this._registrations}}},bg;(function(e){function t(){return new rs(void 0,[])}e.create=t})(bg||(Ht.BulkUnregistration=bg={}));var rs=class{constructor(t,n){this._connection=t,this._unregistrations=new Map,n.forEach(i=>{this._unregistrations.set(i.method,i)})}get isAttached(){return!!this._connection}attach(t){this._connection=t}add(t){this._unregistrations.set(t.method,t)}dispose(){let t=[];for(let i of this._unregistrations.values())t.push(i);let n={unregisterations:t};this._connection.sendRequest(Be.UnregistrationRequest.type,n).catch(()=>{this._connection.console.info("Bulk unregistration failed.")})}disposeSingle(t){let n=Tr.string(t)?t:t.method,i=this._unregistrations.get(n);if(!i)return!1;let r={unregisterations:[i]};return this._connection.sendRequest(Be.UnregistrationRequest.type,r).then(()=>{this._unregistrations.delete(n)},s=>{this._connection.console.info(`Un-registering request handler for ${i.id} failed.`)}),!0}},Ma=class{attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}register(t,n,i){return t instanceof La?this.registerMany(t):t instanceof rs?this.registerSingle1(t,n,i):this.registerSingle2(t,n)}registerSingle1(t,n,i){let r=Tr.string(n)?n:n.method,s=hu.generateUuid(),a={registrations:[{id:s,method:r,registerOptions:i||{}}]};return t.isAttached||t.attach(this.connection),this.connection.sendRequest(Be.RegistrationRequest.type,a).then(c=>(t.add({id:s,method:r}),t),c=>(this.connection.console.info(`Registering request handler for ${r} failed.`),Promise.reject(c)))}registerSingle2(t,n){let i=Tr.string(t)?t:t.method,r=hu.generateUuid(),s={registrations:[{id:r,method:i,registerOptions:n||{}}]};return this.connection.sendRequest(Be.RegistrationRequest.type,s).then(a=>Be.Disposable.create(()=>{this.unregisterSingle(r,i).catch(()=>{this.connection.console.info(`Un-registering capability with id ${r} failed.`)})}),a=>(this.connection.console.info(`Registering request handler for ${i} failed.`),Promise.reject(a)))}unregisterSingle(t,n){let i={unregisterations:[{id:t,method:n}]};return this.connection.sendRequest(Be.UnregistrationRequest.type,i).catch(()=>{this.connection.console.info(`Un-registering request handler for ${t} failed.`)})}registerMany(t){let n=t.asRegistrationParams();return this.connection.sendRequest(Be.RegistrationRequest.type,n).then(()=>new rs(this._connection,n.registrations.map(i=>({id:i.id,method:i.method}))),i=>(this.connection.console.info("Bulk registration failed."),Promise.reject(i)))}},_u=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}applyEdit(t){function n(r){return r&&!!r.edit}let i=n(t)?t:{edit:t};return this.connection.sendRequest(Be.ApplyWorkspaceEditRequest.type,i)}},yg=(0,Qy.FileOperationsFeature)((0,Hy.WorkspaceFoldersFeature)((0,By.ConfigurationFeature)(_u))),Ia=class{constructor(){this._trace=Be.Trace.Off}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}set trace(t){this._trace=t}log(t,n){this._trace!==Be.Trace.Off&&this.connection.sendNotification(Be.LogTraceNotification.type,{message:t,verbose:this._trace===Be.Trace.Verbose?n:void 0}).catch(()=>{})}},Fa=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}logEvent(t){this.connection.sendNotification(Be.TelemetryEventNotification.type,t).catch(()=>{this.connection.console.log("Sending TelemetryEventNotification failed")})}},qa=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}attachWorkDoneProgress(t){return(0,Dt.attachWorkDone)(this.connection,t)}attachPartialResultProgress(t,n){return(0,Dt.attachPartialResult)(this.connection,n)}};Ht._LanguagesImpl=qa;var kg=(0,ek.FoldingRangeFeature)((0,ik.MonikerFeature)((0,nk.DiagnosticFeature)((0,tk.InlayHintFeature)((0,Yy.InlineValueFeature)((0,Zy.TypeHierarchyFeature)((0,Jy.LinkedEditingRangeFeature)((0,Gy.SemanticTokensFeature)((0,zy.CallHierarchyFeature)(qa))))))))),ja=class{constructor(){}attach(t){this._connection=t}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(t){}fillServerCapabilities(t){}attachWorkDoneProgress(t){return(0,Dt.attachWorkDone)(this.connection,t)}attachPartialResultProgress(t,n){return(0,Dt.attachPartialResult)(this.connection,n)}};Ht._NotebooksImpl=ja;var vg=(0,rk.NotebookSyncFeature)(ja);function Tg(e,t){return function(n){return t(e(n))}}Ht.combineConsoleFeatures=Tg;function wg(e,t){return function(n){return t(e(n))}}Ht.combineTelemetryFeatures=wg;function Rg(e,t){return function(n){return t(e(n))}}Ht.combineTracerFeatures=Rg;function xg(e,t){return function(n){return t(e(n))}}Ht.combineClientFeatures=xg;function Cg(e,t){return function(n){return t(e(n))}}Ht.combineWindowFeatures=Cg;function Sg(e,t){return function(n){return t(e(n))}}Ht.combineWorkspaceFeatures=Sg;function Dg(e,t){return function(n){return t(e(n))}}Ht.combineLanguagesFeatures=Dg;function Ag(e,t){return function(n){return t(e(n))}}Ht.combineNotebooksFeatures=Ag;function ok(e,t){function n(r,s,a){return r&&s?a(r,s):r||s}return{__brand:"features",console:n(e.console,t.console,Tg),tracer:n(e.tracer,t.tracer,Rg),telemetry:n(e.telemetry,t.telemetry,wg),client:n(e.client,t.client,xg),window:n(e.window,t.window,Cg),workspace:n(e.workspace,t.workspace,Sg),languages:n(e.languages,t.languages,Dg),notebooks:n(e.notebooks,t.notebooks,Ag)}}Ht.combineFeatures=ok;function sk(e,t,n){let i=n&&n.console?new(n.console(Na)):new Na,r=e(i);i.rawAttach(r);let s=n&&n.tracer?new(n.tracer(Ia)):new Ia,a=n&&n.telemetry?new(n.telemetry(Fa)):new Fa,c=n&&n.client?new(n.client(Ma)):new Ma,p=n&&n.window?new(n.window(mg)):new mg,f=n&&n.workspace?new(n.workspace(yg)):new yg,l=n&&n.languages?new(n.languages(kg)):new kg,b=n&&n.notebooks?new(n.notebooks(vg)):new vg,v=[i,s,a,c,p,f,l,b];function d(g){return g instanceof Promise?g:Tr.thenable(g)?new Promise((y,u)=>{g.then(B=>y(B),B=>u(B))}):Promise.resolve(g)}let w,D,$,C={listen:()=>r.listen(),sendRequest:(g,...y)=>r.sendRequest(Tr.string(g)?g:g.method,...y),onRequest:(g,y)=>r.onRequest(g,y),sendNotification:(g,y)=>{let u=Tr.string(g)?g:g.method;return r.sendNotification(u,y)},onNotification:(g,y)=>r.onNotification(g,y),onProgress:r.onProgress,sendProgress:r.sendProgress,onInitialize:g=>(D=g,{dispose:()=>{D=void 0}}),onInitialized:g=>r.onNotification(Be.InitializedNotification.type,g),onShutdown:g=>(w=g,{dispose:()=>{w=void 0}}),onExit:g=>($=g,{dispose:()=>{$=void 0}}),get console(){return i},get telemetry(){return a},get tracer(){return s},get client(){return c},get window(){return p},get workspace(){return f},get languages(){return l},get notebooks(){return b},onDidChangeConfiguration:g=>r.onNotification(Be.DidChangeConfigurationNotification.type,g),onDidChangeWatchedFiles:g=>r.onNotification(Be.DidChangeWatchedFilesNotification.type,g),__textDocumentSync:void 0,onDidOpenTextDocument:g=>r.onNotification(Be.DidOpenTextDocumentNotification.type,g),onDidChangeTextDocument:g=>r.onNotification(Be.DidChangeTextDocumentNotification.type,g),onDidCloseTextDocument:g=>r.onNotification(Be.DidCloseTextDocumentNotification.type,g),onWillSaveTextDocument:g=>r.onNotification(Be.WillSaveTextDocumentNotification.type,g),onWillSaveTextDocumentWaitUntil:g=>r.onRequest(Be.WillSaveTextDocumentWaitUntilRequest.type,g),onDidSaveTextDocument:g=>r.onNotification(Be.DidSaveTextDocumentNotification.type,g),sendDiagnostics:g=>r.sendNotification(Be.PublishDiagnosticsNotification.type,g),onHover:g=>r.onRequest(Be.HoverRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),void 0)),onCompletion:g=>r.onRequest(Be.CompletionRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onCompletionResolve:g=>r.onRequest(Be.CompletionResolveRequest.type,g),onSignatureHelp:g=>r.onRequest(Be.SignatureHelpRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),void 0)),onDeclaration:g=>r.onRequest(Be.DeclarationRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onDefinition:g=>r.onRequest(Be.DefinitionRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onTypeDefinition:g=>r.onRequest(Be.TypeDefinitionRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onImplementation:g=>r.onRequest(Be.ImplementationRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onReferences:g=>r.onRequest(Be.ReferencesRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onDocumentHighlight:g=>r.onRequest(Be.DocumentHighlightRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onDocumentSymbol:g=>r.onRequest(Be.DocumentSymbolRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onWorkspaceSymbol:g=>r.onRequest(Be.WorkspaceSymbolRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onWorkspaceSymbolResolve:g=>r.onRequest(Be.WorkspaceSymbolResolveRequest.type,g),onCodeAction:g=>r.onRequest(Be.CodeActionRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onCodeActionResolve:g=>r.onRequest(Be.CodeActionResolveRequest.type,(y,u)=>g(y,u)),onCodeLens:g=>r.onRequest(Be.CodeLensRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onCodeLensResolve:g=>r.onRequest(Be.CodeLensResolveRequest.type,(y,u)=>g(y,u)),onDocumentFormatting:g=>r.onRequest(Be.DocumentFormattingRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),void 0)),onDocumentRangeFormatting:g=>r.onRequest(Be.DocumentRangeFormattingRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),void 0)),onDocumentOnTypeFormatting:g=>r.onRequest(Be.DocumentOnTypeFormattingRequest.type,(y,u)=>g(y,u)),onRenameRequest:g=>r.onRequest(Be.RenameRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),void 0)),onPrepareRename:g=>r.onRequest(Be.PrepareRenameRequest.type,(y,u)=>g(y,u)),onDocumentLinks:g=>r.onRequest(Be.DocumentLinkRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onDocumentLinkResolve:g=>r.onRequest(Be.DocumentLinkResolveRequest.type,(y,u)=>g(y,u)),onDocumentColor:g=>r.onRequest(Be.DocumentColorRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onColorPresentation:g=>r.onRequest(Be.ColorPresentationRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onFoldingRanges:g=>r.onRequest(Be.FoldingRangeRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onSelectionRanges:g=>r.onRequest(Be.SelectionRangeRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),(0,Dt.attachPartialResult)(r,y))),onExecuteCommand:g=>r.onRequest(Be.ExecuteCommandRequest.type,(y,u)=>g(y,u,(0,Dt.attachWorkDone)(r,y),void 0)),dispose:()=>r.dispose()};for(let g of v)g.attach(C);return r.onRequest(Be.InitializeRequest.type,g=>{t.initialize(g),Tr.string(g.trace)&&(s.trace=Be.Trace.fromString(g.trace));for(let y of v)y.initialize(g.capabilities);if(D){let y=D(g,new Be.CancellationTokenSource().token,(0,Dt.attachWorkDone)(r,g),void 0);return d(y).then(u=>{if(u instanceof Be.ResponseError)return u;let B=u;B||(B={capabilities:{}});let h=B.capabilities;h||(h={},B.capabilities=h),h.textDocumentSync===void 0||h.textDocumentSync===null?h.textDocumentSync=Tr.number(C.__textDocumentSync)?C.__textDocumentSync:Be.TextDocumentSyncKind.None:!Tr.number(h.textDocumentSync)&&!Tr.number(h.textDocumentSync.change)&&(h.textDocumentSync.change=Tr.number(C.__textDocumentSync)?C.__textDocumentSync:Be.TextDocumentSyncKind.None);for(let le of v)le.fillServerCapabilities(h);return B})}else{let y={capabilities:{textDocumentSync:Be.TextDocumentSyncKind.None}};for(let u of v)u.fillServerCapabilities(y.capabilities);return y}}),r.onRequest(Be.ShutdownRequest.type,()=>{if(t.shutdownReceived=!0,w)return w(new Be.CancellationTokenSource().token)}),r.onNotification(Be.ExitNotification.type,()=>{try{$&&$()}finally{t.shutdownReceived?t.exit(0):t.exit(1)}}),r.onNotification(Be.SetTraceNotification.type,g=>{s.trace=Be.Trace.fromString(g.value)}),C}Ht.createConnection=sk});var Pg=Qe(Jn=>{"use strict";Object.defineProperty(Jn,"__esModule",{value:!0});Jn.resolveModulePath=Jn.FileSystem=Jn.resolveGlobalYarnPath=Jn.resolveGlobalNodePath=Jn.resolve=Jn.uriToFilePath=void 0;var ak=require("url"),Or=require("path"),yu=require("fs"),wu=require("child_process");function ck(e){let t=ak.parse(e);if(t.protocol!=="file:"||!t.path)return;let n=t.path.split("/");for(var i=0,r=n.length;i<r;i++)n[i]=decodeURIComponent(n[i]);if(process.platform==="win32"&&n.length>1){let s=n[0],a=n[1];s.length===0&&a.length>1&&a[1]===":"&&n.shift()}return Or.normalize(n.join("/"))}Jn.uriToFilePath=ck;function ku(){return process.platform==="win32"}function Ka(e,t,n,i){let r="NODE_PATH",s=["var p = process;","p.on('message',function(m){","if(m.c==='e'){","p.exit(0);","}","else if(m.c==='rs'){","try{","var r=require.resolve(m.a);","p.send({c:'r',s:true,r:r});","}","catch(err){","p.send({c:'r',s:false});","}","}","});"].join("");return new Promise((a,c)=>{let p=process.env,f=Object.create(null);Object.keys(p).forEach(l=>f[l]=p[l]),t&&yu.existsSync(t)&&(f[r]?f[r]=t+Or.delimiter+f[r]:f[r]=t,i&&i(`NODE_PATH value is: ${f[r]}`)),f.ELECTRON_RUN_AS_NODE="1";try{let l=(0,wu.fork)("",[],{cwd:n,env:f,execArgv:["-e",s]});if(l.pid===void 0){c(new Error(`Starting process to resolve node module  ${e} failed`));return}l.on("error",v=>{c(v)}),l.on("message",v=>{v.c==="r"&&(l.send({c:"e"}),v.s?a(v.r):c(new Error(`Failed to resolve module: ${e}`)))});let b={c:"rs",a:e};l.send(b)}catch(l){c(l)}})}Jn.resolve=Ka;function vu(e){let t="npm",n=Object.create(null);Object.keys(process.env).forEach(s=>n[s]=process.env[s]),n.NO_UPDATE_NOTIFIER="true";let i={encoding:"utf8",env:n};ku()&&(t="npm.cmd",i.shell=!0);let r=()=>{};try{process.on("SIGPIPE",r);let s=(0,wu.spawnSync)(t,["config","get","prefix"],i).stdout;if(!s){e&&e("'npm config get prefix' didn't return a value.");return}let a=s.trim();return e&&e(`'npm config get prefix' value is: ${a}`),a.length>0?ku()?Or.join(a,"node_modules"):Or.join(a,"lib","node_modules"):void 0}catch{return}finally{process.removeListener("SIGPIPE",r)}}Jn.resolveGlobalNodePath=vu;function lk(e){let t="yarn",n={encoding:"utf8"};ku()&&(t="yarn.cmd",n.shell=!0);let i=()=>{};try{process.on("SIGPIPE",i);let r=(0,wu.spawnSync)(t,["global","dir","--json"],n),s=r.stdout;if(!s){e&&(e("'yarn global dir' didn't return a value."),r.stderr&&e(r.stderr));return}let a=s.trim().split(/\r?\n/);for(let c of a)try{let p=JSON.parse(c);if(p.type==="log")return Or.join(p.data,"node_modules")}catch{}return}catch{return}finally{process.removeListener("SIGPIPE",i)}}Jn.resolveGlobalYarnPath=lk;var Tu;(function(e){let t;function n(){return t!==void 0||(process.platform==="win32"?t=!1:t=!yu.existsSync(__filename.toUpperCase())||!yu.existsSync(__filename.toLowerCase())),t}e.isCaseSensitive=n;function i(r,s){return n()?Or.normalize(s).indexOf(Or.normalize(r))===0:Or.normalize(s).toLowerCase().indexOf(Or.normalize(r).toLowerCase())===0}e.isParent=i})(Tu||(Jn.FileSystem=Tu={}));function uk(e,t,n,i){return n?(Or.isAbsolute(n)||(n=Or.join(e,n)),Ka(t,n,n,i).then(r=>Tu.isParent(n,r)?r:Promise.reject(new Error(`Failed to load ${t} from node path location.`))).then(void 0,r=>Ka(t,vu(i),e,i))):Ka(t,vu(i),e,i)}Jn.resolveModulePath=uk});var Ru=Qe((vT,Eg)=>{"use strict";Eg.exports=vn()});var Og=Qe($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});$a.InlineCompletionFeature=void 0;var fk=vn(),dk=e=>class extends e{get inlineCompletion(){return{on:t=>this.connection.onRequest(fk.InlineCompletionRequest.type,(n,i)=>t(n,i,this.attachWorkDoneProgress(n)))}}};$a.InlineCompletionFeature=dk});var Mg=Qe(Wn=>{"use strict";var pk=Wn&&Wn.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),Lg=Wn&&Wn.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&pk(t,e,n)};Object.defineProperty(Wn,"__esModule",{value:!0});Wn.ProposedFeatures=Wn.NotebookDocuments=Wn.TextDocuments=Wn.SemanticTokensBuilder=void 0;var hk=su();Object.defineProperty(Wn,"SemanticTokensBuilder",{enumerable:!0,get:function(){return hk.SemanticTokensBuilder}});var gk=Og();Lg(vn(),Wn);var mk=uu();Object.defineProperty(Wn,"TextDocuments",{enumerable:!0,get:function(){return mk.TextDocuments}});var _k=du();Object.defineProperty(Wn,"NotebookDocuments",{enumerable:!0,get:function(){return _k.NotebookDocuments}});Lg(bu(),Wn);var Ng;(function(e){e.all={__brand:"features",languages:gk.InlineCompletionFeature}})(Ng||(Wn.ProposedFeatures=Ng={}))});var ir=Qe(wr=>{"use strict";var bk=wr&&wr.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),jg=wr&&wr.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&bk(t,e,n)};Object.defineProperty(wr,"__esModule",{value:!0});wr.createConnection=wr.Files=void 0;var Ig=require("node:util"),xu=Ss(),yk=bu(),is=Pg(),$i=Ru();jg(Ru(),wr);jg(Mg(),wr);var Fg;(function(e){e.uriToFilePath=is.uriToFilePath,e.resolveGlobalNodePath=is.resolveGlobalNodePath,e.resolveGlobalYarnPath=is.resolveGlobalYarnPath,e.resolve=is.resolve,e.resolveModulePath=is.resolveModulePath})(Fg||(wr.Files=Fg={}));var qg;function Wa(){if(qg!==void 0)try{qg.end()}catch{}}var xo=!1,Kg;function kk(){let e="--clientProcessId";function t(n){try{let i=parseInt(n);isNaN(i)||(Kg=setInterval(()=>{try{process.kill(i,0)}catch{Wa(),process.exit(xo?0:1)}},3e3))}catch{}}for(let n=2;n<process.argv.length;n++){let i=process.argv[n];if(i===e&&n+1<process.argv.length){t(process.argv[n+1]);return}else{let r=i.split("=");r[0]===e&&t(r[1])}}}kk();var vk={initialize:e=>{let t=e.processId;xu.number(t)&&Kg===void 0&&setInterval(()=>{try{process.kill(t,0)}catch{process.exit(xo?0:1)}},3e3)},get shutdownReceived(){return xo},set shutdownReceived(e){xo=e},exit:e=>{Wa(),process.exit(e)}};function Tk(e,t,n,i){let r,s,a,c;return e!==void 0&&e.__brand==="features"&&(r=e,e=t,t=n,n=i),$i.ConnectionStrategy.is(e)||$i.ConnectionOptions.is(e)?c=e:(s=e,a=t,c=n),wk(s,a,c,r)}wr.createConnection=Tk;function wk(e,t,n,i){let r=!1;if(!e&&!t&&process.argv.length>2){let p,f,l=process.argv.slice(2);for(let b=0;b<l.length;b++){let v=l[b];if(v==="--node-ipc"){e=new $i.IPCMessageReader(process),t=new $i.IPCMessageWriter(process);break}else if(v==="--stdio"){r=!0,e=process.stdin,t=process.stdout;break}else if(v==="--socket"){p=parseInt(l[b+1]);break}else if(v==="--pipe"){f=l[b+1];break}else{var s=v.split("=");if(s[0]==="--socket"){p=parseInt(s[1]);break}else if(s[0]==="--pipe"){f=s[1];break}}}if(p){let b=(0,$i.createServerSocketTransport)(p);e=b[0],t=b[1]}else if(f){let b=(0,$i.createServerPipeTransport)(f);e=b[0],t=b[1]}}var a="Use arguments of createConnection or set command line parameters: '--node-ipc', '--stdio' or '--socket={number}'";if(!e)throw new Error("Connection input stream is not set. "+a);if(!t)throw new Error("Connection output stream is not set. "+a);if(xu.func(e.read)&&xu.func(e.on)){let p=e;p.on("end",()=>{Wa(),process.exit(xo?0:1)}),p.on("close",()=>{Wa(),process.exit(xo?0:1)})}let c=p=>{let f=(0,$i.createProtocolConnection)(e,t,p,n);return r&&Rk(p),f};return(0,yk.createConnection)(c,vk,i)}function Rk(e){function t(i){return i.map(r=>typeof r=="string"?r:(0,Ig.inspect)(r)).join(" ")}let n=new Map;console.assert=function(r,...s){if(!r)if(s.length===0)e.error("Assertion failed");else{let[a,...c]=s;e.error(`Assertion failed: ${a} ${t(c)}`)}},console.count=function(r="default"){let s=String(r),a=n.get(s)??0;a+=1,n.set(s,a),e.log(`${s}: ${s}`)},console.countReset=function(r){r===void 0?n.clear():n.delete(String(r))},console.debug=function(...r){e.log(t(r))},console.dir=function(r,s){e.log((0,Ig.inspect)(r,s))},console.log=function(...r){e.log(t(r))},console.error=function(...r){e.error(t(r))},console.trace=function(...r){let s=new Error().stack.replace(/(.+\n){2}/,""),a="Trace";r.length!==0&&(a+=`: ${t(r)}`),e.log(`${a}
${s}`)},console.warn=function(...r){e.warn(t(r))}}});var Cu=Qe((CT,$g)=>{"use strict";$g.exports=ir()});var wc=require("path");var Cs=class e{constructor(t,n,i,r){this._uri=t,this._languageId=n,this._version=i,this._content=r,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(t){if(t){let n=this.offsetAt(t.start),i=this.offsetAt(t.end);return this._content.substring(n,i)}return this._content}update(t,n){for(let i of t)if(e.isIncremental(i)){let r=yf(i.range),s=this.offsetAt(r.start),a=this.offsetAt(r.end);this._content=this._content.substring(0,s)+i.text+this._content.substring(a,this._content.length);let c=Math.max(r.start.line,0),p=Math.max(r.end.line,0),f=this._lineOffsets,l=_f(i.text,!1,s);if(p-c===l.length)for(let v=0,d=l.length;v<d;v++)f[v+c+1]=l[v];else l.length<1e4?f.splice(c+1,p-c,...l):this._lineOffsets=f=f.slice(0,c+1).concat(l,f.slice(p+1));let b=i.text.length-(a-s);if(b!==0)for(let v=c+1+l.length,d=f.length;v<d;v++)f[v]=f[v]+b}else if(e.isFull(i))this._content=i.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received");this._version=n}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=_f(this._content,!0)),this._lineOffsets}positionAt(t){t=Math.max(Math.min(t,this._content.length),0);let n=this.getLineOffsets(),i=0,r=n.length;if(r===0)return{line:0,character:t};for(;i<r;){let a=Math.floor((i+r)/2);n[a]>t?r=a:i=a+1}let s=i-1;return t=this.ensureBeforeEOL(t,n[s]),{line:s,character:t-n[s]}}offsetAt(t){let n=this.getLineOffsets();if(t.line>=n.length)return this._content.length;if(t.line<0)return 0;let i=n[t.line];if(t.character<=0)return i;let r=t.line+1<n.length?n[t.line+1]:this._content.length,s=Math.min(i+t.character,r);return this.ensureBeforeEOL(s,i)}ensureBeforeEOL(t,n){for(;t>n&&bf(this._content.charCodeAt(t-1));)t--;return t}get lineCount(){return this.getLineOffsets().length}static isIncremental(t){let n=t;return n!=null&&typeof n.text=="string"&&n.range!==void 0&&(n.rangeLength===void 0||typeof n.rangeLength=="number")}static isFull(t){let n=t;return n!=null&&typeof n.text=="string"&&n.range===void 0&&n.rangeLength===void 0}},Hn;(function(e){function t(r,s,a,c){return new Cs(r,s,a,c)}e.create=t;function n(r,s,a){if(r instanceof Cs)return r.update(s,a),r;throw new Error("TextDocument.update: document must be created by TextDocument.create")}e.update=n;function i(r,s){let a=r.getText(),c=Sc(s.map(lb),(l,b)=>{let v=l.range.start.line-b.range.start.line;return v===0?l.range.start.character-b.range.start.character:v}),p=0,f=[];for(let l of c){let b=r.offsetAt(l.range.start);if(b<p)throw new Error("Overlapping edit");b>p&&f.push(a.substring(p,b)),l.newText.length&&f.push(l.newText),p=r.offsetAt(l.range.end)}return f.push(a.substr(p)),f.join("")}e.applyEdits=i})(Hn||(Hn={}));function Sc(e,t){if(e.length<=1)return e;let n=e.length/2|0,i=e.slice(0,n),r=e.slice(n);Sc(i,t),Sc(r,t);let s=0,a=0,c=0;for(;s<i.length&&a<r.length;)t(i[s],r[a])<=0?e[c++]=i[s++]:e[c++]=r[a++];for(;s<i.length;)e[c++]=i[s++];for(;a<r.length;)e[c++]=r[a++];return e}function _f(e,t,n=0){let i=t?[n]:[];for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);bf(s)&&(s===13&&r+1<e.length&&e.charCodeAt(r+1)===10&&r++,i.push(n+r+1))}return i}function bf(e){return e===13||e===10}function yf(e){let t=e.start,n=e.end;return t.line>n.line||t.line===n.line&&t.character>n.character?{start:n,end:t}:e}function lb(e){let t=yf(e.range);return t!==e.range?{newText:e.newText,range:t}:e}var fr=Bn(Cu());var Wg;(()=>{"use strict";var e={470:r=>{function s(p){if(typeof p!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(p))}function a(p,f){for(var l,b="",v=0,d=-1,w=0,D=0;D<=p.length;++D){if(D<p.length)l=p.charCodeAt(D);else{if(l===47)break;l=47}if(l===47){if(!(d===D-1||w===1))if(d!==D-1&&w===2){if(b.length<2||v!==2||b.charCodeAt(b.length-1)!==46||b.charCodeAt(b.length-2)!==46){if(b.length>2){var $=b.lastIndexOf("/");if($!==b.length-1){$===-1?(b="",v=0):v=(b=b.slice(0,$)).length-1-b.lastIndexOf("/"),d=D,w=0;continue}}else if(b.length===2||b.length===1){b="",v=0,d=D,w=0;continue}}f&&(b.length>0?b+="/..":b="..",v=2)}else b.length>0?b+="/"+p.slice(d+1,D):b=p.slice(d+1,D),v=D-d-1;d=D,w=0}else l===46&&w!==-1?++w:w=-1}return b}var c={resolve:function(){for(var p,f="",l=!1,b=arguments.length-1;b>=-1&&!l;b--){var v;b>=0?v=arguments[b]:(p===void 0&&(p=process.cwd()),v=p),s(v),v.length!==0&&(f=v+"/"+f,l=v.charCodeAt(0)===47)}return f=a(f,!l),l?f.length>0?"/"+f:"/":f.length>0?f:"."},normalize:function(p){if(s(p),p.length===0)return".";var f=p.charCodeAt(0)===47,l=p.charCodeAt(p.length-1)===47;return(p=a(p,!f)).length!==0||f||(p="."),p.length>0&&l&&(p+="/"),f?"/"+p:p},isAbsolute:function(p){return s(p),p.length>0&&p.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var p,f=0;f<arguments.length;++f){var l=arguments[f];s(l),l.length>0&&(p===void 0?p=l:p+="/"+l)}return p===void 0?".":c.normalize(p)},relative:function(p,f){if(s(p),s(f),p===f||(p=c.resolve(p))===(f=c.resolve(f)))return"";for(var l=1;l<p.length&&p.charCodeAt(l)===47;++l);for(var b=p.length,v=b-l,d=1;d<f.length&&f.charCodeAt(d)===47;++d);for(var w=f.length-d,D=v<w?v:w,$=-1,C=0;C<=D;++C){if(C===D){if(w>D){if(f.charCodeAt(d+C)===47)return f.slice(d+C+1);if(C===0)return f.slice(d+C)}else v>D&&(p.charCodeAt(l+C)===47?$=C:C===0&&($=0));break}var g=p.charCodeAt(l+C);if(g!==f.charCodeAt(d+C))break;g===47&&($=C)}var y="";for(C=l+$+1;C<=b;++C)C!==b&&p.charCodeAt(C)!==47||(y.length===0?y+="..":y+="/..");return y.length>0?y+f.slice(d+$):(d+=$,f.charCodeAt(d)===47&&++d,f.slice(d))},_makeLong:function(p){return p},dirname:function(p){if(s(p),p.length===0)return".";for(var f=p.charCodeAt(0),l=f===47,b=-1,v=!0,d=p.length-1;d>=1;--d)if((f=p.charCodeAt(d))===47){if(!v){b=d;break}}else v=!1;return b===-1?l?"/":".":l&&b===1?"//":p.slice(0,b)},basename:function(p,f){if(f!==void 0&&typeof f!="string")throw new TypeError('"ext" argument must be a string');s(p);var l,b=0,v=-1,d=!0;if(f!==void 0&&f.length>0&&f.length<=p.length){if(f.length===p.length&&f===p)return"";var w=f.length-1,D=-1;for(l=p.length-1;l>=0;--l){var $=p.charCodeAt(l);if($===47){if(!d){b=l+1;break}}else D===-1&&(d=!1,D=l+1),w>=0&&($===f.charCodeAt(w)?--w==-1&&(v=l):(w=-1,v=D))}return b===v?v=D:v===-1&&(v=p.length),p.slice(b,v)}for(l=p.length-1;l>=0;--l)if(p.charCodeAt(l)===47){if(!d){b=l+1;break}}else v===-1&&(d=!1,v=l+1);return v===-1?"":p.slice(b,v)},extname:function(p){s(p);for(var f=-1,l=0,b=-1,v=!0,d=0,w=p.length-1;w>=0;--w){var D=p.charCodeAt(w);if(D!==47)b===-1&&(v=!1,b=w+1),D===46?f===-1?f=w:d!==1&&(d=1):f!==-1&&(d=-1);else if(!v){l=w+1;break}}return f===-1||b===-1||d===0||d===1&&f===b-1&&f===l+1?"":p.slice(f,b)},format:function(p){if(p===null||typeof p!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof p);return function(f,l){var b=l.dir||l.root,v=l.base||(l.name||"")+(l.ext||"");return b?b===l.root?b+v:b+"/"+v:v}(0,p)},parse:function(p){s(p);var f={root:"",dir:"",base:"",ext:"",name:""};if(p.length===0)return f;var l,b=p.charCodeAt(0),v=b===47;v?(f.root="/",l=1):l=0;for(var d=-1,w=0,D=-1,$=!0,C=p.length-1,g=0;C>=l;--C)if((b=p.charCodeAt(C))!==47)D===-1&&($=!1,D=C+1),b===46?d===-1?d=C:g!==1&&(g=1):d!==-1&&(g=-1);else if(!$){w=C+1;break}return d===-1||D===-1||g===0||g===1&&d===D-1&&d===w+1?D!==-1&&(f.base=f.name=w===0&&v?p.slice(1,D):p.slice(w,D)):(w===0&&v?(f.name=p.slice(1,d),f.base=p.slice(1,D)):(f.name=p.slice(w,d),f.base=p.slice(w,D)),f.ext=p.slice(d,D)),w>0?f.dir=p.slice(0,w-1):v&&(f.dir="/"),f},sep:"/",delimiter:":",win32:null,posix:null};c.posix=c,r.exports=c}},t={};function n(r){var s=t[r];if(s!==void 0)return s.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.d=(r,s)=>{for(var a in s)n.o(s,a)&&!n.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:s[a]})},n.o=(r,s)=>Object.prototype.hasOwnProperty.call(r,s),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})};var i={};(()=>{let r;n.r(i),n.d(i,{URI:()=>v,Utils:()=>Re}),typeof process=="object"?r=process.platform==="win32":typeof navigator=="object"&&(r=navigator.userAgent.indexOf("Windows")>=0);let s=/^\w[\w\d+.-]*$/,a=/^\//,c=/^\/\//;function p(W,U){if(!W.scheme&&U)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${W.authority}", path: "${W.path}", query: "${W.query}", fragment: "${W.fragment}"}`);if(W.scheme&&!s.test(W.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(W.path){if(W.authority){if(!a.test(W.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(c.test(W.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}let f="",l="/",b=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class v{static isUri(U){return U instanceof v||!!U&&typeof U.authority=="string"&&typeof U.fragment=="string"&&typeof U.path=="string"&&typeof U.query=="string"&&typeof U.scheme=="string"&&typeof U.fsPath=="string"&&typeof U.with=="function"&&typeof U.toString=="function"}scheme;authority;path;query;fragment;constructor(U,Ke,ye,ct,De,S=!1){typeof U=="object"?(this.scheme=U.scheme||f,this.authority=U.authority||f,this.path=U.path||f,this.query=U.query||f,this.fragment=U.fragment||f):(this.scheme=function(Et,Lt){return Et||Lt?Et:"file"}(U,S),this.authority=Ke||f,this.path=function(Et,Lt){switch(Et){case"https":case"http":case"file":Lt?Lt[0]!==l&&(Lt=l+Lt):Lt=l}return Lt}(this.scheme,ye||f),this.query=ct||f,this.fragment=De||f,p(this,S))}get fsPath(){return g(this,!1)}with(U){if(!U)return this;let{scheme:Ke,authority:ye,path:ct,query:De,fragment:S}=U;return Ke===void 0?Ke=this.scheme:Ke===null&&(Ke=f),ye===void 0?ye=this.authority:ye===null&&(ye=f),ct===void 0?ct=this.path:ct===null&&(ct=f),De===void 0?De=this.query:De===null&&(De=f),S===void 0?S=this.fragment:S===null&&(S=f),Ke===this.scheme&&ye===this.authority&&ct===this.path&&De===this.query&&S===this.fragment?this:new w(Ke,ye,ct,De,S)}static parse(U,Ke=!1){let ye=b.exec(U);return ye?new w(ye[2]||f,h(ye[4]||f),h(ye[5]||f),h(ye[7]||f),h(ye[9]||f),Ke):new w(f,f,f,f,f)}static file(U){let Ke=f;if(r&&(U=U.replace(/\\/g,l)),U[0]===l&&U[1]===l){let ye=U.indexOf(l,2);ye===-1?(Ke=U.substring(2),U=l):(Ke=U.substring(2,ye),U=U.substring(ye)||l)}return new w("file",Ke,U,f,f)}static from(U){let Ke=new w(U.scheme,U.authority,U.path,U.query,U.fragment);return p(Ke,!0),Ke}toString(U=!1){return y(this,U)}toJSON(){return this}static revive(U){if(U){if(U instanceof v)return U;{let Ke=new w(U);return Ke._formatted=U.external,Ke._fsPath=U._sep===d?U.fsPath:null,Ke}}return U}}let d=r?1:void 0;class w extends v{_formatted=null;_fsPath=null;get fsPath(){return this._fsPath||(this._fsPath=g(this,!1)),this._fsPath}toString(U=!1){return U?y(this,!0):(this._formatted||(this._formatted=y(this,!1)),this._formatted)}toJSON(){let U={$mid:1};return this._fsPath&&(U.fsPath=this._fsPath,U._sep=d),this._formatted&&(U.external=this._formatted),this.path&&(U.path=this.path),this.scheme&&(U.scheme=this.scheme),this.authority&&(U.authority=this.authority),this.query&&(U.query=this.query),this.fragment&&(U.fragment=this.fragment),U}}let D={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function $(W,U,Ke){let ye,ct=-1;for(let De=0;De<W.length;De++){let S=W.charCodeAt(De);if(S>=97&&S<=122||S>=65&&S<=90||S>=48&&S<=57||S===45||S===46||S===95||S===126||U&&S===47||Ke&&S===91||Ke&&S===93||Ke&&S===58)ct!==-1&&(ye+=encodeURIComponent(W.substring(ct,De)),ct=-1),ye!==void 0&&(ye+=W.charAt(De));else{ye===void 0&&(ye=W.substr(0,De));let Et=D[S];Et!==void 0?(ct!==-1&&(ye+=encodeURIComponent(W.substring(ct,De)),ct=-1),ye+=Et):ct===-1&&(ct=De)}}return ct!==-1&&(ye+=encodeURIComponent(W.substring(ct))),ye!==void 0?ye:W}function C(W){let U;for(let Ke=0;Ke<W.length;Ke++){let ye=W.charCodeAt(Ke);ye===35||ye===63?(U===void 0&&(U=W.substr(0,Ke)),U+=D[ye]):U!==void 0&&(U+=W[Ke])}return U!==void 0?U:W}function g(W,U){let Ke;return Ke=W.authority&&W.path.length>1&&W.scheme==="file"?`//${W.authority}${W.path}`:W.path.charCodeAt(0)===47&&(W.path.charCodeAt(1)>=65&&W.path.charCodeAt(1)<=90||W.path.charCodeAt(1)>=97&&W.path.charCodeAt(1)<=122)&&W.path.charCodeAt(2)===58?U?W.path.substr(1):W.path[1].toLowerCase()+W.path.substr(2):W.path,r&&(Ke=Ke.replace(/\//g,"\\")),Ke}function y(W,U){let Ke=U?C:$,ye="",{scheme:ct,authority:De,path:S,query:Et,fragment:Lt}=W;if(ct&&(ye+=ct,ye+=":"),(De||ct==="file")&&(ye+=l,ye+=l),De){let Pe=De.indexOf("@");if(Pe!==-1){let rn=De.substr(0,Pe);De=De.substr(Pe+1),Pe=rn.lastIndexOf(":"),Pe===-1?ye+=Ke(rn,!1,!1):(ye+=Ke(rn.substr(0,Pe),!1,!1),ye+=":",ye+=Ke(rn.substr(Pe+1),!1,!0)),ye+="@"}De=De.toLowerCase(),Pe=De.lastIndexOf(":"),Pe===-1?ye+=Ke(De,!1,!0):(ye+=Ke(De.substr(0,Pe),!1,!0),ye+=De.substr(Pe))}if(S){if(S.length>=3&&S.charCodeAt(0)===47&&S.charCodeAt(2)===58){let Pe=S.charCodeAt(1);Pe>=65&&Pe<=90&&(S=`/${String.fromCharCode(Pe+32)}:${S.substr(3)}`)}else if(S.length>=2&&S.charCodeAt(1)===58){let Pe=S.charCodeAt(0);Pe>=65&&Pe<=90&&(S=`${String.fromCharCode(Pe+32)}:${S.substr(2)}`)}ye+=Ke(S,!0,!1)}return Et&&(ye+="?",ye+=Ke(Et,!1,!1)),Lt&&(ye+="#",ye+=U?Lt:$(Lt,!1,!1)),ye}function u(W){try{return decodeURIComponent(W)}catch{return W.length>3?W.substr(0,3)+u(W.substr(3)):W}}let B=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function h(W){return W.match(B)?W.replace(B,U=>u(U)):W}var le=n(470);let ge=le.posix||le,Ne="/";var Re;(function(W){W.joinPath=function(U,...Ke){return U.with({path:ge.join(U.path,...Ke)})},W.resolvePath=function(U,...Ke){let ye=U.path,ct=!1;ye[0]!==Ne&&(ye=Ne+ye,ct=!0);let De=ge.resolve(ye,...Ke);return ct&&De[0]===Ne&&!U.authority&&(De=De.substring(1)),U.with({path:De})},W.dirname=function(U){if(U.path.length===0||U.path===Ne)return U;let Ke=ge.dirname(U.path);return Ke.length===1&&Ke.charCodeAt(0)===46&&(Ke=""),U.with({path:Ke})},W.basename=function(U){return ge.basename(U.path)},W.extname=function(U){return ge.extname(U.path)}})(Re||(Re={}))})(),Wg=i})();var{URI:pn,Utils:ST}=Wg;var to=Bn(Cu()),G_=require("child_process");var kc=require("child_process");var Oi=require("path");var Cn=require("fs");var Vg;(function(e){function t(n){return typeof n=="string"}e.is=t})(Vg||(Vg={}));var Su;(function(e){function t(n){return typeof n=="string"}e.is=t})(Su||(Su={}));var Ug;(function(e){e.MIN_VALUE=-2147483648,e.MAX_VALUE=2147483647;function t(n){return typeof n=="number"&&e.MIN_VALUE<=n&&n<=e.MAX_VALUE}e.is=t})(Ug||(Ug={}));var Va;(function(e){e.MIN_VALUE=0,e.MAX_VALUE=2147483647;function t(n){return typeof n=="number"&&e.MIN_VALUE<=n&&n<=e.MAX_VALUE}e.is=t})(Va||(Va={}));var Nr;(function(e){function t(i,r){return i===Number.MAX_VALUE&&(i=Va.MAX_VALUE),r===Number.MAX_VALUE&&(r=Va.MAX_VALUE),{line:i,character:r}}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&Y.uinteger(r.line)&&Y.uinteger(r.character)}e.is=n})(Nr||(Nr={}));var _n;(function(e){function t(i,r,s,a){if(Y.uinteger(i)&&Y.uinteger(r)&&Y.uinteger(s)&&Y.uinteger(a))return{start:Nr.create(i,r),end:Nr.create(s,a)};if(Nr.is(i)&&Nr.is(r))return{start:i,end:r};throw new Error(`Range#create called with invalid arguments[${i}, ${r}, ${s}, ${a}]`)}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&Nr.is(r.start)&&Nr.is(r.end)}e.is=n})(_n||(_n={}));var Ua;(function(e){function t(i,r){return{uri:i,range:r}}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&_n.is(r.range)&&(Y.string(r.uri)||Y.undefined(r.uri))}e.is=n})(Ua||(Ua={}));var Bg;(function(e){function t(i,r,s,a){return{targetUri:i,targetRange:r,targetSelectionRange:s,originSelectionRange:a}}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&_n.is(r.targetRange)&&Y.string(r.targetUri)&&_n.is(r.targetSelectionRange)&&(_n.is(r.originSelectionRange)||Y.undefined(r.originSelectionRange))}e.is=n})(Bg||(Bg={}));var Du;(function(e){function t(i,r,s,a){return{red:i,green:r,blue:s,alpha:a}}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&Y.numberRange(r.red,0,1)&&Y.numberRange(r.green,0,1)&&Y.numberRange(r.blue,0,1)&&Y.numberRange(r.alpha,0,1)}e.is=n})(Du||(Du={}));var Hg;(function(e){function t(i,r){return{range:i,color:r}}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&_n.is(r.range)&&Du.is(r.color)}e.is=n})(Hg||(Hg={}));var zg;(function(e){function t(i,r,s){return{label:i,textEdit:r,additionalTextEdits:s}}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&Y.string(r.label)&&(Y.undefined(r.textEdit)||So.is(r))&&(Y.undefined(r.additionalTextEdits)||Y.typedArray(r.additionalTextEdits,So.is))}e.is=n})(zg||(zg={}));var Gg;(function(e){e.Comment="comment",e.Imports="imports",e.Region="region"})(Gg||(Gg={}));var Xg;(function(e){function t(i,r,s,a,c,p){let f={startLine:i,endLine:r};return Y.defined(s)&&(f.startCharacter=s),Y.defined(a)&&(f.endCharacter=a),Y.defined(c)&&(f.kind=c),Y.defined(p)&&(f.collapsedText=p),f}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&Y.uinteger(r.startLine)&&Y.uinteger(r.startLine)&&(Y.undefined(r.startCharacter)||Y.uinteger(r.startCharacter))&&(Y.undefined(r.endCharacter)||Y.uinteger(r.endCharacter))&&(Y.undefined(r.kind)||Y.string(r.kind))}e.is=n})(Xg||(Xg={}));var Au;(function(e){function t(i,r){return{location:i,message:r}}e.create=t;function n(i){let r=i;return Y.defined(r)&&Ua.is(r.location)&&Y.string(r.message)}e.is=n})(Au||(Au={}));var Qg;(function(e){e.Error=1,e.Warning=2,e.Information=3,e.Hint=4})(Qg||(Qg={}));var Jg;(function(e){e.Unnecessary=1,e.Deprecated=2})(Jg||(Jg={}));var Zg;(function(e){function t(n){let i=n;return Y.objectLiteral(i)&&Y.string(i.href)}e.is=t})(Zg||(Zg={}));var Ba;(function(e){function t(i,r,s,a,c,p){let f={range:i,message:r};return Y.defined(s)&&(f.severity=s),Y.defined(a)&&(f.code=a),Y.defined(c)&&(f.source=c),Y.defined(p)&&(f.relatedInformation=p),f}e.create=t;function n(i){var r;let s=i;return Y.defined(s)&&_n.is(s.range)&&Y.string(s.message)&&(Y.number(s.severity)||Y.undefined(s.severity))&&(Y.integer(s.code)||Y.string(s.code)||Y.undefined(s.code))&&(Y.undefined(s.codeDescription)||Y.string((r=s.codeDescription)===null||r===void 0?void 0:r.href))&&(Y.string(s.source)||Y.undefined(s.source))&&(Y.undefined(s.relatedInformation)||Y.typedArray(s.relatedInformation,Au.is))}e.is=n})(Ba||(Ba={}));var Co;(function(e){function t(i,r,...s){let a={title:i,command:r};return Y.defined(s)&&s.length>0&&(a.arguments=s),a}e.create=t;function n(i){let r=i;return Y.defined(r)&&Y.string(r.title)&&Y.string(r.command)}e.is=n})(Co||(Co={}));var So;(function(e){function t(s,a){return{range:s,newText:a}}e.replace=t;function n(s,a){return{range:{start:s,end:s},newText:a}}e.insert=n;function i(s){return{range:s,newText:""}}e.del=i;function r(s){let a=s;return Y.objectLiteral(a)&&Y.string(a.newText)&&_n.is(a.range)}e.is=r})(So||(So={}));var Pu;(function(e){function t(i,r,s){let a={label:i};return r!==void 0&&(a.needsConfirmation=r),s!==void 0&&(a.description=s),a}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&Y.string(r.label)&&(Y.boolean(r.needsConfirmation)||r.needsConfirmation===void 0)&&(Y.string(r.description)||r.description===void 0)}e.is=n})(Pu||(Pu={}));var Do;(function(e){function t(n){let i=n;return Y.string(i)}e.is=t})(Do||(Do={}));var Yg;(function(e){function t(s,a,c){return{range:s,newText:a,annotationId:c}}e.replace=t;function n(s,a,c){return{range:{start:s,end:s},newText:a,annotationId:c}}e.insert=n;function i(s,a){return{range:s,newText:"",annotationId:a}}e.del=i;function r(s){let a=s;return So.is(a)&&(Pu.is(a.annotationId)||Do.is(a.annotationId))}e.is=r})(Yg||(Yg={}));var Eu;(function(e){function t(i,r){return{textDocument:i,edits:r}}e.create=t;function n(i){let r=i;return Y.defined(r)&&Iu.is(r.textDocument)&&Array.isArray(r.edits)}e.is=n})(Eu||(Eu={}));var Ou;(function(e){function t(i,r,s){let a={kind:"create",uri:i};return r!==void 0&&(r.overwrite!==void 0||r.ignoreIfExists!==void 0)&&(a.options=r),s!==void 0&&(a.annotationId=s),a}e.create=t;function n(i){let r=i;return r&&r.kind==="create"&&Y.string(r.uri)&&(r.options===void 0||(r.options.overwrite===void 0||Y.boolean(r.options.overwrite))&&(r.options.ignoreIfExists===void 0||Y.boolean(r.options.ignoreIfExists)))&&(r.annotationId===void 0||Do.is(r.annotationId))}e.is=n})(Ou||(Ou={}));var Nu;(function(e){function t(i,r,s,a){let c={kind:"rename",oldUri:i,newUri:r};return s!==void 0&&(s.overwrite!==void 0||s.ignoreIfExists!==void 0)&&(c.options=s),a!==void 0&&(c.annotationId=a),c}e.create=t;function n(i){let r=i;return r&&r.kind==="rename"&&Y.string(r.oldUri)&&Y.string(r.newUri)&&(r.options===void 0||(r.options.overwrite===void 0||Y.boolean(r.options.overwrite))&&(r.options.ignoreIfExists===void 0||Y.boolean(r.options.ignoreIfExists)))&&(r.annotationId===void 0||Do.is(r.annotationId))}e.is=n})(Nu||(Nu={}));var Lu;(function(e){function t(i,r,s){let a={kind:"delete",uri:i};return r!==void 0&&(r.recursive!==void 0||r.ignoreIfNotExists!==void 0)&&(a.options=r),s!==void 0&&(a.annotationId=s),a}e.create=t;function n(i){let r=i;return r&&r.kind==="delete"&&Y.string(r.uri)&&(r.options===void 0||(r.options.recursive===void 0||Y.boolean(r.options.recursive))&&(r.options.ignoreIfNotExists===void 0||Y.boolean(r.options.ignoreIfNotExists)))&&(r.annotationId===void 0||Do.is(r.annotationId))}e.is=n})(Lu||(Lu={}));var Mu;(function(e){function t(n){let i=n;return i&&(i.changes!==void 0||i.documentChanges!==void 0)&&(i.documentChanges===void 0||i.documentChanges.every(r=>Y.string(r.kind)?Ou.is(r)||Nu.is(r)||Lu.is(r):Eu.is(r)))}e.is=t})(Mu||(Mu={}));var em;(function(e){function t(i){return{uri:i}}e.create=t;function n(i){let r=i;return Y.defined(r)&&Y.string(r.uri)}e.is=n})(em||(em={}));var tm;(function(e){function t(i,r){return{uri:i,version:r}}e.create=t;function n(i){let r=i;return Y.defined(r)&&Y.string(r.uri)&&Y.integer(r.version)}e.is=n})(tm||(tm={}));var Iu;(function(e){function t(i,r){return{uri:i,version:r}}e.create=t;function n(i){let r=i;return Y.defined(r)&&Y.string(r.uri)&&(r.version===null||Y.integer(r.version))}e.is=n})(Iu||(Iu={}));var nm;(function(e){function t(i,r,s,a){return{uri:i,languageId:r,version:s,text:a}}e.create=t;function n(i){let r=i;return Y.defined(r)&&Y.string(r.uri)&&Y.string(r.languageId)&&Y.integer(r.version)&&Y.string(r.text)}e.is=n})(nm||(nm={}));var Fu;(function(e){e.PlainText="plaintext",e.Markdown="markdown";function t(n){let i=n;return i===e.PlainText||i===e.Markdown}e.is=t})(Fu||(Fu={}));var os;(function(e){function t(n){let i=n;return Y.objectLiteral(n)&&Fu.is(i.kind)&&Y.string(i.value)}e.is=t})(os||(os={}));var Rr;(function(e){e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25})(Rr||(Rr={}));var Wi;(function(e){e.PlainText=1,e.Snippet=2})(Wi||(Wi={}));var rm;(function(e){e.Deprecated=1})(rm||(rm={}));var im;(function(e){function t(i,r,s){return{newText:i,insert:r,replace:s}}e.create=t;function n(i){let r=i;return r&&Y.string(r.newText)&&_n.is(r.insert)&&_n.is(r.replace)}e.is=n})(im||(im={}));var om;(function(e){e.asIs=1,e.adjustIndentation=2})(om||(om={}));var sm;(function(e){function t(n){let i=n;return i&&(Y.string(i.detail)||i.detail===void 0)&&(Y.string(i.description)||i.description===void 0)}e.is=t})(sm||(sm={}));var am;(function(e){function t(n){return{label:n}}e.create=t})(am||(am={}));var cm;(function(e){function t(n,i){return{items:n||[],isIncomplete:!!i}}e.create=t})(cm||(cm={}));var Ha;(function(e){function t(i){return i.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}e.fromPlainText=t;function n(i){let r=i;return Y.string(r)||Y.objectLiteral(r)&&Y.string(r.language)&&Y.string(r.value)}e.is=n})(Ha||(Ha={}));var lm;(function(e){function t(n){let i=n;return!!i&&Y.objectLiteral(i)&&(os.is(i.contents)||Ha.is(i.contents)||Y.typedArray(i.contents,Ha.is))&&(n.range===void 0||_n.is(n.range))}e.is=t})(lm||(lm={}));var um;(function(e){function t(n,i){return i?{label:n,documentation:i}:{label:n}}e.create=t})(um||(um={}));var fm;(function(e){function t(n,i,...r){let s={label:n};return Y.defined(i)&&(s.documentation=i),Y.defined(r)?s.parameters=r:s.parameters=[],s}e.create=t})(fm||(fm={}));var dm;(function(e){e.Text=1,e.Read=2,e.Write=3})(dm||(dm={}));var pm;(function(e){function t(n,i){let r={range:n};return Y.number(i)&&(r.kind=i),r}e.create=t})(pm||(pm={}));var za;(function(e){e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26})(za||(za={}));var hm;(function(e){e.Deprecated=1})(hm||(hm={}));var gm;(function(e){function t(n,i,r,s,a){let c={name:n,kind:i,location:{uri:s,range:r}};return a&&(c.containerName=a),c}e.create=t})(gm||(gm={}));var mm;(function(e){function t(n,i,r,s){return s!==void 0?{name:n,kind:i,location:{uri:r,range:s}}:{name:n,kind:i,location:{uri:r}}}e.create=t})(mm||(mm={}));var _m;(function(e){function t(i,r,s,a,c,p){let f={name:i,detail:r,kind:s,range:a,selectionRange:c};return p!==void 0&&(f.children=p),f}e.create=t;function n(i){let r=i;return r&&Y.string(r.name)&&Y.number(r.kind)&&_n.is(r.range)&&_n.is(r.selectionRange)&&(r.detail===void 0||Y.string(r.detail))&&(r.deprecated===void 0||Y.boolean(r.deprecated))&&(r.children===void 0||Array.isArray(r.children))&&(r.tags===void 0||Array.isArray(r.tags))}e.is=n})(_m||(_m={}));var bm;(function(e){e.Empty="",e.QuickFix="quickfix",e.Refactor="refactor",e.RefactorExtract="refactor.extract",e.RefactorInline="refactor.inline",e.RefactorRewrite="refactor.rewrite",e.Source="source",e.SourceOrganizeImports="source.organizeImports",e.SourceFixAll="source.fixAll"})(bm||(bm={}));var Ga;(function(e){e.Invoked=1,e.Automatic=2})(Ga||(Ga={}));var ym;(function(e){function t(i,r,s){let a={diagnostics:i};return r!=null&&(a.only=r),s!=null&&(a.triggerKind=s),a}e.create=t;function n(i){let r=i;return Y.defined(r)&&Y.typedArray(r.diagnostics,Ba.is)&&(r.only===void 0||Y.typedArray(r.only,Y.string))&&(r.triggerKind===void 0||r.triggerKind===Ga.Invoked||r.triggerKind===Ga.Automatic)}e.is=n})(ym||(ym={}));var km;(function(e){function t(i,r,s){let a={title:i},c=!0;return typeof r=="string"?(c=!1,a.kind=r):Co.is(r)?a.command=r:a.edit=r,c&&s!==void 0&&(a.kind=s),a}e.create=t;function n(i){let r=i;return r&&Y.string(r.title)&&(r.diagnostics===void 0||Y.typedArray(r.diagnostics,Ba.is))&&(r.kind===void 0||Y.string(r.kind))&&(r.edit!==void 0||r.command!==void 0)&&(r.command===void 0||Co.is(r.command))&&(r.isPreferred===void 0||Y.boolean(r.isPreferred))&&(r.edit===void 0||Mu.is(r.edit))}e.is=n})(km||(km={}));var vm;(function(e){function t(i,r){let s={range:i};return Y.defined(r)&&(s.data=r),s}e.create=t;function n(i){let r=i;return Y.defined(r)&&_n.is(r.range)&&(Y.undefined(r.command)||Co.is(r.command))}e.is=n})(vm||(vm={}));var Tm;(function(e){function t(i,r){return{tabSize:i,insertSpaces:r}}e.create=t;function n(i){let r=i;return Y.defined(r)&&Y.uinteger(r.tabSize)&&Y.boolean(r.insertSpaces)}e.is=n})(Tm||(Tm={}));var wm;(function(e){function t(i,r,s){return{range:i,target:r,data:s}}e.create=t;function n(i){let r=i;return Y.defined(r)&&_n.is(r.range)&&(Y.undefined(r.target)||Y.string(r.target))}e.is=n})(wm||(wm={}));var Rm;(function(e){function t(i,r){return{range:i,parent:r}}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&_n.is(r.range)&&(r.parent===void 0||e.is(r.parent))}e.is=n})(Rm||(Rm={}));var xm;(function(e){e.namespace="namespace",e.type="type",e.class="class",e.enum="enum",e.interface="interface",e.struct="struct",e.typeParameter="typeParameter",e.parameter="parameter",e.variable="variable",e.property="property",e.enumMember="enumMember",e.event="event",e.function="function",e.method="method",e.macro="macro",e.keyword="keyword",e.modifier="modifier",e.comment="comment",e.string="string",e.number="number",e.regexp="regexp",e.operator="operator",e.decorator="decorator"})(xm||(xm={}));var Cm;(function(e){e.declaration="declaration",e.definition="definition",e.readonly="readonly",e.static="static",e.deprecated="deprecated",e.abstract="abstract",e.async="async",e.modification="modification",e.documentation="documentation",e.defaultLibrary="defaultLibrary"})(Cm||(Cm={}));var Sm;(function(e){function t(n){let i=n;return Y.objectLiteral(i)&&(i.resultId===void 0||typeof i.resultId=="string")&&Array.isArray(i.data)&&(i.data.length===0||typeof i.data[0]=="number")}e.is=t})(Sm||(Sm={}));var Dm;(function(e){function t(i,r){return{range:i,text:r}}e.create=t;function n(i){let r=i;return r!=null&&_n.is(r.range)&&Y.string(r.text)}e.is=n})(Dm||(Dm={}));var Am;(function(e){function t(i,r,s){return{range:i,variableName:r,caseSensitiveLookup:s}}e.create=t;function n(i){let r=i;return r!=null&&_n.is(r.range)&&Y.boolean(r.caseSensitiveLookup)&&(Y.string(r.variableName)||r.variableName===void 0)}e.is=n})(Am||(Am={}));var Pm;(function(e){function t(i,r){return{range:i,expression:r}}e.create=t;function n(i){let r=i;return r!=null&&_n.is(r.range)&&(Y.string(r.expression)||r.expression===void 0)}e.is=n})(Pm||(Pm={}));var Em;(function(e){function t(i,r){return{frameId:i,stoppedLocation:r}}e.create=t;function n(i){let r=i;return Y.defined(r)&&_n.is(i.stoppedLocation)}e.is=n})(Em||(Em={}));var qu;(function(e){e.Type=1,e.Parameter=2;function t(n){return n===1||n===2}e.is=t})(qu||(qu={}));var ju;(function(e){function t(i){return{value:i}}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&(r.tooltip===void 0||Y.string(r.tooltip)||os.is(r.tooltip))&&(r.location===void 0||Ua.is(r.location))&&(r.command===void 0||Co.is(r.command))}e.is=n})(ju||(ju={}));var Om;(function(e){function t(i,r,s){let a={position:i,label:r};return s!==void 0&&(a.kind=s),a}e.create=t;function n(i){let r=i;return Y.objectLiteral(r)&&Nr.is(r.position)&&(Y.string(r.label)||Y.typedArray(r.label,ju.is))&&(r.kind===void 0||qu.is(r.kind))&&r.textEdits===void 0||Y.typedArray(r.textEdits,So.is)&&(r.tooltip===void 0||Y.string(r.tooltip)||os.is(r.tooltip))&&(r.paddingLeft===void 0||Y.boolean(r.paddingLeft))&&(r.paddingRight===void 0||Y.boolean(r.paddingRight))}e.is=n})(Om||(Om={}));var Nm;(function(e){function t(n){return{kind:"snippet",value:n}}e.createSnippet=t})(Nm||(Nm={}));var Lm;(function(e){function t(n,i,r,s){return{insertText:n,filterText:i,range:r,command:s}}e.create=t})(Lm||(Lm={}));var Mm;(function(e){function t(n){return{items:n}}e.create=t})(Mm||(Mm={}));var Im;(function(e){e.Invoked=0,e.Automatic=1})(Im||(Im={}));var Fm;(function(e){function t(n,i){return{range:n,text:i}}e.create=t})(Fm||(Fm={}));var qm;(function(e){function t(n,i){return{triggerKind:n,selectedCompletionInfo:i}}e.create=t})(qm||(qm={}));var jm;(function(e){function t(n){let i=n;return Y.objectLiteral(i)&&Su.is(i.uri)&&Y.string(i.name)}e.is=t})(jm||(jm={}));var Km;(function(e){function t(s,a,c,p){return new Ku(s,a,c,p)}e.create=t;function n(s){let a=s;return!!(Y.defined(a)&&Y.string(a.uri)&&(Y.undefined(a.languageId)||Y.string(a.languageId))&&Y.uinteger(a.lineCount)&&Y.func(a.getText)&&Y.func(a.positionAt)&&Y.func(a.offsetAt))}e.is=n;function i(s,a){let c=s.getText(),p=r(a,(l,b)=>{let v=l.range.start.line-b.range.start.line;return v===0?l.range.start.character-b.range.start.character:v}),f=c.length;for(let l=p.length-1;l>=0;l--){let b=p[l],v=s.offsetAt(b.range.start),d=s.offsetAt(b.range.end);if(d<=f)c=c.substring(0,v)+b.newText+c.substring(d,c.length);else throw new Error("Overlapping edit");f=v}return c}e.applyEdits=i;function r(s,a){if(s.length<=1)return s;let c=s.length/2|0,p=s.slice(0,c),f=s.slice(c);r(p,a),r(f,a);let l=0,b=0,v=0;for(;l<p.length&&b<f.length;)a(p[l],f[b])<=0?s[v++]=p[l++]:s[v++]=f[b++];for(;l<p.length;)s[v++]=p[l++];for(;b<f.length;)s[v++]=f[b++];return s}})(Km||(Km={}));var Ku=class{constructor(t,n,i,r){this._uri=t,this._languageId=n,this._version=i,this._content=r,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(t){if(t){let n=this.offsetAt(t.start),i=this.offsetAt(t.end);return this._content.substring(n,i)}return this._content}update(t,n){this._content=t.text,this._version=n,this._lineOffsets=void 0}getLineOffsets(){if(this._lineOffsets===void 0){let t=[],n=this._content,i=!0;for(let r=0;r<n.length;r++){i&&(t.push(r),i=!1);let s=n.charAt(r);i=s==="\r"||s===`
`,s==="\r"&&r+1<n.length&&n.charAt(r+1)===`
`&&r++}i&&n.length>0&&t.push(n.length),this._lineOffsets=t}return this._lineOffsets}positionAt(t){t=Math.max(Math.min(t,this._content.length),0);let n=this.getLineOffsets(),i=0,r=n.length;if(r===0)return Nr.create(0,t);for(;i<r;){let a=Math.floor((i+r)/2);n[a]>t?r=a:i=a+1}let s=i-1;return Nr.create(s,t-n[s])}offsetAt(t){let n=this.getLineOffsets();if(t.line>=n.length)return this._content.length;if(t.line<0)return 0;let i=n[t.line],r=t.line+1<n.length?n[t.line+1]:this._content.length;return Math.max(Math.min(i+t.character,r),i)}get lineCount(){return this.getLineOffsets().length}},Y;(function(e){let t=Object.prototype.toString;function n(d){return typeof d<"u"}e.defined=n;function i(d){return typeof d>"u"}e.undefined=i;function r(d){return d===!0||d===!1}e.boolean=r;function s(d){return t.call(d)==="[object String]"}e.string=s;function a(d){return t.call(d)==="[object Number]"}e.number=a;function c(d,w,D){return t.call(d)==="[object Number]"&&w<=d&&d<=D}e.numberRange=c;function p(d){return t.call(d)==="[object Number]"&&-2147483648<=d&&d<=2147483647}e.integer=p;function f(d){return t.call(d)==="[object Number]"&&0<=d&&d<=2147483647}e.uinteger=f;function l(d){return t.call(d)==="[object Function]"}e.func=l;function b(d){return d!==null&&typeof d=="object"}e.objectLiteral=b;function v(d,w){return Array.isArray(d)&&d.every(w)}e.typedArray=v})(Y||(Y={}));var ar=require("fs"),ec=require("path"),R=Bn(ir());var Xa=["true","false","unset","a_ahkpath","a_ahkversion","a_allowmainwindow","a_appdata","a_appdatacommon","a_args","a_clipboard","a_computername","a_comspec","a_controldelay","a_coordmodecaret","a_coordmodemenu","a_coordmodemouse","a_coordmodepixel","a_coordmodetooltip","a_cursor","a_dd","a_ddd","a_dddd","a_defaultmousespeed","a_desktop","a_desktopcommon","a_detecthiddentext","a_detecthiddenwindows","a_endchar","a_eventinfo","a_fileencoding","a_hotkeyinterval","a_hotkeymodifiertimeout","a_hour","a_iconfile","a_iconhidden","a_iconnumber","a_icontip","a_index","a_initialworkingdir","a_is64bitos","a_isadmin","a_iscompiled","a_iscritical","a_ispaused","a_issuspended","a_keydelay","a_keydelayplay","a_keyduration","a_keydurationplay","a_language","a_lasterror","a_linefile","a_linenumber","a_listlines","a_loopfield","a_loopfileattrib","a_loopfiledir","a_loopfileext","a_loopfilefullpath","a_loopfilename","a_loopfilepath","a_loopfileshortname","a_loopfileshortpath","a_loopfilesize","a_loopfilesizekb","a_loopfilesizemb","a_loopfiletimeaccessed","a_loopfiletimecreated","a_loopfiletimemodified","a_loopreadline","a_loopregkey","a_loopregname","a_loopregtimemodified","a_loopregtype","a_maxhotkeysperinterval","a_mday","a_menumaskkey","a_min","a_mm","a_mmm","a_mmmm","a_mon","a_mousedelay","a_mousedelayplay","a_msec","a_mydocuments","a_now","a_nowutc","a_osversion","a_priorhotkey","a_priorkey","a_programfiles","a_programs","a_programscommon","a_ptrsize","a_regview","a_screendpi","a_screenheight","a_screenwidth","a_scriptdir","a_scriptfullpath","a_scripthwnd","a_scriptname","a_sec","a_sendlevel","a_sendmode","a_space","a_startmenu","a_startmenucommon","a_startup","a_startupcommon","a_storecapslockmode","a_tab","a_temp","a_thisfunc","a_thishotkey","a_tickcount","a_timeidle","a_timeidlekeyboard","a_timeidlemouse","a_timeidlephysical","a_timesincepriorhotkey","a_timesincethishotkey","a_titlematchmode","a_titlematchmodespeed","a_traymenu","a_username","a_wday","a_windelay","a_windir","a_workingdir","a_yday","a_year","a_yweek","a_yyyy"],Qa=["a_ahkdir","a_dlldir","a_dllpath","a_globalstruct","a_isdll","a_mainthreadid","a_memorymodule","a_modulehandle","a_scriptstruct","a_threadid"],$m=["autotrim","blockinput","click","clipwait","control","controlclick","controlfocus","controlget","controlgetfocus","controlgetpos","controlgettext","controlmove","controlsend","controlsendraw","controlsettext","coordmode","critical","detecthiddentext","detecthiddenwindows","drive","driveget","drivespacefree","envadd","envdiv","envget","envmult","envset","envsub","envupdate","exit","exitapp","fileappend","filecopy","filecopydir","filecreatedir","filecreateshortcut","filedelete","fileencoding","filegetattrib","filegetshortcut","filegetsize","filegettime","filegetversion","fileinstall","filemove","filemovedir","fileopen","fileread","filereadline","filerecycle","filerecycleempty","fileremovedir","fileselectfile","fileselectfolder","filesetattrib","filesettime","format","formattime","getkeystate","gosub","groupactivate","groupadd","groupclose","groupdeactivate","gui","guicontrol","guicontrolget","hotkey","ifequal","ifexist","ifgreater","ifgreaterorequal","ifless","iflessorequal","ifmsgbox","ifnotequal","ifnotexist","ifwinactive","ifwinexist","ifwinnotactive","ifwinnotexist","imagesearch","inidelete","iniread","iniwrite","input","inputbox","keywait","listlines","menu","mouseclick","mouseclickdrag","mousegetpos","mousemove","msgbox","onerror","onexit","outputdebug","pause","pixelgetcolor","pixelsearch","postmessage","process","progress","random","regdelete","regread","regwrite","run","runas","runwait","send","sendevent","sendinput","sendlevel","sendmessage","sendmode","sendplay","sendraw","setbatchlines","setcapslockstate","setcontroldelay","setdefaultmousespeed","setenv","setformat","setkeydelay","setmousedelay","setnumlockstate","setregview","setscrolllockstate","setstorecapslockmode","settimer","settitlematchmode","setwindelay","setworkingdir","shutdown","sleep","sort","soundbeep","soundget","soundgetwavevolume","soundplay","soundset","soundsetwavevolume","splashimage","splashtextoff","splashtexton","splitpath","statusbargettext","statusbarwait","stringcasesense","stringleft","stringlower","stringright","stringtrimleft","stringtrimright","stringupper","suspend","sysget","thread","tooltip","transform","traytip","urldownloadtofile","winactivate","winactivatebottom","winclose","winget","wingetactivestats","wingetactivetitle","wingetclass","wingetpos","wingettext","wingettitle","winhide","winkill","winmaximize","winmenuselectitem","winminimize","winminimizeall","winminimizeallundo","winmove","winrestore","winset","winsettitle","winshow","winwait","winwaitactive","winwaitclose","winwaitnotactive"],On={space:" ",tab:"	"},$u=["str","astr","wstr","int64","int","uint","short","ushort","char","uchar","float","double","ptr","uptr","hresult"],ss={"\uFF0C":",","\u3002":".","\uFF1B":";","\u2018":"'","\u2019":"'","\u3010":"[","\u3011":"]","\u300A":"<","\u300B":">","\uFF1F":"?","\uFF1A":":","\u201C":'"',"\u201D":'"',"\uFF08":"(","\uFF09":")","\uFF01":"!"},Wm=["abstract","access","alias","argument","async","augments","author","borrows","callback","class","classdesc","constant","constructor","constructs","copyright","default","deprecated","description","emits","enum","event","example","exports","extends","external","field","file","fileoverview","fires","function","generator","global","hideconstructor","host","ignore","implements","inheritdoc","inner","instance","interface","kind","lends","license","link","linkcode","linkplain","listens","member","memberof","method","mixes","module","name","namespace","overload","override","package","param","private","prop","property","protected","public","readonly","requires","returns","satisfies","see","since","static","summary","template","this","throws","todo","tutorial","type","typedef","var","variation","version","virtual","yields"];var xk=(e={})=>({arrayStyle:"none",braceStyle:"One True Brace",breakChainedMethods:!1,ignoreComment:!1,indentString:"    ",indentBetweenHotIfDirectives:!1,keywordStartWithUppercase:!1,maxPreserveNewlines:2,objectStyle:"none",preserveNewlines:!0,spaceBeforeConditional:!0,spaceAfterDoubleColon:!0,spaceInEmptyParen:!1,spaceInOther:!0,spaceInParen:!1,switchCaseAlignment:!1,symbolWithSameCase:!1,whitespaceBeforeInlineComment:"",wrapLineLength:120,...e}),Ck=(e={})=>({exclude:[],v2:{general:{actionWhenV1Detected:"SwitchToV1",commentTagRegex:"^;;\\s*(.*)",completeFunctionCalls:!1,librarySuggestions:"Disabled",symbolFoldingFromOpenBrace:!1,syntaxes:""},completionCommitCharacters:{Class:".(",Function:"("},diagnostics:{classNonDynamicMemberCheck:!0,paramsCheck:!0},file:{interpreterPath:"C:\\Program Files\\AutoHotkey\\v2\\AutoHotkey.exe",maxScanDepth:2},formatter:xk(),warn:{varUnset:!0,localSameAsGlobal:!1,callWithoutParentheses:"Off"},workingDirectories:[]},...e}),Vi=Ck(),Ja="AHK++",at=(e,t=Vi)=>{if(!e)return t;let n=e.split("."),i=t;for(let r of n){if(!i){t===Vi&&console.warn("Failed to get config",e);return}i=i?.[r]}return i},ei=(e,t,n=Vi)=>{let i=e.split("."),r=n;for(let s of i.slice(0,-1))r=r?.[s];if(!r){n===Vi&&console.warn("(Global) Failed to set config",e,t);return}r[i[i.length-1]]=t},Vm=e=>{Object.assign(Vi,e)},Ao=(e=Vi)=>at("v2.general.librarySuggestions",e)==="User and Standard"||at("v2.general.librarySuggestions",e)==="All",Ui=(e=Vi)=>at("v2.general.librarySuggestions",e)==="Local"||at("v2.general.librarySuggestions",e)==="All";var Bm={},ti={author:He("completionitem.author","Add file infos about author, description, date, version."),comment:He("completionitem.generatecomment","Generate comment template of current function/method."),include:He("completionitem.include","Auto import from '{0}'"),prototype:He("completionitem.prototype","Retrieve or set the object on which all instances of the class are based."),thishotkey:He("completionitem.thishotkey","The hidden parameter to the hotkey function."),value:He("completionitem.value","Within the dynamic property 'set', 'Value' contains the value being assigned."),new:He("completionitem.new","export construct a new instance of the class."),this:He("completionitem.this","In the class, access other instance variables and methods of the class through 'this'."),super:He("completionitem.super","In the inherited class, 'super' can replace 'this' to access the superclass version of the method or property that is overridden in the derived class.")},Hm={include:He("codeaction.include","Import '{0}'")},F={acceptparams:He("diagnostic.acceptparams","'{0}' accepts {1} parameter(s)"),assignerr:He("diagnostic.assignerr","This {0} '{1}' cannot be used as an output variable"),classinfuncerr:He("diagnostic.classinfuncerr","Functions cannot contain classes"),classuseerr:He("diagnostic.classuseerr","This class cannot be used as an output variable"),conflictserr:He("diagnostic.conflictserr","This {0} '{2}' declaration conflicts with an existing {1}"),declarationerr:He("diagnostic.declarationerr","Unexpected declaration"),defaultvalmissing:He("diagnostic.defaultvalmissing","Parameter default required. Specifically: '{0}'"),deprecated:He("diagnostic.deprecated","Using '{0}' instead of '{1}'"),didyoumean:He("diagnostic.didyoumean","Did you mean to use '{0}'?"),dupdeclaration:He("diagnostic.dupdeclaration","Duplicate declaration"),duplabel:He("diagnostic.duplabel","Duplicate label"),filenotexist:He("diagnostic.filenotexist","'{0}' does not exist"),funccallerr:He("diagnostic.funccallerr","Function calls require a space or '(', use comma only between parameters"),funccallerr2:He("diagnostic.funccallerr2","In the expression, the function call requires parentheses"),globalconflicts:He("diagnostic.globalconflicts","This global declaration conflicts with an existing {0}"),hotdeferr:He("diagnostic.hotdeferr","Hotkeys/hotstrings cannot be defined in functions/classes"),hotmissbrace:He("diagnostic.hotmissbrace","Hotkey or hotstring is missing its opening brace"),invaliddefinition:He("diagnostic.invaliddefinition","Invalid {0} definition"),invalidencoding:He("diagnostic.invalidencoding","'{0}' invalid file encoding"),invalidhotdef:He("diagnostic.invalidhotdef","Invalid hotkey definition"),invalidparam:He("diagnostic.invalidparam","Invalid parameter definition"),invalidprop:He("diagnostic.invalidprop","Invalid dynamic property"),invalidpropname:He("diagnostic.invalidpropname","Invalid property name in object literal"),invalidsymbolname:He("diagnostic.invalidsymbolname","Invalid symbol naming '{0}'"),invalidsuper:He("diagnostic.invalidsuper","'super' is valid only inside a class"),invalidscope:He("diagnostic.invalidscope","'{0}' cannot be used in functions/classes"),maybehavenotmember:He("diagnostic.maybehavenotmember","Class '{0}' might not have member '{1}'"),maybev1:He("diagnostic.maybev1","This appears be a v1 script, continue parsing?"),missing:He("diagnostic.missing","Missing '{0}'"),missingparam:He("diagnostic.missingparam","Missing a required parameter"),missingoperand:He("diagnostic.missingoperand","Missing operand"),missingretval:He("diagnostic.missingretval","The function missing a return value"),missingspace:He("diagnostic.missingspace","Missing space or operator before this"),objectliteralerr:He("diagnostic.objectliteralerr","Error in object literal"),outofloop:He("diagnostic.outofloop","Break/Continue must be enclosed by a Loop"),paramcounterr:He("diagnostic.paramcounterr","Expected {0} parameters, but got {1}"),pathinvalid:He("diagnostic.pathinvalid","Invalid file path"),propdeclaraerr:He("diagnostic.propdeclaraerr","Not a valid method, class or property definition"),propemptyparams:He("diagnostic.propemptyparams","Empty [] not permitted"),propnotinit:He("diagnostic.propnotinit","Property declaration is not initialized"),requirev1:He("diagnostic.requirev1","This script requires AutoHotkey v1, continue parsing?"),requireversion:He("diagnostic.requireversion","This feature requires the AutoHotkey version >= v{0}"),requirevariable:He("diagnostic.requirevariable","'&' requires a variable"),reservedworderr:He("diagnostic.reservedworderr","The following reserved word '{0}' must not be used as a variable name"),resourcenotfound:He("diagnostic.resourcenotfound","No resource found or could not be resolved"),skipline:He("diagnostic.skipline","The line is skipped and not resolved"),syntaxerror:He("diagnostic.syntaxerror","Syntax error. Specifically: {0}"),tryswitchtov1:He("diagnostic.tryswitchtov1","Try switching to AutoHotkey v1."),typemaybenot:He("diagnostic.typemaybenot","This param should be a '{0}'"),unexpected:He("diagnostic.unexpected","Unexpected '{0}'"),unknown:He("diagnostic.unknown","Unknown {0}"),unknownoperatoruse:He("diagnostic.unknownoperatoruse","Unknown operator use"),unknowntoken:He("diagnostic.unknowntoken","Unknown token '{0}'"),unsupportinclude:He("diagnostic.unsupportinclude","#Include in functions and classes cannot correctly deduce scope and code completion"),unterminated:He("diagnostic.unterminated","Unterminated string text")},xi={varisunset:He("warn.varisunset","Variable '{0}' appears to never be assigned a value"),localsameasglobal:He("warn.localsameasglobal","This local variable '{0}' has the same name as a global variable"),callwithoutparentheses:He("warn.callwithoutparentheses","This function or method call has no parentheses")},Po={ahkpatherr:He("setting.ahkpatherr",`Couldn't resolve AHK v2 interpreter, please check settings: ${Ja}.v2.file.interpreterPath`),getenverr:He("setting.getenverr","Failed to get environment variables"),uialimit:He("setting.uialimit","The UIA executable does not allow redirection to stdin/stdout due to security restrictions, so some features that depend on this will not work"),versionerr:He("setting.versionerr","The current AutoHotkey.exe is not the v2 version, and cannot get the correct syntax analysis, completion and other functions")},Za={switchtov1:He("action.switchtov1","Switch to ahk v1"),skipline:He("action.skipline","Skip the line"),stopparsing:He("action.stopparsing","Stop parsing")},Wu={cannotrename:He("response.cannotrename","The element can't be renamed."),cannotrenamestdlib:He("response.cannotrenamestdlib","Elements defined in the standard AutoHotkey library can't be renamed.")};function zm(){{let e=Gm(`${ni}/package.nls.<>.json`,"utf8");Bm=e?JSON.parse(e):{}}}function He(e,t){return(...n)=>n.length?Sk(Um(e,t),...n):Um(e,t)}function Um(e,t){return Bm[e]||t}function Sk(e,...t){return e.replace(/\{(\d+)\}/g,(...n)=>{let i=parseInt(n[1]);return i<t.length?t[i]:" "})}var Bi={file:[],folder:[]},ri=(e,t="all",n=Bi)=>!!(n.folder.some(i=>i.test(e))||t==="all"&&n.file.some(i=>i.test(e)));var Gi=(l=>(l[l.class=0]="class",l[l.function=1]="function",l[l.method=2]="method",l[l.parameter=3]="parameter",l[l.variable=4]="variable",l[l.property=5]="property",l[l.keyword=6]="keyword",l[l.string=7]="string",l[l.number=8]="number",l[l.operator=9]="operator",l))(Gi||{}),us=(s=>(s[s.static=1]="static",s[s.readonly=2]="readonly",s[s.definition=4]="definition",s[s.defaultLibrary=8]="defaultLibrary",s[s.deprecated=16]="deprecated",s))(us||{}),t_=(e={})=>({array_style:"expand",brace_style:"Preserve",break_chained_methods:!1,ignore_comment:!1,indent_string:"	",indent_between_hotif_directive:!1,keyword_start_with_uppercase:!1,max_preserve_newlines:3,object_style:"expand",preserve_newlines:!0,space_before_conditional:!0,space_after_double_colon:!0,space_in_empty_paren:!1,space_in_other:!0,space_in_paren:!1,switch_case_alignment:!1,symbol_with_same_case:!1,white_space_before_inline_comment:"",wrap_line_length:0,...e}),Dk=e=>{let t=t_();return{array_style:e.arrayStyle??t.array_style,brace_style:e.braceStyle??t.brace_style,break_chained_methods:e.breakChainedMethods??t.break_chained_methods,ignore_comment:e.ignoreComment??t.ignore_comment,indent_string:e.indentString??t.indent_string,indent_between_hotif_directive:e.indentBetweenHotIfDirectives??t.indent_between_hotif_directive,keyword_start_with_uppercase:e.keywordStartWithUppercase??t.keyword_start_with_uppercase,max_preserve_newlines:e.maxPreserveNewlines??t.max_preserve_newlines,object_style:e.objectStyle??t.object_style,preserve_newlines:e.preserveNewlines??t.preserve_newlines,space_before_conditional:e.spaceBeforeConditional??t.space_before_conditional,space_after_double_colon:e.spaceAfterDoubleColon??t.space_after_double_colon,space_in_empty_paren:e.spaceInEmptyParen??t.space_in_empty_paren,space_in_other:e.spaceInOther??t.space_in_other,space_in_paren:e.spaceInParen??t.space_in_paren,switch_case_alignment:e.switchCaseAlignment??t.switch_case_alignment,symbol_with_same_case:e.symbolWithSameCase??t.symbol_with_same_case,white_space_before_inline_comment:e.whitespaceBeforeInlineComment??t.white_space_before_inline_comment,wrap_line_length:e.wrapLineLength??t.wrap_line_length}},Ya;(t=>{function e(n,i,r,s,a){return{name:n,kind:i,range:r,selectionRange:s,children:a}}t.create=e})(Ya||={});var Ln;(t=>{function e(n,i,r,s,a,c,p){let f="",l=!1,b=!1,v=[];a.format?.(a);for(let d of a)v.push(f.length),f+=`, ${d.pass_by_ref?(l=!0,++v[v.length-1],"&"):""}${d.name}${d.defaultVal?` := ${d.defaultVal}`:d.defaultVal===null?"?":d.arr?(b=!0,"*"):""}`;return{assume:0,static:p,variadic:b,children:c,hasref:l,name:n,kind:i,range:r,selectionRange:s,params:a,param_offsets:v,param_def_len:f.length||2,full:`${p?"static ":""}${n}(${f.substring(2)})`,declaration:{},global:{},local:{},labels:{}}}t.create=e})(Ln||={});var Jt;(t=>{function e(n,i,r){return{name:n,kind:i,range:r,selectionRange:{...r}}}t.create=e})(Jt||={});function Nn(e){return e<48?!1:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e>127}String.prototype.trim=function(){return this.replace(/^[ \t\r\n]+|[ \t\r\n]+$/g,"")};String.prototype.trimStart=function(){return this.replace(/^[ \t\r\n]+/,"")};String.prototype.trimEnd=function(){return this.replace(/[ \t\r\n]+$/,"")};var Ak=new RegExp(/['" \t](c|background|#)?((0x)?[\da-f]{6}([\da-f]{2})?|(black|silver|gray|white|maroon|red|purple|fuchsia|green|lime|olive|yellow|navy|blue|teal|aqua))\b/i),Pk=JSON.parse('{ "black": "000000", "silver": "c0c0c0", "gray": "808080", "white": "ffffff", "maroon": "800000", "red": "ff0000", "purple": "800080", "fuchsia": "ff00ff", "green": "008000", "lime": "00ff00", "olive": "808000", "yellow": "ffff00", "navy": "000080", "blue": "0000ff", "teal": "008080", "aqua": "00ffff" }'),Vn=` 	\r
`,Xm="+ - * / % & ++ -- ** // = += -= *= /= //= .= == := != !== ~= > < >= <= >>> >> << >>>= >>= <<= && &= | || ! ~ , ?? ??= : ? ^ ^= |= =>".split(" "),n_="try,throw,return,global,local,static,if,switch,case,for,while,loop,continue,break,goto".split(","),Qm=n_.concat(["class","in","is","isset","contains","else","until","catch","finally","and","or","not","as","super"]),nt={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",Conditional:"Conditional",Expression:"Expression"},r_=/^(alttab|alttabandmenu|alttabmenu|alttabmenudismiss|shiftalttab|shift|lshift|rshift|alt|lalt|ralt|control|lcontrol|rcontrol|ctrl|lctrl|rctrl|lwin|rwin|appskey|lbutton|rbutton|mbutton|wheeldown|wheelup|wheelleft|wheelright|xbutton1|xbutton2|(0*[2-9]|0*1[0-6]?)?joy0*([1-9]|[12]\d|3[012])|space|tab|enter|escape|esc|backspace|bs|delete|del|insert|ins|pgdn|pgup|home|end|up|down|left|right|printscreen|ctrlbreak|pause|help|sleep|scrolllock|capslock|numlock|numpad0|numpad1|numpad2|numpad3|numpad4|numpad5|numpad6|numpad7|numpad8|numpad9|numpadmult|numpadadd|numpadsub|numpaddiv|numpaddot|numpaddel|numpadins|numpadclear|numpadleft|numpadright|numpaddown|numpadup|numpadhome|numpadend|numpadpgdn|numpadpgup|numpadenter|f1|f2|f3|f4|f5|f6|f7|f8|f9|f10|f11|f12|f13|f14|f15|f16|f17|f18|f19|f20|f21|f22|f23|f24|browser_back|browser_forward|browser_refresh|browser_stop|browser_search|browser_favorites|browser_home|volume_mute|volume_down|volume_up|media_next|media_prev|media_stop|media_play_pause|launch_mail|launch_media|launch_app1|launch_app2|vk[a-f\d]{1,2}(sc[a-f\d]+)?|sc[a-f\d]+|`[;{]|[\x21-\x7E])$/i,pt={type:"",content:"",offset:0,length:0,topofline:0,next_token_offset:-1},Oo=[":=","??="],Eo={collapse:"collapse",expand:"expand",none:"none"},bn={start:{line:0,character:0},end:{line:0,character:0}},Vu=["__NEW","__INIT","__ITEM","__ENUM","__GET","__CALL","__SET","__DELETE"],cn=si("Any"),ic=si("Float",R.SymbolKind.Number),oc=si("Integer",R.SymbolKind.Number),Lr=si("Number",R.SymbolKind.Number),Sr=si("String",R.SymbolKind.String),tc=si("Array",R.SymbolKind.Class,"Array"),Cr=si("Object",R.SymbolKind.Class),Ek=si("unset",R.SymbolKind.Null),Mr=si("VarRef",R.SymbolKind.Class,"Any"),Hu={...Sr},zu={...Sr},sc={...Sr},Lo={def:!0,detail:ti.this(),is_param:!0,kind:R.SymbolKind.Variable,name:"this",range:bn,selectionRange:bn},cs={...Lo,name:"super",detail:ti.super()},hn=new RegExp("^[^\0-/:-@[-^`{-\x7F]+$"),as=new RegExp("^;;\\s*(?<tag>.+)"),Jm={$DIRPATH:zu,$DLLFUNC:Hu,$FILEPATH:sc,ANY:cn,ARRAY:tc,FLOAT:ic,INTEGER:oc,NUMBER:Lr,OBJECT:Cr,STRING:Sr,UNSET:Ek,VARREF:Mr},nc=class{message;token;constructor(t,n){this.message=t,this.token=n}},Un=class e{actionWhenV1Detected="Continue";actived=!1;beautify;checkmember;children=[];d=0;d_uri="";declaration={};diagnostics=[];last_diags=0;dlldir=new Map;dllpaths=[];document;find_token;foldingranges=[];fsPath="";get_token;need_scriptdir=!1;include={};includedir=new Map;isparsed=!1;is_virtual=!1;labels={};libdirs=[];linepos={};maybev1;object={method:{},property:{}};parseScript;scriptdir="";scriptpath="";STB=new R.SemanticTokensBuilder;symbolInformation;texts={};typedef={};tokenranges=[];tokens={};uri="";workspaceFolder="";hotstringExecuteAction=!1;constructor(t,n,i=0){let r,s,a,c,p,f,l,b,v,d,w,D,$,C,g,y,u,B,h=this,le=pn.parse(t.uri),ge=!0,Ne=!0,Re=!1,W=Si,U=!1,Ke=0,ye=!1,ct=!1,De,S,Et,Lt,Pe,rn,yn,en,Fe,ut,Rt,Bt,rt,on,Je,Sn,Q={TK_START_EXPR:Ts,TK_END_EXPR:ws,TK_START_BLOCK:Rs,TK_END_BLOCK:Rc,TK_WORD:G,TK_RESERVED:G,TK_STRING:k,TK_EQUALS:M,TK_OPERATOR:x,TK_COMMA:I,TK_BLOCK_COMMENT:_,TK_INLINE_COMMENT:X,TK_COMMENT:_e,TK_DOT:kt,TK_HOT:Qt,TK_SHARP:Qt,TK_NUMBER:fn,TK_LABEL:er,TK_HOTLINE:Qt,TK_UNKNOWN:tr};this.document=t,t.uri&&(ge=!1,this.uri=t.uri.toLowerCase(),this.setWorkspaceFolder(),this.scriptpath=(this.fsPath=le.fsPath).replace(/[\\/][^\\/]+$/,""),this.initLibDirs(n),le.scheme!=="file"&&le.fsPath.substring(1,3)===":\\"&&(this.is_virtual=!0)),this.get_token=function(T,A=!1){let N,L,K;for(T!==void 0&&(N=u,K=g,u=T);(L=jt()).type.endsWith("COMMENT")&&A;);return T!==void 0&&(u=N,g=K),L},this.find_token=function(T,A=!1){let N=T,L=d.charAt(T),K,oe=h.tokens,o={...oe[-1]??pt,type:""};if(!L)return o;if(Vn.includes(L)){for(;Vn.includes((L=d.charAt(++N))||"\0"););if(K=oe[N])return K;if(!L&&(K=oe[h.tokenranges[h.tokenranges.length-1]?.start])){if(K.offset<=T&&T<K.offset+K.length)return K;K=void 0}}else{if(Nn(L.charCodeAt(0)))for(;Nn(d.charCodeAt(--N)););else for(;!Vn.includes(L=d.charAt(--N))&&!Nn(L.charCodeAt(0)););if(!(K=oe[++N]??oe[N-1])&&d.charAt(N)==="."){for(;Nn(d.charCodeAt(--N)););K=oe[N+1]}}if(!K&&d.slice(N=d.lastIndexOf(`
`,N)+1,T).trim()&&(K=h.find_token(N)),K){if(K.offset<=T&&T<K.offset+K.length)return K;for(;(K=oe[K.next_token_offset])&&!(K.offset>T);)if(T<K.offset+K.length)return K}return!A&&h.findStrOrComment(T)||o},this.beautify=function(T,A){let N;for(!h.isparsed&&h.parseScript(),Pe=Dk(T),rt=on="",r=!0,g={...pt},C=-1,N=w,Fe=h.get_token(0),rn=d.substring(d.lastIndexOf(`
`,u=Fe.offset)+1,u),Sn=Je=!1,Re=!0,yn=Pe.indent_string??"	",en=Pe.space_in_other??!0,De=[Ye()],Lt=[],S=void 0,_t(nt.BlockStatement),Pe.symbol_with_same_case&&Di({textDocument:h.document}),A&&(N=h.document.offsetAt(A.end),Fe=h.find_token(h.document.offsetAt(A.start)),A.start=h.document.positionAt(u=Fe.offset),rn=d.substring(d.lastIndexOf(`
`,u)+1,u).match(/^[ \t]*/)[0]);;){if(Bt=(Fe=jt()).type,Rt=(ut=Fe.content).toLowerCase(),Fe.fat_arrow_end)for(;S.in_fat_arrow;)Ze();if(Fe.offset>=N){if(A){let oe=Fe.previous_token,o=u;if(rt==="TK_RESERVED"&&["try","else","finally"].includes(on)&&yt(),(!S.declaration_statement||!O())&&ae(),oe?.type){for(;(Fe=h.find_token(oe.skip_pos??oe.offset+oe.length)).offset<N;)oe=Fe;for(o=oe.offset+oe.length;" 	".includes(d.charAt(o)||"\0");o++);for(Vn.includes(d.charAt(o))||(o=oe.offset+oe.length);O();)De.pop()}A.end=h.document.positionAt(o)}for(;S.mode===nt.Statement;)Ze();break}else if(Sn&&!(Sn=y?!K(Fe):Bt!=="TK_START_BLOCK"||Fe.data))Ze(),rt="TK_END_EXPR",S.last_text=")",D=y>0;else if(D=y>0){if(c!==!1){ae();for(let oe=1;oe<y;oe++)De.push(Ye())}else if(!Sn&&!S.in_expression&&(Fe.type.endsWith("COMMENT")||!xn(S.mode===nt.Statement?Fe.previous_token??pt:{},Fe))&&!(rt==="TK_RESERVED"&&["catch","else","finally","until"].includes(on))){Pe.max_preserve_newlines&&y>Pe.max_preserve_newlines&&(y=Pe.max_preserve_newlines),O()||De.push(Ye());for(let oe=1;oe<y;oe++)De.push(Ye())}}Q[Bt](),Bt.endsWith("COMMENT")||(!Sn&&Bt==="TK_RESERVED"&&["if","for","while","loop","catch","switch"].includes(Rt)&&(Sn=!0,_t(nt.Conditional),Rt!=="switch"&&yt()),S.last_text=Rt,S.had_comment=0,rt=Bt,on=Rt)}let L=De.map(oe=>oe.text.join("")).join(`
`);return De=[],Re=!1,L;function K(oe){if(![nt.Conditional,nt.Statement].includes(S.mode)||S.parent.mode===nt.ObjectLiteral)return!1;switch(oe.type){case"TK_DOT":case"TK_COMMA":case"TK_EQUALS":case"TK_COMMENT":case"TK_INLINE_COMMENT":case"TK_BLOCK_COMMENT":return!1;case"TK_OPERATOR":return/^(!|~|not|%|\+\+|--)$/i.test(oe.content)&&!xn(oe.previous_token??pt,oe);case"TK_STRING":return!oe.ignore&&!xn(oe.previous_token??pt,oe);default:{let o=oe.previous_token??pt;switch(o.type){case"TK_COMMA":case"TK_EQUALS":return!1;case"TK_OPERATOR":return/^(\+\+|--|%)$/.test(o.content)}}}return!0}};function ve(T,A){Pe=t_({max_preserve_newlines:1}),en=!0,yn="	",Re=!0,rn="",delete A.format;for(let N of A){if(!N.range_offset)continue;let[L,K]=N.range_offset;for(rt=on="",De=[Ye()],Je=!1,Lt=[],S=void 0,_t(nt.Expression),Fe=T[T[L].next_token_offset];Fe&&Fe.offset<K;Fe=T[Fe.next_token_offset])Bt=Fe.type,ut=Fe.content,Rt=ut.toLowerCase(),Q[Bt](),rt=Bt,S.last_text=on=Rt;N.defaultVal=De.map(oe=>oe.text.join("")).join(`
`).trim()}Re=!1,De=[]}if(i||/\.d\.(ahk2?|ah2)$/i.test(this.fsPath))this.d=i||1,ge||=!0,this.parseScript=function(){let T=[],A=[],N=this.uri,L="",K=0,oe=0,o=0,m=0,Ft=!1,V=be(0,0),ue=R.DocumentSymbol.create("",void 0,R.SymbolKind.Namespace,V,V,this.children),ne=[],ee,E,We;for(this.clear(),f={region:[],bracket:[]},a={},B=[],d=this.document.getText(),w=d.length,b=this.scriptpath,g={...pt},r=!0,u=0,C=-1,p=$=void 0,v=this.include,ue.property=ue.$property=this.declaration;jt().length;);for(ne=Object.values(this.tokens),o=ne.length;K<o;)switch((ee=ne[K]).type){case"TK_WORD":if(!ee.topofline&&!Ft){K++;break}if(oe=K+1,oe<o){if(m&&((E=ne[oe]).topofline||["=>","?",":","[","{"].includes(E.content))){let Me=Jt.create(ee.content,R.SymbolKind.Property,V=be(ee.offset,ee.length)),Ee=Me,ce={type:5,modifier:4|Ft},ke=E.content==="=>";ee.symbol=ee.definition=Me,Ee.parent=ue,Ee.has_this_param=!0;let Ge=[];if(Vu.includes(L=Me.name.toUpperCase())||(ee.semantic=ce),ue.children?.push(Me),Me.static=Ft,Me.full=`(${A.join(".")}) ${Ft?"static ":""}`+Me.name,(Ft?ue.property:ue.$property)[L]??=Me,(We=a[Me.selectionRange.start.line])&&je(We.symbol=Me,We),(this.object.property[L]??=[]).push(Me),E.content==="["){if(Ge=Xe("]"),Ge.length){Ee.children=Ee.params=Ge,Ee.full+=`[${Ge.full}]`,Ee.param_offsets=Ge.offset,Ee.param_def_len=Ge.full.length+2,Ee.declaration=Ee.local={};for(let Te of Ge)Ee.local[L=Te.name.toUpperCase()]??=Te}if(!(E=ne[++oe]))break}if(E.content==="{"){let Te=Me;for(;(ee=ne[++oe]).content!=="}";)if(ee.content==="=>"){let ft=Ln.create(E.content,R.SymbolKind.Function,V=be(E.offset,E.length),{...V},Ge);L=E.content.toLowerCase(),ft.parent=Me,E.symbol=E.definition=ft,gt(ft),(L==="get"||L==="set")&&(ft.has_this_param=!0,Te[L]=ft)}else E=ee;Me.type_annotations=Te.get?.type_annotations,ke=!!(Te.get&&!Te.set),Me.range.end=this.document.positionAt(ee.offset+ee.length)}else if(E.content==="=>"){let Te=Ln.create("get",R.SymbolKind.Function,V=be(E.offset,E.length),{...V},Ge);Te.parent=Me,Me.get=Te,ke=!0,Te.has_this_param=!0,gt(Te),Me.type_annotations=Te.type_annotations,Me.range.end=Te.range.end}else E.content==="?"&&(E.ignore=!0,E=ne[++oe],Me.defaultVal=null),E?.content===":"?gt(Me):(E=ne[--oe],Me.range.end=this.document.positionAt(E.offset+E.length));ke&&(ce.modifier|=2)}else if((E=ne[oe]).content==="("){let Me=Xe(),Ee=Kt(ee.content,Me,be(ee.offset,ee.length),Ft);ne[oe+1]?.content==="=>"?(++oe,gt(Ee)):Ee.range.end=this.document.positionAt(E.offset+E.length),Ee.full+=` => ${sr(Ee.type_annotations)||"void"}`,ee.symbol=ee.definition=Ee,Vu.includes(L=Ee.name.toUpperCase())||(ee.semantic={type:m?2:1,modifier:6|Ft}),m&&(Ee.has_this_param=!0,Ee.kind=R.SymbolKind.Method,Ee.full=`(${A.join(".")}) ${Ee.full}`,Ee.parent=ue,(this.object.method[L]??=[]).push(Ee)),(We=a[Ee.selectionRange.start.line])&&je(We.symbol=Ee,We),ue.children?.push(Ee);let ce=Ft?ue.property:ue.$property;ce[L]?ce[L].call=Ee:ce[L]=Ee}else if(!m&&(["=>",":",","].includes(E.content)||E.topofline)){let Me=Jt.create(ee.content,R.SymbolKind.Variable,V=be(ee.offset,ee.length));ee.symbol=ee.definition=Me,Me.assigned=Me.def=!0,ee.semantic={type:4,modifier:4|(E.content==="=>"?2:0)},(We=a[Me.selectionRange.start.line])&&je(We.symbol=Me,We),["=>",":"].includes(E.content)?gt(Me):E.content!==","&&--oe,ue.children.push(Me),ue.property[Me.name.toUpperCase()]??=Me}}K=oe+1,Ft=!1;break;case"TK_RESERVED":if(Ft=!1,ee.topofline!==1)ee.type="TK_WORD";else if((L=ee.content.toLowerCase())==="static")Ft=!0,K++;else if(K<o-4&&L==="class"){let Me="",Ee=R.DocumentSymbol.create((ee=ne[++K]).content,void 0,R.SymbolKind.Class,be(ne[K-1].offset,0),be(ee.offset,ee.length),[]);if(oe=K+1,A.push(Ee.name),ee.semantic={type:0,modifier:6},ee.symbol=ee.definition=Ee,Ee.extends="",Ee.uri??=this.uri,(E=ne[oe])?.content==="<"&&!E.topofline){let ce={},ke=0;for(;(E=ne[++oe])?.type==="TK_WORD";){let Ge=be(E.offset,E.length),Te={name:E.content,data:ke,kind:R.SymbolKind.TypeParameter,range:Ge,selectionRange:Ge};if(ke++,ce[E.content.toUpperCase()]??=Te,(E=ne[++oe])?.content==="="&&(gt(Te),E=ne[++oe]),E?.content!==",")break}E?.content===">"?(Ee.type_params=ce,E=ne[++oe]):vt(">")}if(E?.content.toLowerCase()==="extends"){for((E=ne[oe+1])?.type==="TK_WORD"&&this.children.push(Jt.create(E.content,R.SymbolKind.Variable,be(E.offset,E.length)));++oe<o&&(E=ne[oe]).content!=="{";)Me+=E.content;Ee.extends=Me}(We=a[Ee.selectionRange.start.line])&&je(We.symbol=Ee,We),Ee.full=A.join("."),Ee.property={},Ee.prototype={...Ee,detail:void 0,property:Ee.$property={}},(!m&&Ee.name.startsWith("$")?h.typedef:ue.property)[Ee.name.toUpperCase()]??=Ee,ue.children.push(Ee),m++,T.push(ue),ue=Ee,Ee.type_annotations=[Ee.full],K=oe+1}else L==="global"&&ne[K+1].type==="TK_WORD"?K++:ee.type="TK_WORD";break;case"TK_END_BLOCK":m&&(ue.range.end=ue.prototype.range.end=this.document.positionAt(ee.offset+ee.length),ue.property.PROTOTYPE={...ue.prototype,children:void 0,name:"Prototype",kind:R.SymbolKind.Property,full:`(${ue.full}) Prototype`,selectionRange:bn,type_annotations:[ue.full]},ue.uri=N,(ue=ue.prototype).uri=N,this.addFoldingRangePos(ue.range.start,ue.range.end),Object.values(ue.property).forEach(Me=>Me.parent=ue),m--,A.pop(),ue=T.pop());default:K++,Ft=!1;break}if(this.d<0)return;if(this.d&2){let Me=N.endsWith("/ahk2_h.d.ahk")?1:0,Ee;for(let[ke,Ge]of Object.entries(this.declaration)){let Te=Ge;switch(Te.kind){case R.SymbolKind.Function:Te.def=!1,Te.uri=N;case R.SymbolKind.Class:Te.overwrite??=Me,Te.def??=!0,(!(Ee=Zt[ke])||Me>=(Ee.overwrite??0))&&(Zt[ke]=Te);break;case R.SymbolKind.Variable:Te.def&&(Zt[ke]=Te),Te.uri=N;break}}let ce;Me&&(or>xr?["STRUCT","SIZEOF","OBJDUMP","OBJLOAD","A_ZIPCOMPRESSIONLEVEL"].forEach(ke=>delete Zt[ke]):(ce=this.declaration.STRUCT)?.kind===R.SymbolKind.Class&&(ce.def=!1))}ze(),Mo({},this.children,this.diagnostics),this.isparsed=!0,f.region.forEach(Me=>this.addFoldingRange(Me,u-1,"region"));function gt(Me){let Ee=ce();if((E=ne[--oe])||(E=ne[oe=ne.length-1]),Ee.length){let ke=new Set(Ee);ke.delete("void"),Me.type_annotations=Array.from(ke)}return Me.range.end=h.document.positionAt(E.offset+E.length),oe;function ce(){let ke,Ge,Te,ft,dt=[];e:for(;E=ne[++oe];){switch(E.type){case"TK_WORD":for(Te=E.content,ft="TK_WORD",(Ge=Te==="typeof")&&ne[oe+1]?.type===ft&&!ne[oe+1].topofline&&(E.semantic={type:9},E=ne[++oe],Te=E.content),(Te.toLowerCase()!=="this"||Me.kind===R.SymbolKind.Function&&Me.parent?.kind!==R.SymbolKind.Property)&&(E.semantic={type:0});(E=ne[++oe])&&!E.topofline&&E.type!==ft&&(/^[.#~]$/.test(E.content)||E.type==="TK_WORD"&&(E.semantic={type:0}));)Te+=E.content,ft=E.type;if(E?.content==="<"&&!E.topofline){let Tt=[];for(;;){if(Tt.push(ce()),!E||E.content===">"){let Ct={name:Te,kind:Te.toLowerCase()==="comobject"?R.SymbolKind.Interface:R.SymbolKind.Class,extends:Te,full:`${Te}<${Tt.map(gn=>sr(gn)).join(", ")}>`,range:bn,selectionRange:bn};Ct.generic_types=Tt,Ge?Ct.prototype={...Ct}:Ct.data=Jm[Te.toUpperCase()],dt.push(Ct),E=ne[++oe];break}if(E.content!==","){vt(">"),E=ne[++oe];break}}}else Te&&dt.push(Ge?`typeof ${Te}`:Jm[Te.toUpperCase()]??Te);break;case"TK_NUMBER":case"TK_STRING":dt.push(E.content),E=ne[++oe];break;case"TK_START_BLOCK":{let Tt="",Ct={},gn=E,Jr=["TK_NUMBER","TK_RESERVED","TK_WORD"];for(;Jr.includes((E=zt())?.type);){let $t=Jt.create(E.content,R.SymbolKind.Property,be(E.offset,E.length));if(Ct[E.content.toUpperCase()]??=$t,E.semantic={type:5},Tt+=", "+E.content,We&&We===a[$t.selectionRange.start.line]&&je($t,We),(E=ne[++oe])?.content==="?"&&(E.ignore=!0,E=ne[++oe],$t.defaultVal=null,Tt+="?"),E?.content===":"&&(gt($t),E=ne[++oe],Tt+=`: ${sr($t.type_annotations)||"unknown"}`),E?.content!==",")break;We=void 0}if(E?.content==="}"){let $t=R.DocumentSymbol.create("",void 0,R.SymbolKind.Class,bn,bn);$t.property=Ct,$t.name=$t.extends="",$t.uri=h.uri,dt.push(gn.data=E.data=$t),$t.full=(Tt=Tt.substring(2))&&`{ ${Tt} }`}else vt("}"),gn.data=Cr,E?.content==="}"&&(E.data=Cr);E=ne[++oe];break}case"TK_COMMENT":case"TK_BLOCK_COMMENT":We=E;case"TK_INLINE_COMMENT":continue;default:if(E.content==="(")if(",:=?&*)[".includes((ke=ne[oe+2])?.content??"\0")||ke?.content==="=>"){let Tt=E.offset,Ct=Xe(),gn=Kt("",Ct,be(Tt,0));if(oe>=o)break e;ne[oe+1]?.content==="=>"?(++oe,gt(gn)):gn.range.end=h.document.positionAt(E.offset+E.length),gn.full+=` => ${sr(gn.type_annotations)||"void"}`,dt.push(gn),gn.uri=h.uri,We&&We===a[gn.selectionRange.start.line]&&je(We.symbol=gn,We)}else dt.push(...ce()),E?.content===")"&&(E=ne[++oe]);else if(E.content==="-"&&(E=ne[++oe])?.type==="TK_NUMBER")dt.push(`-${E.content}`),E=ne[++oe];else{E.content.toLowerCase()==="throw"&&E.previous_token?.content==="=>"&&(E=ne[++oe]);break e}break}if(E?.content!=="|")break;We=void 0}return dt}}function Xe(Me=")"){let Ee=[],ce=Ee.offset??=[],ke,Ge,Te=!0,ft=0,dt="",Tt=0;e:for(;(E=ne[++oe])&&E.content!==Me;)switch(E.type){case"TK_STRING":if(Te!==!0){vt(Me);break}ke=Jt.create(E.content,R.SymbolKind.String,be(E.offset,E.length)),ce.push(dt.length),dt+=E.content,Ee.push(ke),Te=!1,(E=ne[++oe])?.content==="["?(ft++,E.ignore=!0,dt+=" ["):oe--;break;case"TK_WORD":if(!Te){vt(Me);break e}if(ke=Jt.create(E.content,R.SymbolKind.Variable,be(E.offset,E.length)),Te===1&&(Ee.hasref=ke.pass_by_ref=!0,dt+="&",Te=!0),ke.assigned=ke.def=ke.is_param=!0,Ee.push(ke),E.semantic={type:3,modifier:4},ce.push(dt.length),dt+=E.content,E=ne[++oe],ft&&(ke.defaultVal=!1),E?.content==="*"?(Ee.variadic=ke.arr=!0,E=ne[++oe],dt+="*"):E?.content==="?"&&(ke.defaultVal=null,E.ignore=!0,E=ne[++oe],dt+="?"),E?.content===":"&&(E=ne[oe=gt(ke)+1],dt+=`: ${sr(ke.type_annotations)||"unknown"}`),!E||E.content===":="&&(!(E=ne[++oe])||E.content===Me||(ke.defaultVal=E.content,"-+".includes(E.content)&&ne[oe+1]?.type==="TK_NUMBER"&&(ke.defaultVal+=ne[++oe].content),dt+=` := ${ke.defaultVal}`,!(E=ne[++oe]))))break e;E.content==="["?(ft++,E.ignore=!0,E=ne[++oe],dt+=" ["):ft&&E.content==="]"&&(ft--,E.ignore=!0,E=ne[++oe],dt+="]"),E?.content===","?dt+=", ":(oe--,Te=!1);break;default:if(E.content===","){if(Te){vt(Me);break e}dt+=", ",Te=!0}else if(E.content==="*"){if(!Te){vt(Me);break e}ke=Jt.create("",R.SymbolKind.Variable,be(E.offset,0)),Ee.variadic=ke.arr=ke.assigned=ke.def=ke.is_param=!0,ft&&(ke.defaultVal=!1),Te=!1,Ge??=(Tt=dt.length,ke),dt+="*"}else if(E.content==="[")ft++,E.ignore=!0,dt+="[";else if(ft&&E.content==="]")ft--,E.ignore=!0,dt=dt.trimEnd()+"] ";else if(Te===!0&&E.content==="&")Te=1,E.op_type=-1;else{vt(Me);break e}break}return Ee.full=dt,Ge&&(Ee.push(Ge),ce.push(Tt)),Ee}function Kt(Me,Ee,ce,ke=!1){let Ge={assume:0,children:[],declaration:{},full:`${ke?"static ":""}${Me}(${Ee.full})`,global:{},local:{},hasref:Ee.hasref,kind:R.SymbolKind.Function,labels:{},name:Me,param_def_len:Ee.full.length+2,param_offsets:Ee.offset,params:Ee,range:ce,selectionRange:{...ce},static:ke,variadic:Ee.variadic};Ge.local=Ge.declaration;for(let Te of Ee)Ge.local[Te.name.toUpperCase()]=Te;return delete Ge.local[""],Ge}function zt(){for(;(E=ne[++oe])?.type.endsWith("COMMENT")&&(We=E););return E}function vt(Me){let Ee=1,ce={">":"<",")":"(","]":"[","}":"{"}[Me];for(E??=ne.at(-1),h.addDiagnostic(F.unexpected(E.content),E.offset,E.length);(E=ne[++oe])&&(E.content!==Me||--Ee);){if(E.topofline>0)return oe--;E.content===ce&&++Ee}}};else{let T=this.fsPath.replace(/\.\w+$/,".d.ahk");this.fsPath.endsWith("2")||delete this.actionWhenV1Detected,this.parseScript=function(){d=this.document.getText(),w=d.length,b=this.scriptpath,l="",r=!0,ye=!1,Ke=0,g={...pt},p=$=void 0,u=0,C=-1,f={region:[],bracket:[]},c=!1,W=Si,this.clear(),v=this.include,a={},B=[],s=at("v2.warn.callWithoutParentheses");try{let A=Ir.get_RCDATA("#2");A&&(v[A.uri]=A.path),this.children.push(...bt())}catch(A){U=ye=ct=!1,A instanceof nc?A.message&&this.addDiagnostic(A.message,A.token.offset,A.token.length,R.DiagnosticSeverity.Warning):console.error(A)}{let A=h.d_uri&&ot(Vt(h.d_uri))||ot(T);A?v[h.d_uri=A.uri]=A.path:h.d_uri=""}ze(),Mo(this.declaration,this.children,this.diagnostics),this.isparsed=!0,f.region.forEach(A=>this.addFoldingRange(A,u-1,"region")),this.actived&&(this.actionWhenV1Detected??="Continue")}}function ze(){for(let T of Object.values(a))T.data!==null||!/^[ \t]*\*?[ \t]*@typedef\s/m.test(T.content)||xt(h,T.content,{})}function Ae(T,A=!1,N=F.maybev1()){if(ye)return!1;switch(h.maybev1??=Ke=1,h.actionWhenV1Detected??=at("v2.general.actionWhenV1Detected")){case"SkipLine":{if(!A)return!0;h.addDiagnostic(F.skipline(),T.offset,T.length,R.DiagnosticSeverity.Warning);let L,K,oe="TK_UNKNOWN";if(T.type==="TK_WORD"||T.content==="="&&(oe="TK_STRING")){g=T,u=T.offset+T.length;do{if(K=d.indexOf(`
`,u),K<0&&(K=w),L=d.substring(u,K).trimStart()){let o=K-L.length;g=tt(L=L.trimEnd(),oe,o,L.length,0)}for((T=h.find_token(u=K,!0)).content==="("&&(delete h.tokens[T.offset],g={...pt}),ct=!0,T=Ot();T.ignore&&T.type==="TK_STRING";)K=d.indexOf(`
`,u),K<0&&(K=w),(L=d.substring(u,K).trimEnd())&&(T.content+=L,T.length+=L.length),u=K,T=Ot();ct=!1}while(xn({},T));u=T.offset}return!0}case"SwitchToV1":if(!h.actived)break;Zn?.console.info([h.document.uri,N,F.tryswitchtov1()].join(" ")),N="",Bu(h.document.uri);break;case"Continue":return!1;case"Warn":{if(!h.actived)break;Zn?.window.showWarningMessage(`file: '${h.fsPath}', ${N}`,{title:Za.switchtov1(),action:"SwitchToV1"},{title:Za.skipline(),action:"SkipLine"},{title:Za.stopparsing(),action:"Stop"}).then(L=>{(h.actionWhenV1Detected=L?.action??"Continue")!=="Stop"&&(h.actionWhenV1Detected==="SwitchToV1"?Bu(h.document.uri):h.update())});break}}throw h.clear(),u=w,new nc(N,T)}function bt(T=0,A=h,N=""){let L=[],K=h.document,oe=h.tokens,o=h.tokens[u-1]??pt,m=o.previous_token??pt,Ft=0,V=!0,ue="",ne,ee,E,We,gt,Xe=p,Kt=U,zt=[],vt=[];return Ne=!0,T!==0&&(zt.push(u-1),delete o.data),p=A,U=!1,ce(),p=Xe,U=Kt,o.type==="TK_EOF"&&Ft>(T===0?0:-1)?h.addDiagnostic(F.missing("}"),zt[Ft-(T===0?1:0)],1):gt!==void 0&&h.addFoldingRange(gt,m.offset,"region"),L;function Me(){if(d.charAt(o.offset+o.length)!=="(")return!1;let H=m,fe=o,te=g,q=u,ie=o.topofline>0,Ce=0,j="",z="";for(Ne=!1;Ve();)if((z=o.content)==="(")Ce++;else if(z===")"&&!--Ce){Ve(),j=o.content;break}return m=H,o=fe,g=te,u=q,V=!0,j==="=>"||ie&&j==="{"}function Ee(H){let fe=H.op_type??=te(H);return(fe>=0&&(H.topofline===1||!oi(H.previous_token))||fe<=0&&!q(h.get_token(H.offset+H.length,!0)))&&h.addDiagnostic(F.missingoperand(),H.offset,H.length),H.op_type;function te(ie){switch(ie.content.toLowerCase()){case"!":case"~":case"not":return-1;case"%":return ie.previous_pair_pos===void 0?-1:1;case"&":case"+":case"-":return ie.topofline<1&&oi(ie.previous_token??pt)?0:-1;case"++":case"--":return oi(ie)?1:-1;case":":return 0;case"?":return ie.ignore?1:0;case"*":if(",([".includes(ie.previous_token?.content??"\0")&&",),]()[]".includes(ie.previous_token.content+(h.get_token(ie.offset+1,!0).content||"\0")))return-1;default:return 0}}function q(ie){switch(ie?.type){case"TK_START_BLOCK":case"TK_START_EXPR":case"TK_NUMBER":case"TK_STRING":return!0;case"TK_WORD":return!(ie.topofline===1&&hn.test(H.content)&&A.ranges);case"TK_RESERVED":return/^(class|isset|throw|super)$/.test(ie.content.toLowerCase());case"TK_OPERATOR":return(ie.op_type??=te(ie))===-1;case"TK_END_EXPR":case"TK_EOF":if(H.op_type<1&&H.content==="*")return H.op_type=1;default:return!1}}}function ce(H=0){for(o.type==="TK_START_BLOCK"&&(delete o.data,Ve(),V=!1,!o.topofline&&!m.topofline&&h.addDiagnostic(F.unexpected(o.content),o.offset,o.length));Ne=!0,Ve();){let fe;if(o.topofline===1){let te;ee=o.offset,T===2?o.type!=="TK_RESERVED"&&hn.test(o.content)&&(o.type="TK_WORD",delete o.semantic):(te=tn(":"))&&(vt.length&&o.content.toLowerCase()==="default"&&h.get_token(te).content===":"||te===u&&Vn.includes(d.charAt(u+1))&&hn.test(o.content)&&(!vt.length||o.content.toLowerCase()!=="case"))&&((fe=oe[te])&&((o.next_token_offset=fe.next_token_offset)>0&&(oe[fe.next_token_offset].previous_token=o),delete oe[te]),o.content+=":",o.length=(u=te+1)-o.offset,o.type="TK_LABEL",delete o.semantic,ee=void 0)}switch(o.type){case"TK_EOF":return;case"TK_WORD":if(o.topofline>0&&!o.ignore){let te=Me();if(Ve(),!te&&W&&T!==2&&m.topofline===1&&!o.topofline&&o.type==="TK_WORD"&&m.content.toLowerCase()==="macro"&&(o.topofline=1,(te=Me())?Ve():o.topofline=0),te){let q,ie,Ce=m,j=L.length,z=Ce.topofline===2,J=m.semantic={type:T===2?2:1},me=z?Ce.previous_token?.offset:Ce.offset,Ue=Kr(!0);if(ee=void 0,/^\d/.test(ie=Ce.content.toUpperCase())&&h.addDiagnostic(F.invalidsymbolname(Ce.content),Ce.offset,Ce.length),Ue||(Ue=[],h.addDiagnostic(F.invalidparam(),Ce.offset,o.offset+1-Ce.offset)),Ce.symbol=Ce.definition=q=Ln.create(Ce.content,T===2?R.SymbolKind.Method:R.SymbolKind.Function,R.Range.create(Ce.pos=K.positionAt(Ce.offset),{line:0,character:0}),be(Ce.offset,Ce.length),Ue,void 0,z),T!==0&&(q.parent=A),Ve()&&o.content==="=>"){let we=L.splice(j),Z=T,he=A;T=T===2?3:1,A=q,q.returns=[u,0];let de=Ct(void 0,"return",1);L.push(q),A=he,T=Z,o.fat_arrow_end=!0,q.range.end=K.positionAt(q.returns[1]=m.offset+m.length),h.addFoldingRangePos(q.range.start,q.range.end,"line"),q.children=we,we.push(...de),h.linepos[q.range.end.line]=me}else if(o.content==="{"){let we=L.splice(j),Z=o.offset;o.previous_pair_pos=me,L.push(q),q.children=we,we.push(...bt(T===2?3:1,q,N)),q.range.end=K.positionAt(u),h.addSymbolFolding(q,Z)}else{h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);break}J.modifier=6|z,(ne=a[q.selectionRange.start.line])&&je(ne.symbol=q,ne),T===2&&(q.has_this_param=!0,!q.static&&(q.parent=A.prototype),q.full=`(${N.slice(0,-1)}) `+q.full,(h.object.method[ie]??=[]).push(q)),qn(q);break}if(T===2){if(d.charAt(m.offset+m.length)==="["||o.content.match(/^(=>|\{)$/)){let j=m,z=L.length,J=[],me;if(ee=void 0,o.content==="["&&(J=Kr(!0,"]")??[],Ve(),J.length===0&&h.addDiagnostic(F.propemptyparams(),j.offset,m.offset-j.offset+1),!o.content.match(/^(=>|\{)$/))){h.addDiagnostic(F.propdeclaraerr(),j.offset,j.length),V=!1;break}let Ue=j.topofline===2,we=Ue?j.previous_token?.offset:j.offset,Z=j.symbol=R.DocumentSymbol.create(j.content,void 0,R.SymbolKind.Property,me=be(j.offset,j.length),{...me});(ne=a[Z.selectionRange.start.line])&&je(ne.symbol=Z,ne),Z.parent=Ue?A:A.prototype,Z.has_this_param=!0,Z.static=Ue,Z.children=L.splice(z);let he="";if(J.length){let de=Ln.create("",R.SymbolKind.Function,me,me,J);he=`[${de.full.slice(1,-1)}]`,Z.local=de.local,Z.declaration=de.declaration,Z.param_offsets=de.param_offsets,Z.params=J,qn(Z)}if(L.push(Z),Fn(j,Z),Z.full=`(${N.slice(0,-1)}) ${Ue?"static ":""}${j.content}${he}`,j.semantic={type:5,modifier:4|Ue},o.content==="{"){let de,et,$e,Se,Ut=T,sn=o.offset;for(o.previous_pair_pos=we,Ve(),V=!1,T=1,o.type==="TK_END_BLOCK"&&!m.topofline&&!o.topofline&&h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);Ve()&&o.type!=="TK_END_BLOCK";)if(o.topofline&&/^[gs]et$/.test(Se=o.content.toLowerCase())){let St;if(Ve(),de=m,o.content==="=>")$e=Ln.create(Se,R.SymbolKind.Function,be(m.offset,u-m.offset),be(m.offset,m.length),[...J]),T=3,$e.returns=[u,0],$e.parent=Z,$e.children=Ct(void 0,"return",1),T=2,$e.range.end=K.positionAt($e.returns[1]=m.offset+m.length),Z.range.end=$e.range.end,Z.returns=$e.returns,o.fat_arrow_end=!0,h.addFoldingRangePos($e.range.start,$e.range.end,"line"),m.content==="=>"&&h.addDiagnostic(F.invaliddefinition("function"),de.offset,de.length),Se==="set"?($e.params.unshift(St=Jt.create("Value",R.SymbolKind.Variable,R.Range.create(0,0,0,0))),St.is_param=St.assigned=St.def=!0,St.detail=ti.value()):Z.returns=$e.returns,$e.has_this_param=!0,qn($e),h.linepos[$e.range.end.line]=de.offset;else if(o.content==="{")$e=Ln.create(Se,R.SymbolKind.Function,be(de.offset,u-de.offset),be(de.offset,3),[...J]),et=o,$e.parent=Z,$e.children=bt(3,$e,N),$e.range.end=K.positionAt(u),Se==="set"?($e.params.unshift(St=Jt.create("Value",R.SymbolKind.Variable,R.Range.create(0,0,0,0))),St.is_param=St.assigned=St.def=!0,St.detail=ti.value()):Z.returns=$e.returns,$e.has_this_param=!0,qn($e),h.addSymbolFolding($e,et.offset);else if($e=void 0,h.addDiagnostic(F.invalidprop(),o.offset,o.length),o.content==="}"){V=!1;break}else{let pr=0;for(;o.type!=="TK_EOF";){if(o.content==="{")pr++;else if(o.content==="}"&&--pr<0)break;Ve()}V=!1}$e&&$e!==(Z[$e.name]??=$e)&&h.addDiagnostic(F.dupdeclaration(),de.offset,de.length)}else{let St=0;for(h.addDiagnostic(F.invalidprop(),o.offset,o.length),V=!1;Ve();)if(o.content==="{")St++;else if(o.content==="}"&&--St<0)break;V=!1}Z.range.end=K.positionAt(u-1),T=Ut,h.addSymbolFolding(Z,sn),Z.get&&!Z.set&&(j.semantic.modifier|=2)}else if(o.content==="=>"){let de=u,et;T=3,et=Ln.create("get",R.SymbolKind.Function,me=be(de,u-de),bn,J),et.parent=Z,Z.get=et,Z.returns=et.returns=[u,0],et.children=Ct(void 0,"return",1),T=2,Z.range.end=et.range.end=K.positionAt(et.returns[1]=m.offset+m.length),h.addFoldingRangePos(et.range.start,et.range.end,"line"),et.has_this_param=!0,qn(et),o.fat_arrow_end=!0,h.linepos[Z.range.end.line]=we,j.semantic.modifier|=2}break}o=m,m=pt,V=!1,u=o.offset+o.length;let q=L.length,ie=A;A=A.$property.__INIT;let Ce=Jr("");A.children.push(...L.splice(q)),A=ie,L.push(...Ce),Ce.forEach(j=>j.parent=ie),ee!==void 0&&(h.linepos[(m.pos??=K.positionAt(m.offset)).line]=ee)}else Te(o),o=m,m=pt,u=o.offset+o.length,ft(),ee!==void 0&&(h.linepos[(m.pos??=K.positionAt(m.offset)).line]=ee);break}if(T===2){let te=L.length,q=A;A=A.$property.__INIT;let ie=Jr("");A.children.push(...L.splice(te)),A=q,L.push(...ie),ie.forEach(Ce=>Ce.parent=q)}else o.topofline?ft():(V=!1,L.push(...Ct())),ee!==void 0&&(h.linepos[(m.pos??=K.positionAt(m.offset)).line]=ee);break;case"TK_SHARP":gn();break;case"TK_RESERVED":ke();break;case"TK_START_BLOCK":T===2?h.addDiagnostic(F.unexpected(o.content),o.offset,o.length):(Ft++,zt.push(u-1));break;case"TK_END_BLOCK":if(--Ft>=0&&zt.length){let te=zt.pop();h.addFoldingRange(o.previous_pair_pos=te,u-1),oe[te].next_pair_pos=o.offset,o.topofline===1&&(C=o.offset,r=!0)}if(Ft<H)if(T===0&&H===0)h.addDiagnostic(F.unexpected("}"),o.offset,1),Ft=0,zt.length=0;else{zt.length&&o.previous_pair_pos===void 0&&(oe[o.previous_pair_pos=zt.at(-1)].next_pair_pos=o.offset);return}break;case"TK_END_EXPR":h.addDiagnostic(F.unexpected(o.content),o.offset,1),ee=void 0;break;case"TK_LABEL":{if(vt.length&&o.content.toLowerCase()==="default:"){let q=vt.pop();vt.push(o.offset),q&&h.addFoldingRange(q,m.offset,"case"),Ve(),V=!1,o.topofline||=-1;break}if(T===2){h.addDiagnostic(F.propdeclaraerr(),o.offset,o.length);break}o.symbol=E=Ya.create(o.content,R.SymbolKind.Field,be(o.offset,o.length),be(o.offset,o.length-1)),E.data=zt.at(-1),L.push(E);let te=A.labels;te&&(ue=o.content.toUpperCase().slice(0,-1),E.def=!0,te[ue]?te[ue][0].def?(h.addDiagnostic(F.duplabel(),o.offset,o.length-1),te[ue].splice(1,0,E)):te[ue].unshift(E):te[ue]=[E]),(ne=a[E.selectionRange.start.line])&&je(E,ne),(fe=h.get_token(u,!0)).topofline||h.addDiagnostic(F.unexpected(fe.content),fe.offset,fe.length);break}case"TK_HOTLINE":{if(o.symbol=E=Ya.create(o.content,R.SymbolKind.Event,be(o.offset,o.length),be(o.offset,o.length-2)),E.range.end=K.positionAt(u-1),L.push(E),(ne=a[E.selectionRange.start.line])&&je(E,ne),T!==0&&h.addDiagnostic(F.hotdeferr(),o.offset,o.length),o.ignore){for(;Ve()&&!(!o.ignore||o.type!=="TK_STRING"););E.range.end=K.positionAt(m.offset+m.length),V=!1;break}Zm(o.content)||h.addDiagnostic(F.invalidhotdef(),o.offset,o.length);break}case"TK_HOT":{T!==0?h.addDiagnostic(F.hotdeferr(),o.offset,o.length):!o.ignore&&!Zm(o.content)&&h.addDiagnostic(F.invalidhotdef(),o.offset,o.length);let te=o,q=Ya.create(o.content,R.SymbolKind.Event,be(o.offset,o.length),be(o.offset,o.length-2));(ne=a[q.selectionRange.start.line])&&je(q,ne),o.symbol=q,Ve();let ie;for(q.declaration={},L.push(q),q.global={},q.local={};o.type==="TK_SHARP";)gn(),Ve();if(o.content==="{")o.previous_pair_pos=te.offset,q.params=[ie=Jt.create("ThisHotkey",R.SymbolKind.Variable,be(0,0))],ie.detail=ti.thishotkey(),q.children=bt(1,q),q.range=be(te.offset,u-te.offset),h.addSymbolFolding(q,o.offset),qn(q);else if(o.topofline){if(qn(q),V=!1,o.type.startsWith("TK_HOT"))break;(o.type!=="TK_WORD"||!Me())&&(Ae(te),!Ke&&h.addDiagnostic(F.hotmissbrace(),te.offset,te.length)),V=!1}else{q.params=[ie=Jt.create("ThisHotkey",R.SymbolKind.Variable,be(0,0))],ie.detail=ti.thishotkey();let Ce=A,j=T,z=o.content.toLowerCase(),J=L.length;A=q,T=1,z==="return"?q.children=Ct(void 0,"return"):["global","local","static"].includes(z)?(ke(),q.children=L.splice(J)):(V=!1,Tt(null,te.offset),q.children=L.splice(J)),A=Ce,T=j,qn(q);let me=m.offset+m.length;for(;" 	".includes(d.charAt(me)||"\0");)me++;q.range=be(te.offset,me-te.offset),h.linepos[q.range.end.line]=te.offset}break}case"TK_UNKNOWN":h.addDiagnostic(F.unknowntoken(o.content),o.offset,o.length);break;default:o.topofline===1&&(m!==pt&&xn(m,o,A)?o.topofline=-1:m=pt),V=!1,T===2?(h.addDiagnostic(F.propdeclaraerr(),o.offset,o.length),Ct()):(L.push(...Ct()),ee!==void 0&&(h.linepos[(m.pos??=K.positionAt(m.offset)).line]=ee));break}}}function ke(){let H=o.content.toLowerCase(),fe=m,te=o.offset,q=u,ie;if(Ne=!1,T===2){if(ie=jt(),V=!1,u=q,o.type="TK_WORD",".[(".includes(d.charAt(o.offset+o.length))||ie.content.match(/^(:=|=>|\{)$/))return;if(ie.type!=="TK_EQUALS"&&(H==="class"||H==="static"))ie=void 0,V=!0,o.type="TK_RESERVED";else return}else if(d.charAt(o.offset-1)==="%"||d.charAt(o.offset+o.length)==="%"){o.type="TK_WORD",V=!1,o.semantic={type:4};return}switch(H){case"class":{if(o.topofline!==1){V=!1,o.type="TK_WORD";break}let j,z="";if(Ve(),!o.topofline&&o.type==="TK_RESERVED"&&(o.type="TK_WORD",T!==2&&h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length)),!o.topofline&&o.type==="TK_WORD"){if(T&1&&h.addDiagnostic(F.classinfuncerr(),o.offset,o.length),j=o,Ve(),o.content.toLowerCase()==="extends")if(o=jt(),o.type==="TK_WORD"){for(z=o.content,Dn(o,0,h.children);u<w&&d.charAt(u)==="."&&(jt(),o=jt(),o.type==="TK_WORD");)z+="."+o.content,Fn(o);o.type==="TK_WORD"&&Ve()}else h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);if(o.type!=="TK_START_BLOCK"){V=!1;break}o.previous_pair_pos=te,j.content.match(/^\d/)&&h.addDiagnostic(F.invalidsymbolname(j.content),j.offset,j.length);let J=R.DocumentSymbol.create(j.content,void 0,R.SymbolKind.Class,bn,be(j.offset,j.length));j.symbol=j.definition=J,J.full=N+j.content,J.extends=z,J.uri=h.uri,(ne=a[J.selectionRange.start.line])&&je(J,ne),J.prototype={...J,cache:[],detail:void 0,property:J.$property={}},J.children=[],J.cache=[],J.property={},J.type_annotations=[J.full];let me=Ln.create("__Init",R.SymbolKind.Method,be(0,0),be(0,0),[],[],!0);return(J.property.__INIT=me).ranges=[],me.parent=J,me.full=`(${J.full}) static __Init()`,me.has_this_param=!0,me=Ln.create("__Init",R.SymbolKind.Method,be(0,0),be(0,0),[],[]),(J.$property.__INIT=me).ranges=[],me.parent=J.prototype,me.full=`(${J.full}) __Init()`,me.has_this_param=!0,J.children=bt(2,J,N+j.content+"."),J.range=J.prototype.range=be(te,u-te),j.semantic={type:0,modifier:6},qn(J),h.addSymbolFolding(J,o.offset),L.push(J),!0}else V=!1,m.type="TK_WORD",u=m.offset+m.length,o=m,m=fe;break}case"global":case"static":case"local":if(Ve(),T===2&&!o.topofline&&hn.test(o.content)&&(o.type="TK_WORD"),o.topofline)T===2?h.addDiagnostic(F.propdeclaraerr(),m.offset,m.length):H==="local"||L.some(j=>j.kind===R.SymbolKind.Variable)?h.addDiagnostic(F.declarationerr(),m.offset,m.length):A.assume=H==="static"?1:2;else if(o.type==="TK_WORD"||o.type==="TK_RESERVED"){if(T===0){V=!1,H!=="global"&&h.addDiagnostic(F.declarationerr(),m.offset,m.length);break}else if(T===2&&H!=="static"){h.addDiagnostic(F.propdeclaraerr(),m.offset,m.length),V=!1;break}if("([".includes(d.charAt(u))||h.get_token(u,!0).content.match(/^(\{|=>)$/))o.topofline=2;else{let j=L.length,z=A;T===2&&(o.topofline=2,A=A.property.__INIT);let J=A;V=!1;let me=Jr(H==="global"?"":H);if(H==="global")me.forEach(Ue=>J.global[Ue.name.toUpperCase()]??=Ue);else if(T===2){J.children.push(...L.splice(j)),A=z;for(let Ue of me)Ue.static=!0,Ue.full=Ue.full.replace(") ",") static "),Ue.parent=z}else{let Ue=H==="static";me.forEach(we=>{J.local[we.name.toUpperCase()]??=we,we.static=Ue,we.decl=!0})}L.push(...me)}}else o.type==="TK_EQUALS"&&(u=m.offset+m.length,m.type="TK_WORD",o=m,m=fe,T!==2&&h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length));V=!1;break;case"loop":{if(T===2){ie=h.get_token(u),V=!1,o.type="TK_WORD",ie.content!==":="&&h.addDiagnostic(F.propdeclaraerr(),o.offset,o.length);break}Ve(),o.type==="TK_COMMA"&&(Ae(m),Ke&&Ve());let j=0,z=1,J="loop",me;if(o.type==="TK_EQUALS"){u=m.offset+m.length,m.type="TK_WORD",o=m,m=fe,V=!1,T!==2&&h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length);break}else if(T===2){h.addDiagnostic(F.propdeclaraerr(),m.offset,m.length);break}else fe=m,(V=" 	,".includes(d.charAt(u)||"\0")&&o.type==="TK_WORD"&&["parse","files","read","reg"].includes(me=o.content.toLowerCase()))&&(j=1,z=me==="parse"?3:2,o.type="TK_RESERVED",J+=" "+me,m.hover_word=o.hover_word=J,Ve(),o.type==="TK_COMMA"&&Ve()&&(o.topofline=0),V=!1);if((!o.topofline||o.type==="TK_COMMA")&&o.type!=="TK_START_BLOCK"?L.push(...Ct("{",J,j,z)):j&&h.addDiagnostic(F.acceptparams(J,`${j}~${z}`),fe.offset,fe.length),Tt(!1,te,!0))return;o.type==="TK_RESERVED"&&o.content.toLowerCase()==="until"&&(V=!0,ee=o.offset,L.push(...Ct(void 0,"until",1)));break}case"for":{let j=tn("("),z=[],J=[],me=0;for(j&&(ie=jt());Ve();)switch(o.type){case"TK_COMMA":me++;break;case"TK_RESERVED":if(o.content.toLowerCase()!=="class"||!(T&1)){h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length);break}else o.type="TK_WORD";case"TK_WORD":{let Ue=Dn(o,0);Ue&&(Ue.def=Ue.assigned=!0,Ue.for_index=me,Ue.returns=z,Ue.data=J);break}case"TK_OPERATOR":if(o.content.toLowerCase()==="in"){z.push(o.offset+2),L.push(...$t(void 0,void 0,"{")),z.push(m.offset+m.length),ie&&(o.content!==")"?h.addDiagnostic(F.missing(")"),ie.offset,ie.length):(V=!0,Ve())),J.push(o.offset),!Tt(!1,te,!0)&&o.type==="TK_RESERVED"&&o.content.toLowerCase()==="until"&&(V=!0,ee=o.offset,L.push(...Ct(void 0,"until",1))),J.push(o.offset,me+1);return}h.addDiagnostic(F.unknownoperatoruse(),o.offset,o.length),V=!1;return;default:V=!1;case"TK_END_EXPR":h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);return;case"TK_EQUALS":h.addDiagnostic(F.reservedworderr(m.content),m.offset,m.length);return}break}case"continue":case"break":case"goto":if(T===2){V=!1,o.type="TK_WORD",h.get_token(u,!0).content!==":="&&h.addDiagnostic(F.propdeclaraerr(),o.offset,o.length);break}if(Ve(),!U&&H!=="goto"&&h.addDiagnostic(F.outofloop(),m.offset),o.type==="TK_COMMA"&&(Ae(m),h.addDiagnostic(F.unexpected(","),o.offset,1)),o.topofline)V=!1,H==="goto"&&h.addDiagnostic(F.acceptparams(H,1),m.offset,m.length);else{if(hn.test(o.content))o.type==="TK_NUMBER"&&H!=="goto"?o.content.match(/[^\d]/)&&h.addDiagnostic(F.unexpected(o.content),o.offset,o.length):(o.ignore=!0,o.type="TK_WORD",Ce(o),delete o.semantic),Ve(),V=!1;else if(d.charAt(m.offset+m.length)==="("){let j=[];Pn("(",")",void 0,void 0,j),j.forEach(z=>{z.content.indexOf(`
`)<0&&Ce({content:z.content.slice(1,-1),offset:z.offset+1,length:z.length-2,type:"",topofline:0,next_token_offset:-1})}),Ve(),V=!1}else if(o.type==="TK_STRING")h.addDiagnostic(F.unexpected(o.content),o.offset,o.length),Ve(),V=!1;else{u=m.offset+m.length,m.type="TK_WORD",o=m,m=fe,V=!1,h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length);break}o.topofline||h.addDiagnostic(F.unexpected(o.content),o.offset,o.length)}break;case"as":case"catch":case"else":case"finally":case"until":h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);break;case"super":if(T===3){if(d[u]!=="("){let j=h.get_token(u,!0);j.type!=="TK_DOT"&&j.content!=="["&&!(j.topofline&&o.topofline)&&h.addDiagnostic(F.syntaxerror(o.content),o.offset,o.length)}}else h.addDiagnostic(F.invalidsuper(),o.offset,o.length);o.type="TK_WORD",V=!1;break;case"case":if(vt.length&&o.topofline){let j=vt.pop();vt.push(o.offset),j&&h.addFoldingRange(j,m.offset,"case"),Ve(),V=!1,o.content!==":"&&!o.topofline?(L.push(...Ct(":","case",1,20)),o.content!==":"?(h.addDiagnostic(F.unexpected(o.content),o.offset,o.length),V=!1):(V=!0,Ve(),V=!1,o.type==="TK_START_BLOCK"?o.previous_pair_pos=te:o.topofline||=-1)):(V=o.content===":",h.addDiagnostic(F.unexpected(o.content),o.offset,o.length))}else o.type="TK_WORD",h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length);break;case"try":if(Ve(),V=!1,o.type==="TK_COMMA"&&Ae(m),Tt(!0,te),o.type==="TK_RESERVED"&&o.content.toLowerCase()!=="else"){for(;o.content.toLowerCase()==="catch";)V=!0,ee=o.offset,Ge();for(let j of["else","finally"])o.content.toLowerCase()===j&&(V=!0,ee=o.offset,Ve(),V=!1,Tt(!0,m.offset))}break;case"isset":xc(d.charAt(o.offset+5));break;case"throw":if(or>=xr){o.type="TK_WORD",V=!1;break}default:if(ie=Ot(),ie.type==="TK_EQUALS"||ie.content.match(/^([<>]=?|~=|&&|\|\||[.|?:^]|\*\*?|\/\/?|<<|>>|!?==?)$/))o.type="TK_WORD",u=q,h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length);else if(m=o,o=ie,V=!1,H==="return"||H==="throw"){o.type==="TK_COMMA"&&Ae(m);let j=o.offset;L.push(...Ct(void 0,H)),T&1&&H==="return"&&j<=m.offset&&(A.returns??=[]).push(j,m.offset+m.length)}else if(H==="switch")if(L.push(...Ct("{",H,0,2)),o.content==="{"){o.previous_pair_pos=te,V=!0,zt.push(u-1),vt.push(0),ce(++Ft);let j=vt.pop();j&&h.addFoldingRange(j,m.offset,"case"),Ve(),V=!1}else h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);else(H==="if"||H==="while")&&(o.type==="TK_COMMA"&&Ae(m),L.push(...Ct("{",H,1)),Tt(!1,te,H==="while"));break}function Ce(j){let z=A.labels;if(z){z[H=j.content.toUpperCase()]??=[];let J=be(j.offset,j.length);z[H].push(j.symbol=E=R.DocumentSymbol.create(j.content,void 0,R.SymbolKind.Field,J,J)),E.data=zt.at(-1)}}}function Ge(){let H,fe,te=o.offset;if(ee=te,m=fe=o,H=Ot(),H.topofline||H.content!=="("?(o=H,H=void 0):o=Ot(),o.topofline||o.type!=="TK_WORD"&&!hn.test(o.content))H?(u=H.offset-1,h.addDiagnostic(F.unexpected(o.content),o.offset,o.length)):(V=!1,o.topofline||o.content==="{"?Tt(null,te):h.addDiagnostic(F.unexpected(o.content),o.offset,o.length));else{let q=[];if(V=!0,o.content.toLowerCase()!=="as"){for(;;){let ie="";if(o.type!=="TK_WORD"?h.addDiagnostic(F.unexpected(o.content),o.offset,o.length):(Dn(o),ie+=o.content),m=o,o=Ot(),o.type==="TK_DOT")for(Ve();;){if(o.type==="TK_WORD")Fn(o),ie+="."+o.content,Ve();else if(o.content==="%")h.addDiagnostic(F.unexpected(o.content),o.offset,o.length),Pn("%","%"),Ve(),ie="@";else break;if(o.type!=="TK_DOT")break;Ve()}if(!ie.startsWith("@")&&q.push(ie),o.content===","){if(m=o,o=Ot(),!hn.test(o.content))break}else break}if(H){if(o.content==="{")return h.addDiagnostic(F.missing(")"),H.offset,1),Tt(null,te);if(o.content===")")return Ve(),V=!1,Tt(null,te)}else if(o.content==="{"||o.topofline)return V=!1,Tt(null,te)}if(o.content.toLowerCase()==="as")if(m=o,o=Ot(),V=!1,o.type!=="TK_WORD"&&!hn.test(o.content))h.addDiagnostic(F.unexpected(fe.content),fe.offset,fe.length);else if(o.type!=="TK_WORD")h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length),o.type="TK_WORD";else{let ie=Ot();if(u=o.offset+o.length,!ie.topofline&&ie.content!=="{"&&!(H&&ie.content===")"))h.addDiagnostic(F.unexpected(fe.content),fe.offset,fe.length),V=!1;else{let Ce=Dn(o);Ce&&(V=!0,Ce.def=Ce.assigned=!0,!q.length&&q.push("Error"),Ce.type_annotations=q),H&&(ie.content===")"?(u=ie.offset+1,V=!0):h.addDiagnostic(F.missing(")"),H.offset,1)),V&&(Ve(),V=!1,Tt(null,te))}}else H&&(o.content===")"?(m=o,o=Ot()):h.addDiagnostic(F.missing(")"),H.offset,1)),o.topofline?(V=!1,Tt(null,te)):h.addDiagnostic(F.unexpected(o.content),o.offset,o.length)}}function Te(H){let fe=H.previous_extra_tokens;fe&&(fe.i=0)}function ft(){let H="",fe;if(V=!0,Ve(),V=!1,(fe=o.ignore&&o.content==="?")&&(o=jt()),o.type!=="TK_EQUALS"&&!/^(=[=>]?|\?\??|:)$/.test(o.content)&&(o.type==="TK_DOT"||`, 	\r
`.includes(H=d.charAt(m.offset+m.length))))if(o.type==="TK_DOT"){let te=Dn(m);for(V=!0,fe&&te&&(te.returns=null);Ve();){if(o.type==="TK_WORD"){let q=!0;if(d.charAt(u)==="%")q=!1;else if(Fn(o),Ve(),Oo.includes(o.content))q=!1,Wr(m,void 0,()=>{let ie=u;return L.push(...$t()),[ie,m.offset+m.length]});else if(o.ignore&&o.content==="?"&&(o=jt()),o.type==="TK_DOT")continue;V=!1,q&&o.type!=="TK_EQUALS"&&!"=??".includes(o.content||" ")&&`, 	\r
`.includes(H=d.charAt(m.offset+m.length))?dt(R.SymbolKind.Method,H):L.push(...Ct())}else V=!1,L.push(...Ct());break}}else Dn(m),dt(R.SymbolKind.Function,H);else{let te,q;if(/^=>?$/.test(o.content)&&(te=o.content,q=o.offset),Ke&&te==="="&&Ae(o,!0)&&(V=!1,m=pt,o=Ot()))return;Te(o),o=m,m=pt,V=!1,u=o.skip_pos??o.offset+o.length,L.push(...Ct(void 0,te,q))}}function dt(H,fe){let te,q=m,ie={offset:q.offset,miss:[],comma:[],count:0,unknown:!1,name:q.content};if(fe===","||Ke){if(H===R.SymbolKind.Function&&$m.includes(q.content.toLowerCase())&&Ae(q,!0)&&(V=!1,m=pt,o=Ot()))return;fe===","&&h.addDiagnostic(F.funccallerr(),o.offset,1)}(te=o.type)==="TK_OPERATOR"&&!o.content.match(/^(not|\+\+?|--?|!|~|%|&)$/i)&&h.addDiagnostic(F.unexpected(o.content),o.offset,o.length),q.paraminfo=ie,L.push(...Ct(void 0,void 0,void 0,void 0,ie)),H===R.SymbolKind.Method&&(q.semantic=void 0),q.ignore||(q.semantic??={type:H===R.SymbolKind.Function?1:(ie.method=!0,2)});let Ce=R.DocumentSymbol.create(q.content,void 0,H,be(q.offset,m.offset+m.length-q.offset),be(q.offset,q.length));if(Ce.paraminfo=ie,Ce.offset=q.offset,q.callsite=Ce,m===q){let j=d.indexOf(`
`,q.offset);Ce.range.end=K.positionAt(j<0?w:j)}H===R.SymbolKind.Method&&Wr(q,!0),s!=="Off"&&(s==="On"||te==="TK_START_EXPR")&&h.diagnostics.push({message:xi.callwithoutparentheses(),range:Ce.selectionRange,severity:R.DiagnosticSeverity.Warning})}function Tt(H,fe,te=!1){let q=U;if(U||=te,Ne=!1,o.type==="TK_START_BLOCK")o.previous_pair_pos=fe,V=!0,zt.push(u-1),ce(++Ft),Ve(),V=o.type==="TK_RESERVED"&&o.content.toLowerCase()==="else";else{if(o.type==="TK_RESERVED"&&n_.includes(o.content.toLowerCase())){let ie=o;if(V=!0,ke())return H;(ie===o||ie===m&&!V&&!o.topofline)&&(ie===o&&ie.type==="TK_WORD"?ft():L.push(...Ct()))}else o.type==="TK_WORD"?ft():o.type!=="TK_EOF"&&(m=pt,V=!1,L.push(...Ct()));ee!==void 0&&(h.linepos[(m.pos??=K.positionAt(m.offset)).line]=ee),V=o.type==="TK_RESERVED"&&o.content.toLowerCase()==="else"}if(U=q,typeof H=="boolean"){if(H)V=!1;else if(V)return ee=o.offset,Ve(),V=!1,Tt(!0,m.offset),!0}else V=!1;return!1}function Ct(H,fe,te=0,q=1,ie){let Ce,j=0,z=0,J,me,Ue=[],we=ie??{offset:0,count:0,comma:[],miss:[],unknown:!1};if(Ne=!1,V){let Z=h.get_token(u,!0);Ce=Z.content?Z.offset:u+1,Z.type==="TK_COMMA"?we.miss.push(we.count++):(!Z.topofline||xn(o,Z))&&(++we.count,J=Z)}else Ce=o.content?o.offset:m.offset+m.length+1,o.type==="TK_COMMA"?we.miss.push(we.count++):(!o.topofline||xn(m,o))&&(++we.count,J=o);for(;;){if(Ue.push(...$t(void 0,0,H)),me??=o.offset,o.type==="TK_COMMA")V=!0,++j,++we.count,m.type==="TK_COMMA"||m.type==="TK_START_EXPR"?we.miss.push(we.comma.length):m.type==="TK_OPERATOR"&&!m.ignore&&!m.content.match(/(--|\+\+|%)/)&&h.addDiagnostic(F.unexpected(","),o.offset,1),we.comma.push(o.offset),ie&&(o.paraminfo=ie);else if(o.topofline){V=!1;break}else{if(H===o.content)break;z!==u&&(h.addDiagnostic(F.unexpected(o.content),o.offset,o.length),V=!1)}if(z===u&&(!c||o.length))break;z=u}if(fe==="="||fe==="=>"){let Z=h.find_token(Ce),he=!0,de=h.tokens;if(Z.offset<me){for(;Z&&Z.offset<me;){if(!Z.ignore&&Z.content==="?"){he=!1;break}Z.symbol?Z=h.find_token(h.document.offsetAt(Z.symbol.range.end),!0):Z=de[Z.next_pair_pos??Z.next_token_offset]}if(he){if(fe==="="&&Ae(de[J.next_token_offset],!0)&&(V=!1,m=pt,Z=Ot()))return[];h.addDiagnostic(`${F.unexpected(fe)}, ${F.didyoumean(":=").toLowerCase()}`,te,fe.length)}}}else fe&&(j>=q||we.count-(o===J?1:0)<te)&&h.addDiagnostic(F.acceptparams(fe,q===te?te:`${te}~${q}`),Ce,m.offset+m.length-Ce);return m.content==="*"&&(we.unknown=!0,we.count--),Ue}function gn(){let H=!1,fe,te=o.data??{content:"",offset:o.offset+o.length,length:0};switch(fe=o.content.toLowerCase()){case"#dllload":H=!0;case"#include":case"#includeagain":it(te.content.replace(/`;/g,";"),te,T,H);break;case"#dllimport":if(We=te.content.match(/^((\w|[^\x00-\x7f])+)/i)){let q=be(te.offset,We[0].length),ie=R.Range.create(0,0,0,0),Ce={t:"ptr",i:"int",s:"str",a:"astr",w:"wstr",h:"short",c:"char",f:"float",d:"double",I:"int64"},j=We[0],z=[],J,me="",Ue=0,we="i";W=!0,We=te.content.substring(We[0].length).match(/^[ \t]*,[^,]+,([^,]*)/),We=We?.[1].replace(/[ \t]/g,"").toLowerCase().replace(/i6/g,"I")??"";for(let he of We.replace(/^(\w*)[=@]?=/,(de,et)=>(we=et||we,"")))if(he==="u")me="u";else if(Ce[he])z.push(J=Jt.create(`p${++Ue}_${me+Ce[he]}`,R.SymbolKind.Variable,ie)),J.defaultVal=null,me="";else if(J&&(he==="*"||he==="p"))J.name+="p",J=void 0;else{h.addDiagnostic(F.invalidparam(),te.offset,te.length);return}let Z=Ln.create(j,R.SymbolKind.Function,q,q,z);Z.type_annotations=["fd".includes(we)?"Float":"asw".includes(we)?"String":"Integer"],L.push(Z)}break;case"#requires":fe=te.content.toLowerCase(),W||=fe.startsWith("autohotkey_h"),(We=fe.match(/^\w+[ \t]+v(1|2)/))&&(We[1]==="2"?ye=!0:(h.maybev1=3,!Ae(te,!1,F.requirev1())&&h.addDiagnostic(F.unexpected(te.content),te.offset,te.length)));break;case"#hotif":T!==0?h.addDiagnostic(F.invalidscope(o.content),o.offset,o.length):(gt!==void 0&&h.addFoldingRange(gt,o.offset),Ve(),V=!1,gt=o.topofline?void 0:m.offset);break;case"#hotstring":fe=te.content?.trim().toLowerCase()??"",fe!=="nomouse"&&fe!=="endchars"&&(h.hotstringExecuteAction=/x(?!0)/.test(fe));break;default:fe.match(/^#(if|hotkey|(noenv|persistent|commentflag|escapechar|menumaskkey|maxmem|maxhotkeysperinterval|keyhistory)\b)/i)&&!Ae(o)&&h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);break}}function Jr(H){let fe=[],te,q;Ne=!1;e:for(;Ve();){if(o.topofline===1&&!xn(m,o,A)){V=!1;break}switch(o.type){case"TK_WORD":if(te=m,Ve(),o.type==="TK_EQUALS"){let ie,Ce=o.content,j=u;te.type==="TK_DOT"?Fn(m):(ie=Dn(m,T,fe))?(T===2&&H&&(m.semantic.modifier=1),(q=a[ie.selectionRange.start.line])&&je(ie,q)):H&&h.addDiagnostic(F.conflictserr(H,"built-in variable",m.content),m.offset,m.length),L.push(...$t());let z=[j,m.offset+m.length];A.ranges?.push(z),ie&&(Ce===":="||Ce==="??="&&(ie.assigned??=1)?ie.returns=z:ie.cached_types=[Ce===".="?Sr:Lr],ie.assigned??=!0,ie.def=!0,ie.range.end=K.positionAt(m.offset+m.length),ie.def=!0)}else{if(T===2){let ie=m,Ce=o,j=F.propnotinit(),z=0,J=Dn(m,2,fe);if(J.def=!1,H&&(m.semantic.modifier=1),o.type==="TK_DOT")for(;Ve()&&o.type==="TK_WORD"&&Ve();){if(o.type==="TK_EQUALS"){let me=u,Ue=m,we=Oo.includes(o.content);Fn(m),L.push(...$t());let Z=[me,m.offset+m.length];if(A.ranges?.push(Z),!z&&we&&A.static&&ie.content.toLowerCase()==="prototype"){let he=Jt.create(Ue.content,R.SymbolKind.Property,be(Ue.offset,Ue.length)),de=A.parent.prototype;(ne=a[he.selectionRange.start.line])&&je(he,ne),he.parent=de,he.returns=Z,de.cache.push(he)}continue e}if(o.type==="TK_DOT")Fn(m),z++;else if(o.topofline&&(hn.test(o.content)||o.content==="}")){m=pt,V=!1;break e}else{o.content!==","?j=F.propdeclaraerr():j="";break}}else if(!H&&o.content===":"){let me=o.offset+1,Ue="",we=!1,Z,he=A,de=p.property.__INIT,et=m,$e=de.children.length;if(delete J.def,J.typed=!0,or<xr&&h.addDiagnostic(F.requireversion("2.1-alpha.3"),m.offset,m.length,R.DiagnosticSeverity.Warning),m=o,o=jt(),j="",hn.test(o.content))Z=o,Ue+=o.content,Ve();else if(o.type==="TK_START_EXPR"){let Se=L.length;A=de,we=!0,Pn(o.content,o.content==="("?")":"]"),de.children.push(...L.splice(Se)),A=he,Ve()}else o.content===":="||o.type==="TK_COMMA"||o.topofline&&hn.test(o.content)?(h.addDiagnostic(F.unexpected(o.content),o.offset,o.length),V=!1):j=F.propdeclaraerr();if(!j){for(;;)if(o.content==="."&&o.type!=="TK_OPERATOR")o.type!=="TK_DOT"&&h.addDiagnostic(F.unexpected("."),o.offset,o.length),Ve()&&o.type==="TK_WORD"&&(Ue+="."+o.content,Fn(o),Ve());else if(o.type==="TK_START_EXPR"&&!o.prefix_is_whitespace&&hn.test(m.content)){let Se=L.length,Ut=m,sn=o,St=m.previous_token?.type==="TK_DOT",pr;if(A=de,we=!0,Pn(o.content,o.content==="("?")":pr="]"),de.children.push(...L.splice(Se)),!pr){let hr=R.DocumentSymbol.create(Ut.content,void 0,St?R.SymbolKind.Method:R.SymbolKind.Function,be(Ut.offset,u-Ut.offset),be(Ut.offset,Ut.length));Object.assign(sn.paraminfo??{},{name:Ut.content}),hr.paraminfo=sn.paraminfo,hr.offset=Ut.offset,Ut.callsite=hr,Ut.semantic??={type:St?2:1}}A=he,Ve()}else break;if(Z&&(o.previous_token===Z&&/^([iu](8|16|32|64)|f(32|64)|[iu]ptr)$/i.test(Z.content)?J.type_annotations=[/^f/i.test(Z.content)?"Float":"Integer"]:Z.type==="TK_WORD"&&Dn(Z,3,de.children)),J.type_annotations??=we||!Ue?["Any"]:[Ue],o.content===":="){de.ranges?.push([me,o.offset-1]),me=o.offset+2,L.push(...$t()),A.ranges?.push([me,m.offset+m.length]);continue e}if(o.type==="TK_COMMA"||o.topofline&&(hn.test(o.content)||o.content==="}")&&!(V=!1)){de.ranges?.push([me,o.offset-1]);continue e}h.addDiagnostic(F.propdeclaraerr(),et.offset,et.length),de.children?.splice($e),ie=o.previous_token??pt,Ce=o,J.def=!1}}if(j&&h.addDiagnostic(j,m.offset,m.length),o.topofline&&hn.test(o.content)){m=pt,V=!1;break e}!o.topofline&&o.type!=="TK_COMMA"&&(V=!1,m=ie,o=Ce,u=o.offset+o.length,$t(",")),V=!1;break}if(o.type==="TK_COMMA"||o.topofline&&!(["TK_COMMA","TK_OPERATOR","TK_EQUALS"].includes(o.type)&&!o.content.match(/^(!|~|not)$/i))){let ie=Dn(m,T,fe);if(ie?(q=a[ie.selectionRange.start.line])&&je(ie,q):H&&h.addDiagnostic(F.conflictserr(H,"built-in variable",m.content),m.offset,m.length),o.type!=="TK_COMMA")break e}}break;case"TK_COMMA":continue;case"TK_UNKNOWN":h.addDiagnostic(F.unknowntoken(o.content),o.offset,o.length);break;case"TK_RESERVED":T!==2&&h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length),V=!1,o.type="TK_WORD";break;case"TK_END_BLOCK":V=!1;break e;case"TK_END_EXPR":h.addDiagnostic(F.unexpected(o.content),o.offset,1);default:break e}}return fe}function $t(H,fe=1,te){let q=L.length,ie=[],Ce=(V&&(Ve(),V=!1),o.offset),j;for(Ne=!1;Ve();){if(o.topofline===1)if((!H||H===",")&&!xn(m,o,A)){m.type==="TK_WORD"&&d.charAt(m.offset-1)==="."&&Fn(m),V=!1;break}else m!==pt&&(o.topofline=-1);switch(o.type){case"TK_WORD":{let z=d.charAt(o.offset-1)===".";if(d.charAt(u)==="(")break;if(Ve(),o.type==="TK_COMMA"){if(z)Fn(m);else if(d.charAt(m.offset-1)!=="%"){let J=Dn(m);J&&j!==void 0&&(J.def=J.assigned=!0,j?J.pass_by_ref=!0:J.cached_types=[Lr])}else m.ignore=!0;return V=!1,L.splice(q)}else if(o.content==="=>"){let J=L.length,me=m,Ue=T,we=u;T=1;let Z=be(me.offset,me.length),he=$t(H,fe||1,te??(ie.length?":":void 0));T=Ue;let de=Ln.create("",R.SymbolKind.Function,be(me.offset,m.offset+m.length-me.offset),be(me.offset,0),[Jt.create(me.content,R.SymbolKind.Variable,Z)],L.splice(J));de.children.push(...he),o.fat_arrow_end=!0,de.returns=[we,m.offset+m.length],T!==0&&(de.parent=A),qn(de),L.push(de);break}else if(o.type==="TK_OPERATOR"&&(!o.topofline||!o.content.match(/^(!|~|not|\+\+|--)$/i))){let J=!o.topofline&&["++","--"].includes(o.content);if(d.charAt(m.offset-1)!=="%"&&d.charAt(m.offset+m.length)!=="%")if(z)Fn(m);else{let me=Dn(m);me&&(j!==void 0&&(me.def=me.assigned=!0,j?me.pass_by_ref=!0:me.cached_types=[Lr]),J?(me.def=me.assigned=!0,me.cached_types=[Lr]):(o.content==="??"||o.ignore)&&(me.returns=null))}else z?(Wr(m,null),o=m,m=o.previous_token??pt,xs(H),Ve(),J||=!o.topofline&&["++","--"].includes(o.content)):m.ignore=!0;V=!1;continue}else if(o.topofline&&o.type!=="TK_EQUALS"&&o.type!=="TK_DOT"){if(V=!1,z)d.charAt(m.offset-1)!=="%"?Fn(m):m.ignore=!0;else if(d.charAt(m.offset-1)!=="%"){let J=Dn(m);J&&j!==void 0&&(J.def=J.assigned=!0,j?J.pass_by_ref=!0:J.cached_types=[Lr])}else m.ignore=!0;return $r(ie),L.splice(q)}if(z)Fn(m),(V=o.type==="TK_EQUALS")&&Oo.includes(o.content)&&Wr(m,void 0,()=>{let J=u;return L.push(...$t(H,fe,te??(ie.length?":":void 0))),[J,m.offset+m.length]});else{let J;if(d.charAt(m.offset-1)!=="%"&&(J=Dn(m)))if(j?J.def=J.pass_by_ref=J.assigned=!0:j===!1&&o.type!=="TK_DOT"&&(J.def=J.assigned=!0,J.cached_types=[Lr]),o.type==="TK_EQUALS"){(ne=a[J.selectionRange.start.line])&&je(J,ne);let me=o.content,Ue=u;V=!0,L.push(...$t(H,fe||1,te??(ie.length?":":void 0))),J.range.end=K.positionAt(m.offset+m.length),me===":="||me==="??="&&(J.assigned??=1)?J.returns=[Ue,m.offset+m.length]:J.cached_types=[me===".="?Sr:Lr],J.assigned??=!0,J.def=!0}else V=!1,J.pass_by_ref&&o.type==="TK_DOT"&&h.addDiagnostic(F.requirevariable(),m.previous_token.offset,1);else V=!1,m.ignore=!0}break}case"TK_START_EXPR":if(o.content==="[")Pn("[","]");else{let z,J,me,Ue=!m.type||d.charAt(m.offset+m.length)==="(",we=L.length,Z=o,he=o.offset,de={offset:o.offset,count:0,comma:[],miss:[],unknown:!1};if(m.type==="TK_WORD"&&Ue)if(d.charAt(m.offset-1)==="."){let $e=m;Pn("(",")",void 0,de),$e.semantic={type:2};let Se=R.DocumentSymbol.create($e.content,void 0,R.SymbolKind.Method,be($e.offset,u-$e.offset),be($e.offset,$e.length));Object.assign(Z.paraminfo??{},{name:$e.content,method:!0}),Se.paraminfo=de,Se.offset=$e.offset,$e.callsite=Se,Wr($e,!0);continue}else z=m;let et=!z||d.charAt(z.offset-1)!=="%"||z.previous_token?.previous_pair_pos===void 0;if(Pn("(",")",void 0,de),J=u,et&&((me=h.get_token(u,!0)).content==="=>"||!me.topofline&&te!=="{"&&me.content==="{")){L.splice(we),m=(o=Z).previous_token??pt,u=o.offset+1;let $e=me.content==="=>",Se=Kr(!0),Ut=z?z.offset:he,sn=L.splice(we);J=u,Ve(),z&&(z.content.match(/^\d/)&&h.addDiagnostic(F.invalidsymbolname(z.content),z.offset,z.length),z.semantic={type:1,modifier:6}),Se||(Se=[],h.addDiagnostic(F.invalidparam(),Ut,J-Ut));let St=Ln.create(z?.content??"",R.SymbolKind.Function,be(Ut,0),be(Ut,z?.length??0),Se),pr=A,hr=T;A=St,T=1,z??=Z,L.push(z.symbol=z.definition=St),$e?(St.children=sn,sn.push(...$t(H,z?.topofline?2:fe||1,te??(ie.length?":":void 0))),St.range.end=h.document.positionAt(m.offset+m.length),St.returns=[me.offset+me.length,m.offset+m.length],o.fat_arrow_end=!0):(or<xr&&h.addDiagnostic(F.requireversion("2.1-alpha.3"),z.offset,u-z.offset,R.DiagnosticSeverity.Warning),o.in_expr=Ut,St.children=sn,sn.push(...bt(1,St)),St.range.end=K.positionAt(u),o=h.tokens[o.next_pair_pos]??h.find_token(u-1),o.in_expr=Ut,r=!1),A=pr,T=hr,h.addFoldingRangePos(St.range.start,St.range.end,$e?"line":void 0),T!==0&&(St.parent=A),qn(St)}else if(z)if(d.charAt(z.offset-1)!=="%"||z.previous_token?.previous_pair_pos===void 0){Dn(z),z.semantic??={type:1};let $e=R.DocumentSymbol.create(z.content,void 0,R.SymbolKind.Function,be(z.offset,J-z.offset),be(z.offset,z.length));Object.assign(Z.paraminfo??{},{name:z.content}),$e.paraminfo=de,$e.offset=z.offset,z.callsite=$e}else z.ignore=!0,delete z.semantic}break;case"TK_START_BLOCK":if(Ce<o.offset&&!(m.type==="TK_OPERATOR"&&m.op_type!==1)&&m.type!=="TK_EQUALS")return V=!1,$r(ie),L.splice(q);{let z=h.diagnostics.length,J=!1;if(m.type==="TK_RESERVED"&&m.content.toLowerCase()==="switch"){let me;if(V=!1,o.topofline||(me=h.get_token(u)).topofline||me.type.endsWith("COMMENT"))return $r(ie),L.splice(q);V=J=!0}else m.type==="TK_EQUALS"?":=??=".includes(m.content)||h.addDiagnostic(F.unknownoperatoruse(m.content),m.offset,m.length):fe===1&&(m.type==="TK_WORD"||m.type==="TK_OPERATOR"&&m.content!=="=>"||m.type.startsWith("TK_END"))&&(fe=0);if(gf(fe>0||J))break;return h.diagnostics.splice(z),$r(ie),V=!1,L.splice(q)}case"TK_NUMBER":case"TK_STRING":break;case"TK_END_BLOCK":case"TK_END_EXPR":case"TK_COMMA":return V=!1,$r(ie),L.splice(q);case"TK_LABEL":h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);break;case"TK_UNKNOWN":h.addDiagnostic(F.unknowntoken(o.content),o.offset,o.length);break;case"TK_RESERVED":{let z=d.charAt(o.offset+o.length);if(z==="%"||d.charAt(o.offset-1)==="%"){V=!1,o.type="TK_WORD",o.semantic={type:4};break}if(/^(class|super|isset)$/i.test(o.content)){if(o.content.toLowerCase()==="isset"&&xc(z))break;V=!1,o.type="TK_WORD";break}else if(or>=xr&&o.content.toLowerCase()==="throw"){V=!1,o.type="TK_WORD";break}h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length);break}case"TK_OPERATOR":if(o.content==="%"){let z=d.charAt(o.offset-1);if(H==="%")return V=!1,$r(ie),L.splice(q);z==="."?(Wr(o,null),xs()):Pn("%","%")}else if(o.content==="=>"&&m.type==="TK_WORD"){L.length&&L.at(-1).name===m.content&&L.pop();let z=Ln.create("",R.SymbolKind.Function,be(m.offset,m.length),be(m.offset,0),[Jt.create(m.content,R.SymbolKind.Variable,be(m.offset,m.length))]);z.returns=[u,0],z.children=$t(H,1,te??(ie.length?":":void 0)),z.range.end=K.positionAt(z.returns[1]=m.offset+m.length),o.fat_arrow_end=!0,T!==0&&(z.parent=A),L.push(z),qn(z)}else{if(hn.test(o.content)&&(d[o.offset-1]==="%"||d[o.offset+o.length]==="%")){V=!1,o.type="TK_WORD",o.semantic={type:4};break}if(o.content===":"){if(ie.pop()===void 0){if(te===":")return V=!1,L.splice(q);h.addDiagnostic(F.unexpected(":"),o.offset,1)}}else o.content==="?"&&(o.ignore||ie.push(o.offset));if(Ee(o)===-1){if(o.content==="&"){j=!0;continue}if(["++","--"].includes(o.content)){j=!1;continue}}}break;case"TK_EQUALS":break}j=void 0}return $r(ie),L.splice(q)}function Kr(H=!1,fe=")"){let te=u-1,q=[],ie=[",",fe===")"?"(":"["],Ce=!1,j=!0,z=u,J=o,me=!1,Ue,we={offset:te,count:0,comma:[],miss:[],unknown:!1};for(Ne=!1,J.paraminfo=we,m.type==="TK_WORD"&&J.prefix_is_whitespace===void 0&&(we.name=m.content);Ve();)if(o.topofline===1&&(o.topofline=-1),o.content===fe){if(m.type==="TK_COMMA"){if(H){h.addDiagnostic(F.unexpected(fe),o.offset,o.length);break}o.previous_pair_pos=te,m.paraminfo=we,we.miss.push(we.count++),L.push(...q);return}break}else if(o.type==="TK_WORD"){if(Cc(o.content.toLowerCase())){j=!1;break}if(we.count++,ie.includes(m.content)||m===pt)if(Ve(),o.content===","||o.content===fe){m.content.match(/^\d/)&&h.addDiagnostic(F.invalidsymbolname(m.content),m.offset,m.length);let Z=Jt.create(m.content,R.SymbolKind.Variable,be(m.offset,m.length));if((ne=a[Z.selectionRange.start.line])&&Z.selectionRange.start.line>(Ue??=h.document.positionAt(te).line)&&je(Z,ne),Ce&&(Ce=!1,Z.pass_by_ref=Z.def=Z.assigned=!0),q.push(Z),z=u,J=o,o.content===",")we.comma.push(o.offset),o.paraminfo=we;else break}else if(o.content===":="||H&&o.content==="="){o.content==="="&&(Ae(m),h.addDiagnostic(`${F.unexpected("=")}, ${F.didyoumean(":=").toLowerCase()}`,o.offset,o.length));let Z=o;m.content.match(/^\d/)&&h.addDiagnostic(F.invalidsymbolname(m.content),m.offset,m.length);let he=Jt.create(m.content,R.SymbolKind.Variable,be(m.offset,m.length));if((ne=a[he.selectionRange.start.line])&&he.selectionRange.start.line>(Ue??=h.document.positionAt(te).line)&&je(he,ne),he.def=!0,he.defaultVal=null,q.push(he),L.push(...$t(",",2)),V=!0,z=u,J=o,m!==Z){he.returns=[Z.offset+Z.length,m.offset+m.length],he.range.end=h.document.positionAt(m.offset+m.length);let de=o.previous_token,et=[];for(;de&&de!==Z&&et.unshift(de)<3;)de=de.previous_token;et.length===1?et[0].content.toLowerCase()!=="unset"&&(he.defaultVal=et[0].content):et.length===2&&"-+".includes(et[0].content)?he.defaultVal=`${et[0].content}${et[1].content}`:(he.range_offset=[Z.offset,o.offset],me=!0)}if(Ce&&(Ce=!1,he.pass_by_ref=he.assigned=!0),o.type==="TK_COMMA"){we.comma.push(o.offset),o.paraminfo=we;continue}else{j=o.content===fe;break}}else if(o.type==="TK_OPERATOR")if(o.content==="*"){let Z=m;if(Ve(),o.content===fe){let he=Jt.create(Z.content,R.SymbolKind.Variable,be(Z.offset,Z.length));q.push(he),he.arr=!0,we.unknown=!0,z=u,J=o;break}else{j=!1,we.count--;break}}else if(o.content==="?"&&o.ignore){let Z=m,he=Jt.create(m.content,R.SymbolKind.Variable,be(m.offset,m.length));if(he.def=!0,he.defaultVal=null,q.push(he),Ce&&(Ce=!1,he.pass_by_ref=he.assigned=!0),Ve(),o.type==="TK_COMMA"){Z.content.match(/^\d/)&&h.addDiagnostic(F.invalidsymbolname(Z.content),Z.offset,Z.length),we.comma.push(o.offset),z=u,J=o;continue}else{(j=o.content===fe)||(q.pop(),we.count--);break}}else{j=!1,we.count--;break}else{if(H&&m.type==="TK_WORD"&&m.content.toLowerCase()==="byref"&&o.type==="TK_WORD"){Ae(m),h.addDiagnostic(F.deprecated("&","ByRef"),m.offset,o.topofline?m.length:o.offset-m.offset),V=!1,m=pt;continue}j=!1,we.count--;break}else{j=!1,we.count--;break}}else if(ie.includes(m.content)){if(o.content==="*"){let Z=o,he;if(Ve(),o.content===fe){q.push(he=Jt.create("",R.SymbolKind.Variable,be(Z.offset,0))),he.arr=!0;break}else h.addDiagnostic(F.unexpected("*"),Z.offset,1)}else if(o.content==="&"){let Z=o;if(o=Ot(),o.type==="TK_WORD"){Ce=!0,V=!1;continue}else h.addDiagnostic(F.unexpected("&"),Z.offset,1)}j=!1;break}else{j=!1;break}if(we.comma.forEach(Z=>h.tokens[Z].paraminfo=we),j)return me&&(q.format=ve.bind(void 0,h.tokens)),o.previous_pair_pos=te,h.tokens[te].next_pair_pos=o.offset,h.addFoldingRange(te,u,"block"),q;L.push(...q),u=z,o=J,Pn(fe===")"?"(":"[",fe,te,we)}function xs(H){for(V=!1,u=o.offset+o.length;Ve();)switch(o.type){case"TK_OPERATOR":if(o.content==="%"){if(H==="%")return V=!1;if(Pn("%","%"),Nn(d.charCodeAt(u)))break;return}case"TK_NUMBER":if(!hn.test(o.content))return V=!1;case"TK_RESERVED":case"TK_WORD":if(o.type="TK_WORD",o.semantic={type:5},d.charAt(u)==="%"&&(o.ignore=!0))break;m.content==="%"&&(o.ignore=!0);return;default:return V=!1}}function gf(H=!1){let fe=m,te=o,q=L.length,ie=[],Ce={},j=!0,z,J;for(Ne=!1,V=!0,o.data=Cr;j;)if(!me()||Ue()){if(H&&!j){for(J=m,j=!0;!",}".includes(o.content);)$t("}",2),V=!0;if(V=!0,h.addDiagnostic(F.objectliteralerr(),J.offset,m.offset+m.length-J.offset),o.content===",")continue}break}if(j||H)for(let we of ie)(z=oe[we]).type="TK_WORD",z.semantic={type:5};if(j)(m.content===":"||m.type==="TK_LABEL")&&h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);else return m=fe,o=te,L.splice(q),u=o.skip_pos??o.offset+o.length,V=!1;if(te.data=Cr,o.type==="TK_END_BLOCK"){if(h.addFoldingRange(o.previous_pair_pos=te.offset,o.offset),te.next_pair_pos=o.offset,Object.keys(Ce).length){let we=R.DocumentSymbol.create("",void 0,R.SymbolKind.Class,bn,bn);te.data=we,we.property=Ce,we.name=we.full=we.extends=""}o.data=te.data}else h.addDiagnostic(F.missing("}"),te.offset,1);return!0;function me(){for(;Ve();)switch(z=void 0,o.topofline===1&&(o.topofline=-1),o.type){case"TK_OPERATOR":if(o.content==="%"){if(Pn("%","%"),Nn(d.charCodeAt(u)))break;return Ve(),o.content===":"?!0:j=!1}case"TK_NUMBER":if(!hn.test(o.content))return j=!1;case"TK_RESERVED":case"TK_WORD":{if(ie.push(o.offset),d.charAt(u)==="%")break;let we=m;return Ve(),o.content===":"?(we.content!=="%"&&(z=m),!0):j=!1}case"TK_STRING":return Ve(),o.content===":"?(z={...m},z.content=z.content.slice(1,-1),z.offset++,z.length-=2,!W&&(!m.content.startsWith('"')||!Ae(m))&&h.addDiagnostic([F.invalidpropname(),F.didyoumean(z.content)].join(", "),m.offset,m.length),!0):j=!1;case"TK_LABEL":return o.content.match(/^(\w|[^\x00-\x7f])+:$/)?(z={...o},z.content=z.content.slice(0,-1),z.length--,!0):j=!1;case"TK_END_BLOCK":if(m.type==="TK_START_BLOCK"||m.type==="TK_COMMA")return!1;case"TK_START_EXPR":return j=!1;case"TK_COMMA":if(m.type==="TK_COMMA"||m.type==="TK_START_BLOCK")return!0;default:return j=!1}return!1}function Ue(){let we=o.offset;return L.push(...$t(",")),z&&(Fn(z),(Ce[z.content.toUpperCase()]=Jt.create(z.content,R.SymbolKind.Property,be(z.offset,z.length))).returns=[we+1,m.offset+m.length]),o.type==="TK_COMMA"?!(V=!0):o.type==="TK_END_BLOCK"?V=!0:o.type==="TK_EOF"?!0:!(j=!1)}}function Pn(H,fe,te,q,ie){let Ce=0,j=L.length,z=u,J=m,me=[te??=o.offset],Ue=h.tokens[te],we=[],Z=q??{offset:te,count:0,comma:[],miss:[],unknown:!1},he=!1,de=0,et;if(H!=="%"){let Se=Ue.previous_token;Ue.paraminfo=Z,(Z.name||!Ue.topofline&&Se&&Ue.prefix_is_whitespace===void 0&&((Se.previous_pair_pos??Se.in_expr)!==void 0||Se.type==="TK_WORD"||Se.type==="TK_DOT"))&&(he=!0)}else Ue.op_type=-1;for(;Ve();){if(o.topofline){if(H==="%"&&!(["TK_COMMA","TK_OPERATOR","TK_EQUALS"].includes(o.type)&&!o.content.match(/^(!|~|not)$/i))){Ae(Ue),Ue.next_pair_pos=-1,h.addDiagnostic(F.missing("%"),te,1),V=!1,$r(we);return}o.topofline===1&&(o.topofline=-1)}if(H!=="("&&o.content==="(")j=L.length,z=u,de=1,J=m,Pn("(",")");else if(o.content===fe){if(oe[o.previous_pair_pos=me.pop()].next_pair_pos=o.offset,fe!=="%"?h.addFoldingRange(o.previous_pair_pos,o.offset+1,"block"):o.op_type=1,--Ce<0)break;fe===")"&&de++}else if(o.content===H){if(H==="("){if(d.charAt(o.offset-1)===")"){Pn("(",")");continue}j=L.length,z=u,de=0}Ce++,me.push(u-1),J=m}else if(o.content==="=>"||de===1&&m.content===")"&&o.content==="{"){let Se=L.splice(j),Ut,sn,St=-1,pr=o.content,hr=o;if(m.content===")"){if(de!==1){h.addDiagnostic(F.unknownoperatoruse(),o.offset,2),V=!0;continue}m=J,u=z-1,o=jt(),St=o.offset,Se=[],Ut=Kr(!0),Ut||(Ut=[],h.addDiagnostic(F.invalidparam(),St,o.offset-St+1)),sn=Ot()}else if(m.type==="TK_WORD"&&d.charAt(m.offset-1)!==".")sn=o,St=m.offset,Ut=[Jt.create(m.content,R.SymbolKind.Variable,be(m.offset,m.length))];else{h.addDiagnostic(F.unknownoperatoruse(),o.offset,2),V=!0;continue}if(sn.content!==pr){o=hr,u=hr.offset+hr.length,V=!0,L.push(...Se),h.addDiagnostic(F.unexpected(o.content),o.offset,o.length);continue}Se.push(...L.splice(j));let gr=Ln.create("",R.SymbolKind.Function,be(St,0),be(St,0),Ut,Se);h.tokens[St].symbol=gr,sn.content==="=>"?(m=o,o=sn,Se.push(...$t(fe,2,we.length?":":void 0)),gr.range.end=h.document.positionAt(m.offset+m.length),gr.returns=[sn.offset+2,m.offset+m.length],o.fat_arrow_end=!0):(or<xr&&h.addDiagnostic(F.requireversion("2.1-alpha.3"),z-1,u-z,R.DiagnosticSeverity.Warning),sn.in_expr=St,Se.push(...bt(1,gr)),gr.range.end=K.positionAt(u),o=h.tokens[o.next_pair_pos]??h.find_token(u-1),o.in_expr=St,r=!1),T!==0&&(gr.parent=A),j=L.length,L.push(gr),qn(gr),pr==="=>"&&",:)]}".includes(o.content)&&(o.fat_arrow_end=!0)}else switch(o.type){case"TK_WORD":if(d.charAt(o.offset-1)!==".")if(d.charAt(u)!=="(")if(H==="%"||d.charAt(o.offset-1)!=="%"&&d.charAt(o.offset+o.length)!=="%"){let Se=Dn(o);if(Se){if(Ve(),V=!1,o.type==="TK_EQUALS"){(ne=a[Se.selectionRange.start.line])&&je(Se,ne);let Ut=o.content,sn=u;V=!0,L.push(...$t(fe,2,we.length?":":void 0)),Se.range.end=K.positionAt(m.offset+m.length),Ut===":="||Ut==="??="&&(Se.assigned??=1)?Se.returns=[sn,m.offset+m.length]:Se.cached_types=[Ut===".="?Sr:Lr],Se.assigned??=!0,Se.def=!0}else et||(o.type==="TK_DOT"?et||=void 0:!o.topofline&&["++","--"].includes(o.content)&&(et=!1));et!==void 0?(Se.def=Se.assigned=!0,et?Se.pass_by_ref=!0:Se.cached_types=[Lr]):(o.content==="??"||o.ignore&&o.content==="?")&&(Se.returns=null)}}else o.ignore=!0;else{m=o,o=jt();let Se=m,Ut=o,sn=L.length,St=Kr(),pr=u,hr=d.charAt(Se.offset-1)!=="%"||Se.previous_token?.previous_pair_pos===void 0,gr;if(Ve(),hr&&((gr=o.content==="=>")||o.content==="{")){let mr=A,nb=u;St||h.addDiagnostic(F.invalidparam(),Se.offset,o.offset-Se.offset+1);let _r=Ln.create(Se.content,R.SymbolKind.Function,be(Se.offset,u-Se.offset),be(Se.offset,Se.length),St||[]);Se.content.match(/^\d/)&&h.addDiagnostic(F.invalidsymbolname(Se.content),Se.offset,Se.length),Se.symbol=Se.definition=A=_r,gr?((_r.children=L.splice(sn)).push(...$t(fe,2,we.length?":":void 0)),_r.range.end=K.positionAt(m.offset+m.length),_r.returns=[nb,m.offset+m.length],o.fat_arrow_end=!0):(or<xr&&h.addDiagnostic(F.requireversion("2.1-alpha.3"),Se.offset,u-Se.offset,R.DiagnosticSeverity.Warning),o.in_expr=Se.offset,(_r.children=L.splice(sn)).push(...bt(1,_r)),_r.range.end=K.positionAt(u),o=h.tokens[o.next_pair_pos]??h.find_token(u-1),o.in_expr=Se.offset,r=!1),Se.semantic={type:1,modifier:6},A=mr,T!==0&&(_r.parent=A),qn(_r),L.push(_r),h.addFoldingRangePos(_r.range.start,_r.range.end,gr?"line":void 0)}else{if(hr){let mr;Dn(Se),mr=R.DocumentSymbol.create(Se.content,void 0,R.SymbolKind.Function,be(Se.offset,pr-Se.offset),be(Se.offset,Se.length)),Object.assign(Ut.paraminfo??{},{name:Se.content}),mr.paraminfo=Ut.paraminfo,mr.offset=Se.offset,Se.callsite=mr,Se.semantic??={type:1}}else Se.ignore=!0,delete Se.semantic;if(V=!1,St)for(let mr of St)Cc(mr.name.toLowerCase())||(L.push(mr),(mr.pass_by_ref||mr.returns)&&(mr.def=!0))}}else if(d.charAt(u)==="("){let Se=o,Ut=o=jt();Pn("(",")"),Se.semantic={type:2};let sn=R.DocumentSymbol.create(Se.content,void 0,R.SymbolKind.Method,be(Se.offset,u-Se.offset),be(Se.offset,Se.length));Object.assign(Ut.paraminfo??{},{name:Se.content,method:!0}),sn.paraminfo=Ut.paraminfo,sn.offset=Se.offset,Se.callsite=sn,Wr(Se,!0)}else H!=="%"&&d.charAt(u)==="%"?(Wr(o,null),xs(),Ve(),V=!1):(Fn(o),Ve(),V=!1,o.type==="TK_EQUALS"&&Oo.includes(o.content)&&Wr(m,void 0,()=>{let Se=u;return L.push(...$t(fe,2,we.length?":":void 0)),[Se,m.offset+m.length]}));break;case"TK_START_BLOCK":["TK_WORD","TK_STRING","TK_NUMBER"].includes(m.type)&&h.addDiagnostic(F.unexpected("{"),o.offset,o.length),gf(!0);break;case"TK_STRING":ie?.push(o),H==="["&&tn("]")&&!/\n|`n/.test(o.content)&&tb(o.content.substring(1,o.content.length-1));break;case"TK_END_BLOCK":case"TK_END_EXPR":h.addDiagnostic(F.unexpected(o.content),o.offset,1),$e(),V=!1,$r(we);return;case"TK_RESERVED":{let Se=d.charAt(o.offset+o.length);if(H!=="%"&&(Se==="%"||d.charAt(o.offset-1)==="%")){V=!1,o.type="TK_WORD",o.semantic={type:4};continue}if(/^(class|super|isset)$/i.test(o.content)){if(o.content.toLowerCase()==="isset"&&xc(Se))continue;V=!1,o.type="TK_WORD";continue}else if(or>=xr&&o.content.toLowerCase()==="throw"){V=!1,o.type="TK_WORD";continue}h.addDiagnostic(F.reservedworderr(o.content),o.offset,o.length);break}case"TK_COMMA":Ce===0&&H!=="%"&&(++Z.count,m.type==="TK_COMMA"||m.type==="TK_START_EXPR"?Z.miss.push(Z.comma.length):!m.ignore&&m.type==="TK_OPERATOR"&&!m.content.match(/(--|\+\+|%)/)&&h.addDiagnostic(F.unexpected(","),o.offset,1),Z.comma.push(o.offset),he&&(o.paraminfo=Z));break;case"TK_OPERATOR":if(o.content==="%"){d.charAt(o.offset-1)==="."?(Wr(o,null),xs(fe)):Pn("%","%");break}if(hn.test(o.content)&&(d[o.offset-1]==="%"||d[o.offset+o.length]==="%")){V=!1,o.type="TK_WORD",o.semantic={type:4};continue}if(o.content===":"?we.pop()===void 0&&h.addDiagnostic(F.unexpected(":"),o.offset,1):o.content==="?"&&!o.ignore&&we.push(o.offset),Ee(o)===-1){if(o.content==="&"){et=!0;continue}if(["++","--"].includes(o.content)){et=!1;continue}}break;case"TK_UNKNOWN":h.addDiagnostic(F.unknown(o.content),o.offset,o.length);break;default:o.content==="["?Pn("[","]"):o.content==="."&&Ee(o);break}et=void 0}o.type==="TK_EOF"&&Ce>-1?(fe==="%"&&Ae(Ue),$e()):oe[o.previous_pair_pos].next_pair_pos=o.offset,H!=="%"&&(m.content===","?Z.miss.push(Z.count++):m.type!=="TK_START_EXPR"&&(Z.count++,m.content==="*"&&(Z.unknown=!0,Z.count--))),$r(we);function $e(){let Se;for(;(Se=me.pop())!==void 0;)h.addDiagnostic(F.missing(fe),Se,1)}}function xc(H){let fe=L.length;if(o.definition=Zt.ISSET,o.ignore=!0,o.type="TK_WORD",o.semantic={type:9},H==="("){let te=o;Dn(o),Ve(),Pn("(",")");let q=oe[o.previous_pair_pos]?.paraminfo?.count??0;if(q!==1&&at("v2.diagnostics.paramsCheck"))h.addDiagnostic(F.paramcounterr(1,q),te.offset,u-te.offset);else if(L.length>fe&&m.type==="TK_WORD"){let ie=L.at(-1);m.content===ie.name&&m.offset===h.document.offsetAt(ie.range.start)&&(ie.assigned??=1,ie.returns??=null)}return!0}h.addDiagnostic(F.missing("("),o.offset,5)}function $r(H){let fe;for(;(fe=H.pop())!==void 0;){let te=h.tokens[fe],q=h.tokens[te.next_token_offset]??pt;q.previous_pair_pos!==void 0&&(te.ignore=!0)||(d[q.offset]==="."?or<xr-1?h.addDiagnostic(F.requireversion("2.1-alpha.2"),fe,1,R.DiagnosticSeverity.Warning):te.ignore=!0:h.addDiagnostic(F.missing(":"),fe,1))}}function Wr(H,fe=!1,te){if(N==="")return;let q,ie,Ce=!1,j=H.previous_token?.previous_token;if(!j||d.charAt(j.offset-1)==="."&&(j.content.toLowerCase()!=="prototype"||(Ce=!0,!(j=j.previous_token?.previous_token)||d.charAt(j.offset-1)==="."))||(ue=j.content.toLowerCase(),ue!=="this"&&ue!=="super"||!(ie=z())||Ce&&!(ie=ie.prototype)||!ie.cache))return;if(fe){let J=H.callsite?.paraminfo;if(J&&H.content.toLowerCase()==="defineprop"&&J.count>1&&J.miss[0]!==0){let me=J.comma[0],Ue=!!ie.prototype,we=oe[H.next_token_offset];if(d.charAt(H.offset+H.length)==="("&&(we=oe[we.next_token_offset]),we.type!=="TK_STRING"||we.next_token_offset!==me)ie.checkmember=!1;else{let Z=oe[oe[me].next_token_offset],he=we.content.slice(1,-1),de,et,$e;q=be(we.offset+1,he.length),(Z.type!=="TK_START_BLOCK"||!(et=Z.data?.property)||et.GET||et.VALUE||et.SET)&&(de=Jt.create(he,R.SymbolKind.Property,q),de.full=`(${N.slice(0,-1)}) ${(de.static=Ue)?"static ":""}${he}`,de.parent=ie,$e=de,(de.returns=et?.GET?.returns)?de.alias=!0:de.returns=et?.VALUE?.returns),(et=et?.CALL)&&(de=Jt.create("",R.SymbolKind.Variable,be(0,0)),de.arr=!0,de=Ln.create(he,R.SymbolKind.Method,q,q,[de],void 0,Ue),de.full=`(${N.slice(0,-1)}) ${de.full}`,de.returns=et.returns,de.alias=!0,de.parent=ie,$e?($e={...$e,[$e.alias?"get":$e.returns?"val":"set"]:$e},$e.val?$e=de:$e.call=de):$e=de),$e&&ie.cache.push($e)}}}else{if(fe===null)return ie.checkmember=!1,void 0;let J=Jt.create(H.content,R.SymbolKind.Property,q=be(H.offset,H.length));J.static=!!ie.prototype,ie.cache.push(J),J.def=!1,J.parent=ie,J.returns=te?.(),(ne=a[J.selectionRange.start.line])&&je(J,ne)}return;function z(){let J=[R.SymbolKind.Method,R.SymbolKind.Property],me=A,Ue=!0;for(;me&&me.kind!==R.SymbolKind.Class;)J.includes(me.kind)&&(Ue=!!me.static),me=me.parent;return Ue?me:me?.prototype}}function Cc(H,fe=0){return fe===2?!1:!!(Xa.includes(H)||W&&Qa.includes(H))}function Dn(H,fe=0,te){let q=H.content.toLowerCase();if(H.ignore||Cc(q,fe)&&(H.ignore=!0)){(H.definition=Zt[q.toUpperCase()])?.uri&&(te??L).push(Jt.create(H.content,R.SymbolKind.Variable,be(H.offset,H.length)));return}if(!H.length)return;let ie=be(H.offset,H.length),Ce=Jt.create(H.content,R.SymbolKind.Variable,ie);return fe===2?(Ce.kind=R.SymbolKind.Property,Fn(H,Ce),N&&(Ce.full=`(${N.slice(0,-1)}) ${Ce.name}`,H.symbol=Ce)):q.match(/^\d/)&&h.addDiagnostic(F.invalidsymbolname(H.content),H.offset,H.length),(te??L).push(Ce),Ce}function Fn(H,fe){let te=h.object.property[H.content.toUpperCase()]??=[];H.semantic??={type:5},fe?te.unshift(fe):te[0]??=Jt.create(H.content,R.SymbolKind.Property,be(H.offset,H.length))}function tb(H){h.texts[H.toUpperCase()]=H}function qn(H){let fe=h.diagnostics,te=R.DiagnosticSeverity.Error,q,ie=!1,Ce={};if(H.kind===R.SymbolKind.Class){let j=H,z=j.$property,J=j.property??={},me=j.children??=[],Ue=[J.__INIT],we=j.prototype;we.checkmember??=j.checkmember,qn(J.__INIT),z.__INIT?.ranges?.length?(qn(z.__INIT),Ue.push(z.__INIT)):delete z.__INIT,J.PROTOTYPE={...we,children:void 0,name:"Prototype",kind:R.SymbolKind.Property,full:`(${j.full}) Prototype`,selectionRange:bn,type_annotations:[j.full]},me.forEach(Z=>{if(ue=Z.name.toUpperCase(),Vu.includes(ue)&&delete(oe[K.offsetAt(Z.selectionRange.start)]??{}).semantic,Z.children){let he=Z.static||Z.kind===R.SymbolKind.Class?J:z,de=he[ue];if(!de)he[ue]=Z;else if(de.kind===R.SymbolKind.Property&&!(de.get??de.set))(Z.children.length||Z.kind!==R.SymbolKind.Property)&&(he[ue]=Z);else{if(de.kind!==Z.kind&&![Z.kind,de.kind].includes(R.SymbolKind.Class)){let et,$e=de.kind===R.SymbolKind.Property?(et=Z,de):(et=de,Z);if(!$e.call)return $e.call=et,he[ue]=$e}fe.push({message:F.dupdeclaration(),range:Z.selectionRange,severity:te})}}}),me.forEach(Z=>{if(Z.children)return;let he=Z.static?J:z;if(!(q=he[ue=Z.name.toUpperCase()]))return Z.def===!1||(he[ue]=Z);if(!(q.typed===!0&&(Z.typed||!Z.children&&(q.typed=1)))){if(q.children&&(!Z.typed||Z.range.start.line<q.range.start.line)){let de=q;if(!de.val)return de.val=Z}Z.def!==!1&&fe.push({message:F.dupdeclaration(),range:Z.selectionRange,severity:te})}}),me.push(...Ue,...j.cache??[],...j.prototype.cache??[]),j.cache?.forEach(Z=>J[Z.name.toUpperCase()]??=Z),j.prototype.cache?.forEach(Z=>z[Z.name.toUpperCase()]??=Z),delete j.cache,delete j.prototype.cache}else{let j=H,z=j.declaration,J=j.has_this_param,me={},Ue={},we,Z=[];J?(Ce.THIS=z.THIS=Lo,Ce.SUPER=z.SUPER=cs,j.kind===R.SymbolKind.Function&&(Z=void 0)):Qm.includes(j.name.toLowerCase())&&h.diagnostics.push({message:F.reservedworderr(j.name),range:j.selectionRange,severity:te});for(let he of j.params??[])he.def=he.assigned=he.is_param=!0,he.name&&(Z?.push(he),he.defaultVal!==void 0||he.arr?ie=!0:ie&&fe.push({message:F.defaultvalmissing(he.name),range:he.selectionRange,severity:te}),(q=Ce[ue=he.name.toUpperCase()])?fe.push({message:F.conflictserr("parameter","parameter",q.name),range:he.selectionRange,severity:te}):Ce[ue]=z[ue]=me[ue]=he);for(let[he,de]of Object.entries(j.local??{}))(q=Ce[he])?fe.push({message:F.conflictserr(de.static?"static":"local","parameter",q.name),range:de.selectionRange,severity:te}):(z[he]=de,de.assigned||=!!de.returns);for(let[he,de]of Object.entries(j.global??{})){if(q=z[he]){if(Ce[he]){fe.push({message:F.conflictserr("global","parameter",q.name),range:de.selectionRange,severity:te});continue}let et=de.static?"static":"local";if(fe.push({message:F.conflictserr(...q.selectionRange.start.line<de.selectionRange.start.line?(q=de,["global",et]):[et,"global"],q.name),range:q.selectionRange,severity:te}),de!==q)continue;delete j.local[he]}z[he]??=de,h.declaration[he]??=de,de.assigned||=!!de.returns,de.is_global=!0}for(let he of j.children??=[])if(ue=he.name.toUpperCase(),he.kind===R.SymbolKind.Function){let de=he;if(de.static||(de.closure=!0),!ue)continue;if(z[ue]){if(q=Ce[ue]){fe.push({message:F.conflictserr("function","parameter",q.name),range:he.selectionRange,severity:te});continue}else if(q=j.global[ue]){if(fe.push({message:F.conflictserr(...q.selectionRange.start.line<he.selectionRange.start.line||q.selectionRange.start.line===he.selectionRange.start.line&&q.selectionRange.start.character<he.selectionRange.start.character?(q=he,["function","global"]):["global","function"],q.name),range:q.selectionRange,severity:te}),he===q)continue;delete j.global[ue],delete q.is_global,h.declaration[ue]===q&&delete h.declaration[ue]}else if(q=j.local[ue])if(q.selectionRange.start.line<he.selectionRange.start.line||q.selectionRange.start.line===he.selectionRange.start.line&&q.selectionRange.start.character<he.selectionRange.start.character){fe.push({message:F.conflictserr("function",q.kind===R.SymbolKind.Function?"Func":q.static?"static":"local",he.name),range:he.selectionRange,severity:te});continue}else q.static&&fe.push({message:F.conflictserr(q.kind===R.SymbolKind.Function?"function":"static",he.kind===R.SymbolKind.Function?"Func":"static",q.name),range:q.selectionRange,severity:te})}z[ue]=j.local[ue]=he}else he.kind===R.SymbolKind.Variable&&(((we=he).def?me:Ue)[ue]??=(we.assigned||=!!we.returns,he));if(j.children.unshift(...Z??[]),j.parent?.assume===2&&(j.assume??=2),j.assume===2){for(let[he,de]of Object.entries(me={...Ue,...me}))(q=z[he])?q.kind===R.SymbolKind.Function&&de.def?de.assigned!==1&&fe.push({message:F.assignerr("Func",q.name),range:de.selectionRange,severity:te}):q.kind===R.SymbolKind.Variable&&de.def&&de.kind===q.kind&&(q.def=!0,q.assigned||=!!de.returns):(h.declaration[he]??=j.global[he]=de,de.is_global=!0);Ue={}}else{let he=j.assume===1,de=j.kind!==R.SymbolKind.Function||!j.parent;for(let[et,$e]of Object.entries(me))delete Ue[et],(q=z[et])?q.kind===R.SymbolKind.Function?$e.assigned!==1&&fe.push({message:F.assignerr("Func",q.name),range:$e.selectionRange,severity:te}):q.kind===R.SymbolKind.Variable&&$e.def&&$e.kind===q.kind&&(q.def=!0,q.assigned||=!!$e.returns):(z[et]=$e,de?(j.local[et]=$e,$e.static=he):he&&($e.static=null))}me=Ue,Ue={};for(let he in me)z[he]||((Ue[he]=me[he]).def=!1);j.unresolved_vars=Ue;for(let he in me=j.local)me[he].def=!0;Ce=Object.assign(j.local,Ce),J&&(delete Ce.THIS,delete Ce.SUPER,delete z.THIS,delete z.SUPER)}}function Ve(){return V?(m=o,V=(o=Ot()).type!=="TK_EOF"):V=o.type!=="TK_EOF"}}function ht(T,A){T.extends=(A=A.trim()).replace(/^(.+[\\/])?/,N=>{if(N=N.slice(0,-1)){let L;if(N=N.replace(/\\/g,"/").toLowerCase(),N.endsWith(".ahk")||(N+=".d.ahk"),N.startsWith("~/"))L=pn.file(ni+N.slice(1));else if(/^([a-z]:)?\//.test(N))L=pn.file(N);else if(N.includes(":"))L=pn.parse(N);else{let K=(le.path+"/../"+N).split("/"),oe=[];K.shift();for(let o of K)if(o!=="..")oe.push(o);else if(!oe.pop())return"";L=le.with({path:oe.join("/")})}T.extendsuri=L.toString().toLowerCase()}return""}),!T.extendsuri&&T.extends.startsWith("#")&&(T.extendsuri=Zt[(T.extends=T.extends.substring(1)).toUpperCase()]?.uri??ln.ahk2)}function Vt(T){return T.replace(/%(a_scriptdir|a_workingdir)%/i,()=>(h.need_scriptdir=!0,h.scriptdir)).replace(/%a_linefile%/i,h.fsPath)}function it(T,A,N=0,L=!1){let K,oe=!1,o=T[0];if(`'"`.includes(o)&&T.endsWith(o)&&(T=T.slice(1,-1)),K=T.match(/^(\*[iI][ \t])?(.*)$/))if(oe=!!K[1],K=Vt(K[2]),A&&h[L?"dlldir":"includedir"].set((A.pos??=h.document.positionAt(A.offset)).line,L?l:b),!K.trim())L?l="":A&&h.addDiagnostic(F.pathinvalid(),A.offset,A.length);else if(L)(0,ar.existsSync)(K)&&(0,ar.statSync)(K).isDirectory()?l=K.endsWith("/")||K.endsWith("\\")?K:K+"\\":(K.match(/\.\w+$/)||(K=K+".dll"),K=Uu(K,[],l,!0)?.path??K,K.includes(":")?h.dllpaths.push(K.replace(/\\/g,"/")):h.dllpaths.push((l&&(0,ar.existsSync)(l+K)?l+K:K).replace(/\\/g,"/")));else{let m=K.startsWith("<");if(A){if(K.startsWith("*")){let Ft=Ir.get_RCDATA(A.content.substring(1));Ft?(v[Ft.uri]=Ft.path,A.data=[void 0,Ft.uri]):h.addDiagnostic(F.resourcenotfound(),A.offset,A.length,R.DiagnosticSeverity.Warning);return}else!(K=Uu(K,h.libdirs,b))||!(0,ar.existsSync)(K.path)?oe||h.addDiagnostic(K?F.filenotexist(K.path):F.pathinvalid(),A.offset,A.length):(0,ar.statSync)(K.path).isDirectory()?h.includedir.set(A.pos.line,b=K.path):(v[K.uri]=K.path,A.data=[K.path,K.uri]);N!==0&&h.addDiagnostic(F.unsupportinclude(),A.offset,A.length,R.DiagnosticSeverity.Warning)}else(K=ot(K))&&(v[K.uri]=K.path);h.need_scriptdir||=m&&(!K||K.path.toLowerCase().startsWith(h.libdirs[0].toLowerCase()))}else T&&A&&h.addDiagnostic(F.pathinvalid(),A.offset,A.length)}function ot(T){T.startsWith("<")?T=T.replace(/(\.d)?>$/i,".d>"):T=T.replace(/(\.d\.ahk)?$/i,".d.ahk");let A=Uu(T,h.libdirs,h.scriptpath,!0,{...On,locale:ds});if(A&&!(0,ar.statSync)(A.path).isDirectory())return A}function Le(T,A){return A?(T&&T+`

`)+A:T}function je(T,A){let N=A.content;if(N.startsWith(";")){T.detail=A.data??=N.replace(/^[ \t]*; ?/gm,"");return}if(!/^\/\*\*(?!\/)/.test(N)){T.detail=A.data??=N.replace(new RegExp(`^${d.substring(d.lastIndexOf(`
`,A.offset)+1,A.offset)}`,"gm"),"").replace(/^\/\*\s*\n|\s*\*+\/$/g,"");return}if(!A.data)A.data=xt(h,N,T);else{let{detail:L,ignore:K,tags:oe,vars:o}=A.data,m=o&&(o[T.name.toUpperCase()]??o[""]);K&&(T.ignore=K),oe&&(T.tags=oe),T.markdown_detail=Le(m?.detail??"",L),m&&(T.type_annotations=m.type_annotations??=Hi(m.type_str))}}function xt(T,A,N){if(N.detail=A,A=A.replace(/^[ \t]*(\*?[ \t]*(?=@)|\* ?)/gm,"").replace(/^\/\*+\s*|\s*\**\/$/g,""),!A)return{detail:N.markdown_detail=N.detail=""};let L=[],K=[],oe,o="",m,Ft=N,V={},ue={},ne=ce=>{},ee,E,We,gt={[R.SymbolKind.Variable]:"var",[R.SymbolKind.Property]:"prop"}[N.kind];if(Ft.params){let ce=Ft.params;ne=ke=>{if(!/^d/.test(ke))return ue[ke]??=ce.find(Ge=>ke===Ge.name.toUpperCase()&&!(Ge.markdown_detail=""))??((Ft.overload_params??={})[ke]={type_annotations:!1,markdown_detail:""})}}for(let ce of A.split(/\n(?=@)/)){if(!(ee=ce.match(/^@(\w*)/))){L.push(ce);continue}switch(m=ee[1].toLowerCase(),ce=ce.substring(m.length+1),We&&!m.startsWith("prop")&&(We=void 0),m){case"arg":case"argument":m="param";case"param":case"prop":case"property":case"var":if(ce=Ee(ce),ee=ce.match(/^\s*(\[(\w|[^\x00-\x7f]|(\[\])?\.)*.*?\]|(\w|[^\x00-\x7f]|(\[\])?\.)*)/)){let ke="",Ge=ee[1]??="",Te=!1,ft=()=>Te?`<u>\`${Ge}\`</u>`:`\`${Ge}\``;if(ce=ce.substring(ee[0].length),Ge.startsWith("[")&&(Ge.slice(1,-1).replace(/^((\w|[^\x00-\x7f]|(\[\])?\.)*)(.*)$/,(...dt)=>((Ge=dt[4].trimStart()).startsWith("=")&&(ke=Ge.substring(1).trim()),Ge=dt[1])),Te=!0),m==="param"){if(E=ne(Ge.replace(/(\[\])?\..*$/,"").toUpperCase()),E?.name?.length===Ge.length)Te=E.defaultVal!==void 0,E.type_annotations??=Hi(o);else if(E?.name){let dt=Ge.split(".");Me(vt(E,dt.shift()),dt,o,`*@param* ${ft()}${o&&`: *\`${o}\`*`}${ce.trim()&&`
___
${ce}`}`),E.markdown_detail||(E=void 0)}m=`*@param* ${ft()}${o&&`: *\`${o}\`*`}${ke&&` := \`${ke}\``}${Xe(ce)}`,L.push(m),E&&(E.markdown_detail+=`${m}

`);continue}else if(m.startsWith("prop"))m="property",We??=V[""]??=Kt(),Me(vt(We,We.name),Ge.split("."),o,`*@${m}* ${ft()}${o&&`: *\`${o}\`*`}${ke&&` := \`${ke}\``}${ce.trim()&&`
___
${ce}`}`);else if(gt==="var"){ce=ce.trimStart(),N.name.toLowerCase()===Ge.toLowerCase()?(N.type_annotations??=Hi(o),(oe??={})[Ge.toUpperCase()]??={detail:ce,type_annotations:N.type_annotations},N.markdown_detail??=ce):(oe??={})[Ge.toUpperCase()]??={detail:ce,type_str:o};continue}ce=Xe(ce),L.push(m=`*@${m}* \`${Ge}\`${o&&`: *\`${o}\`*`}${ke&&` := \`${ke}\``}${ce}`)}continue;case"return":case"returns":case"type":ce=Ee(ce),L.push(`*@${m}*${o&&` *\`${o}\`*`}${Xe(ce)}`),!gt||N.get?(gt||m!=="type")&&(N.type_annotations??=Hi(o)):m==="type"&&((oe??={})[""]??={detail:ce,type_annotations:Hi(o)},L.pop());continue;case"enum":case"throws":ce=Ee(ce),L.push(`*@${m}*${o&&` *\`${o}\`*`}${Xe(ce)}`);continue;case"typedef":ce=Ee(ce),ee=ce.match(/^\s*(\$?(\w|[^\x00-\x7f])*)/),(m=ee[1])&&(T.typedef[m.toUpperCase()]??=We={name:m,kind:R.SymbolKind.TypeParameter,range:bn,selectionRange:bn,type_annotations:Hi(o)}),L.push(`*@typedef* \`${m}\`: *\`${o||"Any"}\`*${Xe(ce.substring(ee[0].length))}`);continue;case"overload":if(!(ee=ce.match(/^\s*(\w|[^\x00-\x7f])*(?=[([])/)))break;K.push(`${N.name||"_"}${ce.substring(ee[0].length).trimEnd()}`);continue;case"example":L.push("*@example*"),(ce=ce.replace(/^\s*<caption>(.*?)<\/caption>/,(ke,Ge)=>(L.push(Ge),"")).replace(/^[ \t\r\n]+/,""))&&L.push("```ahk2\n"+ce+"\n```");continue;case"extends":m="*@extends* ",(ee=ce.match(/^\s*{([^{}]+)}/))&&(N.kind===R.SymbolKind.Class&&ht(N,ee[1]),m+=`\`${ee[1]}\``,ce=ce.substring(ee[0].length)),L.push(`${m}${Xe(ce)}`);continue;case"ignore":N.ignore=!0;break;case"deprecated":N.tags??=[1];break;case"alias":if(N.kind===R.SymbolKind.Class&&(o=ce.trim()).endsWith(">")&&o.startsWith(N.name+"<")){let ke=new e(Hn.create("","ahk2",0,`class ${o}{
}`),void 0,1);ke.parseScript();let Ge=ke.declaration[N.name.toUpperCase()]?.type_params;Ge&&(N.type_params=Ge,Object.values(Ge).forEach(Te=>Te.range=Te.selectionRange=bn))}break}L.push(`*@${m}*${Xe(ce)}`)}if(gt){let ce=oe?.[""]?.type_annotations;!ce&&(m=V[""])&&(((oe??={})[""]??={detail:""}).type_annotations=ce=[m]),N.type_annotations??=ce}else Ft.params&&(m=K.join(`
`))&&(N.overloads=m);return A=L.join(`

`),N.markdown_detail=Le(N.markdown_detail??"",A),{detail:A,ignore:N.ignore,tags:N.tags,vars:oe};function Xe(ce){ce=ce.replace(/^[ \t]*[-]/,"");let ke=0,Ge=0,Te=0;for(let ft of ce)switch(Te++,ft){case`
`:if(ke>1||++Ge===2)return ce;case"	":ke=0;break;case" ":ke++;break;case"\r":break;default:if(Ge){let dt=!1;if(ft==="|"||ft===">"||"-+*".includes(ft)&&" 	".includes(ce[Te])||ce.substring(Te-1,Te+2)==="```")dt=!0;else if(ft==="#"){for(;ce[Te]==="#";Te++);dt=" 	".includes(ce[Te])}else if(ft!=="."){for(;ft>="0"&&ft<="9";ft=ce[Te++]);dt=ft==="."&&" 	".includes(ce[Te])}if(dt)return`
${ce}`}return` \u2014 ${ce}`}return""}function Kt(ce=""){return{kind:R.SymbolKind.Class,name:ce,full:"",extends:"",uri:"",property:{},range:bn,selectionRange:bn}}function zt(ce,ke,Ge){for(let Te=ce.length-1;Te>=0;Te--)ke.includes(ce[Te])&&ce.splice(Te,1);return Ge&&ce.push(Ge),Ge}function vt(ce,ke){let Ge=ke.endsWith("]")&&(ke=ke.slice(0,-2),!0),Te=V[ke=ke.toUpperCase()]??=zt(ce.type_annotations||=[],[Cr],Kt(ce.name));return Ge?V[`${ke}[]`]??=(Te.extends||="Array",zt(ce.type_annotations||[],[tc]),zt((Te.generic_types??=[])[0]??=[],[Cr],Kt())):Te}function Me(ce,ke,Ge,Te){let ft=ce.name.toUpperCase(),dt=ke.length;for(let Tt of ke){let Ct=0,gn;for(;Tt.endsWith("]");)Tt=Tt.slice(0,-2),Ct++;if(ft+=`.${gn=Tt.toUpperCase()}`,dt--,ce=V[ft]??=ce.property[gn]??={kind:R.SymbolKind.Property,name:Tt,range:bn,selectionRange:bn},Ct||dt)do ce=V[ft+"."]??=zt(ce.type_annotations||=[],[Cr],Kt()),Ct&&(ce=V[ft+="[]"]??=(ce.extends||="Array",zt((ce.generic_types??=[])[0]??=[],Ct>1?[Cr,tc]:[Cr],Kt())),Ct--);while(Ct)}ce.property||(ce.markdown_detail??=Te,ce.type_annotations??=Hi(Ge))}function Ee(ce){let ke=ce.match(/^\s*\{/);if(o="",!ke)return ce;let Ge=1,Te=ke[0].length,ft=Te;for(;Ge;)switch(ce[Te++]){case"{":Ge++;continue;case"}":Ge--;continue;case void 0:return ce;case'"':case"'":{let dt=ce[Te-1],Tt;for(;(Tt=ce[Te++])!==dt;)if(Tt==="`")Te++;else if(!Tt||Tt===`
`)return ce;break}}return o=ce.substring(ft,Te-1).trim(),ce.substring(Te)}}function be(T,A){return R.Range.create(h.document.positionAt(T),h.document.positionAt(T+A))}function tt(T,A,N,L,K){let oe=d.charAt(N-1),o={content:T,type:A,offset:N,length:L,topofline:K,previous_token:g,next_token_offset:-1,prefix_is_whitespace:Vn.includes(oe)?oe:void 0};return h.tokens[N]=o,g.next_token_offset=N,o}function Mt(T,A){let N=0,L=0,K,oe="",o="",m,Ft,V=[nt.ArrayLiteral,nt.Expression,nt.ObjectLiteral].includes(A);return T&&(N=T.indentation_level,L=T.had_comment,oe=T.last_text,o=T.last_word,V||=T.in_expression,m=T.array_style,Ft=T.object_style),{array_style:m,case_body:!1,catch_block:!1,declaration_statement:!1,else_block:!1,finally_block:!1,had_comment:L,if_block:!1,in_case_statement:!1,in_case:!1,in_expression:V,indentation_level:N,last_text:oe,last_word:o,loop_block:0,mode:A,object_style:Ft,parent:T,start_line_index:De.length,ternary_depth:K,try_block:!1}}function Ye(){return{text:[],indent:0}}function qe(){if(c!==!1)return;let T=De.pop();for(;T?.text.length===0;)T=De.pop();T&&De.push(T),S.had_comment&&De.push(Ye())}function O(){return De.at(-1).text.length===0}function re(T=!1){if(Pe.wrap_line_length&&!T){let A=De.at(-1),N=0;A.text.length>0&&(N=A.text.join("").length+ut.length+(Je?1:0),N>=Pe.wrap_line_length&&(T=!0))}(Pe.preserve_newlines&&D||T)&&!O()&&ae(!0)}function ae(T=!1){if(!T&&(T===null||!xn(Fe.previous_token??pt,pt))){for(;S.mode===nt.Statement;)Ze();S.if_block=S.try_block=S.catch_block=!1,S.loop_block=0}O()||De.push(Ye())}function xe(T){let A=De.at(-1);A.text.length?Je&&A.text.push(" "):(rn&&A.text.push(rn),S.indentation_level=N(S.indentation_level)),Je=void 0,A.text.push(T??ut);function N(L){if(L){for(let K=De.length-2;K>=0;K--)if(De[K].text.length){L=Math.min(De[K].indent+1,L);break}A.text.push(yn.repeat(A.indent=L))}return L}}function yt(){S.indentation_level+=1}function Pt(){S.indentation_level>0&&(!S.parent||S.indentation_level>S.parent.indentation_level)&&(S.indentation_level-=1)}function _t(T){S?(Lt.push(S),Et=S):Et=Mt(void 0,T),S=Mt(Et,T)}function Ze(){Lt.length>0&&(Et=S,S=Lt.pop())}function lt(){return S.parent.mode===nt.ObjectLiteral&&S.mode===nt.Statement&&S.last_text===":"&&!S.ternary_depth}function qt(){if(rt==="TK_RESERVED"&&["try","else","finally"].includes(S.last_text)||rt==="TK_END_EXPR"&&Et.mode===nt.Conditional||rt==="TK_WORD"&&S.mode===nt.BlockStatement&&(!D&&Fe.previous_token?.callsite||!S.in_case&&!["TK_WORD","TK_RESERVED","TK_START_EXPR"].includes(Bt)&&!["--","++","%"].includes(ut))||S.declaration_statement&&(!y||xn(Fe.previous_token??pt,Fe))||S.mode===nt.ObjectLiteral&&S.last_text===":"&&!S.ternary_depth){switch(_t(nt.Statement),yt(),S.last_word){case"if":case"for":case"loop":case"while":case"catch":ae(!0);case"try":case"finally":case"else":S.declaration_statement=!0;break}return!0}return!1}function It(T){return["break","continue","global","goto","local","return","static","throw"].includes(T)}function tn(T){let A=u,N=d.charAt(A);for(;N!==T&&Vn.includes(N)&&++A<w;)N=d.charAt(A);return N===T?A:0}function Ot(T=0){let A;do A=jt(T);while(A.type.endsWith("COMMENT"));return A}function jt(T=0){let A,N,L,K=0,oe=u;for(y=0;Vn.includes(N=d.charAt(u++));)if(N===`
`)C=u-1,y+=1,r=!0;else if(u>=w)return V(),Ft(),h.tokens[-1]??={content:"",type:"TK_EOF",offset:w,length:0,topofline:xn(g,pt)?-1:1,next_token_offset:-1,previous_token:g};let o=u-1,m=h.tokens[o];if(m&&m.length){let ue=!1;if((r=!!(m.topofline&&m.type.endsWith("_BLOCK")))&&(C=o),u=m.skip_pos??o+m.length,g=m,m.ignore?m.type==="TK_START_EXPR"?(c=!0,ue=!Re):m.type==="TK_END_EXPR"?(c=null,ue=!Re):m.type.endsWith("COMMENT")&&(g=m.previous_token??pt):m.type.endsWith("COMMENT")&&(g=m.previous_token??pt),!Re){let ne=m.previous_extra_tokens,ee=m;if(ne&&(oe<o&&(ne.i=0),ne.i<ne.len?(m=ne.tokens[ne.i++],u=o):ne.i=0),ue&&ee===m)return jt()}return m}if(r){r=!1,K=1;let ue=d.indexOf(`
`,u);ue<0&&(ue=w);let ne=d.substring(C+1,ue).trim().replace(/(^|[ \t]+);.*$/,"");if(ne.includes("::")&&(Ne||!`"'`.includes(ne[0])||!["TK_EQUALS","TK_COMMA","TK_START_EXPR"].includes(g.type))){if(L=ne.match(/^(:([^:]*):(`.|[^`])*?::)(.*)$/i)){let ee;if((ee=/x(?!0)/i.test(L[2]))||/^[ \t]*\{?$/.test(L[4])||(ee=h.hotstringExecuteAction&&!/x0/i.test(L[2]))?(u+=L[1].length-1,g=tt(L[1],"TK_HOT",o,L[1].length,1)):(C=ue,u=o+L[0].length,g=tt(L[1],"TK_HOTLINE",o,L[1].length,1),o+=L[1].length,g.skip_pos=u,g.data={content:d.substring(o,u),offset:o,length:u-o},h.tokenranges.push({start:o,end:u,type:3,previous:g.offset})),g.ignore=!0,Ft(),L[3]||h.addDiagnostic(F.invalidhotdef(),g.offset,g.length),g.type==="TK_HOTLINE"||!ee&&!/^[ \t]*\{/.test(L[4])){if(T>5)return delete h.tokens[g.offset],g;ct=ee=!0;let E=g,We=Ot(T+1),gt;for(;We.ignore&&We.type==="TK_STRING";){if((u=d.indexOf(`
`,gt=u))<0&&(u=w),gt<u){let Xe=d.substring(gt,u).trimEnd();We.content+=Xe,We.length+=Xe.length}h.tokenranges.push({start:We.offset,end:We.offset+We.length,type:3}),ee=!1,We=Ot(T+1)}ct=!1,g=E,!ee&&g.type==="TK_HOT"?(g.type="TK_HOTLINE",g.skip_pos=u=o+L[0].length,o+=L[1].length,g.data={content:d.substring(o,u),offset:o,length:u-o},h.tokenranges.push({start:o,end:u,type:3,previous:g.offset})):u=E.skip_pos??E.offset+E.length}return g}else if(L=ne.match(/^(((([<>$~*!+#^]*?)(`?;|[\x21-\x3A\x3C-\x7E]|[^\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]+))|~?(`?;|[\x21-\x3A\x3C-\x7E]|[^\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]+)[ \t]*&[ \t]*~?(`?;|[\x21-\x3A\x3C-\x7E]|[^\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]+))([ \t]+up)?[ \t]*::)(.*)$/i)){let ee=L[9].match(/^([ \t]*)(([<>~*!+#^]*?)(`[{;]|[a-z]\w+|[^{]))$/i);if(Ft(),ee){let E=ee[4].toLowerCase();if(E.length===1||!/^joy|^pause$/.test(E)&&r_.test(E))return C=ue,u=o+L[0].length,g=tt(L[1].replace(/[ \t]+/g," "),"TK_HOTLINE",o,L[1].length,1),o+=g.length+ee[1].length,g.skip_pos=u,g.data={content:L[9].trim(),offset:o,length:u-o,data:ee[2]},h.tokenranges.push({start:o,end:u,type:3,previous:g.offset}),g}return u=d.indexOf("::",u)+2,g=tt(L[1].replace(/[ \t]+/g," "),"TK_HOT",o,L[1].length,1)}}N!=="#"&&Ft()}if(Nn(N.charCodeAt(0))||N==="$"&&ge){for(;u<w&&Nn(d.charCodeAt(u));)N+=d.charAt(u),u+=1;if(d.charAt(o-1)!=="."){if(L=N.match(/^(\d+[Ee](\d+)?|(0[Xx][\da-fA-F]+)|(\d+))$/)){if(L[2]||L[3])return g=tt(N,"TK_NUMBER",o,N.length,K),g.data=!!L[2],g.semantic={type:8},g;if(L[4]){let ue;if(u<w&&d.charAt(u)==="."){let ne="",ee="",E=u+1;for(;E<w&&Nn(d.charCodeAt(E));)ne+=d.charAt(E),E+=1;if(ne.match(/^\d*([Ee]\d+)?$/))return N+="."+ne,u=E,g=tt(N,"TK_NUMBER",o,N.length,K),g.data=!0,g.semantic={type:8},g;if(ne.match(/^\d*[Ee]$/)&&E<w&&"-+".includes(d.charAt(E))){for(ne+=d.charAt(E),E+=1;E<w&&Nn(d.charCodeAt(E));)ee+=d.charAt(E),E+=1;ee.match(/^\d+$/)&&(N+="."+ne+ee,u=E)}ue=!0}return g=tt(N,"TK_NUMBER",o,N.length,K),g.data=ue,g.semantic={type:8},g}else if(u<w&&"-+".includes(d.charAt(u))){let ue=d.charAt(u),ne=u,ee;if(u+=1,ee=jt(T+1),delete h.tokens[ee.offset],ee.type==="TK_NUMBER"&&ee.content.match(/^\d+$/))return N+=ue+ee.content,g=tt(N,"TK_NUMBER",o,N.length,K),g.data=!0,g.semantic={type:8},g;u=ne}}if(Qm.includes(A=N.toLowerCase())){if(/^(and|or|not|in|is|contains)$/.test(A))return g=tt(N,"TK_OPERATOR",o,N.length,K);if(K||A!=="class")return g=tt(N,"TK_RESERVED",o,N.length,K)}}return g=tt(N,"TK_WORD",o,N.length,K)}if(N==="("||N==="["){if(N==="("&&K&&!c){let ue=u,ne=ue,ee;for(;ue<w;)if((ee=d.charAt(ue++))===`
`)if(ct){let E=d.indexOf(`
`,ue),We=null,gt=C+1,Xe=[];for(;E>0&&!(We=d.substring(ue,E).match(/^[ \t]*\)/));)Xe.push(E-ue),E=d.indexOf(`
`,ue=E+1);return E<0&&(Xe.push(w-ue),We=d.substring(ue,w).match(/^[ \t]*\)/)),u=We?ue+We[0].length:w,Xe.push(u-ue),A=d.substring(o,u).trimEnd(),g=tt(d.substring(gt,o)+A,"TK_STRING",o,A.length,1),h.addFoldingRange(gt,u,"block"),g.data=Xe,g.ignore=!0,g}else{let E=!g.type||g.type==="TK_START_BLOCK"&&g.topofline>0;for(g=tt(N,"TK_START_EXPR",o,1,1),g.ignore=!0,u=ue-1,c=!0;" 	".includes(d.charAt(++o)||"\0"););let We=d.substring(o,u).trimEnd();g.data={content:We,offset:o,length:u-o},g.skip_pos=u,h.tokenranges.push({start:o,end:u,type:3,previous:g.offset});let gt=We.match(/(^|[ \t])join([^ \t]*)/i),Xe=/(^|[ \t])[Cc]/.test(We),Kt=g,zt=Re,vt=g,Me=!1,Ee=u,ce=0,ke,Ge=()=>{};if(gt){let Te=gt[2].replace(/`[srn]/g,"  "),ft=new e(Hn.create("","ahk2",-10,Te)),dt=!1;ft.parseScript(),delete ft.tokens[-1];let Tt=Object.values(ft.tokens);o+=4+gt[1].length+gt.index,Tt.length&&(dt=Vn.includes(Te.charAt(Te.length-1)),Tt.forEach(Ct=>{Ct.offset+=o,Ct.length=0,Ct.next_token_offset=-1}),Ge=(Ct,gn)=>{let Jr=[];for(let $t=0;$t<Ct;$t++){gn=d.indexOf(`
`,gn+1);for(let Kr of Tt)Kr={...Kr},Kr.offset=gn,Jr.push(Kr)}return{i:0,len:Jr.length,tokens:Jr,suffix_is_whitespace:dt}},",)]}".includes(Tt[0].content)&&(Me=!0))}for(Re=!0,ke=jt(),c&&ke.type!=="TK_EOF"&&(Xe&&ke.topofline&&ke.type.endsWith("COMMENT")?ce=y-2:(y>1&&(ke.previous_extra_tokens=Ge(y-1,Ee)),ke.topofline=E?1:0),Ee=C,vt=ke,ke=jt());c&&ke.type!=="TK_EOF";)ke.topofline&&(Xe&&ke.type.endsWith("COMMENT")?ce+=y-1:((ce+=y)&&(ke.previous_extra_tokens=Ge(ce,Ee)),ke.topofline=ce=0,Me&&vt.content==="?"&&(vt.ignore=!0)),Ee=C),vt=ke,ke=jt();return ke.ignore&&ke.type==="TK_END_EXPR"&&(y>1&&(ke.previous_extra_tokens=Ge(y-1,Ee)),Kt.next_pair_pos=ke.offset,ke.previous_pair_pos=Kt.offset,h.addFoldingRange(Kt.offset,ke.offset,"block")),u=Kt.skip_pos,g=(Re=zt)?Kt:jt()}else if(ee===")"||ee==="("){if(ue-ne<5||d.substring(ne,ne+4).toLowerCase()!=="join")break}else(ee===" "||ee==="	")&&(ne=ue)}return g=tt(N,"TK_START_EXPR",o,1,K)}if(N===")"||N==="]")return g=tt(N,"TK_END_EXPR",o,1,K),N===")"&&K&&c?(c=!1,g.ignore=!0,Re?g:jt()):g;if(N==="{"&&(A="TK_START_BLOCK")||N==="}"&&(A="TK_END_BLOCK"))return K&&(C=o,r=!0),g=tt(N,A,o,1,K);if(N==='"'||N==="'"){let ue=N,ne=o,ee={type:7},E=!1,We,gt;if(A="",!/^[ \t\r\n+\-*/%:?~!&|^=<>[({,.]$/.test(N=d.charAt(o-1))){let Xe=F.missingspace(),Kt=o;ue===N&&(N==="'"||!Ae(g)?(Xe=F.didyoumean(`\`${N}`),Kt--):(Xe="",o=g.offset,g=g.previous_token,h.tokenranges.pop())),Xe&&h.addDiagnostic(Xe,Kt,1)}for(;N=d.charAt(u++);)if(N==="`")u++;else{if(N===ue)return A+=d.substring(o,u),g=tt(A,"TK_STRING",o,u-o,K),h.tokenranges.push({start:o,end:u,type:2}),E&&(g.data=null,g.semantic=ee),We&&(g=We,u=g.offset+g.length),Nn(d.charCodeAt(u))&&h.addDiagnostic(F.missingspace(),u),g;if(c){if(N===`
`){let Xe=u-1;for(;" 	".includes(N=d.charAt(u)||"\0");)u++;if(N===")"){A=d.substring(o,Xe).trimEnd(),g=tt(A,"TK_STRING",o,A.length,K=0),We??=g,A="",h.tokenranges.push({start:o,end:o+g.length,type:3});let Kt=g.previous_token;for(;Kt&&(!Kt.ignore||Kt.content!=="(");)Kt=Kt.previous_token;for(h.addFoldingRange(o,Xe,"string"),g=tt(")","TK_END_EXPR",u,1,1),g.ignore=!0,Kt&&(Kt.next_pair_pos=u,g.previous_pair_pos=Kt.offset),c=!1,E=!0,o=++u;" 	".includes(N=d.charAt(u)||"\0");)u++;A=d.substring(o,u),o=u}}}else if(N===`
`||N===";"&&" 	".includes(d.charAt(u-2))){A=(A+d.substring(o,u-(N===";"?2:1))).trimEnd(),--u,A&&(g=tt(A,"TK_STRING",o,A.trimStart().length,K),h.tokenranges.push({start:o,end:o+g.length,type:3}),E&&(g.data=null,g.semantic=ee),We??=g,A="");break}}if(N){if(T>5)return g=We,u=g.offset+g.length,delete h.tokens[g.offset],g;ct=Ne=!0;let Xe=Ot(T+1);e:for(;Xe.ignore&&Xe.type==="TK_STRING";){let Kt=u,zt=Xe.data;for(E&&(Xe.semantic=ee);N=d.charAt(u++);)if(N==="`")u++;else if(N===ue){let vt=d.substring(Kt,u);Xe.content+=vt,Xe.length+=vt.length,zt[zt.length-1]+=vt.length,h.tokenranges.push({start:Xe.offset,end:Xe.offset+Xe.length,type:3}),Nn(d.charCodeAt(u))&&h.addDiagnostic(F.missingspace(),u);break e}else if(N===`
`||N===";"&&" 	".includes(d.charAt(u-2))){let vt=d.substring(Kt,u-(N===";"?2:1)).trimEnd();vt&&(Xe.content+=vt,Xe.length+=vt.length,zt[zt.length-1]+=vt.length),h.tokenranges.push({start:Xe.offset,end:Xe.offset+Xe.length,type:3}),u--;break}if(!N){let vt=d.substring(Kt,--u);vt&&(Xe.content+=vt,Xe.length+=vt.length),h.tokenranges.push({start:Xe.offset,end:Xe.offset+Xe.length,type:3})}Xe=Ot(T+1)}return(!Xe.ignore||Xe.type!=="TK_STRING")&&((gt=Xe.previous_token)?h.addDiagnostic(F.unterminated(),gt.offset+gt.length,1):h.addDiagnostic(F.missing(ue),ne,1)),ct=!1,g=We,u=g.offset+g.length,g}else return h.addDiagnostic(F.unterminated(),w,1),A+=d.substring(o,w),g=tt(A,"TK_STRING",o,w-o,K),h.tokenranges.push({start:o,end:w,type:3}),E&&(g.data=null,g.semantic=ee),c&&(h.addFoldingRange(o,w,"string"),c=!1),g}if(N==="."){let ue=d.charAt(u);if(ue==="=")return u++,g=tt(".=","TK_EQUALS",o,2,K);if(Vn.includes(d.charAt(u-2))&&Vn.includes(ue))return g=tt(N,"TK_OPERATOR",o,1,K);if(ue.match(/\d/)&&["TK_EQUALS","TK_OPERATOR","TK_COMMA","TK_START_EXPR"].includes(g.type)){let ne=u+1,ee="";for(;ne<w&&Nn(d.charCodeAt(ne));)ue+=d.charAt(ne),ne+=1;if(ue.match(/^\d+([Ee]\d+)?$/))return u=ne,N+=ue,g=tt("0"+N,"TK_NUMBER",o,N.length,K),g.data=!0,g.semantic={type:8},g;if(ne<w&&ue.match(/^\d+[Ee]$/)&&"-+".includes(d.charAt(ne))){for(ue+=d.charAt(ne),ne+=1;ne<w&&Nn(d.charCodeAt(ne));)ee+=d.charAt(ne),ne+=1;if(ee.match(/^\d+$/))return u=ne,N+=ue+ee,g=tt("0"+N,"TK_NUMBER",o,N.length,K),g.data=!0,g.semantic={type:8},g}}return g=tt(N,/[%([]|[^\x00-\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\x7f]/.test(ue)?"TK_DOT":"TK_UNKNOWN",o,1,K)}if(N===";"){let ue=K&&`
`.includes(d.charAt(C))?"TK_COMMENT":(K=0,"TK_INLINE_COMMENT"),ne="",ee,E,We,gt=o-1,Xe,Kt=0,zt=!0;for(;;){if(u=gt,gt=d.indexOf(`
`,u+1),Xe=d.substring(u+1,gt=gt<0?w:gt).trim(),Xe.startsWith(";")){if(Kt++,ee=Xe.match(/^;\s*@/)){if(Kt>1)break;let Me=Xe.substring(ee[0].length).replace(/\s+;.*$/,"").toLowerCase();if(ee=Me.match(/^([-.\w]+)(?=(\s|$))/))switch(ee[1]){case"include":(Me=Me.substring(ee[1].length).trimStart())&&it(Me);break;case"include-winapi":W&&(ee=se[ln.winapi])&&Object.defineProperty(v,ln.winapi,{value:ee.fsPath,enumerable:!1});break;case"reference":h.d_uri||=Me.substring(ee[1].length).trimStart();break;case"lint-disable":case"lint-enable":Me=Me.substring(ee[1].length).trimStart(),Me==="class-non-dynamic-member-check"&&(ee[1]==="lint-enable"?delete(p??h).checkmember:(p??h).checkmember=!1);break}We=!0}else if(ee=Xe.match(/^;+\s*([{}])/)){if(zt=!1,ee[1]==="{"?f.bracket.push(u+1):(ee=f.bracket.pop())!==void 0&&h.addFoldingRange(ee,u+1,"block"),Kt===1&&(We=!0),K&&!We)continue;u=gt;break}if((ee=Xe.match(/^;\s*(~?\s*|@)(todo|fixme)(:?\s*)(.*)/i))&&(h.children.push(R.DocumentSymbol.create(`${ee[2].toUpperCase()}: ${ee[4].trim()}`,void 0,R.SymbolKind.Module,E=be(u+1,gt-u-1),E)),K))continue;if(K){if(ee=Xe.match(/^;\s*[@#](end)?region\b/i))We=!0,zt=!1,V(),ee[1]?(ee=f.region.pop())!==void 0&&h.addFoldingRange(ee,u+1,"region"):(f.region.push(u+1),(Xe=Xe.substring(ee[0].length).trim())&&h.children.push(R.DocumentSymbol.create(Xe,void 0,R.SymbolKind.Module,E=be(u+1,gt-u-1),E)));else if(ee=Xe.match(as)){let Me=ee.groups;for(let Ee in Me)if(Ee.startsWith("tag")&&(ee=Me[Ee]?.trim()))break;typeof ee!="string"&&(ee=ee[1]?.trim()),ee&&(h.children.push(R.DocumentSymbol.create(ee,void 0,R.SymbolKind.Module,E=be(u+1,gt-u-1),E)),We=!0)}if(!We)continue}u=gt}break}ne=d.substring(o,u).trimEnd(),h.tokenranges.push({start:o,end:u,type:1});let vt=h.tokens[o]={type:ue,content:ne,offset:o,length:ne.length,next_token_offset:-1,topofline:K,ignore:We,skip_pos:u,previous_token:g};if(!K)Vn.includes(d.charAt(o-1))||h.addDiagnostic(F.unexpected(vt.content),o,vt.length);else{let Me=h.document.positionAt(u).line;!ct&&!We&&Xe[0]&&!Xe.startsWith("/*")&&(a[Me+1]=vt),$&&(g.pos??=h.document.positionAt(g.offset)).line>$.endLine&&V(),$?$.endLine=Me:zt&&($=R.FoldingRange.create(h.document.positionAt(o).line,Me,void 0,void 0,"comment"))}return vt}if(N==="/"&&K&&d.charAt(u)==="*"){let ue=d.indexOf(`
`,--u),ne=0,ee="";for(;!(L=d.substring(u,ue>0?ue:w).match(/(^[ \t]*\*\/)|\*\/([ \t]*\r?)$/))&&ue>0;)C=ue,ue=d.indexOf(`
`,u=ue+1),ne++;L?.[1]?(u=d.indexOf("*/",C)+2,r=!0,C=u-1):u=(ue<0?w:ue)-(L?.[2].length??(ee="*/",0)),h.tokenranges.push({start:o,end:u,type:1});let E={type:"TK_BLOCK_COMMENT",content:d.substring(o,u)+ee,offset:o,length:u-o,next_token_offset:-1,previous_token:g,topofline:K,skip_pos:u};if(!ct){let We=u,gt=0;for(;" 	\r".includes(N=d[We]??"\0")||N===`
`&&++gt<2;We++);(d[o+2]==="*"&&d[o+3]!=="/"&&!(E.data=null)||!`
\0`.includes(N))&&(a[h.document.positionAt(We).line]=E)}return V(),h.tokens[o]=E,ne&&h.addFoldingRange(o,u,"comment"),E}if(Xm.includes(N)){if(ge&&"<>".includes(N))return g=tt(N,N==="<"?"TK_START_EXPR":"TK_END_EXPR",o,N.length,K);for(;u<w&&Xm.includes(N+d.charAt(u))&&(N+=d.charAt(u),u+=1,!(u>=w)););if(N===",")return g=tt(N,"TK_COMMA",o,1,K);if(N==="?"){g=tt(N,"TK_OPERATOR",o,1,K);let ue=u,ne=g,ee=Ot(T+1);return u=ue,(")]},:??".includes(ee.content)||ee.content==="."&&ee.type!=="TK_OPERATOR")&&(ne.ignore=!0,ee.content.startsWith(".")&&or<xr-1&&h.addDiagnostic(F.requireversion("2.1-alpha.2"),ne.offset,ne.length,R.DiagnosticSeverity.Warning)),g=ne}else N==="??="&&or<xr-1&&h.addDiagnostic(F.requireversion("2.1-alpha.2"),o,N.length,R.DiagnosticSeverity.Warning);return g=tt(N,N.match(/([:.+\-*/|&^]|\/\/|>>|<<|\?\?)=/)?"TK_EQUALS":"TK_OPERATOR",o,N.length,K)}if(N==="#"){let ue="#";for(;Nn((N=d.charAt(u)).charCodeAt(0));)ue+=N,u++;if(B.push(o),g=tt(ue,"TK_SHARP",o,ue.length,K),Rt=ue.toLowerCase(),K&&Vn.includes(N)&&(Rt==="#hotif"||W&&Rt==="#initexec"))return g;if(C=d.indexOf(`
`,o=u),u=C<0?w:C,K&&Vn.includes(N)){if(N===" "||N==="	"){for(;" 	".includes(d.charAt(o)||"\0");)o++;let ne=d.substring(o,u).trimEnd().replace(/(^|[ \t]+);.*$/,"");g.data={content:ne,offset:o,length:ne.length},u=o+ne.length,ne&&(g.skip_pos=u,h.tokenranges.push({start:o,end:o+ne.length,type:3,previous:g.offset}))}}else g.type="TK_UNKNOWN",g.content+=d.substring(o,u).trimEnd(),g.length+=u-o;return g}return g=tt(N,"TK_UNKNOWN",o,N.length,K);function Ft(){B.length>1&&h.addFoldingRange(B[0],B.pop(),"imports"),B.length=0}function V(){$&&($.endLine>$.startLine&&h.foldingranges.push($),$=void 0)}}function jr(T=S.start_line_index){let A=De[T-1];return A?.text.length?A.indent:S.indentation_level}function no(){if(S.mode===nt.ObjectLiteral)return S.object_style??Pe.object_style;if(S.mode===nt.ArrayLiteral)return S.array_style??Pe.array_style}function Ts(){qt()?S.last_word="_":(dr()||D&&!xn(Fe.previous_token??pt,Fe))&&ae(null);let T=nt.Expression;if(ut!=="("){if(Fe.ignore){_t(T),Je=Fe.previous_token?.content!=="(",xe(),S.last_word="";return}if(Fe.topofline<1&&oi(Fe.previous_token??pt)){_t(T),xe(),S.last_word="",S.indentation_level=jr()+1,Pe.space_in_paren&&(Je=!0);return}(!D&&Fe.previous_token?.callsite||rt==="TK_RESERVED")&&(Je=!0),T=nt.ArrayLiteral}else Fe.ignore?ae(!0):rt==="TK_END_EXPR"||rt==="TK_WORD"?Je=Vn.includes(Fe.prefix_is_whitespace||"\0"):rt==="TK_STRING"?Je=!0:rt==="TK_RESERVED"&&(on.match(/^(break|continue|goto)$/i)?Je=!1:["if","for","while","loop","case","catch","switch"].includes(on)?Je=!!Pe.space_before_conditional:Je=en);if(lt()||(D&&Pe.preserve_newlines?ae(!0):(rt==="TK_EQUALS"||rt==="TK_COMMA"||rt==="TK_OPERATOR")&&re()),_t(T),S.last_word="",Et.indentation_level=Math.min(Et.indentation_level,S.indentation_level=jr()),xe(),Fe.ignore){let A=Fe.data.content;A&&xe(A)}else Pe.space_in_paren&&(Je=!0);yt(),ut==="["&&(S.array_style??Pe.array_style)===Eo.expand&&ae(!0)}function ws(){for(;S.mode===nt.Statement;)Ze();let T=ut==="]"&&S.mode===nt.ArrayLiteral;if(Ze(),T){let A=S.array_style??Pe.array_style;A===Eo.collapse||on==="["||S.indentation_level>=Et.indentation_level?qe():(A!=="none"||D&&Pe.preserve_newlines)&&ae(!0)}else(rt==="TK_END_EXPR"||rt==="TK_END_BLOCK")&&S.indentation_level>=Et.indentation_level?qe():rt!=="TK_START_EXPR"&&re();Je=!!(Pe.space_in_paren&&!(rt==="TK_START_EXPR"&&!Pe.space_in_empty_paren)),xe(),c??=!1}function Rs(){if(Fe.data)_t(nt.ObjectLiteral),S.indentation_level=jr(),Et.mode!==nt.Conditional&&(Et.indentation_level=S.indentation_level),Je||=en&&rt!=="TK_START_EXPR",xe(),yt(),(S.object_style??Pe.object_style)===Eo.expand?ae(!0):Je=en;else{let T;if(Fe.in_expr)T=jr();else if(["try","if","for","while","loop","catch","else","finally","switch"].includes(S.last_word))T=jr();else for(;S.mode===nt.Statement;)Ze();S.declaration_statement=!1,_t(nt.BlockStatement),S.in_expression=!1,S.indentation_level=T??=S.indentation_level,Je??=en,Et.in_case_statement&&rt==="TK_LABEL"&&/^(default)?:$/.test(on)?(S.case_body=null,ae(),S.indentation_level--):(Pe.brace_style==="Allman"||D&&Pe.preserve_newlines&&Pe.brace_style==="Preserve")&&(Fe.in_expr===void 0||S.mode===nt.Expression)&&ae(!0);let A=!O();xe(),Et.indentation_level=Math.min(Et.indentation_level,S.indentation_level),Pe.switch_case_alignment&&S.last_word==="switch"||yt(),A||Pe.brace_style!=="Preserve"?ae(!0):Je=en}S.last_word=""}function Rc(){for(;S.mode===nt.Statement;)Ze();let T=S.mode===nt.ObjectLiteral,A=T||Fe.in_expr!==void 0;if(T){let N=S.object_style??Pe.object_style;N===Eo.collapse||on==="{"?qe():(N!=="none"||D&&Pe.preserve_newlines)&&ae(!0),Je=en&&on!=="{"}else(Pe.brace_style!=="Preserve"||D)&&ae(!0);Ze(),xe(),A||(Et.case_body===null&&yt(),Pe.brace_style!=="Preserve"&&ae(!0),Je=en)}function G(){let T=!1;if(Je||=/^(TK_NUMBER|TK_WORD|TK_RESERVED|TK_STRING|TK_END_)/.test(rt),qt()&&(T=S.declaration_statement,!D&&["try","else","finally"].includes(S.last_word)&&["if","while","loop","for","try","switch"].includes(Rt)&&Pt()),Bt==="TK_RESERVED"){if(Pe.keyword_start_with_uppercase!==void 0&&(ut=Pe.keyword_start_with_uppercase?Rt.replace(/^./,A=>A.toUpperCase()):Rt),It(Rt))D&&ae(T);else{let A=!1;switch(Rt){case"else":for(;S.mode===nt.Statement&&!S.if_block&&!S.loop_block&&!(S.catch_block&&!S.else_block);)Ze();break;case"finally":for(;S.mode===nt.Statement&&!S.catch_block&&!S.try_block&&!(S.else_block&&S.catch_block);)Ze();break;case"catch":for(;S.mode===nt.Statement&&!S.try_block&&!(S.catch_block&&!S.else_block);)Ze();break;case"until":for(;S.mode===nt.Statement&&S.loop_block!==1;)Ze();break;case"case":case"class":for(;S.mode===nt.Statement;)Ze();break;case"if":case"for":case"loop":case"while":case"try":case"switch":if(!T)if(D&&S.mode===nt.Statement&&!S.declaration_statement&&!S.in_expression)ae(!1);else for(;S.mode===nt.Statement&&S.declaration_statement;)Ze();break}if(S.if_block?Rt==="else"?(S.if_block=!1,S.else_block=!0,A=!0):S.if_block=!1:S.loop_block?S.loop_block===1&&Rt==="until"?(S.loop_block=0,A=!0):Rt==="else"?(S.else_block=!0,S.loop_block=0,A=!0):S.loop_block=0:S.try_block?Rt==="catch"?(S.try_block=!1,S.catch_block=!0,A=!0):Rt==="finally"?(S.try_block=!1,S.finally_block=!0,A=!0):S.try_block=!1:S.catch_block?Rt==="finally"?(S.catch_block=S.else_block=!1,S.finally_block=!0,A=!0):Rt==="else"?(S.else_block=!0,A=!0):Rt==="catch"?A=!0:S.catch_block=S.else_block=!1:S.else_block=S.finally_block=!1,Rt==="class"){ae(),xe(),S.last_word=Rt,S.start_line_index=De.length,_t(nt.Statement),Sn=!0;return}else if(Rt==="case"){ae(),S.case_body&&(Pt(),S.case_body=!1),xe(),S.in_case=!0,S.in_case_statement=!0;return}switch(A?(qe(),S.last_text!=="}"||Pe.brace_style==="Allman"||Pe.brace_style==="One True Brace Variant"||D&&Pe.preserve_newlines&&Pe.brace_style!=="Preserve"?ae(!0):Je=en):D&&(on==="else"&&!Pe.preserve_newlines&&["if","for","loop","while","try","switch"].includes(Rt)?Pt():ae(T)),Rt){case"loop":S.loop_block=1;break;case"while":case"for":S.loop_block=2;break;case"if":S.if_block=!0;break;case"try":S.try_block=!0;break}}S.last_word=Rt,S.start_line_index=De.length}else D&&S.mode===nt.Statement&&!S.in_expression&&!xn(Fe.previous_token??pt,Fe)?ae(T):D&&(Pe.preserve_newlines||Fe.symbol)?(Fe.symbol||no()!==Eo.collapse)&&ae(!Fe.symbol):["TK_COMMA","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"].includes(rt)&&(lt()||re()),!Sn&&S.mode===nt.BlockStatement&&Fe.symbol?.children&&(_t(nt.Statement),Sn=!0),S.last_word="_",Pe.symbol_with_same_case&&(ut=Fe.definition?.name||ut);xe()}function k(){if(qt())if(D&&Pe.preserve_newlines)ae(!0);else if(S.declaration_statement)Je=rt!=="TK_OPERATOR";else{let T=Fe.previous_token;Je=T.op_type!==-1&&!T.next_pair_pos&&en}else rt==="TK_RESERVED"||rt==="TK_WORD"?D?ae():Je=!0:rt==="TK_COMMA"||rt==="TK_START_EXPR"||rt==="TK_EQUALS"||rt==="TK_OPERATOR"?lt()||re():(D&&ae(),Fe.ignore||Fe.data!==void 0?Je=!1:Je=!0);if(Fe.ignore){let T;if(ae(!0),Pe.ignore_comment&&ut.trimStart().startsWith("(")&&(T=ut.indexOf(`
`))>0){let A=ut.slice(0,T).trimEnd().replace(/[ \t]+;.*$/,"");/(^[ \t]*\(|[ \t])c(om(ments?)?)?/i.test(A)?ut=`${A}
${ut.slice(T+1).replace(/^[ \t]*;.*\r?\n/gm,"").replace(/[ \t]+;.*/gm,"")}`:ut=`${A}
${ut.slice(T+1)}`}xe(),De[De.length-1].text=[ut];return}xe()}function M(){qt(),Je=en,xe(),Je=en}function I(){if(S.ternary_depth!==void 0){for(let A=S.ternary_indent;A>0;A--,Pt());S.ternary_indent=0,delete S.ternary_depth}(S.mode===nt.BlockStatement||S.declaration_statement)&&(_t(nt.Statement),yt()),rt==="TK_WORD"&&Vn.includes(Fe.prefix_is_whitespace||"\0")&&Fe.previous_token?.callsite?D&&Pe.preserve_newlines?ae(!0):Je=!0:(Je=en&&rt==="TK_COMMA"||on==="for"&&rt==="TK_RESERVED",S.mode===nt.Statement&&S.parent.mode===nt.ObjectLiteral&&Ze(),D&&Pe.preserve_newlines?ae(!0):O()||(D=!1));let T=no();T&&qe(),xe(),T===Eo.expand?ae(!0):Je=en}function x(){let T=!!(en||ut.match(/^\w/)),A=T;if(Fe.previous_token?.callsite&&(Je=!0),qt()){if(S.declaration_statement&&Rt.match(/^(\+\+|--|%|!|~|not)$/)){Je=!0,S.last_word="_",xe(),Rt==="not"&&(Je=!0);return}}else if(ut==="=>")Sn&&S.mode===nt.Statement&&S.parent.mode===nt.BlockStatement&&(Sn=!1),_t(nt.Statement),yt(),S.in_fat_arrow=!0;else if(Rt.match(/^(\+\+|--|%|!|~|not)$/)&&dr()){ae(),xe(),Rt==="not"&&(Je=!0);return}if(rt==="TK_RESERVED"&&(Je=!0),ut==="%"){A=!!(Fe.previous_pair_pos!==void 0&&" 	".includes(d.charAt(Fe.offset+1)||"\0")),Je||=!!(Fe.next_pair_pos&&" 	".includes(Fe.prefix_is_whitespace||"\0")),D&&Pe.preserve_newlines&&S.mode===nt.Statement&&xn(Fe.previous_token??pt,Fe)&&ae(!0),xe(),Je=A;return}if(ut===":"&&(S.in_case||S.mode===nt.Statement&&S.parent.in_case)){S.in_case||Ze(),yt(),xe(),tn(`
`)?ae():Je=en,S.in_case=!1,S.case_body=!0,_t(nt.Statement),S.case_body=!0,Bt="TK_LABEL";return}D&&Pe.preserve_newlines?ae(!0):rt==="TK_OPERATOR"&&!on.match(/^(--|\+\+|%|!|~|not)$/)&&re(),["--","++","!","~"].includes(ut)||"-+".includes(ut)&&(["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR","TK_COMMA","TK_RESERVED"].includes(rt)||Fe.previous_token?.callsite)?(A=!1,T=ut==="!"&&rt==="TK_WORD",!Je&&(ut==="++"||ut==="--")&&["TK_END_EXPR","TK_WORD"].includes(rt)&&(A=!0)):ut===":"?S.ternary_depth?(Ze(),S.ternary_depth--):(T=!1,no()&&qe()):ut==="?"?Fe.ignore?(T=!1,A=h.tokens[Fe.next_token_offset]?.content.startsWith("?")??!1):(S.ternary_depth===void 0?S.ternary_depth=1:S.ternary_depth++,yt(),S.ternary_indent=(S.ternary_indent??0)+1,_t(nt.Expression),S.ternary_depth=S.parent.ternary_depth):ut==="."?A=T=!0:ut==="&"?((rt!=="TK_WORD"&&rt!=="TK_END_EXPR"||Fe.previous_token?.callsite)&&(A=!1),(rt==="TK_COMMA"||rt==="TK_START_EXPR")&&(T=!1)):ut==="*"&&(on===","?A=!1:h.tokens[Fe.next_token_offset]?.type==="TK_END_EXPR"&&(T=A=!1)),Je||=T,xe(),Je=A}function _(){if(S.mode===nt.Statement){let L=h.tokens[Fe.previous_token?.next_token_offset];!L||!S.in_expression&&!xn(L.previous_token??pt,L)?ae():S.had_comment<2&&qe()}if(Pe.ignore_comment)return;let T=ut.split(`
`),A=/^\/\*\*(?!\/)/.test(ut),N="";A||(N=new RegExp(`^${d.substring(d.lastIndexOf(`
`,Fe.offset)+1,Fe.offset)}`)),ae(!0),xe(T[0].trimEnd());for(let L=1,K=T.length-1;L<K;L++)ae(!0),xe(A?T[L].replace(/^(\s*(\*?\s*(?=@)|\* ?))?/," * "):T[L].trimEnd().replace(N,""));T.length>1&&(ae(!0),xe((A?" ":"")+T.at(-1).trim())),ae(!0),S.had_comment=3}function X(){if(e_(ut,S,Pe),Pe.ignore_comment)return;O()&&De.length>1&&De.pop();let T;De[De.length-1].text.push(Pe.white_space_before_inline_comment||((T=Fe.previous_token)?d.substring(T.skip_pos??T.offset+T.length,Fe.offset):"	"),ut),ae(!0),S.had_comment=1}function _e(){if(S.mode===nt.Statement){let T=h.tokens[Fe.previous_token?.next_token_offset];!T||!S.in_expression&&!xn(T.previous_token??pt,T)?ae():S.had_comment<2&&qe()}e_(ut,S,Pe),!Pe.ignore_comment&&(ut.split(`
`).forEach(T=>{ae(!0),xe(T.trim())}),ae(!0),S.had_comment=2)}function kt(){qt(),re(S.last_text===")"&&Pe.break_chained_methods),xe()}function fn(){Bt="TK_WORD",G()}function Qt(){if(ae(),Pe.symbol_with_same_case&&Bt==="TK_SHARP"&&(ut=qo[Rt]?.[0]||ut),Rt==="#hotif"&&Pe.indent_between_hotif_directive){S.hotif_block&&(Pt(),S.hotif_block=!1),xe(),h.tokens[Fe.next_token_offset]?.topofline===0&&(yt(),S.hotif_block=!0),Je=!0;return}xe();let T=Fe.data?.content;T?xe(Bt==="TK_HOTLINE"?T:" "+T):Bt==="TK_HOT"?Je=!!Pe.space_after_double_colon:Je=en||Bt==="TK_SHARP"}function er(){if(ae(null),Rt==="default:"&&(S.in_case_statement||S.mode===nt.BlockStatement&&S.last_word==="switch")){S.case_body?Pt():S.case_body=!0,xe(),yt(),S.in_case=!1,S.in_case_statement=!0,Je=en,_t(nt.Statement),S.case_body=!0;return}xe();let T=De.at(-1).text;T[0].trim()===""?De[De.length-1].text=T.slice(1):yt()}function tr(){xe(),h.tokens[Fe.next_token_offset]?.topofline===1&&ae()}function dr(){return D&&(S.parent.mode===nt.BlockStatement&&["TK_END_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_WORD","TK_STRING"].includes(rt)||rt==="TK_OPERATOR"&&/^(\+\+|--|%)$/.test(on)||rt==="TK_RESERVED"&&/^(break|continue|goto|global|local|loop|return|static|throw)$/.test(on))}}clear(){this.texts={},this.declaration={},this.include={},this.tokens={},this.linepos={},this.labels={},this.typedef={},this.object={method:{},property:{}},this.need_scriptdir=this.hotstringExecuteAction=this.isparsed=!1,this.children.length=this.dllpaths.length=this.tokenranges.length=0,this.diagnostics.length=this.foldingranges.length=0,this.includedir.clear(),this.dlldir.clear(),this.d_uri="",delete this.maybev1,delete this.checkmember,delete this.symbolInformation}get included(){return zi[this.uri]??{}}get relevance(){let t=this.uri,n={...ii[t]};for(let i in zi[t])Object.assign(n,ii[i]);return delete n[t],n}findSymbol(t,n,i){let r,s,a=this.uri;if(n===R.SymbolKind.Field){let v=this.tokens,d=i?this.document.offsetAt(i):-1,w;s=i&&this.searchScopedNode(i);for(r of(s??this).labels?.[t.endsWith(":")?t.slice(0,-1):t]??[]){if(!r.def)break;if((w=r.data)===-1||w<d&&(!(w=v[v[w].next_pair_pos]?.offset)||d<w))return{node:r,uri:a,scope:s}}return s&&null}let c,p,f=!0;if(t.startsWith("$"))return(r=b(this.d?a:this.d_uri))&&{node:r,uri:a,is_global:!0};if(s=i&&this.searchScopedNode(i)){if(s.kind===R.SymbolKind.Class)s=void 0;else if(s.kind===R.SymbolKind.Property&&t==="THIS")return{node:s.parent,uri:a,scope:s,is_this:!0}}let l=s;for(;l?.local;){if(c=l.local[t]){r=c,p=l,f=!1,r.is_param&&l.parent?.kind===R.SymbolKind.Property&&(p=l.parent);break}if(l.has_this_param&&(t==="THIS"||t==="SUPER")){for(r=l;r.kind!==R.SymbolKind.Class;)if(!(r=r.parent))return null;return t==="THIS"?{node:r,uri:a,scope:s,is_this:!0}:(r=ac(r,this))?{node:r,uri:a,scope:s,is_this:!1}:null}if(((c=l.global?.[t])&&(r=c)||l.assume===2)&&(f=!0))break;if((c=l.declaration?.[t])?(r=c,p=l,f=!1):r??=(p=l,l.unresolved_vars?.[t]),l.static&&l.kind===R.SymbolKind.Function){(c=l.parent?.local[t])?.static&&(r=c,p=l.parent),r?.def&&(f=!1);break}l=l.parent}return f&&(r=b(this.d_uri)??this.declaration[t]??(f=1,r)??(f=!0,this.typedef[t])),r&&{node:r,uri:a,scope:s,is_global:f,parent:p};function b(v){let d=se[v];if(!d)return;let w=d.declaration[t]??d.typedef[t];return w&&(a=w.uri=v,w)}}getContext(t,n=!1){let i,r,s,a,c,p,f=this.document,l=this.tokens,{line:b}=t,v=f.getText(R.Range.create(b,0,b+1,0)).trimEnd(),{character:d}=t;for(a=d;--a>=0&&Nn(v.charCodeAt(a)););if(!n)for(;Nn(v.charCodeAt(d));d++);let w=R.Range.create(b,a+=this.d&&v[a]==="$"?0:1,b,d),D=p=v.slice(a,d),$=f.offsetAt(w.start),C=(s=l[$])?s.previous_token:l[$-1];if(C?.content==="."&&!s?.prefix_is_whitespace&&C.type!=="TK_OPERATOR"||(c=C&&oi(C)&&s?.type==="TK_START_EXPR"&&s.topofline<1&&(s.content==="["||s.prefix_is_whitespace===void 0))){let g=C,y=c?C:C.previous_token,u=!!s?.paraminfo||v[d]==="(";for(;y;)switch(y.type){case"TK_DOT":g=y,y=y.previous_token;break;case"TK_END_EXPR":if(!(y=l[y.previous_pair_pos]))break;g=y,!y.next_pair_pos||y.topofline>0?y=void 0:y.prefix_is_whitespace===void 0||y.content==="["&&!y.previous_token?.callsite?(y=y.previous_token)&&(y.type==="TK_NUMBER"||y.type==="TK_STRING"||y.content==="%"&&(y=pt)?(g=y,y=void 0):y.type==="TK_WORD"||y.type==="TK_DOT"||y.type.startsWith("TK_END_")||(y=void 0)):y=void 0;break;case"TK_END_BLOCK":if(y.in_expr!==void 0){g=l[y.in_expr],y=void 0;break}if(g=y,!(y=l[y.previous_pair_pos]))break;case"TK_START_BLOCK":g=y.data?y:pt,y=void 0;break;case"TK_NUMBER":case"TK_STRING":g=y,y=void 0;break;case"TK_WORD":if(g=y,y=y.previous_token){if(y.type==="TK_DOT")break;if(y.type==="TK_START_BLOCK"){y=void 0;break}g.prefix_is_whitespace===void 0&&y.previous_pair_pos!==void 0&&y.content==="%"&&(g=pt),y=void 0}break;case"TK_OPERATOR":if(y.ignore&&y.content==="?"){g=y,y=y.previous_token;break}default:y=void 0;break}/TK_WORD|TK_NUMBER|TK_STRING|TK_START_/.test(g.type)?(s=g,w.start=f.positionAt(g.offset),w.end=f.positionAt(C.offset+(c?1:0))):(s=pt,i=R.SymbolKind.Null),p="",i??=c?R.SymbolKind.Variable:u?R.SymbolKind.Method:R.SymbolKind.Property}else if(s)if(s.type==="TK_WORD"){let g=s.semantic,y=(r=s.symbol)??s.definition,u;if(y)i=y.kind,u=y,i===R.SymbolKind.Class?p=u.full:(i===R.SymbolKind.Property||i===R.SymbolKind.Method)&&(p=u.full.replace(/^\(([^ \t]+)\).*$/,(...B)=>`${B[1]}${u.static?".":"#"}${u.name}`));else if(g)switch(g.type){case 1:i=R.SymbolKind.Function;break;case 2:i=R.SymbolKind.Method;break;case 0:i=R.SymbolKind.Class;break;case 5:i=R.SymbolKind.Property;break;case 4:if(s.ignore)break;case 3:i=R.SymbolKind.Variable;break}else i=R.SymbolKind.Variable}else s.type==="TK_LABEL"&&(i=R.SymbolKind.Field);else if(C?.content.startsWith("#"))s=C,p=C.content;else if(s=this.find_token(w.start.character===v.length?$-1:$),s.type==="TK_STRING")p=s.content;else if(s.type.endsWith("COMMENT")){let g=v.substring(0,d),y=g.match(/(@see|\{@link(code|plain)?|@param(\s+\{[^}]*\})?)\s+((\[[ \t]*)?[^ \t]+)$/);if(y){if(g=y[4],y[1].startsWith("@param")){g=g.replace(/^\[[ \t]*/,"");let u=s.symbol;u?.params&&(g=`${Gu(u)}~${g}`)}else v[d]===":"&&/^[a-zA-Z]+$/.test(g)&&(g="");(y=g.match(/^(([\w.$#~]|[^\x00-\x7f])+)(\(\))?$/))&&(p=y[1],i=p.includes(".")?y[3]?R.SymbolKind.Method:R.SymbolKind.Property:y[3]?R.SymbolKind.Function:R.SymbolKind.Class)}else(y=g.match(/(([\w.]|[^\x00-\x7f])+)$/))&&(p=y[1]+D)}return i??=R.SymbolKind.Null,{text:p,word:D,range:w,kind:i,linetext:v,token:s,symbol:r}}searchScopedNode(t,n){let{line:i,character:r}=t,s,a,c,p;for(let f of n??this.children)if(!(!(s=f.children)||i>f.range.end.line||i<f.selectionRange.start.line||i===f.selectionRange.start.line&&r<f.selectionRange.start.character||i===f.range.end.line&&r>f.range.end.character)){if(t.line>f.selectionRange.start.line||t.character>f.selectionRange.end.character){switch(f=this.searchScopedNode(t,s)??f,f.kind){case R.SymbolKind.Property:return this.searchScopedNode(t,[f.get,f.set].filter(Boolean))??f;case R.SymbolKind.Class:p=this.document.offsetAt(t),a=f;for(c of[a.property.__INIT,a.$property?.__INIT])for(let l of c?.ranges??[]){if(p<l[0])break;if(p<=l[1])return this.searchScopedNode(t,c.children)??c}}return f}return}}getScopeSymbols(t){if(!t||t.kind===R.SymbolKind.Class||t.kind===R.SymbolKind.Property)return{};let n=t,i=[n];for(;(n=n.parent)&&n.kind!==R.SymbolKind.Class;)i.push(n);let r=n?.kind===R.SymbolKind.Class?{THIS:Lo,SUPER:cs}:{};for(;n=i.pop();)n.kind!==R.SymbolKind.Property&&(n.assume===2?r={}:n.assume===1&&Object.entries(r).forEach(([s,a])=>!a.static&&a.static!==null&&delete r[s]),Object.assign(r,n.local??{}),Object.entries(n.declaration??{}).forEach(([s,a])=>r[s]??=a),Object.entries(n.unresolved_vars??{}).forEach(([s,a])=>r[s]??=a),Object.keys(n.global??{}).forEach(s=>delete r[s]));return r}initLibDirs(t){let n;if(!t){for(n of at("v2.workingDirectories"))if(this.uri.startsWith(n)){t=Dr(pn.parse(n).fsPath.replace(/[\\/]$/,""));break}}t?this.scriptdir=t:(n=(0,ec.resolve)()).toLowerCase()!==this.scriptpath.toLowerCase()&&n.toLowerCase()!==process.argv0.toLowerCase()&&this.scriptpath.toLowerCase().startsWith(n.toLowerCase())&&!/\\lib(\\.+)?$/i.test(this.scriptpath)?(0,ar.existsSync)(this.scriptpath+"\\Lib")&&(0,ar.statSync)(this.scriptpath+"\\Lib").isDirectory()?this.scriptdir=this.scriptpath:this.scriptdir=n:this.scriptdir=this.scriptpath.replace(/\\Lib(\\.+)?$/i,""),this.libdirs=[t=this.scriptdir+"\\Lib\\"],t=t.toLowerCase();for(let i of li)t!==i.toLowerCase()&&this.libdirs.push(i)}getColors(){let t=this.tokenranges,n=this.document,i=n.getText(),r=[];for(let s of t)if(s.type===2){let a=s.start,c="",p=s.end,f=Ak.exec(i.substring(a,p));if(!f||!f[1]&&p-a!==f[2].length+2)continue;let l=R.Range.create(n.positionAt(a+=f.index+1+(f[1]?.length??0)),n.positionAt(a+f[2].length));c=f[5]?Pk[f[5].toLowerCase()]:f[3]===void 0?f[2]:f[2].substring(2);let b={red:0,green:0,blue:0,alpha:1},v=["red","green","blue"];f[4]!==void 0&&v.unshift("alpha");for(let d of v)b[d]=parseInt("0x"+c.substring(0,2))/255,c=c.slice(2);r.push({range:l,color:b})}return r}addDiagnostic(t,n,i,r=R.DiagnosticSeverity.Error,s){let a=this.document.positionAt(n),c=a;i!==void 0&&(c=this.document.positionAt(n+i)),(s||this.diagnostics).push({range:R.Range.create(a,c),message:t,severity:r})}addFoldingRange(t,n,i="block"){let r=this.document.positionAt(t).line,s=this.document.positionAt(n).line-(i==="block"?1:0);r<s&&this.foldingranges.push(R.FoldingRange.create(r,s,void 0,void 0,i))}addFoldingRangePos(t,n,i="block"){let r=t.line,s=n.line-(i==="block"?1:0);r<s&&this.foldingranges.push(R.FoldingRange.create(r,s,void 0,void 0,i))}addSymbolFolding(t,n){let i=at("v2.general.symbolFoldingFromOpenBrace")?this.document.positionAt(n).line:t.range.start.line,r=t.range.end.line-1,s=this.foldingranges;i<r&&(s[s.length-1]?.startLine===i&&s.pop(),s.push(R.FoldingRange.create(i,r,void 0,void 0,"block")))}update(){let t=this.uri,n=this.include;this.parseScript(),this.foldingranges.reverse(),In[t]&&(In[t].length=0,In[t].push(...Object.values(this.declaration).filter(b=>b.kind===R.SymbolKind.Class||b.kind===R.SymbolKind.Function)));let i=this.include,r=Object.keys(i).length,s=0;for(let b in n)if(!(b in i)){s=2;break}if(!s&&(r>Object.keys(n).length||""in n)&&(s=1),!s)return this.sendDiagnostics(!0);if(Io(this,this.scriptdir),s===1){let b=Ci(this);for(let v in this.included)Object.assign(ii[v],b)}else ls();let a=this.scriptpath,c=Object.keys(ii[t]).length;for(let b in zi[t])r=Object.keys(ii[b]).length,(r>c||r===c&&se[b].scriptpath.length<a.length)&&(a=se[b].scriptpath,c=r);let p,f=a.toLowerCase(),l=this.relevance;(f+"\\").startsWith(this.scriptdir.toLowerCase()+"\\lib\\")?(a=this.scriptdir,f=a.toLowerCase()):f!==this.scriptdir.toLowerCase()&&this.initLibDirs(a);for(let b in l)delete n[b],(p=se[b]).scriptdir.toLowerCase()!==f&&(p.initLibDirs(a),p.need_scriptdir&&p.parseScript());for(let b in n){let v=se[b];v&&!v.actived&&v.close()}this.sendDiagnostics(!0,!0)}clearDiagnostics(){this.last_diags&&(this.include={},this.last_diags=0,Zn?.sendDiagnostics({uri:this.document.uri,diagnostics:[]}))}sendDiagnostics(t=!1,n=!1){let i=this.last_diags;if((i!==this.diagnostics.length||t&&i)&&(Zn?.sendDiagnostics({uri:this.document.uri,diagnostics:this.diagnostics}),this.last_diags=this.diagnostics.length),!!n)for(let r in this.relevance)se[r]?.sendDiagnostics(t)}setWorkspaceFolder(){let t=this.uri;for(let n of Gr)if(t.startsWith(n))return this.workspaceFolder=n;return this.workspaceFolder=""}keepAlive(){if(this.actived)return!0;let{uri:t,d:n}=this;if(!se[t])return!1;if(n&&n>2&&!t.includes("?"))return!0;let i;for(let r in this.relevance)if((i=se[r])?.actived&&i.relevance[t])return!0;return!1}close(t=!1,n=!0){if(this.actived=!1,!t&&this.keepAlive())return;this.clearDiagnostics();let i=this.relevance;if((t||!this.workspaceFolder)&&(delete se[this.uri],delete ii[this.uri],!this.actived&&se[this.d_uri]?.close(!1,!1)),!n)return;let r=!0;for(let s in i)r=!1,se[s]?.close(!1,!1);r?se[this.uri]||delete zi[this.uri]:ls()}findStrOrComment(t){let n=this.tokenranges,i=0,r=n.length-1,s=0,a;for(;i<=r;)if(a=n[s=i+r>>1],t<a.start)r=s-1;else if(t>=a.end)i=s+1;else break;if(i<=r&&a)return this.tokens[a.start]??((a=this.tokens[a.previous])?.data&&{...a.data,previous_token:a,type:""})}};function si(e,t=0,n=""){return{name:e,full:e,kind:t,extends:n,range:bn,selectionRange:bn,uri:""}}function Zm(e){let t=e.match(/^((([<>$~*!+#^]*?)(`?;|[\x21-\x3A\x3C-\x7E]|\w+|[^\x00-\x7f]))|~?(`?;|[\x21-\x3A\x3C-\x7E]|\w+|[^\x00-\x7f])[ \t]+&[ \t]+~?(`?;|[\x21-\x3A\x3C-\x7E]|\w+|[^\x00-\x7f]))([ \t]+up)?::$/i);if(!t)return!1;for(let n=4;n<7;n++)if((t[n]??"").length>1&&!r_.test(t[n]))return!1;return!0}function Uu(e,t,n="",i=!1,r=On){let s,a="",c=e;if(e.startsWith("<")&&e.endsWith(">")){if(!(e=e.slice(1,-1)))return;let p=[e+".ahk"];(s=e.match(/^((\w|[^\x00-\x7f])+)_.*/))&&p.push(s[1]+".ahk");for(let f of t)for(let l of p)if((0,ar.existsSync)(e=f+l))return a=pn.file(e).toString().toLowerCase(),{uri:a,path:se[a]?.fsPath??e,raw:c}}else{for(;s=e.match(/%a_(\w+)%/i);){let p=s[1].toLowerCase();if(r[p])e=e.replace(s[0],r[p]);else return}return e.indexOf(":")<0?e=(0,ec.resolve)(n,e):e.includes("..")&&(e=(0,ec.resolve)(e)),i&&!(0,ar.existsSync)(e)?void 0:(a=pn.file(e).toString().toLowerCase(),{uri:a,path:se[a]?.fsPath??e,raw:c})}}function Io(e,t,n=new Set){let i=e.include,r=t.toLowerCase();n.add(e);for(let s in i){let a=i[s];if(ri(a))continue;let c,p;if(c=se[s])c.scriptdir.toLowerCase()!==r&&(c.initLibDirs(t),c.need_scriptdir&&c.parseScript());else{if(!(0,ar.existsSync)(a)||!(p=ui(Dr(a))))continue;(se[s]=c=new Un(p,t)).parseScript()}n.has(c)||Io(c,t,n)}}function ac(e,t){let n=!1,i,r,s,a;switch(e.kind){case R.SymbolKind.Method:case R.SymbolKind.Function:s="func";break;case R.SymbolKind.Number:s=e.name;break;case R.SymbolKind.String:s="string";break;default:if(!e.property)return;case R.SymbolKind.Class:if(a=e,r=a.base)return r;if(n=!!a.prototype,s=a.extends,t??=se[a.uri],i=a.extendsuri,!s)if((a.full||a.name).toLowerCase()==="any")if(n)n=!1,s="class";else return;else s="object";break}return a=ai(t??se[ln.ahk2],s,i),n?a:a?.prototype}function Tn(e,t,n,i,r){let s,a,c,p,f=0,l=t,b=r??=[];for(n=n.toUpperCase();;){if(f===b.length){if(b.includes(l))break;b.push(l)}if(c=l.property?.[n])if(i){if(c.kind===R.SymbolKind.Method)return c.uri??=l.uri,c;if((p=c).kind===R.SymbolKind.Class||(p=c.call))return p.uri??=l.uri,p;s??=(c.uri??=l.uri,c)}else if(c.kind===R.SymbolKind.Method)a??=(c.uri??=l.uri,c);else{if(c.children)return c.uri??=l.uri,c;s??=(c.uri??=l.uri,c)}if((p=b[++f])===null)break;if(!(l=p??ac(l,e))){b.push(null);break}}if(s??=a)return s}function Xi(e,t,n){let i=t,r=n??[],s=[];for(;i&&!r.includes(i);)r.push(i),s.push(i.property),i=ac(i,e);if(!n)for(let a;i=r.pop();a=i.checkmember??=a);return Object.assign({},...s.reverse())}function Qi(e,t){let n=Tn(t??=se[e.uri],e,"call",!0);return n?.full?.startsWith("(Object) static Call(")?Tn(t,e.prototype,"__new",!0)??n:n}function i_(e,t,n){let i=[],r;do if(r=t.property?.[n])return r.uri??=t.uri,r;while(t=(r=t.extends?.toLowerCase())&&[r,`(${r}) prototype`].includes(t.full.toLowerCase())&&!i.includes(t)&&i.push(t)?ac(t,e):void 0)}function ai(e,t,n){let i=t.toUpperCase().split("."),r=i.shift(),s=n?se[n]?.declaration[r]:zr(e,r)?.node;if(!(!s?.property||s.def===!1)){n??=s.uri;for(r of i)if(!(s=i_(e,s,r)))return;return s.uri??=n,s}}function oi(e){switch(e.type){case"TK_DOT":return!0;case"TK_END_BLOCK":return!!(e.data??e.in_expr!==void 0);case"TK_END_EXPR":case"TK_NUMBER":case"TK_STRING":return!0;case"TK_WORD":return!e.paraminfo;case"TK_OPERATOR":if(e.op_type===1)return!0;switch(e.content){case"?":return!!e.ignore;case"%":return e.previous_pair_pos!==void 0;case"++":case"--":return!e.topofline&&oi(e.previous_token??pt)}default:return!1}}function Fr(e,t,n,i){let r=[],s=[],a=e.tokens,c=[0],p=pt,f,l,b;typeof n=="object"?f=e.document.offsetAt(n):f=n;e:for(;t&&t.offset<f;){switch(t.type){case"TK_STRING":case"TK_NUMBER":if(C())break e;r.push(t),p=t;break;case"TK_WORD":if(C())break e;if(r.push(t),p=t,t.symbol){t=e.find_token(e.document.offsetAt(t.symbol.range.end),!0);continue}else if(t.callsite){if(t.next_token_offset>=f||t.next_token_offset===-1)break e;if(r.push(l={content:"",type:"TK_FUNC",paraminfo:t.callsite.paraminfo??t.paraminfo}),t=a[t.next_token_offset],l.data=t?.content==="(",!t||!(t=a[t.next_pair_pos])){r.length=0;break e}}break;case"TK_DOT":if((t=a[t.next_token_offset])?.type==="TK_WORD"){if(l=a[t.next_token_offset],l?.content==="["&&l.topofline<1||l?.content==="("&&!l.prefix_is_whitespace){let u={content:t.content,type:"TK_FUNC"};if(r.push(u),l.offset>=f)break e;if(u.data=l.content==="(",u.paraminfo=l.paraminfo,!(t=a[l.next_pair_pos])){r.length=0;break e}break}l?.content==="%"&&!l.prefix_is_whitespace&&l.previous_pair_pos===void 0?g():r.push({content:t.content,type:"TK_FUNC"})}else if(t?.type==="TK_START_EXPR"){if(t.offset>=f)break e;if(r.push({content:"",type:"TK_FUNC",data:t.content==="(",paraminfo:t.paraminfo}),!(t=a[t.next_pair_pos])){r.length=0;break e}}else g();break;case"TK_OPERATOR":if(t.content==="%"&&t.previous_pair_pos===void 0){if(!t.prefix_is_whitespace)g();else{if(C())break e;g()}break}case"TK_EQUALS":if($(t))break e;break;case"TK_START_EXPR":if(!(t=a[(l=t).next_pair_pos])){r.length=0;break e}if(!l.symbol&&(!l.prefix_is_whitespace||l.content==="["&&l.topofline<1)&&(p.op_type===1||["TK_WORD","TK_NUMBER","TK_STRING","TK_END_EXPR"].includes(p.type)||p.type==="TK_END_BLOCK"&&(b=a[p.previous_pair_pos])&&(b.data??b.in_expr!==void 0)))r.push({content:"",type:"TK_FUNC",paraminfo:l.paraminfo,data:l.content==="("});else if(l.content==="[")r.push({symbol:tc});else{if(C())break e;if(r.push(l),l.symbol){p=t,t=e.find_token(e.document.offsetAt(l.symbol.range.end),!0);continue}}p=t;break;case"TK_START_BLOCK":if(!(t=a[(l=t).next_pair_pos])){r.length=0;break e}r.push(l);break;case"TK_COMMENT":case"TK_INLINE_COMMENT":case"TK_BLOCK_COMMENT":break;case"TK_COMMA":r.length=s.length=0,p=pt,c=[0];break;case"TK_END_BLOCK":case"TK_END_EXPR":if(t.offset===f-1)break e;default:r.length=0;break e}t=a[t.next_token_offset]}if(!r.length)return[];for(;t=s.pop();)D(t);let v=new Set,d=[],w;for(t of r){if(t.symbol)if(t.symbol.kind===R.SymbolKind.Property){let u=t.symbol,B=u.parent;(u=B?.property?.[u.name.toUpperCase()])?d=Mn(u,se[B.uri]??e,B):d=[]}else d=[t.symbol],t.symbol.uri??=e.uri;else switch(t.type){case"TK_FUNC":{let u=!!t.data,B=t.content.toLowerCase()||(u?"call":"__item");d=Hr(e,d,B,u,t.paraminfo,w);break}case"TK_WORD":{let u=e.document.positionAt(t.offset),B=zr(e,t.content,R.SymbolKind.Variable,u);if(!B)break;d=new Set;let h=B.node;if(h.kind===R.SymbolKind.Variable)for(let le of Nk(h,e,u,B.scope,i))d.add(le);else if(d.add(h),B.is_this!==void 0){w=i??h;continue}break}case"TK_NUMBER":/^[-+]?(\d+$|0[xX])/.test(t.content)?d=[oc]:/^[-+]?\d+[.eE]/.test(t.content)?d=[ic]:d=[Lr];break;case"TK_STRING":d=[Sr];break;case"TK_START_BLOCK":if(!(l=t.data))break;if(d=[l],l.uri??=e.uri,b=!l.extends&&l.property?.BASE){let u=Mn(b,e,i);if(u.length<2)l.base=u[0];else{d=[];for(let B of u)d.push({...l,base:B})}}break;case"TK_START_EXPR":{let u=(l=t.paraminfo?.comma)?.length?l.at(-1):t.next_token_offset;d=Fr(e,a[u],t.next_pair_pos-1,i);break}default:if(t.content==="||")for(let u of d)v.add(u);d=[];break}w=void 0}for(let u of d)v.add(u);return[...v];function D(u){let B=c.pop(),h={content:"",type:"TK_NUMBER"},le=r.splice(B??0);if(B===void 0||!le.length)return r.length=0,!0;switch(u.op_type??(u.type==="TK_EQUALS"&&0)){case-1:u.content==="&"&&le.length===1&&le[0].type==="TK_WORD"&&le[0].offset&&(h={symbol:Mr});case 1:break;case 0:{let ge=r.splice((B=c.pop())??0),Ne;if(B===void 0||!ge.length)return r.length=0,!0;if(u.content.startsWith("."))h.type="TK_STRING";else if(u.content===":="){c.push(r.length),r.push(...le);return}else if(["&&","and"].includes(Ne=u.content.toLowerCase())){c.push(r.length),r.push(h),r.push({type:"TK_OPERATOR",content:"||",op_type:0}),r.push(...le);return}else if(["||","or","??","??=",":"].includes(Ne)){c.push(r.length),r.push(...ge),r.push({type:"TK_OPERATOR",content:"||",op_type:0}),r.push(...le);return}break}default:return r.length=0,!0}c.push(r.length),r.push(h)}function $(u){let B=y(u,!1),h=s.length?y(s[s.length-1]):-1;for(;B<=h;){if(D(s.pop()))return!0;h=s.length?y(s[s.length-1]):-1}u.content==="?"?u.ignore||r.splice(c[c.length-1]??0):(s.push(u),!u.op_type&&c.push(r.length)),p=u}function C(){if(oi(p))return $(p={content:".",type:"TK_OPERATOR",op_type:0})}function g(){let u=t;r.splice(c[c.length-1]),r.push({symbol:cn});do{for(;t;)if(t.type==="TK_WORD"){if(u=t,t=a[t.next_token_offset],!t||t.content!=="%"||t.prefix_is_whitespace)break}else if(t.content==="%"&&t.previous_pair_pos===void 0){if(u=a[t.next_pair_pos],t=a[u?.next_token_offset],!t||t.type!=="TK_WORD"||t.prefix_is_whitespace)break}else break;if(t&&(t.content==="["||t.content==="("&&!t.prefix_is_whitespace)){if(u=t,t=a[t.next_pair_pos],!t)break;u=t,t=a[t.next_token_offset]}}while(t?.type==="TK_DOT"&&t.offset<f);p=t=u}function y(u,B=!0){if(u.type==="TK_OPERATOR")switch(u.content.toLowerCase()){case"++":case"--":return u.op_type===-1?77:82;case"||":case"or":return 17;case"&&":case"and":return 21;case"is":return 28;case">":case"<":case">=":case"<=":return 34;case"=":case"==":case"!=":case"!==":return 30;case"~=":return 36;case".":return 38;case"|":return 42;case"^":return 46;case"&":return u.op_type===-1?67:50;case"<<":case">>":case"<<<":return 54;case"//":return 62;case"+":case"-":return u.op_type===-1?67:58;case"*":case"/":return 62;case"**":return 73;case"not":return 25;case"!":return 67;case"?":return u.ignore?85:11;case":":return 11;default:return 0}return u.type==="TK_DOT"?86:u.type==="TK_EQUALS"?B?7:99:u.type==="TK_COMMA"?6:0}}function Hr(e,t,n,i,r,s){let a=new Set,c=s;for(let f of t){let l=f;switch(c=s??l,f.kind){case 0:return[cn];case R.SymbolKind.Class:if(i&&n==="call"){if(!(f=Tn(e,l,n,i))){if(p(l))break;continue}if((f.full??"").startsWith("(ComObject)")){let v=e.tokens,d=[],w=v[v[r?.offset]?.next_token_offset];w?.type==="TK_STRING"&&(d.push(w.content),(w=v[w.next_token_offset])?.content===","&&(w=v[w.next_token_offset],w?.type==="TK_STRING"&&(d.push(w.content),w=v[w.next_token_offset])),w?.content===")"&&a.add({kind:R.SymbolKind.Interface,name:"ComObject",full:`ComObject<${d.join(", ")}>`,generic_types:[d],range:bn,selectionRange:bn}));continue}break}case R.SymbolKind.Function:case R.SymbolKind.Method:if(i&&n==="call")break;default:if(!(f=Tn(e,l,n,i))){if(f=p(l))break;continue}if(f.kind!==R.SymbolKind.Property){if(f.alias){let b=Mn(f,se[f.uri]??e,c);for(let v of i?Hr(e,b,"call",!0):b)a.add(v);continue}else if(i)break;if(!r)a.add(f);else for(let b of Hr(e,[f],"__item",!1,r,c))a.add(b);continue}else if(f.alias){let b=Hr(e,Mn(f,se[f.uri]??e,c),"call",!0);for(let v of i?Hr(e,b,"call",!0):b)a.add(v);continue}else if(i||r&&!f.get?.params.length){for(let b of Hr(e,Mn(f,se[f.uri]??e,c),i?"call":"__item",i,r))a.add(b);continue}break}for(let b of Mn(f,se[f.uri]??e,c))a.add(b)}return a;function p(f){let l=Tn(e,f,i?"__call":"__get",i);if(!l)return;if(l.kind===R.SymbolKind.Method&&!l.alias)return l;let b=l.kind===R.SymbolKind.Class?[l]:l.children?void 0:Mn(l,se[l.uri]??e,c);if(b?.length)for(let v of Hr(e,b,"call",!0,r))a.add(v)}}function Ok(e,t,n,i){let r=fs(t,e.selectionRange.start);if(!r||r.index<0)return[];let{pos:s,index:a,kind:c}=r,p=t.getContext(s),f=Fr(t,p.token,p.range.end,i),l=!0;if(f.includes(cn))return[cn];if(!f.length)return[];let b=p.text?"":p.word.toLowerCase();c===R.SymbolKind.Property?(b||="__item",l=!1):b||="call";for(let d of f)if(v(d,b,n))return[cn];return n=[...new Set(n)],n.includes(cn)?[cn]:n;function v(d,w,D,$=0){switch(d.kind){case R.SymbolKind.Method:$++;case R.SymbolKind.Function:if(!l||w!=="call")break;case R.SymbolKind.Property:{let C=d.params?.[a+$],g;if(!C||!(g=C.type_annotations))break;for(let y of g){if(y===Mr)return!0;y.data===Mr&&D.push(...rc(y.generic_types?.[0]??[],t,i,o_(t,i)?.type_params))}break}case R.SymbolKind.Class:{let C=Tn(t,d,w,l),g=d;if(!C)break;if(l){if(C.kind===R.SymbolKind.Class)C=Qi(C);else if(C.full?.startsWith("(Object) static Call("))C=Tn(t,g.prototype,"__new",!0)??C;else if(C.kind===R.SymbolKind.Property||C.alias){let y=Mn(C,se[C.uri]??t,g);C.kind===R.SymbolKind.Property&&C.alias&&(y=Hr(t,y,"call",!0)),y.forEach(u=>v(u,"call",D,-1));return}C?.kind===R.SymbolKind.Method&&v(C,"call",D,-1);return}else if(C.kind===R.SymbolKind.Class)C=Tn(t,C,"__item",!1);else{if(C.kind!==R.SymbolKind.Property)return;if(!C.params){for(let y of Mn(C,se[C.uri]??t,g))(y=Tn(t,y,"__item",!1))&&v(y,"",D);return}}C&&v(C,"",D)}}}}function o_(e,t){if(!t||t.children)return t;let n=zr(e,t.full.replace(/<.+/,""))?.node;if(n?.prototype)return n}function Nk(e,t,n,i,r){let s=e.name.toUpperCase(),a=e,c=e.type_annotations?[e]:[];if(!i)for(let b in t?.relevance){let v=se[b]?.declaration?.[s];v?.type_annotations&&(c.includes(v)||c.push(v))}let p,f;for(let b of c){if((f=b.returns)&&(b.returns=void 0),p=Mn(b,t,r),f&&(b.returns=f),b.is_param&&b.pass_by_ref){let v=new Set;for(let d of p){if(d===Mr)return[cn];d.data===Mr?cc(d.generic_types?.[1]??[cn],v,t,r):v.add(d)}p=[...v]}if(p.includes(cn)&&(p=[cn])||!p.includes(Cr))return p;break}p??=[],f=void 0;for(let b of(i??t).children??[])if(s===b.name.toUpperCase())if(b.kind===R.SymbolKind.Variable){if(b.range.end.line>n.line||b.range.end.line===n.line&&b.range.end.character>n.character)break;(b.pass_by_ref||b.returns&&(b.for_index===void 0||Ym(b,f??=t.document.offsetAt(n))))&&(e=b)}else return[b];if(e.for_index!==void 0){let v=function(d,w=!0){let D=0,$;switch(d.kind){case R.SymbolKind.Class:{let C=[];if(w&&(f=Tn(t,d,"__enum",!0,C))){if(f.kind!==R.SymbolKind.Method)break;for(let g of Mn(f,se[f.uri]??t,d))v(g,!1);break}else if((f=Tn(t,d,"call",!0,C))?.kind===R.SymbolKind.Method)D=-1,$=d,d=f;else break}case R.SymbolKind.Method:D++;case R.SymbolKind.Function:{let C=d.params?.[e.for_index+D],g;if(!C||!(g=C.type_annotations))break;for(let y of g){if(y===Mr)return!0;y.data===Mr&&p.push(...rc(y.generic_types?.[0]??[],t,$,o_(t,$)?.type_params))}break}}};var l=v;if(e===a&&!Ym(e,f??=t.document.offsetAt(n)))return[];let b=Mn(e,t,r);for(let d of b)if(v(d))return[cn];return p=[...new Set(p)],p.includes(cn)?[cn]:p}return e.pass_by_ref&&!e.is_param?Ok(e,t,p,r):(p.push(...Mn(e,t,r)),p=[...new Set(p)],p.includes(cn)?[cn]:p)}function Ym(e,t){let n=e.data;return n[0]<=t&&t<n[1]}function rc(e,t,n,i){let r=new Set,s;for(let c of e){if(typeof c=="object"){r.add(c);continue}(s=c.startsWith("typeof "))&&(c=c.substring(7)),`'"`.includes(c[0])?r.add(Sr):/^[-+]?(\d+$|0[xX])/.test(c)?r.add(oc):/^[-+]?\d+[.eE]/.test(c)?r.add(ic):r.add(`${s?"typeof ":""}${c}`)}let a=new Set;return cc([...r],a,t,n,i),[...a]}function cc(e,t,n,i,r){let s,a=-1,c,p,f,l,b;for(let d of e)a++,typeof d=="string"?((p=d.startsWith("typeof "))&&(d=d.substring(7)),(l=r?.[d.toUpperCase()])?cc(i.generic_types?.[l.data]??(l.type_annotations||[]),t,n,i,r):(f=(c=d==="this")&&i||zr(n,d)?.node)&&(f.kind===R.SymbolKind.TypeParameter?(b=!0,e[a]="",e.push(...rc(f.type_annotations||[],n))):f.kind!==R.SymbolKind.Variable&&(t.add(f=!p&&f.prototype||f),!c&&(e[a]=f)))):d.kind===R.SymbolKind.TypeParameter?(b=!0,e[a]="",e.push(...rc(d.type_annotations||[],n))):t.add(r?v(d):d);b&&e.push(...new Set(e.splice(0).filter(Boolean)));function v(d){let w=d.generic_types;return!w||(s??=new RegExp(`[< ](${Object.keys(r).join("|")})[,>]`,"i"),!s.test(d.full))?d:(w=w.map(D=>D.flatMap($=>typeof $=="object"?[v($)]:(l=r[$.toUpperCase()])?i.generic_types?.[l.data]??(l.type_annotations||[]):[$])),w.length||(w=void 0),{...d,generic_types:w,full:d.full.replace(/<.+/,w?`<${w.map(D=>sr(D)).join(", ")}>`:"")})}}function Mn(e,t,n){let i,r,s,a;switch(!e.cached_types){case!0:{let p=e.type_annotations;if(!p)break;i=new Set;for(let f of p){if(typeof f=="object"){i.add(f);continue}(s=f.startsWith("typeof "))&&(f=f.substring(7)),`'"`.includes(f[0])?i.add(Sr):/^[-+]?(\d+$|0[xX])/.test(f)?i.add(oc):/^[-+]?\d+[.eE]/.test(f)?i.add(ic):i.add(`${s?"typeof ":""}${f}`)}if(i.has(cn))return e.cached_types=[cn];e.cached_types=[...i],a=i.has(Cr)}default:if(cc(r=e.cached_types,i=new Set,t,n,n&&e.parent?.type_params),!a)return[...i]}let c;if(e.returns){e.cached_types=[cn],c=[];for(let p=0,f=e.returns,l=f.length;p<l;p+=2)c.push(...Fr(t,t.find_token(f[p],!0),f[p+1],n));if(i){for(let p of new Set(c))p.property&&!p.name&&!i.has(p)&&(i.add(p),r.push(p));c=[...i],e.cached_types=r}else i=new Set(c),e.cached_types=c=[...i]}else c=i?[...i]:[];return c}function Gu(e){let t;switch(e.kind){case R.SymbolKind.Interface:return e.full;case R.SymbolKind.Class:return t=e,t.prototype?`typeof ${t.full}`:t.full||"Object";case R.SymbolKind.Function:{if(e.name){let i=e,r=[e],s=[e.name];for(;i.parent?.params;)r.push(i=i.parent),s.push(i.name);if(!s.includes("")&&i.kind!==R.SymbolKind.Property)return i.kind!==R.SymbolKind.Function&&s.splice(-1,1,Gu(i)),s.reverse().join("~")}let n=e;return t=n.full.replace(/^[^()]+/,""),t.length===n.param_def_len&&(n.params.some(i=>i.range_offset)&&(t=`(${n.params.map(i=>`${i.pass_by_ref?"&":""}${i.name}${i.defaultVal===null||i.range_offset?"?":i.defaultVal?` := ${i.defaultVal}`:i.arr?"*":""}`).join(", ")})`),t+=` => ${Fo(e)||"void"}`),t}case R.SymbolKind.String:case R.SymbolKind.Number:return(e.data??e.name).toString();case 0:return"Any";case R.SymbolKind.Null:return"unset";case R.SymbolKind.Method:case R.SymbolKind.Property:if(t=e.full?.match(/^\((.+?)\)/)?.[1])return`${t}${e.static?".":"#"}${e.name}`;default:return"unknown"}}function Fo(e,t,n){return sr(e.type_annotations||Mn(e,se[e.uri]??t,n))}function sr(e){if(!e)return"";let t=[...new Set(e.map(i=>typeof i=="string"?i:Gu(i)))],n=t.pop();return n?((t=t.map(i=>i.includes("=>")&&!`"'`.includes(i[0])?`(${i})`:i)).push(n),t.join(" | ")):""}function Hi(e){if(e){let t=new Un(Hn.create("","ahk2",0,`$:${e}`),void 0,-1);return t.parseScript(),t.declaration.$?.type_annotations??!1}return!1}var Lk=[R.SymbolKind.Variable,R.SymbolKind.Function,R.SymbolKind.Field];function zr(e,t,n,i){let r=t.toUpperCase().split(/[.#~]/),s=r.length-1,a=r.shift(),c=!0,p,f,l=e.findSymbol(a,n,!s&&Lk.includes(n)?i:void 0);if(l===null)return;let b=l?.scope;if(!l||l.is_global===1?l=$(e.relevance,a)??l:l.is_global&&l.node.kind===R.SymbolKind.Variable&&(f=$(e.relevance,a),f&&(f.node.kind!==R.SymbolKind.Variable||f.node.def&&!l.node.def)&&(l=f)),n===R.SymbolKind.Field)return l;if((!l||l.node.kind===R.SymbolKind.Variable&&((c=!l.node.def)||l.is_global))&&(f=D(a))?l={uri:f.uri,node:f,is_global:!0}:b&&(b.uri??=e.uri,l.scope=b),!l)return;let v=a.length,d,w=l.node;w.uri??=l.uri;for(a of r){switch(t[v]){default:return;case"#":if(!(w=w.prototype))return;case".":if(!(w=i_(e,w,a)))return;break;case"~":if(!(w=(d=w).declaration?.[a]))return;w.uri??=d.uri}v+=a.length+1}return s&&(n===R.SymbolKind.Method&&(f=w.call)&&(f.uri??=w.uri,w=f),l={node:w,uri:w.uri,parent:d}),l;function D(C){if(f=Zt[C])return f;for(let g of[ln.ahk2_h,ln.ahk2])if(f=se[g]?.typedef[C])return f.uri??=g,f;if(c&&!s&&(f=se[p=ln.winapi]?.declaration[C]))return f.uri??=p,f}function $(C,g){let y,u;for(let B in C)if(u=(se[B]??c_(Dr(C[B]),!1))?.findSymbol(g,n)){if(u.node.kind!==R.SymbolKind.Variable)return u;(!y||u.node.def&&!y.node.def)&&(y=u)}return y}}function ci(e,t){let{text:n,word:i,range:r,kind:s}=t,a;if(n)return(a=zr(e,n,s,r.end))&&[a];let c=[],p=s===R.SymbolKind.Method,f=Fr(e,t.token,r.end);if(!i&&f.length){for(let l of f)c.push({node:l,uri:l.uri});return c}for(let l of f)(a=Tn(e,l,i,p))&&c.push({node:a,uri:a.uri,parent:l});if(c.length)return c}function fs(e,t,n){let i,r,s,a,c=e.tokens,p=e.document.offsetAt(t);function f(v){let d=c[v.offset];if(i=e.document.positionAt(v.offset),d.type==="TK_WORD"){if(a&&t.line>e.document.positionAt(a.offset+a.length).line&&!xn(a,pt))return;r=p>v.offset+d.content.length?0:-1}else{if(d.previous_token?.symbol)return;if(r=0,d.content==="["){if(d.topofline===1||!oi(d.previous_token))return;s=R.SymbolKind.Property}else if(d.prefix_is_whitespace||!oi(d.previous_token))return}if(r!==-1)for(let w of v.comma)if(p>w)++r;else break;return s??=v.method?R.SymbolKind.Method:R.SymbolKind.Function,{name:v.name??"",pos:i,index:r,kind:s}}if(n)return f(n);let l=e.find_token(p),b=a=l.previous_token;if(!(p<=l.offset&&!(l=b))){if(l.callsite&&p>l.offset+l.length&&t.line<=l.callsite.range.end.line)return f(l.paraminfo);if(!(l.topofline>0))for(;l.topofline<=0;){switch(l.type){case"TK_END_BLOCK":l=c[l.previous_pair_pos];break;case"TK_END_EXPR":l=c[(b=l).previous_pair_pos],l=l?.previous_token;break;case"TK_START_EXPR":case"TK_COMMA":if(b=l,l.paraminfo)return f(l.paraminfo);break;case"TK_OPERATOR":l.content==="%"&&!l.next_pair_pos&&(l=c[l.previous_pair_pos]);default:break}if(!(l=l?.previous_token))break;if(l.callsite&&l.paraminfo)return f(l.paraminfo)}}}var ii={},zi={};function ls(){ii={},zi={};for(let e of Object.values(se))Ci(e)}function Ci(e,t){let{uri:n,include:i}=e,r=!0,s=ii[n]??=(r=!1,{[n]:e.fsPath});t=(t??=zi[n])?{...t}:{},e.is_virtual||(t[n]=e.fsPath);for(let a in i)if(Object.assign(zi[a]??={},t),!!(e=se[a]))if(s[a])t[a]||Ci(e,t);else{if(r&&t[a])continue;let c=Ci(e,t);c[n]?s=ii[n]=Object.assign(c,s):Object.assign(s,c)}return s}function Ji(e,t,n){let i=e.markdown_detail;return i===void 0?e.detail??"":(n&&(i=i.replace(n,"")),i=i.replace(/\{@link(code|plain)?\b([^{}\n]*)\}/gm,(...r)=>{let s=r[2]?.trim()??"",a="",c,p=s.search(/[|\s]/);if(p!==-1&&(a=s.substring(p+1).trim(),s=s.slice(0,p).trim()),t&&(c=s.match(/^(([\w.$#~]|[^\x00-\x7f])+)(\(\))?$/)?.[1])){let f=zr(t,c,c.includes(".")?s.endsWith(")")?R.SymbolKind.Method:R.SymbolKind.Property:s.endsWith(")")?R.SymbolKind.Function:R.SymbolKind.Class);if(f&&(t=se[f.uri])){let{start:{line:l,character:b}}=f.node.selectionRange,v=encodeURIComponent(JSON.stringify([pn.parse(t.document.uri).toJSON(),[-1,{selection:{startLineNumber:l+1,startColumn:b+1}}]]));a||=s,s=`command:_workbench.open?${v}`}}return/^[a-z]+:/.test(s)&&(a||=s)?`[${r[1]==="code"?`\`${a}\``:a}](${s})`:` ${s} ${a} `}),i?{kind:"markdown",value:i}:"")}function No(e,t){if(e.kind===t.kind)return e.kind===R.SymbolKind.Class?F.conflictserr("class","Class",e.name):e.kind===R.SymbolKind.Function?F.conflictserr("function","Func",e.name):F.dupdeclaration();switch(t.kind){case R.SymbolKind.Variable:return F.assignerr(e.kind===R.SymbolKind.Function?"Func":"Class",e.name);case R.SymbolKind.Function:return e.kind===R.SymbolKind.Variable?F.assignerr("Func",e.name):F.conflictserr("function","Class",e.name);case R.SymbolKind.Class:return e.kind===R.SymbolKind.Function?F.conflictserr("class","Func",e.name):e.kind===R.SymbolKind.Property||e.kind===R.SymbolKind.Method?F.dupdeclaration():F.assignerr("Class",e.name);case R.SymbolKind.Property:case R.SymbolKind.Method:return F.dupdeclaration()}return""}function Mo(e,t,n){let i="",r,s,a=R.DiagnosticSeverity.Error;for(let c of t)if(!(!c.name||!c.selectionRange.end.character))switch((r=c).kind){case R.SymbolKind.Variable:r.assigned||=!!r.returns;case R.SymbolKind.Class:case R.SymbolKind.Function:if(!(s=e[i=c.name.toUpperCase()]))e[i]=c;else if(s.is_global){if(r.kind===R.SymbolKind.Variable){if(r.def&&s.kind!==R.SymbolKind.Variable){r.assigned!==1&&(c.has_warned??=n.push({message:F.assignerr(s.kind===R.SymbolKind.Function?"Func":"Class",c.name),range:c.selectionRange,severity:a}));continue}}else if(s.kind===R.SymbolKind.Function){c.has_warned??=n.push({message:No(s,c),range:c.selectionRange,severity:a});continue}else s.def&&s.assigned!==1&&(s.has_warned??=n.push({message:F.assignerr(c.kind===R.SymbolKind.Function?"Func":"Class",c.name),range:s.selectionRange,severity:a}));e[i]=c}else r.kind===R.SymbolKind.Variable?s.kind===R.SymbolKind.Variable?r.def&&!s.def?e[i]=c:s.assigned||=r.assigned:r.def&&(delete r.def,r.assigned!==1&&(c.has_warned??=n.push({message:No(s,c),range:c.selectionRange,severity:a}))):s.kind===R.SymbolKind.Variable?(s.def&&(delete s.def,s.assigned!==1&&(s.has_warned??=n.push({message:No(c,s),range:s.selectionRange,severity:a}))),e[i]=c):s.def!==!1?c.has_warned??=n.push({message:No(s,c),range:c.selectionRange,severity:a}):r.def!==!1&&(e[i]=c);break}}function xn(e,t,n){switch(e.type){case"":case"TK_COMMA":case"TK_EQUALS":case"TK_START_EXPR":return!0;case"TK_OPERATOR":if(e.ignore)return!1;if(!/^(%|\+\+|--)$/.test(e.content))return!0;default:switch(t.type){case"TK_DOT":case"TK_COMMA":case"TK_EQUALS":return!0;case"TK_OPERATOR":return!/^(!|~|not|%|\+\+|--)$/i.test(t.content)&&(!n?.ranges||!hn.test(t.content));case"TK_STRING":if(t.ignore)return!0;default:return!1}}}function s_(e){let t=as;try{e&&(as=new RegExp(e,"i"))}catch(n){throw as=t,n}return as}function a_(e){switch(e.braceStyle){case"Allman":case"0":e.braceStyle="Allman";break;case"One True Brace":case"1":e.braceStyle="One True Brace";break;case"One True Brace Variant":case"-1":e.braceStyle="One True Brace Variant";break;default:e.braceStyle="Preserve";break}return e}function Mk(e){let t=e.match(/^;\s*@format\b/i);return t?Object.fromEntries(e.substring(t[0].length).split(",").map(i=>{let r=i.indexOf(":");return[i.substring(0,r).trim(),i.substring(r+1).trim()]})):{}}function e_(e,t,n){let i=Mk(e);for(let r of["array_style","object_style"])r in i&&(t[r]=i[r],delete i[r]);Object.assign(n,i)}var l_=require("fs"),lc=Bn(ir());async function u_(e,t){let n=e.textDocument.uri,i=se[n.toLowerCase()],r=i?.document;if(!i||t.isCancellationRequested)return;let s=[],a={},c=[],p,f,l=xi.callwithoutparentheses(),b=new RegExp("^"+F.filenotexist("(.+?)\\*\\.(\\w+)")),v=new RegExp(F.didyoumean("(.+?)").replace(/\?$/,"\\?").replace(/^\w/,d=>`[${d.toUpperCase()+d.toLowerCase()}]`)+"$|^"+F.deprecated(".+?","(.+?)"));for(let d of e.context.diagnostics)if(l===d.message){let w=i.tokens[r.offsetAt(d.range.start)],$=w.callsite.range.end,C=w.next_token_offset===-1?$=d.range.end:r.positionAt(w.next_token_offset);(C.line>$.line||C.line===$.line&&C.character>$.character)&&(C=$),c.push({newText:"(",range:{start:d.range.end,end:C}},{newText:")",range:{start:$,end:$}})}else if(f=v.exec(d.message))(a[`${r.getText(d.range)} ${p=f[1]||f[2]}`]??=[]).push({range:d.range,newText:p});else if(f=b.exec(d.message)){p=r.getText(d.range).replace(/\//g,"\\").replace(/[^\\]+$/,"");let w=Dr(f[1]),D=new RegExp(`\\.${f[2]}$`,"i"),$=[],C=Object.assign({},d.range);C.start=Object.assign({},C.start),C.start.character=0;for(let u of(0,l_.readdirSync)(w))try{D.test(u)&&$.push(`#Include '${p}${u}'`)}catch{}let g={range:C,newText:$.join(`
`)},y={title:Hm.include(w+"*."+f[2]),kind:lc.CodeActionKind.QuickFix};y.edit={changes:{[n]:[g]}},s.push(y)}for(let[d,w]of Object.entries(a))s.push({kind:lc.CodeActionKind.QuickFix,edit:{changes:{[n]:w}},title:d.replace(/(\S+) (\S+)/,"Replace '$1' with '$2'")});return c.length&&s.push({kind:lc.CodeActionKind.Refactor,edit:{changes:{[n]:c}},title:"Use parenthesized function call styles"}),s.length?s:void 0}async function f_(e,t){let{range:n,color:i,textDocument:{uri:r}}=e,s=se[r.toLowerCase()]?.document.getText(n);if(!s||t.isCancellationRequested)return;let a=/^0x/.test(s)?"0x":"",c=s.length-(a?2:0)>6?"A":"",p=[i.red,i.green,i.blue];return c&&p.unshift(i.alpha),p=p.map(f=>`0${Math.round(f*255).toString(16)}`.slice(-2)),p=[p.join(""),p.reverse().join("")],[{label:`${c}RGB: ${p[0]}`,textEdit:{range:n,newText:`${a}${p[0]}`}},{label:`BGR${c}: ${p[1]}`,textEdit:{range:n,newText:`${a}${p[1]}`}}]}async function d_(e,t){if(!t.isCancellationRequested)return se[e.textDocument.uri.toLowerCase()]?.getColors()}var Ai=Bn(ir());var Zi="ahk++.",Xu=`${Zi}executeCommand`,Yi=`${Zi}getActiveTextEditorUriAndPosition`,uc=`${Zi}insertSnippet`,Qu=`${Zi}setTextDocumentLanguage`,p_=`${Zi}updateStatusBar`,dw=`${Zi}getWorkspaceFiles`,pw=`${Zi}getWorkspaceFileContent`,ps="ahk++.lsp.",h_=`${ps}exportSymbols`,g_=`${ps}getAHKversion`,m_=`${ps}getContent`,__=`${ps}getVersionInfo`,b_=`${ps}setV2Interpreter`,Yn="ahk++.",y_=`${Yn}diagnostic.full`,k_=`${Yn}addDocComment`,v_=`${Yn}setAScriptDir`,hw=`${Yn}run`,gw=`${Yn}runSelection`,mw=`${Yn}stop`,T_=`${Yn}setV2Interpreter`,_w=`${Yn}debugConfigs`,bw=`${Yn}debugParams`,yw=`${Yn}debugAttach`,kw=`${Yn}selectSyntaxes`,vw=`${Yn}updateVersionInfo`,Tw=`${Yn}exportSymbols`,ww=`${Yn}switchAhkVersion`;function jo(e){return at("commands")?.includes(e)?!0:(Zn?.console.warn(`Command '${e}' is not implemented!`),!1)}function w_(e){return e?.replace(/^[ \t]*(\*?[ \t]*(?=@)|\* ?)/gm,"").replace(/^\/\*+\s*|\s*\**\/$/g,"")??""}function Ik(e,t){jo(uc)&&Zn?.sendRequest(uc,[e,t])}function Bu(e,t){if(jo(Qu))return Zn?.sendRequest(Qu,[e,t])}function fc(e,t,n){let i=n?.replace(/\$/g,"\\$").split(`
`),r={},s=[],a=[],c=["/**"],p,f,l=0,b=!0;if(i?.forEach(d=>{(f=d.match(/^@(param|arg)\s+(({[^}]*}\s)?\s*(\[.*?\]|\S+).*)$/i))?(p=r[f[4].replace(/^\[?((\w|[^\x00-\x7f])+).*$/,"$1").toUpperCase()]??=[]).push("@param "+f[2].trim()):(f=d.match(/^@(returns?)([\s:]\s*(.*))?$/i))?(p=s,s.push(`@${f[1].toLowerCase()} ${f[3]}`)):p&&!d.startsWith("@")?p.push(d):(p=void 0,a.push(d))}),a.join("").trim()?a.forEach(d=>c.push(" * "+d)):(c.push(" * $0"),b=!1),t.params.forEach(d=>{if(p=r[d.name.toUpperCase()])p.forEach(w=>c.push(" * "+w));else if(d.name){let w=Fo(d,e);w?c.push(` * @param \${${++l}:{${w}\\}} ${d.name} $${++l}`):c.push(` * @param ${d.name} $${++l}`)}}),s.length)s.forEach(d=>c.push(" * "+d));else{let d=Fo(t,e);d&&c.push(` * @returns \${${++l}:{${d}\\}} $${++l}`)}c.push(" */");let v=c.join(`
`);return b&&(v=v.replace(new RegExp(`\\$${l}\\b`),"$0")),v}async function Fk(){if(!jo(Yi)||!jo(uc))return;let{uri:e,position:t}=await Zn?.sendRequest(Yi),n=se[e.toLowerCase()],i=n.searchScopedNode(t),r=i?.children||n.children;for(let f of r)if((f.kind===Ai.SymbolKind.Function||f.kind===Ai.SymbolKind.Method)&&f.selectionRange.start.line===t.line&&f.selectionRange.start.character<=t.character&&t.character<=f.selectionRange.end.character){i=f;break}if(!i||!i.params)return;let s,a=i.selectionRange.start,c,p;if(i.markdown_detail===void 0)s=`${fc(n,i)}
`,c=n.tokens[n.document.offsetAt(a)],c.topofline===2&&(c=c.previous_token),a=n.document.positionAt(c.offset),p={start:a,end:a};else{if(c=n.find_token(n.document.offsetAt({line:a.line-1,character:0})),c.type!=="TK_BLOCK_COMMENT")return;s=fc(n,i,w_(i.detail)),p={start:n.document.positionAt(c.offset),end:n.document.positionAt(c.offset+c.length)}}Ik(s,p)}function R_(e){let t=se[e.toLowerCase()],n={},i={};if(!t)return;ls();for(let s of[t.uri,...Object.keys(t.relevance)]){if(!(t=se[s]))continue;let a;a=Object.entries(t.include).map(c=>se[c[0]]?.fsPath??Dr(c[1])),!a.length&&(a=void 0),r(Object.values(t.declaration),i[t.fsPath||t.document.uri]={includes:a},t)}return i;function r(s,a,c,p){let f,l,b,v;for(let C of s)if(C.selectionRange.end.character)switch(f=C.kind){case Ai.SymbolKind.Class:b=C,(a.classes??=[]).push(v={name:C.name,label:b.full,extends:w(b),detail:D(C)}),r(Object.values(b.property??{}),v,c,b),r(Object.values(b.$property??{}),v,c,b.prototype);break;case Ai.SymbolKind.Property:if(l=C,(a.properties??=[]).push({name:C.name,label:l.full,static:l.static??!1,variadic:l.variadic??!1,params:$(l.params),readonly:l.params&&!C.set||!1,type:Fo(l,c,p),detail:D(C)}),!(C=C.call))break;case Ai.SymbolKind.Function:case Ai.SymbolKind.Method:l=C,(a[f===Ai.SymbolKind.Function?"functions":"methods"]??=[]).push({name:C.name,label:l.full,static:l.static??!1,variadic:l.variadic??!1,params:$(l.params),returns:Fo(l,c,p),detail:D(C)});break}function d(C){switch(C.defaultVal){case!1:return null;case null:return"unset";default:return C.defaultVal}}function w(C){let g;if(g=C.extends)return n[`${C.extendsuri},${g}`]??=ai(t,g,C.extendsuri)?.full||g}function D(C){return C.markdown_detail?w_(C.detail):C.detail??""}function $(C){return C?.map(g=>({name:g.name,defval:d(g),byref:g.pass_by_ref??!1,variadic:g.arr??!1,type:sr(g.type_annotations)}))}}}async function qk(){if(!jo(Yi))return;let{uri:e}=await Zn?.sendRequest(Yi),t=se[e.toLowerCase()];if(t){ls();for(let n in t.relevance)(n=se[n]?.document.uri)&&hs({textDocument:{uri:n}});hs({textDocument:{uri:e}})}}async function jk(){if(!jo(Yi))return;let{uri:e}=await Zn?.sendRequest(Yi),t=se[e.toLowerCase()];t&&(t.scriptdir!==t.scriptpath&&(t.initLibDirs(t.scriptpath),t.need_scriptdir&&t.parseScript()),Io(t,t.scriptpath),Ci(t),t.sendDiagnostics(!1,!0))}function x_(e){let t=se[e.toLowerCase()];if(!t)return;let n=t.document,i=t.tokens,r={line:0,character:0},s=t.get_token(0);for(;s.type==="TK_SHARP";)r.line=n.positionAt(s.offset).line+1,s=t.get_token(n.offsetAt(r));let a=[];(!s.type||s.type.endsWith("COMMENT"))&&/^\s*[;*]?\s*@(date|version)\b/im.test(s.content)&&a.push({uri:e,content:s.content,single:!1,range:{start:n.positionAt(s.offset),end:n.positionAt(s.offset+s.length)}});for(let c of t.tokenranges)if(c.type===1&&(s=i[c.start])?.topofline&&/^;\s*@ahk2exe-setversion\b/i.test(s.content))return a.concat({uri:e,content:s.content,single:!0,range:{start:n.positionAt(c.start),end:n.positionAt(c.end)}});return a}var dc={[y_]:()=>qk(),[k_]:()=>Fk(),[v_]:jk};function C_(e,t){if(!t?.isCancellationRequested)return dc[e.command]?.(e.arguments??[])}var cr=require("fs"),eo=require("path"),Oe=Bn(ir());function Xr(e){if(typeof e!="object")return e;var t,n,i=Object.prototype.toString.call(e);if(i==="[object Object]"){if(e.constructor!==Object&&typeof e.constructor=="function"){n=new e.constructor;for(t in e)e.hasOwnProperty(t)&&n[t]!==e[t]&&(n[t]=Xr(e[t]))}else{n={};for(t in e)t==="__proto__"?Object.defineProperty(n,t,{value:Xr(e[t]),configurable:!0,enumerable:!0,writable:!0}):n[t]=Xr(e[t])}return n}if(i==="[object Array]"){for(t=e.length,n=Array(t);t--;)n[t]=Xr(e[t]);return n}return i==="[object Set]"?(n=new Set,e.forEach(function(r){n.add(Xr(r))}),n):i==="[object Map]"?(n=new Map,e.forEach(function(r,s){n.set(Xr(s),Xr(r))}),n):i==="[object Date]"?new Date(+e):i==="[object RegExp]"?(n=new RegExp(e.source,e.flags),n.lastIndex=e.lastIndex,n):i==="[object DataView]"?new e.constructor(Xr(e.buffer)):i==="[object ArrayBuffer]"?e.slice(0):i.slice(-6)==="Array]"?new e.constructor(e):e}async function S_(e,t){let{position:n,textDocument:{uri:i}}=e,r=se[i=i.toLowerCase()],s={};if(!r||t.isCancellationRequested)return;let a=[],c=a.pop(),p,f,l,b,v,{triggerKind:d,triggerCharacter:w}=e.context??{},D=Q=>Q;if(w==="*"){let Q=r.tokens[r.document.offsetAt(n)-3];if(Q?.type==="TK_BLOCK_COMMENT"){!Q.previous_token?.type&&Q===r.get_token(0,!1)&&a.push({label:"/** */",detail:"File Doc",kind:Oe.CompletionItemKind.Text,insertTextFormat:Oe.InsertTextFormat.Snippet,textEdit:Oe.TextEdit.replace({start:r.document.positionAt(Q.offset),end:r.document.positionAt(Q.offset+Q.length)},["/************************************************************************"," * @description ${1:}"," * @author ${2:}"," * @date ${3:$CURRENT_YEAR/$CURRENT_MONTH/$CURRENT_DATE}"," * @version ${4:0.0.0}"," ***********************************************************************/","$0"].join(`
`))});let ve=yn(Q);if(ve){let ze=ve;a=[{label:"/** */",detail:"JSDoc Comment",kind:Oe.CompletionItemKind.Snippet,insertTextFormat:Oe.InsertTextFormat.Snippet,textEdit:Oe.TextEdit.replace({start:r.document.positionAt(Q.offset),end:r.document.positionAt(Q.offset+Q.length)},`/**
 * $0
 */`)}],ze.params&&(a[0].textEdit.newText=fc(r,ze))}}return a}if(w==="@"){let Q=r.findStrOrComment(r.document.offsetAt(n)-1);if(Q?.type.endsWith("COMMENT")){let ve=r.document.positionAt(Q.offset).line===n.line,ze=Q.type==="TK_BLOCK_COMMENT"?"/*":";";return Yt.directive["@"].filter(Ae=>ze.includes(p=Ae.data)&&(ve||p!=="/"))}return}let $=Object.fromEntries(Object.entries(at("v2.completionCommitCharacters")??{}).map(Q=>(Q[1]=(Q[1]||void 0)?.split(""),Q))),{text:C,word:g,token:y,range:u,linetext:B,kind:h,symbol:le}=r.getContext(n,!0),ge=Xr(r.relevance),{line:Ne,character:Re}=n;for(let Q in ge)ri(Q)&&(console.log("Excluding "+Q+" from completion suggestions"),delete ge[Q]);let W=!1,U=Ko(g),Ke;switch(y.type){case"TK_UNKNOWN":if(y.content===".")break;if(y.content!=="#")return;case"TK_SHARP":return y.topofline===1?Yt.directive["#"]:[];case"TK_HOT":case"TK_HOTLINE":{if(!y.ignore)return Yt.key.filter(ve=>!ve.label.toLowerCase().includes("alttab"));let Q=r.document.offsetAt(n)-y.offset;return 0<Q&&Q<=C.indexOf(":",1)?Yt.option.hotstring:void 0}case"":case"TK_EOF":if((l=y.previous_token)?.type==="TK_SHARP"){let Q=!1;switch(l.content.toLowerCase()){case"#dllload":Q=!0;case"#include":case"#includeagain":{let ve=r.document.offsetAt(n)-y.offset,ze=y.content,Ae=ze.slice(0,ve),bt,ht=Ae[0],Vt=!1,it="";if(`'"`.includes(ht)?Ae=Ae.slice(1):ht="",Ae=Ae.replace(/^\*i[ \t]/i,""),Ae.startsWith("*")){U=Ko(Ae.slice(1));for(let Ye of Ir.get_RCDATA()?.paths??[])U.test(Ye)&&Bt(Ye,Oe.CompletionItemKind.File);return a}if(Ae[0]==="<"&&(ht=">"+ht,Ae=Ae.slice(1)),/["<>*?|]/.test(Ae)||Q&&ht.startsWith(">"))return;if(Ae=Ae.replace(/`(.)/g,"$1").replace(/[^\\/]+$/,Ye=>(it=Ye,"")),!ht.startsWith(">")&&ze.includes("%")){if(ze.replace(/%[^%]+%/g,qe=>"\0".repeat(qe.length))[ve]==="\0")return Object.values(Zt).filter(qe=>qe.kind===Oe.SymbolKind.Variable&&U.test(qe.name)).map(Je);let Ye={...On,scriptdir:r.scriptdir,linefile:r.fsPath};if(Ae=Ae.replace(/%a_(\w+)%/i,(qe,O)=>{let re=Ye[O.toLowerCase()];return typeof re=="string"?re:"\0"}),Ae.includes("\0"))return}if(Q)bt=[(v=r.dlldir.get(n.line))?v:r.scriptpath,"C:\\Windows\\System32"];else if(ht.startsWith(">"))bt=r.libdirs,Vt=!0;else{let Ye=r.scriptpath,qe=n.line;for(let[O,re]of r.includedir)if(O<qe)Ye=re;else break;bt=[Ye]}ht&&(ze.endsWith(ht)||ze.endsWith(">")?ht="":ht.length===2&&ze.endsWith(ht[1])&&(ht=ht[0]));let ot=Ae.endsWith("/")?"/":"\\",Le=Ko(it),je=Q?/\.(dll|ocx|cpl)$/i:Vt?/\.ahk$/i:/\.(ahk2?|ah2)$/i,xt={title:"Trigger Suggest",command:"editor.action.triggerSuggest"},be=hn.test(it)?void 0:{start:{line:n.line,character:n.character-it.length},end:n},tt=be?(Ye,qe)=>Ye.textEdit={newText:qe,range:be}:(Ye,qe)=>Ye.insertText=qe,Mt=be||ht?tt:()=>{};for(let Ye of bt)if(!(!(0,cr.existsSync)(Ye=(0,eo.resolve)(Ye,Ae)+"\\")||!(0,cr.statSync)(Ye).isDirectory()||s[Ye=Ye.toUpperCase()])){try{s[Ye]=1;for(let qe of(0,cr.readdirSync)(Ye))try{if((0,cr.statSync)(Ye+qe).isDirectory()){if(!Le.test(qe))continue;s[`${qe.toUpperCase()}/`]??=(qe=qe.replace(/(`|(?<= );)/g,"`$1"),tt(c={label:qe,command:xt,kind:Oe.CompletionItemKind.Folder},qe+ot),1)}else{if(!je.test(qe)||!Le.test(Vt?qe=qe.replace(je,""):qe))continue;s[qe.toUpperCase()]??=(qe=qe.replace(/(`|(?<= );)/g,"`$1"),Mt(c={label:qe,kind:Oe.CompletionItemKind.File},qe+ht),1)}a.push(c)}catch{}}catch{}if(Ae.includes(":"))break}return a}default:return}}else if(l?.type!=="TK_HOTLINE")return;if(l.ignore)return Rt(),a;a.push(...Yt.key),h=Oe.SymbolKind.Event;break;case"TK_BLOCK_COMMENT":if(!/[<{|:.,][ \t]*$/.test(B.substring(0,u.start.character)))return;if(C.includes("."))for(let Q of Object.values(ai(r,C.replace(/\.[^.]*$/,""))?.property??{}))Q.kind===Oe.SymbolKind.Class&&U.test(Q.name)&&a.push(Je(Q));else en();return a;case"TK_COMMENT":case"TK_INLINE_COMMENT":return;default:{if(y.callsite||y.topofline>0)break;let Q=["TK_COMMA","TK_DOT","TK_EQUALS","TK_NUMBER","TK_OPERATOR","TK_RESERVED","TK_STRING","TK_WORD"],ve=y.type==="TK_STRING"?0:3,ze=r.tokens,Ae=0,bt,ht=(l=y).callsite,Vt=ht?.paraminfo;for(;(l=(bt=ze[l.previous_pair_pos])??l.previous_token)&&++Ae!==ve;){if(bt){if(W=!0,l.topofline>0||(Ae++,!(l=bt.previous_token))||l.topofline>0){l=void 0;break}continue}if(W||=l.next_pair_pos!==void 0||Q.includes(l.type),Vt??=l.paraminfo){l=ze[Vt.offset]?.previous_token,Ae++,W=!0;break}if((ht??=l.callsite)||l.topofline>0)break}if((ht??Vt)&&(Vt??=ht?.paraminfo,W=!0),l?.type==="TK_RESERVED")switch(p=l.content.toLowerCase()){case"class":if(Ae===2)return[{label:"extends",kind:Oe.CompletionItemKind.Keyword,preselect:!0}];if(Ae===3&&y.previous_token?.content.toLowerCase()==="extends")Ae=1;else return;case"catch":if(Ae!==1)return;if(C)en();else{let it=y,ot=r.document.offsetAt(u.end);for(C=y.content;(it=ze[it.next_token_offset])&&it.offset<ot;C+=it.content);if(hn.test(C.replace(/\./g,"")))for(let Le of Object.values(ai(r,C)?.property??{}))Le.kind===Oe.SymbolKind.Class&&U.test(Le.name)&&a.push(Je(Le))}return a;case"break":case"continue":case"goto":{if(Ae===1&&y.type!=="TK_WORD")return;b=r.searchScopedNode(n);let it=(b??r).labels,ot,Le=r.document.offsetAt(n);for(let je in it)if(U.test(je))for(let xt of it[je]){if(!xt.def)break;if((ot=xt.data)===-1||ot<Le&&(!(ot=ze[ze[ot].next_pair_pos]?.offset)||Le<ot)){a.push(Je(xt));break}}if(!b){for(let je in ge)for(let xt in it=se[je]?.labels)if(U.test(xt))for(let be of it[xt]){if(!be.def)break;if(be.data===-1){a.push(Je(be));break}}}if(Ae===1||Ae===2&&!ve)return a;if(ve)for(let je of a)je.insertText=`'${je.insertText}'`}}else if(!ve&&!y.ignore){let it=new Set,ot=Vt&&fs(r,n,Vt),Le,je,xt=C.substring(1).endsWith(C[0])?"":C[0],be=xt?Mt=>({label:Mt,kind:Le,insertText:`${Mt}${xt}`}):Mt=>({label:Mt,kind:Le,command:je});if(ot){let Mt,Ye,qe,O,re,ae=ci(r,r.getContext(ot.pos))??[],xe=Object.values(ln),yt=[],Pt=[];for(re of ae){if(Mt=re.node,Pt.includes(Mt))continue;switch(Pt.push(Mt),O=xe.includes(Mt.uri),qe=ot.index,Ye=Mt.name.toLowerCase(),Le=Oe.CompletionItemKind.Value,je={title:"cursorRight",command:"cursorRight"},O&&(re.kind??ot.kind)){case Oe.SymbolKind.Method:switch(Ye){case"deleteprop":case"getmethod":case"getownpropdesc":case"hasownprop":case"hasmethod":case"hasprop":{if(qe!==0||!re.parent)continue;let Ze=Ye.endsWith("method")?lt=>lt!==Oe.SymbolKind.Method:void 0;for(let lt of Object.values(Xi(r,re.parent,yt)))U.test(lt.name)&&!Ze?.(lt.kind)&&Bt(lt.name,lt.kind===Oe.SymbolKind.Method?Oe.CompletionItemKind.Method:Oe.CompletionItemKind.Property);continue}case"bind":case"call":if(Pt.pop(),!re.parent||![Oe.SymbolKind.Function,Ye==="call"&&Oe.SymbolKind.Class].includes(re.parent.kind))break;{let Ze=re.parent;ae.push({node:Ze,uri:Ze.uri,kind:Ze.kind});continue}}break;case Oe.SymbolKind.Function:switch(Ye){case"dynacall":if(qe!==0)continue;case"dllcall":if(qe===0){await ut();continue}qe++;case"comcall":if(qe>1&&qe%2===0)for(let Ze of["cdecl"].concat($u))Bt(Ze,Oe.CompletionItemKind.TypeParameter)&&(c.commitCharacters=["*"]);continue;case"comobject":qe===0&&a.push(...(await Ju("GetProgID",[]))?.filter(Ze=>U.test(Ze)).map(be)??[]);continue;case"numget":if(qe===2||qe===1)qe=0;else continue;case"numput":if(qe%2===0)for(let Ze of $u.filter(lt=>!/str$/i.test(lt)))Bt(Ze,Oe.CompletionItemKind.TypeParameter);continue;case"hotkey":qe<2&&a.push(...Yt.key.filter(Ze=>U.test(Ze.label)));continue;case"objbindmethod":case"hasmethod":case"objhasownprop":case"hasprop":if(qe===1){let Ze=Vt?.comma[0];if(!Ze)continue;let lt=Ye.endsWith("method")?qt=>qt!==Oe.SymbolKind.Method:void 0;for(let qt of Fr(r,r.find_token(Vt.offset+1,!0),Ze))for(let It of Object.values(Xi(r,qt,yt)))U.test(It.name)&&!lt?.(It.kind)&&Bt(It.name,It.kind===Oe.SymbolKind.Method?Oe.CompletionItemKind.Method:Oe.CompletionItemKind.Property)}continue}}Mt.kind===Oe.SymbolKind.Class&&(ot.kind===Oe.SymbolKind.Property?Mt=Tn(se[Mt.uri],Mt,"__item",!1):Mt=Qi(Mt));let _t=Mt?.params?.[qe];if(_t){if(O){if(_t.name==="Keys"){Le=Oe.CompletionItemKind.Text,je=void 0,Ye.includes("send")&&a.push(be("Blind")),a.push(...Yt.key.filter(Ze=>U.test(Ze.label)));continue}if(_t.name==="WinTitle"){a.push(...Yt.option.ahk_criteria.filter(Ze=>U.test(Ze.label)));continue}}await tt(_t.type_annotations||[])}}}if(!a.length&&(l=y.previous_token)?.content===":="&&(l=l?.previous_token)?.type==="TK_WORD"){let Mt=ci(r,r.getContext(r.document.positionAt(l.offset)))??[];Le=Oe.CompletionItemKind.Value,je={title:"cursorRight",command:"cursorRight"};for(let Ye of Mt)await tt(Ye.node.type_annotations||[])}return!a.length&&Rt(),a;async function tt(Mt){let Ye;for(let qe of Mt)if(!it.has(qe))switch(it.add(qe),qe){case zu:Fe(!0);break;case Hu:await ut();break;case sc:Fe();break;case Sr:Le=Oe.CompletionItemKind.Text,je=void 0;break;default:if(typeof qe=="string"){/['"]/.test(qe[0])?qe.endsWith(qe[0])&&U.test(qe=qe.slice(1,-1))&&a.push(be(qe)):(Ye=zr(r,qe)?.node)?.type_annotations&&!it.has(Ye)&&Ye.kind===Oe.SymbolKind.TypeParameter&&(it.add(Ye),await tt(Ye.type_annotations));break}qe.data===sc&&(qe=qe.generic_types?.[0]?.[0]??"",typeof qe=="string"&&/^(['"])\w+(\|\w+)*\1$/.test(qe)&&Fe(!1,new RegExp(`[^.\\/]+$(?<!\\.(${qe.slice(1,-1)}))`,"i")));break}}}}}let ye="([".includes(B[u.end.character]||"\0"),ct=at("v2.formatter.braceStyle")==="Allman"?`
`:" ";if(le){if(!le.children&&(b??=r.searchScopedNode(n))?.kind===Oe.SymbolKind.Class){let Q=b,ve=["__Init()","__Call(${1:Name}, ${2:Params})","__Delete()","__Enum(${1:NumberOfVars})","__Get(${1:Key}, ${2:Params})","__Item[$1]","__New($1)","__Set(${1:Key}, ${2:Params}, ${3:Value})"];if(a.push(...Yt.snippet),y.topofline===1&&a.push(Yt.static,{label:"class",insertText:["class $1",`{
	$0
}`].join(ct),kind:Oe.CompletionItemKind.Snippet,insertTextFormat:Oe.InsertTextFormat.Snippet}),r.tokens[y.next_token_offset]?.topofline===0)return y.topofline===1?(a.pop(),a):void 0;le.static??!1?ve.splice(0,1):Q=Q.prototype??{},y.topofline&&ve.forEach(Ae=>{let bt=Ae.replace(/[([].*$/,"");a.push({label:bt,kind:Oe.CompletionItemKind.Snippet,insertTextFormat:Oe.InsertTextFormat.Snippet,insertText:Ae+ct+`{
	$0
}`})});for(let Ae of Object.values(Xi(r,Q)))Bt(Ae.name,Ae.kind===Oe.SymbolKind.Method?Oe.CompletionItemKind.Method:Oe.CompletionItemKind.Property);return a}return}if(h===Oe.SymbolKind.Null)return;if(h===Oe.SymbolKind.Property||h===Oe.SymbolKind.Method){if(!y.symbol&&y.semantic?.type===5)return;let Q={},ve=Fr(r,y,u.end),ze=0,Ae=ve.includes(cn),bt=[],ht={};B[u.end.character]==="."&&(ye="([".includes(B.charAt(u.end.character+g.length+1)||"\0")),Ae?ve=[]:D=it=>ht[it]??it;for(let it of ve){if(it.kind===Oe.SymbolKind.Interface){let Le=it.generic_types?.[0]?.map(xt=>`'"`.includes(xt[0])?xt.slice(1,-1):xt);if(!Le?.length)continue;let je=await Ju("GetDispMember",Le)??{};Object.entries(je).forEach(xt=>U.test(xt[0])&&Bt(xt[0],xt[1]===1?Oe.CompletionItemKind.Method:Oe.CompletionItemKind.Property));continue}let ot=Xi(r,it,bt);for(let Le=bt.length;ze<Le;ze++)ht[bt[ze].full]=`0000${ze}`.slice(-4);for(let[Le,je]of Object.entries(ot))U.test(Le)&&((v=Q[Le])?v.detail?.endsWith(je.full??"")||(v.detail="(...) "+(v.insertText=je.name),v.commitCharacters=v.command=v.documentation=void 0,v.sortText=v.labelDetails=void 0):a.push(Q[Le]=Je(je)))}if(!Ae&&(d!==1||g.length<3))return a;let Vt=new Set([r.object,se[ln.ahk2]?.object,se[ln.ahk2_h]?.object]);Vt.delete(void 0);for(let it in ge)Vt.add(se[it].object);for(let it in v=r.object.property){let ot=v[it];ot.length===1&&!ot[0].full&&rt(ot[0])&&delete v[it]}for(let it of Vt)for(let ot of Object.values(it))for(let[Le,je]of Object.entries(ot))if(U.test(Le)){if(v=Q[Le]){if(v.detail?.endsWith(je[0].full??""))continue}else if(a.push(Q[Le]=v=Je(je[0])),je.length===1)continue;v.detail="(...) "+v.label,v.insertText?.endsWith(")")&&je.some(xt=>xt.kind===Oe.SymbolKind.Property)&&(v.insertText=v.label,v.kind=Oe.CompletionItemKind.Property),v.commitCharacters=v.command=v.documentation=void 0}return a}if(a.push(...Yt.snippet),b??=r.searchScopedNode(n),b?.children&&b.kind===Oe.SymbolKind.Property)return y.topofline!==1?void 0:[{label:"get",kind:Oe.CompletionItemKind.Function},{label:"set",kind:Oe.CompletionItemKind.Function}];let De=at("v2.formatter.keywordStartWithUppercase"),S=De?function(Q){a.push(Q=Object.assign({},Q)),Q.insertText=(Q.insertText??Q.label).replace(/(?<=^(loop\s)?)[a-z]/g,ve=>ve.toUpperCase())}:Q=>a.push(Q);if(W)for(let Q of Yt.keyword){if(Q.label==="break")break;U.test(Q.label)&&S(Q)}else{let Q=Oe.CompletionItemKind.Snippet,ve=Oe.InsertTextFormat.Snippet,ze=bt=>bt,Ae=ze;De&&(ze=bt=>bt.replace(/\b[a-z](?=\w)/g,ht=>ht.toUpperCase())),at("v2.formatter.switchCaseAlignment")&&(Ae=bt=>bt.replace(/^\t/gm,""));for(let[bt,ht]of[["switch",["switch ${1:[SwitchValue, CaseSense]}",Ae(`{
	case \${2:}:
		\${3:}
	default:
		$0
}`)]],["trycatch",["try",`{
	$1
}`,"catch ${2:Error} as ${3:e}",`{
	$0
}`]],["class",["class $1",`{
	$0
}`]]])a.push({label:bt,kind:Q,insertTextFormat:ve,insertText:ze(ht.join(ct))});for(let bt of Yt.keyword)U.test(bt.label)&&S(bt)}!b&&(v=B.match(/^\s*(((([<>$~*!+#^]*?)(`?;|[a-z]\w+|[\x21-\x3A\x3C-\x7E]|[^\x00-\x7f]))|~?(`?;|[\x21-\x3A\x3C-\x7E]|[a-z]\w+|[^\x00-\x7f])\s*&\s*~?(`?;|[\x21-\x3A\x3C-\x7E]|[a-z]\w+|[^\x00-\x7f]))\s*(\s(up?)?)?)$/i))&&(a=a.concat(v[8]?{label:"Up",kind:Oe.CompletionItemKind.Keyword}:Yt.key.filter(Q=>!Q.label.toLowerCase().includes("alttab"))));for(let Q in Zt)U.test(Q)&&(s[Q]=Je(Zt[Q]));for(let Q of Object.values(r.declaration))U.test(p=Q.name.toUpperCase())&&!rt(Q)&&(!s[p]||Q.kind!==Oe.SymbolKind.Variable)&&(s[p]=Je(Q));let Et=Object.keys(ge).reverse();for(let Q of new Set([r.d_uri,...Et.map(ve=>se[ve]?.d_uri),...Et])){if(!(v=se[Q]))continue;let ve=v.d;f=v.fsPath,v=v.declaration;for(let ze in v){let Ae=v[ze];U.test(ze)&&(ve||!s[ze]||s[ze].kind===Oe.CompletionItemKind.Variable&&Ae.kind!==Oe.SymbolKind.Variable)&&(s[ze]=c=Je(Ae))}}b&&(n=u.end,Object.entries(r.getScopeSymbols(b)).forEach(([Q,ve])=>{U.test(Q)&&(ve.def!==!1||!s[Q]&&!rt(ve))&&(s[Q]=Je(ve))}));let Lt=Ao(),Pe=Ui();if(console.log("includeUserStdLib:",Lt,", includeLocalLib:",Pe),Lt||Pe){let it=function(ot){let Le=(ot=ot.replace(/(\s);/g,"$1`;")).toLowerCase(),je=[],xt=r.scriptpath,be=0,tt=-1;for(let O of Q)if(++be,Le.startsWith(O.toLowerCase())){let re=(0,eo.basename)(ot);Le.endsWith(".ahk")&&!Q.slice(0,be-1).some(ae=>(0,cr.existsSync)(ae+re))?je.push(`#Include <${(0,eo.relative)(O,ot.slice(0,-4))}>`):be===1?je.push(`#Include %A_MyDocuments%\\AutoHotkey\\Lib\\${re}`):be===2?je.push(`#Include %A_AhkPath%\\..\\Lib\\${re}`):je.push(`#Include %A_ScriptDir%\\Lib\\${re}`)}r.includedir.forEach((O,re)=>{Le.startsWith(O.toLowerCase()+"\\")?O.length>=xt.length&&(tt=re,xt=O):xt||(tt=re)}),tt===-1&&(tt=Ae),xt.charAt(0)===Le.charAt(0)&&je.push(`#Include ${(0,eo.relative)(xt,ot)}`);let Mt={line:r.document.lineCount,character:0},Ye=`#Include ${ot}`,qe;return je.forEach(O=>O.length<Ye.length&&(Ye=O)),Ye=`
`+Ye,tt!==-1?(qe=r.document.getText({start:{line:tt,character:0},end:{line:tt+1,character:0}}),Mt={line:tt,character:qe.length}):n.line===Mt.line-1&&((bt??=(ht=r.find_token(0))?.type.endsWith("COMMENT")&&!yn(ht))?(Mt=r.document.positionAt(ht.offset+ht.length),Ye=`
`+Ye):(Mt.line=0,Ye=Ye.trimStart()+`
`)),[Oe.TextEdit.insert(Mt,Ye)]};var Sn=it;let Q=r.libdirs,ve={},ze=0,Ae=-1,bt,ht,Vt=r.workspaceFolder;Vt=(Vt?pn.parse(Vt).fsPath:r.scriptdir).toLowerCase(),r.includedir.forEach((ot,Le)=>Ae=Le);for(let ot in In){if(ri(ot)){console.log("Excluding",ot);continue}if(!ge[ot]&&(f=In[ot].fsPath)&&(Lt&&In[ot].islib||Pe&&f.toLowerCase().startsWith(Vt))){for(let Le of In[ot])U.test(p=Le.name)&&!s[p.toUpperCase()]&&(c=Je(Le),ze++,c.additionalTextEdits=ve[f]??=it(f),c.detail=`${ti.include(f)}

${c.detail??""}`,console.log(`Adding ${c.label} to vars`),s[p.toUpperCase()]=c);if(ze>300)break}}}if(Et.unshift(r.uri),!Et.includes(ln.winapi)&&Et.some(Q=>se[Q]?.include[ln.winapi])){for(let Q in v=se[ln.winapi]?.declaration)if(U.test(Q)&&!s[Q]){let ve=Je(v[Q]);s[Q]=ve}}if(!W&&h!==Oe.SymbolKind.Event&&(d===1&&C.length>2&&C.includes("_")||/[A-Z]{2,}/.test(C)))for(let Q of Yt.constant)U.test(Q.label)&&a.push(Q);let rn=a.concat(Object.values(s));return console.log("Vars:",Object.values(s).map(Q=>Q.label).join(`
`)),rn;function yn(Q){if(Q.symbol)return Q.symbol;let ve,ze=r.tokens[Q.next_token_offset];if(ze&&((ve=ze.symbol)?.detail??(ve=r.tokens[ze.next_token_offset]?.symbol)?.detail)!==void 0)return ve}function en(){let Q,ve=[Zt,r.declaration];for(let ze in ge)(Q=se[ze])&&ve.push(Q.declaration);for(let ze of ve)for(let Ae in ze)(Q=ze[Ae]).kind===Oe.SymbolKind.Class&&U.test(Ae)&&(s[Ae]??=a.push(Je(Q)))}function Fe(Q=!1,ve){Ke??=r.document.offsetAt(n);let ze=y.content.substring(1,Ke-y.offset),Ae="";if(/[*?"<>|\t]/.test(ze))return;/^\w:[\\/]/.test(ze)||(ze=`${r.scriptdir}/${ze}`),ze=ze.replace(/`(.)/g,"$1").replace(/[^\\/]+$/,Le=>(Ae=Le,""));try{if(!(0,cr.existsSync)(ze)||!(0,cr.statSync)(ze).isDirectory())return}catch{return}let bt=ze.endsWith("/")?"/":"\\",ht=Ko(Ae),Vt={title:"Trigger Suggest",command:"editor.action.triggerSuggest"},it=hn.test(Ae)?void 0:{start:{line:n.line,character:n.character-Ae.length},end:n},ot=it?(Le,je)=>Le.textEdit={newText:je,range:it}:(Le,je)=>Le.insertText=je;try{for(let Le of(0,cr.readdirSync)(ze))if(ht.test(Le))try{if((0,cr.statSync)(ze+Le).isDirectory())Le=Le.replace(/(`|(?<= );)/g,"`$1"),ot(c={label:Le,command:Vt,kind:Oe.CompletionItemKind.Folder},Le+bt);else{if(Q||ve?.test(Le))continue;Le=Le.replace(/(`|(?<= );)/g,"`$1"),c={label:Le,kind:Oe.CompletionItemKind.File},it&&(c.textEdit={range:it,newText:Le})}a.push(c)}catch{}}catch{}}async function ut(){Ke??=r.document.offsetAt(n);let Q=y.content.substring(1,Ke-y.offset),ve="",ze,Ae=[r],bt={};for(let Le in ge)(ze=se[Le])&&Ae.push(ze);Q=Q.replace(/`(.)/g,"$1").replace(/[^\\/]+$/,Le=>(ve=Le,""));let ht=Ko(ve),Vt=Oe.CompletionItemKind.Function,it=hn.test(ve)?void 0:{start:{line:n.line,character:n.character-ve.length},end:n},ot=Le=>(Le=Le.replace(/(`|(?<= );)/g,"`$1"),c={label:Le,kind:Oe.CompletionItemKind.File},it?c.textEdit={range:it,newText:`${Le}\\`}:c.insertText=`${Le}\\`,c);if(Q){if(Fe(!1,/[^.\\/]+$(?<!\.(dll|ocx|cpl))/i),Q.endsWith("/")||Q.endsWith(":\\"))return;let Le=new Set,je=Q.slice(0,-1).replace(/\\/g,"/").toLowerCase(),xt=!0;/\.\w+$/.test(je)||(je+=".dll"),je.includes(":")?Le.add(je):je.includes("/")?Le.add(r.scriptpath+(je.startsWith("/")?je:`/${je}`)):(je=`/${je}`,Ae.forEach(be=>be.dllpaths.forEach(tt=>{(tt=tt.toLowerCase()).endsWith(je)&&(Le.add(tt),xt=!1)})),xt&&(Le.add(je.substring(1)),Ae.forEach(be=>Le.add(be.scriptpath+je))));for(let be of await Ir.get_DllExport(Le,!0))ht.test(be)&&a.push({label:be,kind:Vt})}else{Ae.forEach(Le=>Le.dllpaths.forEach(je=>ht.test(je=je.replace(/^.*[\\/]/,""))&&(bt[je.toUpperCase()]??=a.push(ot(je.replace(/\.dll$/i,""))))));try{for(let Le of(0,cr.readdirSync)("C:\\Windows\\System32"))/\.(dll|ocx|cpl)$/i.test(Le)&&ht.test(Le)&&(bt[Le.toUpperCase()]??=a.push(ot(Le.replace(/\.dll$/i,""))))}catch{}for(let Le of pc)ht.test(Le)&&a.push({label:Le,kind:Vt})}}function Rt(){for(let Q of Yt.text)U.test(Q.label)&&(s[Q.label.toUpperCase()]=!0,a.push(Q));for(let Q in v=r.texts)U.test(Q)&&Bt(v[Q],Oe.CompletionItemKind.Text);for(let Q in ge)for(let ve in v=se[Q]?.texts)U.test(ve)&&Bt(v[ve],Oe.CompletionItemKind.Text)}function Bt(Q,ve){return s[p=Q.toUpperCase()]?!1:(a.push(c={label:Q,kind:ve}),s[p]=!0)}function rt(Q){return Q.selectionRange.end.line===Ne&&Re===Q.selectionRange.end.character}function on(Q,ve){let ze=ve?.full;ze&&(Q.sortText=D(ze),Q.labelDetails={description:ze})}function Je(Q){let ve=Oe.CompletionItem.create(Q.name);switch(Q.kind){case Oe.SymbolKind.Method:on(ve,Q.parent);case Oe.SymbolKind.Function:if(ve.kind=Q.kind===Oe.SymbolKind.Method?Oe.CompletionItemKind.Method:Oe.CompletionItemKind.Function,at("v2.general.completeFunctionCalls")){let Ae=Q;ye?ve.command={title:"cursorRight",command:"cursorRight"}:Ae.params.length?(ve.command={title:"Trigger Parameter Hints",command:"editor.action.triggerParameterHints"},Ae.params[0].name.includes("|")?(ve.insertText=ve.label+"(${1|"+Ae.params[0].name.replace(/\|/g,",")+"|})",ve.insertTextFormat=Oe.InsertTextFormat.Snippet):(ve.insertText=ve.label+"($0)",ve.insertTextFormat=Oe.InsertTextFormat.Snippet)):ve.insertText=ve.label+"()"}else ve.commitCharacters=$.Function;ve.detail=Q.full;break;case Oe.SymbolKind.Variable:if(ve.kind=Oe.CompletionItemKind.Variable,!Q.range.end.character)return ve.detail=Q.detail,ve;break;case Oe.SymbolKind.Class:ve.kind=Oe.CompletionItemKind.Class,ve.commitCharacters=$.Class,ve.detail="class "+(Q.full||ve.label);break;case Oe.SymbolKind.Event:return ve.kind=Oe.CompletionItemKind.Event,ve;case Oe.SymbolKind.Field:return ve.kind=Oe.CompletionItemKind.Field,ve.label=ve.insertText=ve.label.slice(0,-1),ve;case Oe.SymbolKind.Property:{ve.kind=Oe.CompletionItemKind.Property,ve.detail=Q.full||ve.label,on(ve,Q.parent);let Ae=Q;!Ae.call&&Ae.get?.params.length&&(ve.insertTextFormat=Oe.InsertTextFormat.Snippet,ve.insertText=ve.label+"[$0]");break}default:return ve.kind=Oe.CompletionItemKind.Text,ve}Q.tags&&(ve.tags=Q.tags);let ze=Ji(Q,r);return ze&&(ve.documentation=ze),ve}}var Pi=Bn(ir());async function D_(e,t){if(t.isCancellationRequested)return;let n=e.textDocument.uri.toLowerCase(),i=se[n],r=i?.getContext(e.position),s=[];if(!r)return;if(!r.token.type){let c=r.token.previous_token;if(c?.content.match(/^#include/i)){let p=e.position.line,f=r.linetext.indexOf("#"),l=c.data,b=l?.data;if(b){f+=l.offset-c.offset;let v=Pi.Range.create(0,0,se[b[1]]?.document.lineCount??0,0),d=f+l.content.length,w=b[0]?pn.file(Dr(b[0].replace(/`;/g,";"))).toString():b[1];return[Pi.LocationLink.create(w,v,v,Pi.Range.create(p,f,p,d))]}}return}if(r.kind===Pi.SymbolKind.Null)return;let a=[];return ci(i,r)?.forEach(c=>{!a.includes(c.node)&&a.push(c.node)&&c.node.selectionRange.end.character&&(n=c.node.uri??c.uri)&&s.push(Pi.LocationLink.create(se[n].document.uri,c.node.range,c.node.selectionRange))}),s}var hc=Bn(ir());async function A_(e){let t=se[e.textDocument.uri.toLowerCase()],n=hc.Range.create(0,0,t.document.lineCount,0),i=at("v2.formatter");i.indentString??=e.options.insertSpaces?" ".repeat(e.options.tabSize):"	";let r=t.beautify(i);return[{range:n,newText:r}]}async function P_(e){let t=se[e.textDocument.uri.toLowerCase()],n=e.range,i=at("v2.formatter");i.indentString=e.options.insertSpaces?" ".repeat(e.options.tabSize):"	";let r=t.beautify(i,n).trim();return[{range:n,newText:r}]}async function E_(e){let t=se[e.textDocument.uri.toLowerCase()],{ch:n,position:i}=e,r=at("v2.formatter"),s,a,c,p;if(r.indentString=" ".repeat(e.options.tabSize),a=t.document.getText({start:{line:0,character:0},end:{line:0,character:1}}),(a==="	"||!e.options.insertSpaces&&a!==" ")&&(r.indentString="	"),n===`
`){let{line:l,character:b}=i,v=t.document.getText({start:{line:l-1,character:0},end:{line:l+2,character:0}}).split(/\r?\n/),d=v[0].trimEnd(),w;if(v[1].trim()||(b=v[1].length),d.endsWith("{")){let D=r.indentString;(p=f({line:l-1,character:d.length}))&&(w=r.indentString,v[1].substring(0,b)!==w&&p.push({newText:w,range:{start:{line:l,character:0},end:{line:l,character:b}}}),(d=(v[2]??="").trimStart()).startsWith("}")&&!v[2].startsWith((w=w.replace(D,""))+"}")&&p.push({newText:w,range:{start:{line:l+1,character:0},end:{line:l+1,character:v[2].length-d.length}}}))}else if((c=t.linepos[l-1])!==void 0){let D={start:t.document.positionAt(c),end:{line:l-1,character:d.length}},$=t.beautify(r,D).trim();p=[{range:D,newText:$}],w=r.indentString,v[1].substring(0,b)!==w&&p.push({newText:w,range:{start:{line:l,character:0},end:{line:l,character:b}}})}else if(!d&&v[0]!==(v[1]=v[1].substring(0,b))){if(!v[0]){if(s=t.find_token(t.document.offsetAt(i)),s.type==="TK_STRING"||s.type.endsWith("COMMENT"))return;let D=["TK_START_EXPR","TK_START_BLOCK",""];for(;(s=s.previous_token)&&!D.includes(s.type););if(D.pop(),D.includes(s?.type))return}p=[{newText:v[0],range:{start:{line:l,character:0},end:{line:l,character:b}}}]}return p}else{if(n==="}")return f(i);if(a=ss[n]){let l={line:i.line,character:i.character-1};if(s=t.find_token(t.document.offsetAt(l)),s.type==="TK_WORD")return s.length>1&&(a=s.content.replace(/./g,b=>ss[b]??b),l=t.document.positionAt(s.offset),i.character=l.character+s.length),[hc.TextEdit.replace({start:l,end:i},a)]}}function f(l){if(s=t.tokens[t.document.offsetAt({line:l.line,character:l.character-1})],c=s?.previous_pair_pos,c!==void 0){for(;(s=t.tokens[c])?.previous_pair_pos!==void 0;)c=s.previous_pair_pos;let b={start:t.document.positionAt(c),end:l},v=t.beautify(r,b).trim();return[{range:b,newText:v}]}}}var gs=Bn(ir());async function O_(e,t){if(t.isCancellationRequested)return;let n=e.textDocument.uri.toLowerCase(),i=se[n],r=i?.getContext(e.position),s=[],a;if(!r)return;if(r.kind===gs.SymbolKind.Null)return r.token.semantic?.type!==4&&(a=r.token,a=qo[(a.hover_word||a.content).toLowerCase()])?a[1]:void 0;let c=ci(i,r);if(!c?.length)return;let p=[];if(c=c.filter(f=>!p.includes(f.node)&&p.push(f.node)),c.length>1)for(a of c)(a=a.node.full)&&s.push({kind:"ahk2",value:a});else{let{node:f,is_global:l,uri:b}=c[0],v=f;if(f.kind===gs.SymbolKind.Class&&!v.full?.startsWith("("))s.push({kind:"ahk2",value:"class "+(v.full||f.name)});else if(v.full){s.push({kind:"ahk2",value:v.full});let w=v.overloads;switch(typeof w){case"object":w=w.map(D=>D.full).join(`
`);case"string":v.name&&(w=w.replace(/^(\w|[^\x00-\x7f])+/gm,v.full.substring(0,v.full.search(/(?!^)[([]/)))),s.at(-1).value+=`
${w}`;break}}let d=Ji(f,se[b]);typeof d=="string"?d=d&&"```plaintext\n"+d+"\n```":d=d.value,f.is_param?d.startsWith("*@param* ")?d=d.replace(/\n|(?<=`\*?)  /,`
___
`):d=`*@param* \`${f.name}\`${(a=sr(f.type_annotations))&&`: *\`${a}\`*`}
___
${d}`:f.kind===gs.SymbolKind.Variable?d=`${l===!0?"*@global*":f.static?"*@static*":"*@local*"} \`${f.name}\`${(a=sr(f.type_annotations))&&`: *\`${a}\`*`}
___
${d}`:f.kind===gs.SymbolKind.Property&&s.length&&(a=sr(f.type_annotations))&&(s[0].value+=`: ${a}`),d&&s.push({value:(s.length?`___
`:"")+d})}return{contents:{kind:"markdown",value:s.map(f=>f.kind==="ahk2"?"```ahk2\n"+f.value+"\n```":f.value).join(`

`)}}}var nn=Bn(ir());async function N_(e,t){let n=[],i=se[e.textDocument.uri.toLowerCase()];if(!i||t.isCancellationRequested)return;let r=Zu(i,i.getContext(e.position));for(let s in r)n.push(...r[s].map(a=>({uri:s,range:a})));return n}function Zu(e,t,n=!0){if(t.kind===nn.SymbolKind.Null)return;let i=ci(e,t);if(i?.length!==1)return;let r=t.text.toUpperCase(),s={},{node:a,uri:c,scope:p,is_this:f,is_global:l}=i[0];if(!(!c||!a.selectionRange.end.character||f===!1)){if(!n&&(a===Zt[r]||c===ln.winapi))return null;if(f){let b=a,v=[],d=b.property;for(let w of Object.values(d??{}))w.children?.length&&ms(w,r,v,!1,!1);return v.length?{[se[c].document.uri]:v}:void 0}switch(a.kind){case nn.SymbolKind.Field:if(p){let b=p.labels;b&&b[r]&&(s[se[c].document.uri]=b[r].map(v=>v.selectionRange))}else{let b=e.labels;b[r]&&(s[e.document.uri]=b[r].map(v=>v.selectionRange));for(let v in e.relevance)b=se[v].labels,b[r]&&(s[se[v].document.uri]=b[r].map(d=>d.selectionRange))}break;case nn.SymbolKind.Function:case nn.SymbolKind.Variable:case nn.SymbolKind.Class:if(a.kind!==nn.SymbolKind.Class||!a.full.includes(".")){let b=l===!0?void 0:i[0].parent,v={[e.uri]:b};if(c!==e.uri&&(v[c]=void 0),!b)for(let d in e.relevance)v[d]=void 0;for(let d in v){let w=gc(v[d]??se[d],r,nn.SymbolKind.Variable);w.length&&(s[se[d].document.uri]=w)}break}default:if(a.kind===nn.SymbolKind.Class||a.static){if(a.kind===nn.SymbolKind.Class)r=a.full.toUpperCase();else{let C=a,g=C.full?.match(/^\(([^)]+)\)[ \t]static[ \t]([^(]+)($|[([])/);if(g)r=`${g[1]}.${g[2]}`.toUpperCase();else if(C.parent?.kind===nn.SymbolKind.Class)r=`${C.parent.full}.${C.name}`.toUpperCase();else return}let b=r.split("."),v=b.length,d=0,w={};for(let C of new Set([e.uri,...Object.keys(e.relevance)]))w[se[C].document.uri]=gc(se[C],b[0],nn.SymbolKind.Variable);for(;d<v;){let C=b.slice(0,++d).join("."),g=zr(e,C);if(g?.node.kind===nn.SymbolKind.Class)for(let y of Object.values(g.node.property??{}))y.children?.length&&ms(y,"THIS",w[se[g.uri].document.uri]??=[],!1,!1);for(let y in w){let u=w[y],B=se[y.toLowerCase()],h=s[y]??=[],le=B.document,ge=B.tokens;e:for(let Ne of u){let Re=ge[le.offsetAt(Ne.start)];if(Re){for(let W=d;W<v;W++)if((Re=ge[Re.next_token_offset])?.type!=="TK_DOT"||(Re=ge[Re.next_token_offset])?.type!=="TK_WORD"||Re.content.toUpperCase()!==b[W])continue e;h.push({start:le.positionAt(Re.offset),end:le.positionAt(Re.offset+Re.length)})}}s[y].length||delete s[y]}w={}}let D=a.parent,$=s[se[c].document.uri]??=[];for(;D&&D.kind!==nn.SymbolKind.Class;)D=D.parent;if(D){let C=a.name.toLowerCase(),g=[];for(let y of D.children??[])y.static&&y.name.toLowerCase()===C&&g.push(y.selectionRange);$.unshift(...g)}else $.includes(a.selectionRange)||$.unshift(a.selectionRange);break}return}if(Object.keys(s).length){for(let b in s){let v={};for(let d of s[b])v[`${d.start.line},${d.start.character}`]??=d;s[b]=Object.values(v)}return s}}}function gc(e,t,n,i=[]){if(!(n===nn.SymbolKind.Method||n===nn.SymbolKind.Property)){let r=e,s=!e.kind,a=!r?.local?.[t]?.static,c=s;if(a&&!s&&r.declaration?.[t]?.static===null&&(a=!1),c)c=!1;else{let p=r.local,f=r.declaration;p?.[t]||f?.[t]||(c=void 0)}for(let p of r.children??[])p.name.toUpperCase()===t&&i.push(p.selectionRange),p.children?.length&&ms(p,t,i,s,s||p.kind===nn.SymbolKind.Function?c:void 0,a);if(r.kind===nn.SymbolKind.Property){let p=r;for(let f of[p.get,p.set,p.call])f?.children?.length&&gc(f,t,n,i)}}return i}function ms(e,t,n,i,r,s=!0){let a=e.kind===nn.SymbolKind.Function&&e.static,c=a||e.closure,p,f=r;if(a&&s&&!i)return;if(i&&e.has_this_param&&["THIS","SUPER"].includes(t))r=f=!1;else if(e.assume===2||e.global?.[t]){if(!i)return;r=f=!0}else if(e.local?.[t]||(!c||i&&!r)&&e.declaration?.[t]){if(!i)return;r=f=!1}else i&&!r&&(a&&(!(p=e.declaration?.[t])||p.kind===nn.SymbolKind.Variable&&!p.def)||e.unresolved_vars?.[t])&&(f=!0);s&&(s=!e?.local?.[t]?.static),f===i?e.children?.forEach(b=>{b.name.toUpperCase()===t&&b.kind!==nn.SymbolKind.Property&&b.kind!==nn.SymbolKind.Method&&b.kind!==nn.SymbolKind.Class&&n.push(b.selectionRange),b.children?.length&&ms(b,t,n,i,b.kind===nn.SymbolKind.Function?r:i||void 0,s),b.kind===nn.SymbolKind.Property&&l(b)}):e.children?.forEach(b=>{b.children?.length&&ms(b,t,n,i,i?!1:void 0,s),b.kind===nn.SymbolKind.Property&&l(b)});function l(b){for(let v of[b.get,b.set,b.call])v?.children?.length&&gc(v,t,nn.SymbolKind.Variable,n)}}var L_=Bn(gi());var mc;async function M_(e,t){let n=se[e.textDocument.uri.toLowerCase()];if(!n||t.isCancellationRequested)return;let i=n.getContext(e.position);return(mc=Zu(n,i,!1))?{range:i.range,placeholder:i.text.split(".").pop()||""}:new L_.ResponseError(0,mc===null?Wu.cannotrenamestdlib():Wu.cannotrename())}async function I_(e,t){if(t.isCancellationRequested)return;let n={changes:{}},i=e.newName;for(let r in mc)n.changes[r]=mc[r].map(s=>({range:s,newText:i}));return n}var lr=Bn(ir());var Xt,Qr=new Map;function F_(e,t){let n=e.semantic,i;if(n){let r=e.pos??(e.pos=t.document.positionAt(e.offset)),s=n.type;if(s===7)if(e.ignore){let a=r.line+1,c=e.data;for(let p=0;p<c.length;p++)t.STB.push(a++,0,c[p],s,0)}else t.STB.push(r.line,r.character,e.length,s,0);else(Xt&&(s===2||s===5)&&e.previous_token?.type==="TK_DOT"||(Xt=void 0,s===0))&&(s=$k(e.content.toUpperCase(),e,t)),t.STB.push(r.line,r.character,e.length,s,(n.modifier??0)|e.definition?.static===!0)}else if(Xt&&e.type!=="TK_DOT"&&!e.type.endsWith("COMMENT"))Xt=void 0;else if(e.type==="TK_WORD"&&["THIS","SUPER"].includes(i=e.content.toUpperCase())&&e.previous_token?.type!=="TK_DOT"){let r=t.findSymbol(i,lr.SymbolKind.Variable,t.document.positionAt(e.offset));r?.is_this!==void 0&&(Xt=r.node)}}function hs(e,t){let n=se[e.textDocument.uri.toLowerCase()];return!n||t?.isCancellationRequested?{data:[]}:(n.STB.previousResult(""),Xt=void 0,Qr.clear(),Di({textDocument:e.textDocument},null),Object.values(n.tokens).forEach(i=>F_(i,n)),j_(n),Qr.clear(),n.sendDiagnostics(),n.STB.build())}function q_(e,t){let n=se[e.textDocument.uri.toLowerCase()];if(!n||t?.isCancellationRequested)return{data:[]};let i=n.document.offsetAt(e.range.start),r=n.document.offsetAt(e.range.end);n.STB.previousResult(""),Xt=void 0,Qr.clear(),Di({textDocument:e.textDocument},null);for(let s of Object.values(n.tokens))if(!(s.offset<i)){if(s.offset>r)break;F_(s,n)}return j_(n),Qr.clear(),n.STB.build()}function $k(e,t,n){let i=t.semantic;switch(i.type){case 0:return Xt=Yu[e],Xt?.kind!==lr.SymbolKind.Class&&(Xt=void 0),0;case 2:case 5:if(Xt&&!t.ignore){let s=Xt.property[e],a=s?.kind,c;if(!s||s.def===!1){let p=(c=Qr.get(Xt)??(Qr.set(Xt,c=Xi(n,Xt)),c))[e];p?(s=p,a=p.kind):i.type===2?c.__CALL&&(a=lr.SymbolKind.Null):c.__GET&&(a=lr.SymbolKind.Null)}switch(a){case lr.SymbolKind.Method:if(i.modifier=(i.modifier??0)|2|1,t.callsite){if(Xt){if(s.full?.startsWith("(Object) static Call("))s=Tn(n,Xt.prototype,"__new",!0)??s;else if(s.full?.startsWith("(Object) DefineProp(")){let p=n.tokens[t.next_token_offset];p?.content==="("&&(p=n.tokens[p.next_token_offset]),p&&(p.type==="TK_STRING"?r(Xt,p.content.slice(1,-1),p.offset+1):r(Xt,""))}}_c(n,s,t.callsite)}return Xt=void 0,i.type=2;case lr.SymbolKind.Class:return i.modifier=(i.modifier??0)|2,Xt=Xt.property[e],t.callsite&&_c(n,Xt,t.callsite),i.type=0;case lr.SymbolKind.Property:{let p=s;return i.modifier=(i.modifier??0)|(s.static?1:0)|(!p.set&&p.children?2:0),Xt=Xt.range===s.range?Xt.prototype:void 0,i.type=5}case void 0:if((Xt.checkmember??n.checkmember)!==!1&&at("v2.diagnostics.classNonDynamicMemberCheck")){let p=n.tokens[t.next_token_offset];Oo.includes(p?.content)?r(Xt,t.content,t.offset):Qr.get(Xt)?.["#checkmember"]!==!1&&((Xt.undefined??={})[t.content.toUpperCase()]??=t)}}}default:return Xt=void 0,i.type}function r(s,a,c){let p=se[s.uri];if(p&&c){if(s.property[a.toUpperCase()])return;let f=lr.Range.create(p.document.positionAt(c),p.document.positionAt(c+a.length)),l=lr.DocumentSymbol.create(a,void 0,lr.SymbolKind.Property,f,f);if(l.static=l.def=!0,a=a.toUpperCase(),p===n&&p.d<2)s.children?.push(l),s.property[a]??=l;else{let b=Qr.get(s);b&&(b[a]??=l)}s.undefined&&delete s.undefined[a]}else if(delete s.undefined,p&&p.d<2)s.checkmember=!1;else{let f=Qr.get(s);f&&(f["#checkmember"]=!1)}}}function j_(e){for(let t of Qr.keys()){if(!t.undefined)continue;let n=t.name;for(let i of Object.values(t.undefined))i.has_warned||(i.has_warned=!0,e.addDiagnostic(F.maybehavenotmember(n,i.content),i.offset,i.length,2))}}var ur=Bn(ir());var Ei={};async function K_(e,t){if(t.isCancellationRequested)return;let{textDocument:{uri:n},context:i,position:r}=e,s=se[n.toLowerCase()],a=i?.activeSignatureHelp?.activeSignature,c,p;switch(i?.triggerKind){case 2:if(i.isRetrigger){if(i.triggerCharacter===" "||!(p=s.tokens[c=s.document.offsetAt(r)-1]?.paraminfo))return g()}else{if(c=s.document.offsetAt(r),i.triggerCharacter===" "){let u=s.find_token(c);u.offset>=c&&(p=u.previous_token?.callsite)&&(p=p.range.start.line===r.line&&p.paraminfo)}else p=s.tokens[c-1]?.paraminfo;if(!p)return}break}let f=fs(s,r,p);if(!f||f.index<0)return;let{name:l,pos:b,index:v,kind:d}=f,w=`${s.uri}?${l},${b.line},${b.character}`;if(w===Ei.loc){if(v===Ei.index)return g();Ei.index=v}else Ei={loc:w,index:v};let D=Ei.nodes,$=new Set,C={activeSignature:a,signatures:[]};if(!D){let le=function(ge,Ne,Re=0){let W,U=ge.uri;switch(ge.kind){case ur.SymbolKind.Method:if(!B)break;if(Re++,Ne==="call"){D.push({node:ge,needthis:Re,uri:U});break}W=ge,Ke();break;case ur.SymbolKind.Function:if(!B)break;if(Ne==="call"){D.push({node:ge,needthis:Re,uri:U});break}W=ge;default:Ke();break}function Ke(){let ye,ct=ge;if(ye=Tn(s,ct,Ne,B)){if(B){if(ye.kind===ur.SymbolKind.Class)ye=Qi(ye);else if(ye.full?.startsWith("(Object) static Call("))ye=Tn(s,ct.prototype,"__new",!0)??ye;else if(ye.kind===ur.SymbolKind.Property||ye.alias){let De=Mn(ye,se[ye.uri]??s,ct);return ye.kind===ur.SymbolKind.Property&&ye.alias&&(De=Hr(s,De,"call",!0)),De.forEach(S=>le(S,"call",-1))}else if(W&&Ne==="bind"){if($.has(W))return;$.add(W);let De=W.full.indexOf("(",W.name?1:0);W={...W,name:ye.name,detail:ye.markdown_detail===void 0?ye.detail:void 0,full:`(Func) Bind${W.full.slice(De,De+W.param_def_len)} => BoundFunc`,markdown_detail:ye.markdown_detail},ye=W}}else if(ye.kind===ur.SymbolKind.Class)ye=Tn(s,ye,"__item",!1);else{if(ye.kind!==ur.SymbolKind.Property)return;if(!ye.params){for(let De of Mn(ye,se[ye.uri]??s,ct))(De=Tn(s,De,"__item",!1))&&D.push({node:De,needthis:Re,uri:De.uri});return}}ye&&D.push({node:ye,needthis:Re,uri:ye.uri})}}};var y=le;let u=s.getContext(b),B=!0;if(Ei.nodes=D=[],u.kind===ur.SymbolKind.Null||u.token.symbol)return;let h=Fr(s,u.token,u.range.end);if(h.includes(cn)){if(d!==ur.SymbolKind.Method)return;let ge=l.toUpperCase();D=[];for(let Ne of new Set([ln.ahk2,ln.ahk2_h,s.uri,...Object.keys(s.relevance)]))for(let Re of se[Ne]?.object.method[ge]??[])D.push({node:Re,uri:Ne})}else{let ge=u.text?"":u.word.toLowerCase();d===ur.SymbolKind.Property?(ge||="__item",B=!1):ge||="call";for(let Ne of h)le(Ne,ge)}}for(let u of D){let B=u.node,h=se[u.uri],le=u.needthis??0;if(!B.params||$.has(B))continue;let ge=[B],Ne=v-le,Re=[],W=B.name&&B.full.match(/^(\(.+?\))?[^([]+/)?.[0].length||0,U,Ke,ye,ct,De,S,Et=Ji(B,h,/(^|\n)\*@param\*(.|\n|\r)*?(?=\n\*@|$)/g);if(B.overloads)if(typeof B.overloads=="string"){let Lt=new Un(Hn.create("","ahk2",-10,B.kind===ur.SymbolKind.Function?B.overloads:`class _ {
${B.overloads}
}`),void 0,-1);Lt.parseScript(),De=B.name||"_";let Pe=B.kind===ur.SymbolKind.Function?Lt.children:Lt.declaration._?.children??[],rn=B.full.match(/^(\(.+?\))?[^([]+/)?.[0]??De;for(let yn of Pe)yn.name!==De||!yn.params||(yn.full=rn+yn.full.replace(/^(\(.+?\))?[^([]+/,""),ge.push(yn));B.overloads=ge.slice(1)}else ge.push(...B.overloads);W+=le>0?7:1,$.add(B);for(let Lt of ge){De=Lt.full,U=Lt.params,ye=Lt.variadic&&U[(ct=U.length)-1].arr?Math.min(Ne,ct-1):Ne,S=U[ye]?.name.toUpperCase()??(le&&ye===-1?"this":"\0"),Ke=B.params.find(rn=>rn.name.toUpperCase()===S)??B.overload_params?.[S],Re=Lt.param_offsets.map((rn,yn)=>({label:[rn+=W,rn+(U[yn].name.length||1)]})),le>0&&(Re.unshift({label:"this"}),ye++,De=De.replace(/(?<=.)\(/,"(this"+(U.length?", ":"")));let Pe=Ke&&Ji(Ke,h);Pe&&(Re[ye].documentation=Pe),C.signatures.push({label:De,parameters:Re,documentation:Et,activeParameter:ye})}}return Ei.signinfo=C;function g(){let u=Ei.signinfo;return u&&(u.activeSignature=a),u}}var wt=Bn(ir());var Yu={};function Di(e,t){let n=e.textDocument.uri.toLowerCase(),i=se[n];if(!i||t?.isCancellationRequested)return[];if(t!==null&&i.symbolInformation)return i.symbolInformation;let r=Yu={...Zt},s=[n,...Object.keys(i.relevance)],a={};s=s.map(D=>se[D]?.d_uri).concat(s);for(let D of s){let $=se[D];if(!$)continue;let C=$.d,g=$.declaration,y;for(let u in g)!(y=r[u])||C||g[u].kind!==wt.SymbolKind.Variable&&(y.kind===wt.SymbolKind.Variable||y.def===!1)?r[u]=g[u]:y.kind===wt.SymbolKind.Variable&&(y.assigned||=g[u].assigned,g[u].def)&&(y.def??=!1)}if(i.symbolInformation)return i.symbolInformation;ln.winapi&&!s.includes(ln.winapi)&&(a=se[ln.winapi]?.declaration??a);let c=at("v2.warn.localSameAsGlobal"),p=[],f=new Map,l=[wt.SymbolKind.Method,wt.SymbolKind.Property,wt.SymbolKind.Class];for(let[D,$]of Object.entries(i.declaration)){let C=r[D],g=!1;C.kind===wt.SymbolKind.Variable&&!C.assigned&&(a[D]?(C=r[D]=a[D],g=!0):$.returns===void 0&&f.set(C,$)),(C===$||$.kind!==wt.SymbolKind.Variable)&&(p.push($),w($,$,g||$===Zt[D]).definition=$)}if(v(i),at("v2.warn.varUnset"))for(let[D,$]of f)D.assigned||i.diagnostics.push({message:xi.varisunset($.name),range:$.selectionRange,severity:wt.DiagnosticSeverity.Warning});return i.actived&&(d(i),i.sendDiagnostics(!1,!0)),n=i.document.uri,i.symbolInformation=p.map(D=>wt.SymbolInformation.create(D.name,D.kind,D.range,n));function b(D,$){!(D.assigned||=$.assigned)&&$.returns===void 0&&(f.has(D)||f.set(D,$))}function v(D,$={},C=!1){let g=[],y=D.kind===wt.SymbolKind.Class,u;D.children?.forEach(B=>{if(B.children&&g.push(B),!B.name)return;let h=B.kind;if(h===wt.SymbolKind.Variable||h===wt.SymbolKind.Function||!y&&h===wt.SymbolKind.Class){let le=B.name.toUpperCase(),ge=$[le]??r[le];if(ge===B||!ge)return;(u=w(B,ge,ge===Zt[le])).definition=ge,ge.selectionRange.end.character?B.kind!==wt.SymbolKind.Variable?p.push(B):ge.kind===wt.SymbolKind.Variable?b(ge,B):u.callsite&&_c(i,ge,u.callsite):delete u.semantic}else l.includes(h)||p.push(B)});for(let B of g){let h={},le,ge=C,Ne=B;switch(B.kind){case wt.SymbolKind.Class:{let Re=B;h={THIS:Lo,SUPER:cs},C=!1;for(let W of[Re.property,Re.prototype?.property??{}])Object.values(W).forEach(U=>U.selectionRange.end.character&&p.push(U));break}case wt.SymbolKind.Property:if(Ne.has_this_param){let Re=B;for(let W of[Re.get,Re.set,Re.call])W&&(g.push(W),W.selectionRange.end.character&&p.push(W))}else break;case wt.SymbolKind.Method:case wt.SymbolKind.Function:if(Ne.has_this_param)h={THIS:Lo,SUPER:cs};else if($.SUPER?.range.end.character===0&&delete $.SUPER,Ne.assume!==2)if(Ne.assume===1&&(C=!1),Ne.static)for(let[Re,W]of Object.entries($))(W.static||W===r[Re])&&(h[Re]=W);else h={...$};else C=!0;case wt.SymbolKind.Event:C||=Ne.assume===2;for(let[Re,W]of Object.entries(Ne.global??{}))le=h[Re]=r[Re]??=W,w(W,le,le===Zt[Re]).definition=le,le.kind===wt.SymbolKind.Variable&&b(le,W);for(let[Re,W]of Object.entries(Ne.local??{})){if(w(h[Re]=W,W).definition=W,W.kind===wt.SymbolKind.Variable){if(W.is_param)continue;!W.assigned&&W.returns===void 0?f.set(W,W):c&&!W.decl&&r[Re]&&i.diagnostics.push({message:xi.localsameasglobal(W.name),range:W.selectionRange,severity:wt.DiagnosticSeverity.Warning})}p.push(W)}for(let[Re,W]of Object.entries(Ne.declaration??={}))(le=h[Re])?le!==W&&(w(W,le,le===Zt[Re]).definition=le,le.kind===wt.SymbolKind.Variable&&b(le,W)):C?(le=r[Re]??=(p.push(W),W.is_global=!0,i.declaration[Re]=W),w(W,le,le===Zt[Re]).definition=le,le.kind===wt.SymbolKind.Variable&&b(le,W)):!W.def&&(le=r[Re])?w(W,le,le===Zt[Re]).definition=le:(w(h[Re]=Ne.local[Re]=W,W).definition=W,p.push(W),W.static===null&&(W.static=!0),c&&W.kind===wt.SymbolKind.Variable&&r[Re]&&i.diagnostics.push({message:xi.localsameasglobal(W.name),range:W.selectionRange,severity:wt.DiagnosticSeverity.Warning}));for(let[Re,W]of Object.entries(Ne.unresolved_vars??{}))(le=h[Re]??r[Re]??a[Re])?w(W,le,le===Zt[Re]).definition=le:(w(W,W).definition=W,p.push(h[Re]=W),Ne.assume===1&&(W.static=!0),W.returns===void 0&&f.set(W,W));break;default:h={...$};break}v(B,h,C),C=ge}}function d(D){if(D.d)return;let $={...Zt},C={},g,y;Object.keys(D.labels).forEach(le=>C[le]=!0);for(let le in D.relevance)if(g=se[le]){if(g.d)continue;Mo($,Object.values(g.declaration).filter(ge=>ge.kind!==wt.SymbolKind.Variable),g.diagnostics);for(let ge in g.labels)(y=g.labels[ge][0]).def&&(C[ge]?y.has_warned??=g.diagnostics.push({message:F.duplabel(),range:y.selectionRange,severity:wt.DiagnosticSeverity.Error}):C[ge]=!0)}let u=Object.values(D.declaration);Mo($,u,D.diagnostics);for(let le in D.relevance)(g=se[le])&&Mo($,Object.values(g.declaration).filter(ge=>ge.kind===wt.SymbolKind.Variable),g.diagnostics);let B;u.forEach(le=>{if(le.kind===wt.SymbolKind.Class&&(B=le).extendsuri===void 0){let ge=B.extends?.toUpperCase();ge===le.name.toUpperCase()?h(D,B,!1):ge&&!ai(D,ge)?.prototype&&h(D,B)}});for(let le in D.relevance)if(g=se[le]){for(let ge of Object.values(g.declaration))if(ge.kind===wt.SymbolKind.Class&&(B=ge).extendsuri===void 0){let Ne=B.extends?.toUpperCase();Ne===ge.name.toUpperCase()?h(g,B,!1):Ne&&!ai(g,Ne)?.prototype&&h(g,B)}}function h(le,ge,Ne=!0){let Re=le.document.offsetAt(ge.selectionRange.start),W,U=le.tokens;if(!(W=U[U[Re].next_token_offset])||!(W=U[W.next_token_offset])||W.has_warned)return;Re=W.offset,W.has_warned=!0;let Ke={start:le.document.positionAt(Re),end:le.document.positionAt(Re+ge.extends.length)};le.diagnostics.push({message:Ne?F.unknown("class '"+ge.extends)+"'":F.unexpected(ge.extends),range:Ke,severity:wt.DiagnosticSeverity.Warning})}}function w(D,$,C=!1){let g,y,u,B,h=$.kind;switch(h){case wt.SymbolKind.Variable:if($.is_param){if(!D.selectionRange.end.character)return{};u=3;break}u=4;break;case wt.SymbolKind.Class:u=0;break;case wt.SymbolKind.Function:u=1;break}if((g=i.tokens[B=i.document.offsetAt(D.selectionRange.start)])&&u!==void 0&&!g.ignore){if((y=g.semantic)===void 0){if(g.semantic=y={type:u},D.kind===wt.SymbolKind.Variable&&D.def&&(h===wt.SymbolKind.Class||h===wt.SymbolKind.Function)&&(i.addDiagnostic(No(D,{kind:h}),B,D.name.length),delete D.def),!g.callsite&&u===1){let le=i.tokens[g.next_token_offset];le&&le.topofline<1&&!(le.op_type>=0||":?.+-*/=%<>,)]}".includes(le.content.charAt(0))||!le.data&&le.content==="{")&&i.addDiagnostic(F.funccallerr2(),g.offset,g.length,2)}}else h!==void 0&&(y.type=u);u<3&&(y.modifier=(y.modifier??0)|2|(C?8:0))}return g??{}}}function Wk(e){let t=e.params,n=t.length,i=n;for(e.variadic&&(i=1/0,n>0&&t[n-1].arr&&n--);n>0&&t[n-1].defaultVal!==void 0;)--n;for(let r=0;r<n;++r)t[r].defaultVal===!1&&--n;return{min:n,max:i,has_this_param:e.has_this_param}}function _c(e,t,n){let i=n.paraminfo,r,s;if(!i||!at("v2.diagnostics.paramsCheck")||((r=t?.kind===wt.SymbolKind.Class)&&(t=Qi(t)),!(s=t?.params)))return;let{max:a,min:c}=Wk(t),p=s.length-(t.variadic?1:0),f={},{count:l,miss:b}=i,v;for(b=[...b];(v=b.pop())!==void 0;)if(v!==--l){l++,b.push(v);break}(l<c&&!i.unknown||l>a)&&e.diagnostics.push({message:F.paramcounterr(c===a?c:a===1/0?`${c}+`:`${c}-${a}`,l),range:n.range,severity:wt.DiagnosticSeverity.Error});for(v of b){if(v>=p)break;f[v]=!0,d(s,v)&&e.addDiagnostic(F.missingparam(),i.comma[v]??e.document.offsetAt(n.range.end),1)}if(t.hasref&&s.forEach((w,D)=>{if(D<l&&w.pass_by_ref&&!f[D]){let $,C;if(D===0?$=n.offset+n.name.length+1:$=i.comma[D-1]+1,(C=e.find_token($)).content!=="&"&&(C.content.toLowerCase()!=="unset"||w.defaultVal===void 0)&&e.tokens[C.next_token_offset]?.type!=="TK_DOT"){let g=0;if(Fr(e,C,i.comma[D]??(g=e.document.offsetAt(n.range.end)-(e.tokens[n.offset+n.name.length]?1:0))).some(B=>B===Mr||B===cn||B.data===Mr))return;let u=e.tokens[i.comma[D]]?.previous_token;u&&(g=u.offset+u.length),e.addDiagnostic(F.typemaybenot("VarRef"),C.offset,Math.max(0,g-C.offset),2)}}}),!t.returns?.length&&!(t.type_annotations||null)?.length&&!(r&&t.name.toLowerCase()==="__new")){let w=e.tokens[n.offset];if(w?.previous_token?.type==="TK_EQUALS"){let D=e.get_token(e.document.offsetAt(n.range.end),!0);(!D||!xn(D.previous_token,D)||D.content!=="??"&&(D.content!=="?"||!D.ignore))&&e.addDiagnostic(F.missingretval(),w.offset,w.length,2)}}function d(w,D){if(w[D].defaultVal!==void 0)return!1;let $=D-1;for(;$>=0;){for(;$>=0&&w[$].defaultVal===!1;$--,D++);if(!w[D]||w[D].defaultVal!==void 0)return!1;for(;$>=0&&w[$].defaultVal!==!1;$--);}return!0}}async function $_(e,t){let n=[],i=e.query,r=0;if(t.isCancellationRequested||!i||!i.match(/^(\w|[^\x00-\x7f])+$/))return n;let s=new RegExp(i.match(/[^\w]/)?i.replace(/(.)/g,"$1.*"):"("+i.replace(/(.)/g,"$1.*")+"|[^\\w])","i");for(let c in se)if(a(c))return n;{let c,p,f;for(let l of Gr){l=pn.parse(l).fsPath;for await(let b of _s(l))if(c=pn.file(b).toString().toLowerCase(),!se[c]&&(f=ui(b))){if((p=new Un(f)).parseScript(),p.maybev1)continue;if(se[c]=p,a(c))return n}}}return n;function a(c){for(let p of Di({textDocument:{uri:c}}))if(s.test(p.name)&&(n.push(p),++r>=1e3))return!0;return!1}}var pc=[],se={},xr=rf("2.1-alpha.3"),Ir={get_DllExport:(e,t=!1)=>Promise.resolve([]),get_RCDATA:e=>{},get_ahkProvider:async()=>null},Zn,qr="",ds="en-us",ni="",Si=!1,or=rf("3.0.0.0"),ln={},Zt={},In={},qo={},li=[],Gr=[],Yt;function tf(e,t=!0){let n;try{if(n=(0,Cn.readFileSync)(e),n[0]===255&&n[1]===254)return n.toString("utf16le");if(n[0]===239&&n[1]===187&&n[2]===191)return n.toString("utf8").substring(1);try{return new TextDecoder("utf8",{fatal:!0}).decode(n)}catch{t&&Zn?.window.showErrorMessage(F.invalidencoding(e))}}catch(i){t&&(delete i.stack,i.path=e,console.log(i))}}function ui(e,t=!0){{let n=tf(e,t);if(n!==void 0)return Hn.create(pn.file(e).toString(),"ahk2",-10,n)}}function c_(e,t=!0,n=!0){if(ri(e))return;let i=ui(e,t);if(i){let r=new Un(i);return r.parseScript(),n&&(se[r.uri]=r),r}}function Dr(e){if(!(0,Cn.existsSync)(e))return e;e.includes("..")&&(e=(0,Oi.resolve)(e));let t=e.split(/[/\\]/),n=t.shift().toLowerCase(),i;for(let r of t){if(i=r.toLowerCase())try{for(let s of(0,Cn.readdirSync)(n))if(s===i){r=s;break}}catch{}n+=Oi.sep+r}return n}function ef(e){let t=e.match(/<>./),n;if(t){if((0,Cn.existsSync)(n=e.replace("<>",ds)))return n;if(ds.toLowerCase()==="zh-tw"&&(0,Cn.existsSync)(n=e.replace("<>","zh-cn")))return n;if((0,Cn.existsSync)(n=e.replace(t[0],"")))return n}else if((0,Cn.existsSync)(e))return e}function Gm(e,t){let n=ef(e);if(n)return(0,Cn.readFileSync)(n,t&&{encoding:t})}function bc(){let e=Rr.Keyword,t="*";Zt={},ln={},Yt={constant:[],directive:{"#":[],"@":Wm.map(n=>({label:n,kind:e,data:t}))},key:[],keyword:[],snippet:[],text:[],option:{ahk_criteria:[],hotstring:[]},static:{label:"static",insertText:"static",kind:Rr.Keyword}}}function Ni(e="ahk2",t=3){let n,i=`${ni}/syntaxes/<>/${e}`;{let l=function(b){return ef(p+b)||(p!==i?ef(i+b):void 0)};var s=l;let a=at("v2.general.syntaxes"),c=a&&(0,Cn.existsSync)(a)?a:"",p=c?`${c}/<>/${e}`:i,f;if((n=l(".d.ahk"))&&(f=ui(Dr(n)))){let b=new Un(f,void 0,t);b.parseScript(),se[b.uri]=b,ln[e]=b.uri}if((n=l(".json"))&&r(JSON.parse((0,Cn.readFileSync)(n,{encoding:"utf8"}))),e==="ahk2"&&(Yt.static=Yt.keyword.find(b=>b.label==="static")??Yt.static,r(JSON.parse((0,Cn.readFileSync)(`${ni}/syntaxes/ahk2_common.json`,{encoding:"utf8"}))),c))for(let b of(0,Cn.readdirSync)(c))b.toLowerCase().endsWith(".snippet.json")&&!(0,Cn.statSync)(b=`${n}/${b}`).isDirectory()&&r(JSON.parse((0,Cn.readFileSync)(b,{encoding:"utf8"})))}function r(a){let c,p,f,l,b=_n.create(0,0,0,0);for(let w in a){let D=a[w];switch(w){case"constants":p=Rr.Constant,c=Wi.Snippet;for(l of D)Yt.constant.push({label:l.prefix,kind:p,insertTextFormat:c,insertText:`\${1:${l.prefix} := }${l.body}$0`,detail:l.description??l.body});break;case"directives":f="",p=Rr.Keyword,c=Wi.Snippet;for(l of D)l.prefix??=l.body.trim(),"@#".includes(f=l.prefix.charAt(0))&&(Yt.directive[f].push({label:l.prefix.replace(/^[^#\w]/,""),insertText:l.body.replace(/^\W+/,""),kind:p,insertTextFormat:c,detail:l.description,data:l.body.charAt(0)}),f==="#"&&(qo[l.prefix.toLowerCase()]=[l.prefix,{contents:{kind:"markdown",value:"```ahk2\n"+(l.syntax??d(l.body))+"\n```\n\n"+(l.description??"")}}]));break;case"keys":p=Rr.Keyword;for(l of D)Yt.key.push({label:l.body,kind:p,detail:l.description});break;case"keywords":p=Rr.Keyword,c=Wi.Snippet;for(l of D)l.prefix??=l.body.trim(),Yt.keyword.push({label:l.prefix,kind:p,insertTextFormat:c,insertText:l.body,detail:l.description,preselect:!0}),qo[l.prefix.toLowerCase()]=[l.prefix,{contents:{kind:"markdown",value:"```ahk2\n"+(l.syntax??d(l.body))+"\n```\n\n"+(l.description??"")}}];break;case"snippet":p=Rr.Snippet,c=Wi.Snippet;for(l of D)Yt.snippet.push({label:l.prefix,insertText:v(l.body),detail:l.description,kind:p,insertTextFormat:c});break;case"variables":for(l of D)Zt[l.body.toUpperCase()]={name:l.body,kind:za.Variable,range:b,selectionRange:b,detail:l.description};break;case"texts":p=Rr.Text;for(l of D)Yt.text.push({label:l.body,kind:p});break;case"options":p=Rr.Text;for(let $ in D){let C=Yt.option[$]??=[];for(l of D[$])C.push({label:l.body,kind:p,detail:l.description})}break;default:break}}function v(w){return typeof w=="object"?w.join(`
`):w}function d(w){return w.replace(/\$\{\d+((\|)|:)([^}]*)\2\}|\$\d/g,(...D)=>D[2]?D[3].replace(/,/g,"|"):D[3]||"")}}}function _s(e,t=Bi){let n=at("v2.file.maxScanDepth"),{file:i,folder:r}=t;return s(Dr(e),0);async function*s(a,c){try{let p=await Cn.promises.opendir(a);for await(let f of p)if(f.isDirectory()&&c<n){let l=(0,Oi.resolve)(a,f.name);r?.some(b=>b.test(l))||(yield*s(l,c+1))}else if(f.isFile()&&/\.(ahk2?|ah2)$/i.test(f.name)){let l=(0,Oi.resolve)(a,f.name);i?.some(b=>b.test(l))||(yield l)}}catch{}}}function nf(e){let t=at("v2.general.librarySuggestions",e);typeof t=="boolean"&&ei("v2.general.librarySuggestions",t?"All":"Disabled",e),a_(at("v2.formatter",e)??{});try{s_(at("v2.general.commentTagRegex",e))}catch(r){delete r.stack,ei("v2.general.commentTagRegex",at("v2.general.commentTagRegex"),e),console.log(r)}let n=at("v2.workingDirectories",e);if(n instanceof Array?ei("v2.workingDirectories",n.map(r=>(r=pn.file(r.includes(":")?r:(0,Oi.resolve)(r)).toString().toLowerCase()).endsWith("/")?r:r+"/"),e):ei("v2.workingDirectories",[],e),at("exclude",e)){let r=[],s=[];for(let c of at("exclude",e))try{(/[\\/]$/.test(c)?s:r).push(Vk(c))}catch{console.log(`[Error] Invalid glob pattern: ${c}`)}Bi.file=r,Bi.folder=s,console.log(`Excluded files:
	${Bi.file.map(c=>c.source).join(`
	`)||"(none)"}`),console.log(`Excluded folders:
	${Bi.folder.map(c=>c.source).join(`
	`)||"(none)"}`);let a=at("v2.file.maxScanDepth",e);a===void 0&&(a=2),a<0&&(a=1/0),ei("v2.file.maxScanDepth",a,e)}let i=at("v2.general.syntaxes",e);i&&ei("v2.general.syntaxes",(0,Oi.resolve)(i).toLowerCase(),e),Vm(e)}function rf(e){let t={ALPHA:-3,BETA:-2,RC:-1},n=(e.replace(/-\w+/,r=>`.${t[r.substring(1).toUpperCase()]}`)+".0").split("."),i=0;for(let r=0;r<4;r++)i+=parseInt(n[r])*2**((3-r)*10);return i}async function Ju(e,t){return Ir.get_ahkProvider().then(n=>n?.sendRequest(e,...t))}function Ko(e){let t;return e=e.replace(/([*.?+^$|\\/[\](){}])|([^\x00-\x7f])|(.)/g,(n,i,r,s)=>`${s||(t??=r)||`\\${i}`}.*`),new RegExp(t?e:`([^\\x00-\\x7f]|${e})`,"i")}function W_(){In={}}function of(e){Si=e}function bs(e){qr=e.replace(/^.:/,t=>t.toLowerCase())}function V_(e){return Zn=e}function U_(e){ni=e.replace(/[/\\]$/,"")}function B_(e){e&&(ds=e.toLowerCase())}function H_(e){or=rf(e)}function yc(e){let t=Gr;if(Gr=[...e],at("v2.workingDirectories").forEach(n=>!e.has(n)&&Gr.push(n)),Gr.sort().reverse(),!(t.length===Gr.length&&!t.some((n,i)=>Gr[i]!==n)))for(let n of Object.values(se))se[n.uri]&&!n.setWorkspaceFolder()&&!n.actived&&n.close()}async function sf(e){return new Promise(t=>setTimeout(t,e))}function Vk(e){let t="",n=!1,i,r;(i=e.startsWith("!"))&&(e=e.slice(1));for(let s=0,a,c=e.length;s<c;s++)switch(r=e[s]){case"/":case"\\":t+="[\\x5c/]";break;case"$":case"^":case"+":case".":case"(":case")":case"=":case"|":t+="\\"+r;break;case"?":t+=".";break;case"!":s?t.endsWith("[")?t+="^":t+="\\"+r:i=!0;break;case"{":n=!0,t+="(";break;case"}":n=!1,t+=")";break;case",":t+=n?"|":",";break;case"*":for(a=s;e[s+1]==="*";)s++;s>a&&/^[\x5c/]?\*+[\x5c/]?$/.test(e.substring(a-1,s+2))?(t+="((?:[^\\x5c/]*(?:[\\x5c/]|$))*)",s++):t+="([^\\x5c/]*)";break;default:t+=r}return/^([a-zA-Z]:|\*\*)/.test(e)?t="^"+t:/[\\/]/.test(e[0])||(t="[\\x5c/]"+t),/[\\/]$/.test(e)||(t+="$"),i&&(t=t.startsWith("^")?`^(?!${t})`:`(?!${t})`),new RegExp(t,"i")}var vc=require("fs"),af=require("path");function z_(e){let t=Li(qr,!0);if(!t)return;let n=(0,kc.spawnSync)(`"${t}" /CP65001 /ErrorStdOut=utf-8 *`,[],{cwd:t.replace(/[\\/].+?$/,""),shell:!0,input:e});if(n)return(n.stdout??"").toString()}function Li(e,t=!1){if(!e)return"";let n=[];e.includes(":")||n.push((0,af.resolve)(e)),process.platform==="win32"&&!/[\\/]/.test(e)&&n.push((0,kc.execSync)(`where ${e}`,{encoding:"utf-8"}).trim()),n.push(e);for(let i of n)if(i)try{return(0,vc.lstatSync)(i).isSymbolicLink()&&t&&(i=(0,af.resolve)(i,"..",(0,vc.readlinkSync)(i))),i}catch{continue}return""}var Ar;async function Uk(){return new Promise(async e=>{let t=Li(qr);if(!t)return e(0);let n,i=1200;for(;;)try{n=await(0,to.createClientSocketTransport)(i);break}catch{i++}let r=(0,G_.spawn)(t,[`${ni}/server/dist/ahkProvider.ahk`,i.toString()]);if(!r||!r.pid)return e(0);let s=a=>{if(s=void 0,!a)return e(0);a.onNotification("initialized",c=>(a.dispose(),e(c))),a.listen()};r.on("close",()=>s?.()),n.onConnected().then(a=>s?.((0,to.createMessageConnection)(a[0],a[1])),()=>s?.())})}async function X_(){if(Ar!==void 0)return Ar;let e=0;return process.platform==="win32"&&(e=await Uk()),e?new Promise(t=>{let n=!1;Ar=(0,to.createMessageConnection)(...(0,to.createServerSocketTransport)(e)),Ar.onNotification("initialized",()=>{n=!0,t(Ar??(Ar=void 0,null))}),Ar.onClose(()=>Ar=void 0),Ar.listen(),setTimeout(()=>{n||(Ar?.dispose(),t(Ar=null))},500)}):Ar=null}var ys=require("fs");var $o=class{close=()=>{};is_bit64;reader;resource={};dataDirectory=[];sectionTable=[];constructor(t){let i=Buffer.alloc(4096),r,s,a,c;this.is_bit64=new Promise(async(b,v)=>{try{if(a=await ys.promises.open(t,"r"),this.close=()=>a?.close(),await f(0)!==23117)throw Error("no MS-DOS stub");if(r=await l(60),await l(r)!==17744)throw Error("no PE file");s=r+24,b(await f(s)===523)}catch(d){return a?.close(),v(d)}}),this.reader=()=>c??=new Promise(async(b,v)=>{try{let h=function(ge){let Ne=B.find(Re=>ge>=Re.virtualAddress);if(!Ne||ge>=Ne.virtualAddress+Ne.sizeOfRawData)throw Error("out of range");return ge-Ne.virtualAddress+Ne.pointerToRawData};var d=h;let w=await this.is_bit64,D=s+(w?112:96),$=await l(D-4),C=await f(r+6),g=await f(r+20),y=Buffer.alloc(40*C),{dataDirectory:u,sectionTable:B}=this;if((await a.read(y,0,y.length,s+g)).bytesRead!==y.length)throw Error("bad PE file");for(let ge=0,Ne=0;ge<C;ge++,Ne+=40){let Re=y.readUInt32LE(Ne+12),W=y.readUInt32LE(Ne+16),U=y.readUInt32LE(Ne+20);B.push({virtualAddress:Re,sizeOfRawData:W,pointerToRawData:U})}if(this.sectionTable=B.sort((ge,Ne)=>Ne.virtualAddress-ge.virtualAddress),y=Buffer.alloc(8*$),(await a.read(y,0,y.length,D)).bytesRead!==y.length)throw Error("bad PE file");for(let ge=0,Ne=0;ge<$;ge++,Ne+=8)u.push({virtualAddress:y.readUInt32LE(Ne),size:y.readUInt32LE(Ne+4)});b({readUInt16LE:f,readUInt32LE:l,RVA2Offset:h,read:p,readString:le});async function le(ge){return await a.read(i,0,i.length,h(ge)),i.subarray(0,i.indexOf(Buffer.alloc(1))).toString()}}catch(w){return this.close(),v(w)}});async function p(b,v){return(await a.read(Buffer.alloc(v),0,v,b)).buffer}async function f(b){return await a.read(i,0,2,b),i.readUInt16LE(0)}async function l(b){return await a.read(i,0,4,b),i.readUInt32LE(0)}}async getExport(){let t=await this.reader(),n=this.dataDirectory[0];if(!n?.virtualAddress)return;if(n.data)return n.data;let i=n.virtualAddress,r=i+n.size,s=await t.read(t.RVA2Offset(i),40),a=s.readUInt32LE(12),c=s.readUInt32LE(16),p=s.readUInt32LE(20),f=s.readUInt32LE(24),l=t.RVA2Offset(s.readUInt32LE(28)),b=t.RVA2Offset(s.readUInt32LE(32)),v=t.RVA2Offset(s.readUInt32LE(36)),d={Module:await t.readString(a),Functions:[],OrdinalBase:c},w={};for(let D=0;D<f;D++){let $=await t.readUInt32LE(b),C=await t.readUInt16LE(v),g=await t.readUInt32LE(l+C*4);b+=4,v+=2,w[C]=!0;let y=g>i&&g<r?await t.readString(g):"0x"+(g+4294967296).toString(16).substring(1);d.Functions.push({Name:await t.readString($),EntryPoint:y,Ordinal:c+C})}for(let D=0;f<p;D++,f++){for(;w[D];)D++;let $=await t.readUInt32LE(l+D*4),C=$>i&&$<r?await t.readString($):"0x"+($+4294967296).toString(16).substring(1);w[D]=!0,d.Functions.splice(D,0,{Name:"",EntryPoint:C,Ordinal:c+D})}return n.data=d}async getImport(){let t=await this.reader(),n=this.dataDirectory[1];if(!n?.virtualAddress)return;if(n.data)return n.data;let i=t.RVA2Offset(n.virtualAddress),r=await t.readUInt32LE(i+12),s=await t.readUInt32LE(i+16),a=4,c=i,p,f,l,b;await this.is_bit64?(a=8,f=BigInt(65535),l=BigInt("0x8000000000000000"),p=async d=>(await t.read(d,8)).readBigUInt64LE()):(f=65535,l=2147483648,p=t.readUInt32LE);let v={};for(;s;){let d=await t.readString(r),w=v[d]??=[];for(let D=0;b=await p(t.RVA2Offset(s+D*a));D++)w.push(b&l?`Ordinal#${b&f}`:await t.readString(Number(b)+2));c+=20,r=await t.readUInt32LE(c+12),s=await t.readUInt32LE(c+16)}return n.data=v}async getResource(...t){let n=await this.reader(),i=this.dataDirectory[2];if(!i?.virtualAddress)return;if(t.length===1&&this.resource[t[0]])return this.resource[t[0]];let r=n.RVA2Offset(i.virtualAddress),s=[r],a={};return t.forEach(b=>this.resource[b]??=a[b]=[]),a[10]&&=this.resource[10]={},await c(r),t.forEach(b=>a[b]??=this.resource[b]),t.length===1?a[t[0]]:a;async function c(b,v=0){let d={NumberOfNamedEntries:await n.readUInt16LE(b+12),NumberOfIdEntries:await n.readUInt16LE(b+14)},w=[],D=d.NumberOfIdEntries+d.NumberOfNamedEntries;b+=16;for(let $=0;$<D;$++,b+=8){let C=await n.readUInt32LE(b);if(v===0&&!a[C&65535])continue;let g=await n.readUInt32LE(b+4),y={name:C,id:C&65535,pad:C&4294901760,nameOffset:C&2147483647,offsetToData:g,dataIsDirectory:!!((g&2147483648)>>31),offsetToDirectory:g&2147483647},u,B;if((C&2147483648)>>31){let h=r+y.nameOffset,le=await n.readUInt16LE(h);u=(await n.read(h+2,le*2)).toString("utf16le")}else B=C;if(y.dataIsDirectory){if(s.includes(r+y.offsetToDirectory))break;s.push(r+y.offsetToDirectory);let h=await c(r+y.offsetToDirectory,v+1);if(h===void 0)break;w.push({struct:y,id:B,name:u,directory:h})}else{let h=r+y.offsetToDirectory,ge={struct:{offsetToData:await n.readUInt32LE(h),size:await n.readUInt32LE(h+4),codePage:await n.readUInt32LE(h+8),reserved:await n.readUInt32LE(h+12)},lang:y.name&1023,subLang:y.name>>10};w.push({struct:y,id:B,name:u,data:ge})}if(v===0){let h=w[w.length-1];if(y.id===16){let le=h.directory?.entries[0].directory?.entries??[];for(let ge of le){let Ne=ge.data?.struct;Ne&&await p(a[16],Ne)}}else if(y.id===24){let le=h.directory?.entries[0].directory?.entries??[];for(let ge of le){let Ne=ge.data?.struct;Ne?.size&&a[24].push(await f(Ne))}}else if(y.id===10){a[10]instanceof Array&&(a[10]={});let le=a[10];for(let ge of h.directory?.entries??[]){let Ne=ge.name??`#${ge.id}`,Re=ge.directory?.entries?.pop()?.data?.struct;Re&&(le[Ne.toLowerCase()]=await n.read(n.RVA2Offset(Re.offsetToData),Re.size))}}else throw Error("not handled")}}return{struct:d,entries:w}}async function p(b,v){let d=0,w=0,D=v.offsetToData,$=await n.read(n.RVA2Offset(D),v.size);u(w),w=l(2+d,D);let C={Signature:$.readUInt32LE(w),StrucVersion:$.readUInt32LE(w+4),FileVersionMS:$.readUInt32LE(w+8),FileVersionLS:$.readUInt32LE(w+12),ProductVersionMS:$.readUInt32LE(w+16),ProductVersionLS:$.readUInt32LE(w+20),FileFlagsMask:$.readUInt32LE(w+24),FileFlags:$.readUInt32LE(w+28),FileOS:$.readUInt32LE(w+32),FileType:$.readUInt32LE(w+36),FileSubtype:$.readUInt32LE(w+40),FileDateMS:$.readUInt32LE(w+44),FileDateLS:$.readUInt32LE(w+48)},g={StringTable:[],Version:[C.FileVersionMS>>16,C.FileVersionMS&65535,C.FileVersionLS>>16,C.FileVersionLS&65535].join(".")};b.push(g),w=l(w+52,D);let y=u(w);if(y.Key==="StringFileInfo"&&[0,1].includes(y.Type)&&y.ValueLength===0){let B=l(2+d,D);for(;;){let h=u(B),le={};for(g.StringTable.push(le),w=l(2+d,D);w<B+h.Length;){let ge=w,Ne=u(w);w=l(2+d,D);let Re=u(w,!1);Ne.Length===0?w=B+h.Length:w=l(ge+Ne.Length,D),le[Ne.Key]=Re.Key}if(w=l(h.Length+B,D),w===B||w>=y.Length)break;B=w}}function u(B,h=!0){let le={};return h&&(le={Length:$.readUInt16LE(B),ValueLength:$.readUInt16LE(B+2),Type:$.readUInt16LE(B+4)},B+=6),d=($.indexOf(Buffer.alloc(2),B)+1>>1)*2,{...le,Key:$.subarray(B,d).toString("utf16le")}}}async function f(b){return(await n.read(n.RVA2Offset(b.offsetToData),b.size)).toString()}function l(b,v){return(b+v+3&4294967292)-(v&4294967292)}}};async function Q_(e,t){let n,i="",r,s=[""];for(;;)try{if(!(0,ys.existsSync)(e))throw Error();n=new $o(e);let a=await n.is_bit64;if(i&&t!==void 0&&a!==t)throw n.close(),Error();return n}catch(a){if(a instanceof Error||a.errno===-4058){if(!r){if(e.includes(":")||!(r=process.env.Path?.split(";")))return;t===!1&&r.unshift("C:\\Windows\\SysWOW64\\"),i=e,i.toLowerCase().endsWith(".dll")||s.push(".dll")}let c;e:for(;(c=r.pop())!==void 0;)for(let p of s)if(c&&(0,ys.existsSync)(e=(c.endsWith("/")||c.endsWith("\\")?c:c+"\\")+i+p))break e;if(!c)return}}}function ks(e){var t,n,i;if(Array.isArray(e)){for(n=Array(t=e.length);t--;)n[t]=(i=e[t])&&typeof i=="object"?ks(i):i;return n}if(Object.prototype.toString.call(e)==="[object Object]"){n={};for(t in e)t==="__proto__"?Object.defineProperty(n,t,{value:ks(e[t]),configurable:!0,enumerable:!0,writable:!0}):n[t]=(i=e[t])&&typeof i=="object"?ks(i):i;return n}return e}var Bk="ahk2-language-server",Vo=new fr.TextDocuments(Hn),Nt=V_((0,fr.createConnection)(fr.ProposedFeatures.all)),Wo=new Set,df=!1,cf=!1,J_="";dc[b_]=e=>pf(e[0].replace(/^[A-Z]:/,t=>t.toLowerCase()));Nt.onInitialize(async e=>{let t=e.capabilities;df=!!(t.workspace&&t.workspace.configuration),cf=!!(t.workspace&&t.workspace.workspaceFolders);let n={serverInfo:{name:Bk},capabilities:{textDocumentSync:{change:fr.TextDocumentSyncKind.Incremental,openClose:!0},completionProvider:{resolveProvider:!1,triggerCharacters:[".","#","*","@"]},signatureHelpProvider:{triggerCharacters:["(",","," "]},documentSymbolProvider:!0,definitionProvider:!0,documentFormattingProvider:!0,documentRangeFormattingProvider:!0,documentOnTypeFormattingProvider:{firstTriggerCharacter:"}",moreTriggerCharacter:[`
`,...Object.keys(ss)]},executeCommandProvider:{commands:Object.keys(dc)},hoverProvider:!0,foldingRangeProvider:!0,colorProvider:!0,codeActionProvider:!0,renameProvider:{prepareProvider:!0},referencesProvider:{workDoneProgress:!0},semanticTokensProvider:{legend:{tokenTypes:Object.values(Gi).filter(s=>typeof s=="string"),tokenModifiers:Object.values(us).filter(s=>typeof s=="string")},full:!0,range:!0},workspaceSymbolProvider:!0}};cf&&(e.workspaceFolders?.forEach(s=>Wo.add(s.uri.toLowerCase()+"/")),n.capabilities.workspace={workspaceFolders:{supported:!0}});let i,r=process.env;if(r.AHK2_LS_CONFIG)try{i=JSON.parse(r.AHK2_LS_CONFIG)}catch{}return e.initializationOptions&&(i=Object.assign(i??{},e.initializationOptions)),U_((0,wc.resolve)(__dirname,"../..")),B_((i?at("locale",i):void 0)??e.locale),Ir.get_RCDATA=zk,Ir.get_DllExport=eb,Ir.get_ahkProvider=X_,zm(),bc(),i&&nf(i),at("v2.file.interpreterPath")||ei("v2.file.interpreterPath",""),await pf(Li(at("v2.file.interpreterPath")))||lf(Po.ahkpatherr()),yc(Wo),Ni(),n});Nt.onInitialized(()=>{df&&Nt.client.register(fr.DidChangeConfigurationNotification.type),cf&&Nt.workspace.onDidChangeWorkspaceFolders(e=>{e.removed.forEach(t=>Wo.delete(t.uri.toLowerCase()+"/")),e.added.forEach(t=>Wo.add(t.uri.toLowerCase()+"/")),yc(Wo)}),eb(["user32","kernel32","comctl32","gdi32"].map(e=>`C:\\Windows\\System32\\${e}.dll`)).then(e=>pc.push(...e))});Nt.onDidChangeConfiguration(async e=>{let t=e?.settings;if(console.log("Configuration changed"),df&&!t&&(t=await Nt.workspace.getConfiguration(Ja)),!t){Nt.window.showWarningMessage("Failed to obtain the configuration");return}console.log("New configuration:",t);let n=ks(at());nf(t);let i=at("exclude")!==at("exclude",n);yc(Wo);let r=at("v2.file.interpreterPath");r!==at("v2.file.interpreterPath",n)&&await pf(Li(r))&&Nt.sendRequest(p_,[r]),(i||at("v2.general.librarySuggestions")!==at("v2.general.librarySuggestions",n))&&(Ao()&&(i||!Ao(n))&&Z_(),Ui()&&(i||!Ui(n))&&(console.log("Parsing local libraries"),Vo.all().forEach(s=>hf(s.uri.toLowerCase())))),at("v2.general.syntaxes")!==at("v2.general.syntaxes",n)&&(bc(),Ni(),Si&&(Ni("ahk_h"),Ni("winapi",4)))});Nt.onDidChangeWatchedFiles(e=>{let t,n;for(let i of e.changes)switch(i.type){case 2:(n=se[i.uri.toLowerCase()])?.actived===!1&&(Hn.update(n.document,[{text:tf(n.fsPath)??""}],0),n.update());break;case 3:(n=se[t=i.uri.toLowerCase()])&&(n.close(!0),delete se[t]);break}});Vo.onDidOpen(e=>{let t=J_===e.document.uri,n=e.document.uri.toLowerCase(),i=se[n];if(console.log(`Document opened: ${n}`),ri(n)){console.log(`Skipping: ${n}`);return}i?i.document=e.document:se[n]=i=new Un(e.document),Object.defineProperty(i.include,"",{value:"",enumerable:!1}),i.actived=!0,t&&(i.actionWhenV1Detected="Continue"),Ui()&&hf(n).then(()=>i.last_diags&&Object.keys(i.included).length&&i.update())});Vo.onDidClose(e=>se[e.document.uri.toLowerCase()]?.close());Vo.onDidChangeContent(e=>se[e.document.uri.toLowerCase()]?.update());Nt.onCodeAction(u_);Nt.onCompletion(S_);Nt.onColorPresentation(f_);Nt.onDocumentColor(d_);Nt.onDefinition(D_);Nt.onDocumentFormatting(A_);Nt.onDocumentRangeFormatting(P_);Nt.onDocumentOnTypeFormatting(E_);Nt.onDocumentSymbol(Di);Nt.onFoldingRanges(e=>se[e.textDocument.uri.toLowerCase()]?.foldingranges);Nt.onHover(O_);Nt.onPrepareRename(M_);Nt.onReferences(N_);Nt.onRenameRequest(I_);Nt.onSignatureHelp(K_);Nt.onExecuteCommand(C_);Nt.onWorkspaceSymbol($_);Nt.languages.semanticTokens.on(hs);Nt.languages.semanticTokens.onRange(q_);Nt.onRequest(h_,e=>R_(e));Nt.onRequest(g_,ff);Nt.onRequest(m_,e=>se[e.toLowerCase()]?.document.getText());Nt.onRequest(__,x_);Nt.onNotification("onDidCloseTextDocument",e=>{e.id==="ahk2"?se[e.uri.toLowerCase()]?.close(!0):J_=e.uri});Vo.listen(Nt);Nt.listen();async function lf(e){if(!at("commands")?.includes(Xu))return Nt.window.showErrorMessage(e);await Nt.window.showErrorMessage(e,{title:"Select AHK v2 interpreter"})&&Nt.sendRequest(Xu,[T_])}async function Tc(e=!1,t=!0){let n=`
	#NoTrayIcon
	#Warn All, Off
	s := "", Append := SubStr(A_AhkVersion, 1, 1) = "1" ? "FileAppend2" : "FileAppend"
	for _, k in ${JSON.stringify([...Xa,...Qa])}
		try if SubStr(k, 1, 2) = "a_" && !IsObject(v := %k%)
			s .= SubStr(k, 3) "|" v "\`n"
	%Append%(s, "*", "utf-8")
	FileAppend2(text, file, encode) {
		FileAppend %text%, %file%, %encode%
	}`,i=0,r=z_(n);if(r===void 0)return t?Tc(e,!1):(lf(Po.ahkpatherr()),!1);if(!(r=r.trim())){let a=qr;if((await ff([a]))[0].endsWith("[UIAccess]")){let c=!1,p=a.replace(/_uia\.exe$/i,".exe");if(i=2,a!==p&&(p=Li(p,!0))&&!(await ff([p]))[0].endsWith("[UIAccess]")&&(bs(p),(c=await Tc(e))&&(i=0),bs(a)),i&&Nt.window.showWarningMessage(Po.uialimit()),await s(),c)return!0}else i=1;return i!==2&&t?Tc(e,!1):(On.mydocuments||Nt.window.showErrorMessage(Po.getenverr()),!1)}if(Object.assign(On,Object.fromEntries(r.replace(/|[A-Z]:\\/g,a=>a.toLowerCase()).split(`
`).map(a=>a.split("|")))),On.ahkpath??=qr,H_(On.ahkversion??="2.0.0"),On.ahkversion.startsWith("1.")&&lf(Po.versionerr()),!e||!li.length){li.length=0,li.push(On.mydocuments+"\\AutoHotkey\\Lib\\",On.ahkpath.replace(/[^\\/]+$/,"Lib\\"));let a;for(a of Object.values(In))a.islib=Y_(a.fsPath)}if(On.threadid?Si||(of(!0),e=!1,Ni("ahk2_h"),Ni("winapi",4)):Si&&(of(!1),e=!1,bc(),Ni()),Object.assign(On,{index:"0",clipboard:"",threadid:""}),await s(),e)return!0;for(let a in se){let c=se[a];c.d||(c.initLibDirs(),(Object.keys(c.include).length||c.diagnostics.length)&&c.update())}return W_(),Ao()&&Z_(),!0;async function s(){let a=new $o(qr);try{vs=await a.getResource(10)}catch(c){console.error(c)}finally{a.close()}}}function uf(e){return Object.assign(Object.values(e.declaration).filter(t=>t.kind===fr.SymbolKind.Class||t.kind===fr.SymbolKind.Function),{fsPath:e.fsPath,islib:Y_(e.fsPath)})}async function Z_(){let e,t,n,i,r;console.log("Parsing user libraries"),console.log(`Libraries:
	`,li.join(`
	`));for(e of li)for await(t of _s(e))if(!In[n=pn.file(t).toString().toLowerCase()]){if(!(i=se[n])&&(!(r=ui(t))||(i=new Un(r)).d||(i.parseScript(),i.maybev1)))continue;In[n]=uf(i),await sf(50)}}function Y_(e){e=e.toLowerCase();for(let t of li)if(e.startsWith(t.toLowerCase()))return!0;return!1}async function Hk(e,t){let n=!!e&&(0,wc.resolve)(e,"..").toLowerCase()===(0,wc.resolve)(t,"..").toLowerCase();return await Tc(n)?(n||Vo.all().forEach(i=>{let r=se[i.uri.toLowerCase()];r&&(r.initLibDirs(r.scriptdir),Ui()&&hf(r.uri))}),!0):!1}async function pf(e){let t=qr;return!e||e.toLowerCase()===t.toLowerCase()?!1:(bs(e),await Hk(t,e)||bs(t),!0)}async function hf(e){console.log(`Parsing project: ${e}`);let t=se[e];if(!t||!e.startsWith("file:"))return;t.d||(In[e]??=uf(t));let n=t.workspaceFolder,i=!1,r,s;n?(n=pn.parse(n).fsPath,i=!0):n=t.scriptdir+"\\lib";for await(r of _s(n))if(!In[e=pn.file(r).toString().toLowerCase()]){if(!(t=se[e])){if(!(s=ui(r))||(t=new Un(s)).d||(t.parseScript(),t.maybev1))continue;i&&(Io(se[e]=t,t.scriptdir),Ci(t))}In[e]=uf(t),await sf(50)}}async function ff(e){return Promise.all(e.map(async t=>{let n;try{n=new $o(t);let i=(await n.getResource(16))[0].StringTable[0];if(i.ProductName?.toLowerCase().startsWith("autohotkey")){let r=await n.is_bit64,s=(await n.getResource(24))[0]?.replace(/<!--[\s\S]*?-->/g,"")??"",a=`${i.ProductName} ${i.ProductVersion??"unknown version"} ${r?"64":"32"} bit`;return s.includes('uiAccess="true"')&&(a+=" [UIAccess]"),a}}catch(i){console.error(i)}finally{n?.close()}return"unknown version"}))}async function eb(e,t=!1){let n={};for(let i of e){let r=await Q_(i,On.ptrsize==="8"?!0:On.ptrsize==="4"?!1:void 0);if(r)try{if((await r.getExport())?.Functions.forEach(s=>n[s.Name]=!0),t)break}finally{r.close()}}return delete n[""],Object.keys(n)}var vs;function zk(e){let t=Li(qr,!0);if(!t)return;if(!e)return{uri:"",path:"",paths:Object.keys(vs??{})};let n=`${t.toLowerCase()}:${e}`,i=pn.from({scheme:"ahkres",path:n}).toString().toLowerCase();if(se[i])return{uri:i,path:n};if(!e||!vs)return;let r=vs[e];if(r)try{return(se[i]=new Un(Hn.create(i,"ahk2",-10,new TextDecoder("utf8",{fatal:!0}).decode(r)))).parseScript(),{uri:i,path:n}}catch{delete vs[e]}}
//# sourceMappingURL=server.js.map
